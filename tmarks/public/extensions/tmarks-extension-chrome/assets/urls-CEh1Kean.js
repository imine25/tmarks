var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const t={provider:"openai",apiKeys:{},apiUrls:{},model:"gpt-4o",enableCustomPrompt:!1,customPrompt:void 0},a={apiUrl:"",apiKey:""},o={theme:"auto",autoSync:!0,syncInterval:24,maxSuggestedTags:5,defaultVisibility:"public",enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1},n=()=>({aiConfig:{provider:t.provider,apiKeys:{...t.apiKeys},apiUrls:{...t.apiUrls},model:t.model,enableCustomPrompt:t.enableCustomPrompt,customPrompt:t.customPrompt,savedConnections:{}},bookmarkSite:{...a},preferences:{...o}});class s{static STORAGE_KEY="config";static configCache=null;static initialized=!1;static cloneSavedConnections(e){const i={};return e?(Object.entries(e).forEach(([e,t])=>{Array.isArray(t)&&(i[e]=t.map(e=>({...e})))}),i):i}static mergeWithDefaults(e){const i=n();return e?{aiConfig:{provider:e.aiConfig?.provider||i.aiConfig.provider,apiKeys:{...i.aiConfig.apiKeys,...e.aiConfig?.apiKeys||{}},apiUrls:{...i.aiConfig.apiUrls,...e.aiConfig?.apiUrls||{}},model:e.aiConfig?.model??i.aiConfig.model,customPrompt:e.aiConfig?.customPrompt??i.aiConfig.customPrompt,enableCustomPrompt:e.aiConfig?.enableCustomPrompt??i.aiConfig.enableCustomPrompt,savedConnections:{...i.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}}},bookmarkSite:{apiUrl:e.bookmarkSite?.apiUrl??i.bookmarkSite.apiUrl,apiKey:e.bookmarkSite?.apiKey??i.bookmarkSite.apiKey},preferences:{theme:e.preferences?.theme??i.preferences.theme,autoSync:e.preferences?.autoSync??i.preferences.autoSync,syncInterval:e.preferences?.syncInterval??i.preferences.syncInterval,maxSuggestedTags:e.preferences?.maxSuggestedTags??i.preferences.maxSuggestedTags,defaultVisibility:e.preferences?.defaultVisibility??i.preferences.defaultVisibility,enableAI:e.preferences?.enableAI??i.preferences.enableAI,defaultIncludeThumbnail:e.preferences?.defaultIncludeThumbnail??i.preferences.defaultIncludeThumbnail,defaultCreateSnapshot:e.preferences?.defaultCreateSnapshot??i.preferences.defaultCreateSnapshot}}:i}static ensureInitialized(){this.initialized||(chrome.storage.onChanged.addListener((e,i)=>{if("local"!==i)return;const t=e[this.STORAGE_KEY];t&&(this.configCache=this.mergeWithDefaults(t.newValue))}),this.initialized=!0)}static async loadConfig(){if(this.ensureInitialized(),this.configCache)return this.configCache;try{const e=await chrome.storage.local.get([this.STORAGE_KEY]),i=this.mergeWithDefaults(e[this.STORAGE_KEY]);return this.configCache=i,i}catch(e){const i=n();return this.configCache=i,i}}static async saveConfig(e){try{const i=await this.loadConfig();let t;t=Boolean(e.aiConfig&&Object.prototype.hasOwnProperty.call(e.aiConfig,"savedConnections"))?this.cloneSavedConnections(e.aiConfig?.savedConnections):this.cloneSavedConnections({...i.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}});const{savedConnections:a,...o}=e.aiConfig||{},n={...i,...e,aiConfig:{...i.aiConfig,...o,savedConnections:t},bookmarkSite:{...i.bookmarkSite,...e.bookmarkSite||{}},preferences:{...i.preferences,...e.preferences||{}}};await chrome.storage.local.set({[this.STORAGE_KEY]:n}),this.configCache=this.mergeWithDefaults(n)}catch(i){throw i}}static async getAIApiKey(){const e=await this.loadConfig(),i=e.aiConfig.provider;return e.aiConfig.apiKeys[i]}static async setAIApiKey(e,i){const t=await this.loadConfig();await this.saveConfig({aiConfig:{...t.aiConfig,apiKeys:{...t.aiConfig.apiKeys,[e]:i}}})}static async getBookmarkSiteApiKey(){return(await this.loadConfig()).bookmarkSite.apiKey}static async getBookmarkSiteApiUrl(){return(await this.loadConfig()).bookmarkSite.apiUrl}static async getTMarksConfig(){const e=await this.loadConfig();return{bookmarkApiUrl:e.bookmarkSite.apiUrl,bookmarkApiKey:e.bookmarkSite.apiKey}}static async clear(){await chrome.storage.local.clear(),this.configCache=null}}const r={DEFAULT_BASE_URL:"https://tmarks.669696.xyz",DEFAULT_API_BASE:"https://tmarks.669696.xyz/api"};function c(e){const i=(e||r.DEFAULT_BASE_URL).replace(/\/$/,"");return{BASE_URL:i,API_BASE:`${i}/api`,WEB_APP:`${i}/`,TAB_GROUPS:`${i}/tab`}}function p(e){if(!e)return r.DEFAULT_API_BASE;const i=e.trim().replace(/\/+$/,"");return i.endsWith("/api")?i:`${i}/api`}const l={OPENAI:"https://api.openai.com/v1",CLAUDE:"https://api.anthropic.com/v1",DEEPSEEK:"https://api.deepseek.com/v1",ZHIPU:"https://open.bigmodel.cn/api/paas/v4",MODELSCOPE:"https://api-inference.modelscope.cn/v1",SILICONFLOW:"https://api.siliconflow.cn/v1",IFLOW:"https://apis.iflow.cn/v1"},f={OPENAI:"https://platform.openai.com/api-keys",CLAUDE:"https://console.anthropic.com/",DEEPSEEK:"https://platform.deepseek.com/api_keys",ZHIPU:"https://open.bigmodel.cn/usercenter/apikeys",MODELSCOPE:"https://www.modelscope.cn/my/myaccesstoken",SILICONFLOW:"https://cloud.siliconflow.cn/account/ak",IFLOW:"https://console.xfyun.cn/services/iat"},m={GOOGLE_FAVICON:"https://www.google.com/s2/favicons"},g={DEFAULT_PAGE_SIZE:100,MAX_PAGES:100};export{l as A,m as E,g as P,s as S,r as T,f as a,i as b,e as c,c as g,p as n};
