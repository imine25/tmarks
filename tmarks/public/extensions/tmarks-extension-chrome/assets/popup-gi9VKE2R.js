import"./modulepreload-polyfill-YP0FEG5d.js";import{k as e,r as t,l as a,m as r,P as o,L as s,F as n,n as l,R as i}from"./react-vendor-1ZtHTM4k.js";import{a as c,b as d,E as p,S as b,L as u,u as x}from"./index-CjfICgkq.js";import{t as m,S as v,g,i as h,n as f,a as j}from"./urls-T86wRnwx.js";import{l as _}from"./vendor-BSnXPJO2.js";import{g as N,c as w,a as y}from"./tab-collection-BHctueL_.js";import{c as k}from"./index-3rMDm5L8.js";import"./dexie-BAhLzSXZ.js";import"./index-NQ3jknxk.js";function C(e){const t="inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-semibold border transition-all duration-200 active:scale-95";return"bw"===e?`${t} border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] hover:opacity-90`:"mono"===e?`${t} border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-message-info-bg)] text-[var(--tab-message-info-icon)] hover:opacity-90`:`${t} border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-surface)] text-[var(--tab-message-info-icon)] shadow-sm hover:bg-[color:var(--tab-surface-muted)]`}function L(e,t){const a="border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] text-[var(--tab-text)] hover:bg-[color:var(--tab-surface-muted)]",r="border border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] text-[var(--tab-message-success-icon)] shadow-sm hover:opacity-90";return"bw"===e?t?"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] shadow-sm hover:opacity-90":"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-unselected-bg)] text-[var(--tab-tag-unselected-text)] hover:bg-[color:var(--tab-surface-muted)]":t?r:a}function S({tags:t,selectedTags:a,onToggle:r,theme:o="classic"}){return e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(t=>{const s=a.includes(t.name),n=t.isNew,l=function(e,t,a){const r="border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] text-[var(--tab-text)] hover:bg-[color:var(--tab-surface-muted)]",o="border border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-message-info-bg)] text-[var(--tab-message-info-icon)] hover:opacity-90",s="border border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] text-[var(--tab-message-success-icon)] hover:opacity-90",n="border border-[color:var(--tab-message-warning-border)] bg-[color:var(--tab-message-warning-bg)] text-[var(--tab-message-warning-icon)] hover:opacity-90";return"bw"===e?t?"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] hover:opacity-90":"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-unselected-bg)] text-[var(--tab-tag-unselected-text)] hover:bg-[color:var(--tab-surface-muted)]":t?a?n:s:a?o:r}(o,s,n);return e.jsxs("button",{onClick:()=>r(t.name),className:`inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-medium transition-all duration-200 active:scale-95 ${l}`,children:[e.jsx("span",{className:"truncate max-w-[110px]",children:t.name}),n&&e.jsx("span",{className:"ml-1 text-[10px] italic uppercase tracking-widest "+("bw"===o?s?"text-[var(--tab-tag-selected-text)]":"text-[var(--tab-tag-new-indicator)]":s?"text-[var(--tab-message-warning-icon)]":"text-[var(--tab-message-info-icon)]"),children:` ${m("tag_new")} `})]},t.name)})})}function M({title:o,url:s,description:n,thumbnail:l,thumbnails:i,favicon:c,onThumbnailChange:d}){const[p,b]=t.useState(0),[u,x]=t.useState(!1),v=i&&i.length>0?i:l?[l]:[],g=v[p],h=v.length>1;return e.jsxs("div",{className:"bg-[color:var(--tab-surface)] border border-[color:var(--tab-border)] rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200",children:[g&&!u&&e.jsxs("div",{className:"relative h-32 bg-[color:var(--tab-surface-muted)] group",children:[e.jsx("img",{src:g,alt:"",className:"w-full h-full object-cover",onError:e=>{x(!0),e.currentTarget.style.display="none"}}),h&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const e=p>0?p-1:v.length-1;b(e),x(!1),d&&v[e]&&d(v[e])},className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:opacity-90 active:scale-95",title:m("newtab_prev"),children:e.jsx(a,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{const e=p<v.length-1?p+1:0;b(e),x(!1),d&&v[e]&&d(v[e])},className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:opacity-90 active:scale-95",title:m("newtab_next"),children:e.jsx(r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute bottom-2 right-2 px-2 py-1 rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[p+1," / ",v.length]})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[c&&e.jsx("img",{src:c,alt:"",className:"w-5 h-5 flex-shrink-0 mt-0.5 rounded",onError:e=>{e.currentTarget.style.display="none"}}),e.jsx("h3",{className:"flex-1 text-base font-semibold text-[var(--tab-text)] line-clamp-2 "+(l&&!c?"text-center":""),children:o})]}),e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] truncate",title:s,children:s}),n&&e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] line-clamp-3",children:n})]})]})}function E({message:t}){return e.jsx("div",{className:"bg-[color:var(--tab-message-info-bg)] border border-[color:var(--tab-message-info-border)] rounded-lg p-3 shadow-lg animate-in slide-in-from-top-5 fade-in duration-300 text-[var(--tab-message-info-icon)]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-[color:var(--tab-message-info-icon-bg)] rounded-full p-1.5 flex-shrink-0",children:e.jsxs("svg",{className:"w-5 h-5 text-[var(--tab-message-info-icon)] animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("div",{className:"flex-1 pt-0.5",children:[e.jsx("p",{className:"text-sm font-medium",children:t}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})]})})}function B({bookmark:a,newTags:r,onUpdateTags:o,onUpdateDescription:s,onCreateSnapshot:n,onCancel:l}){const[i,c]=t.useState(null),[d,p]=t.useState(""),[b,u]=t.useState(!1),[x,g]=t.useState(""),[h,f]=t.useState(a.description||"");t.useEffect(()=>{v.getBookmarkSiteApiUrl().then(e=>{if(e){const t=e.replace(/\/api$/,"");p(t)}})},[]);const j=a.tags.map(e=>e.name),_=r.filter(e=>!j.includes(e)),N=_.length>0;return e.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-[color:var(--tab-overlay)] backdrop-blur-sm animate-in fade-in duration-200",children:[b&&e.jsx("div",{className:"absolute top-4 left-0 right-0 px-4 z-50",children:e.jsx(E,{message:x})}),e.jsxs("div",{className:"bg-[color:var(--tab-surface)] rounded-xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"sticky top-0 bg-[color:var(--tab-surface)] border-b border-[color:var(--tab-border)] px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-[color:var(--tab-message-warning-icon-bg)] rounded-full p-2 flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-[var(--tab-message-warning-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--tab-text)]",children:m("bookmark_exists_title")}),e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] mt-1",children:m("bookmark_exists_desc")})]})]})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"bg-[color:var(--tab-surface-muted)] rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:m("label_title")}),e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:a.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:m("label_created_at")}),e.jsx("div",{className:"text-sm text-[var(--tab-text)]",children:(w=a.created_at,new Date(w).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),a.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:m("label_description")}),e.jsx("div",{className:"text-sm text-[var(--tab-text)]",children:a.description})]}),a.tags.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-2",children:m("label_existing_tags")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(t=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[color:var(--tab-message-info-icon-bg)] text-[var(--tab-message-info-icon)]",style:t.color?{backgroundColor:`${t.color}20`,color:t.color}:void 0,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-[var(--tab-text-muted)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-[var(--tab-text)]",children:a.has_snapshot?m("snapshot_count",String(a.snapshot_count||0)):m("no_snapshot")})]}),a.has_snapshot&&d&&e.jsxs("a",{href:`${d}/bookmarks/${a.id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-[var(--tab-message-info-icon)] hover:opacity-90 hover:bg-[color:var(--tab-message-info-icon-bg)] rounded transition-colors",onClick:e=>e.stopPropagation(),children:[m("view_snapshot"),e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})]}),N&&e.jsxs("div",{className:"bg-[color:var(--tab-message-success-bg)] border border-[color:var(--tab-message-success-border)] rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-[var(--tab-message-success-icon)] mb-2",children:m("label_new_tags_detected")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(t=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[color:var(--tab-message-success-icon-bg)] text-[var(--tab-message-success-icon)]",children:t},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)] mb-3",children:m("label_select_action")}),e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("snapshot"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"snapshot",checked:"snapshot"===i,onChange:()=>c("snapshot"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:m("action_create_snapshot")}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:m("action_create_snapshot_desc")})]})]}),N&&e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("update-tags"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"update-tags",checked:"update-tags"===i,onChange:()=>c("update-tags"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:m("action_add_tags")}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:m("action_add_tags_desc")})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("update-description"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"update-description",checked:"update-description"===i,onChange:()=>c("update-description"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:m("action_update_desc")}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:m("action_update_desc_desc")}),"update-description"===i&&e.jsx("textarea",{value:h,onChange:e=>f(e.target.value),placeholder:m("placeholder_new_desc"),rows:3,className:"mt-2 w-full rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-2 text-sm text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] resize-none",onClick:e=>e.stopPropagation()})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-[color:var(--tab-surface-muted)] border-t border-[color:var(--tab-border)] px-6 py-4 rounded-b-xl flex gap-3",children:[e.jsx("button",{onClick:l,disabled:b,className:"flex-1 px-4 py-2.5 text-sm font-medium text-[var(--tab-text)] bg-[color:var(--tab-surface)] border border-[color:var(--tab-border-strong)] rounded-lg hover:bg-[color:var(--tab-surface-muted)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m("btn_cancel")}),e.jsx("button",{onClick:async()=>{if("snapshot"===i){u(!0),g(m("msg_capturing"));try{await n(),g(m("msg_snapshot_success")),setTimeout(()=>{u(!1),l()},1500)}catch(e){g(m("msg_snapshot_failed")),setTimeout(()=>{u(!1)},2e3)}}else if("update-tags"===i){u(!0),g(m("msg_updating_tags"));try{await o(r),g(m("msg_tags_success")),setTimeout(()=>{u(!1),l()},1500)}catch(e){g(m("msg_tags_failed")),setTimeout(()=>{u(!1)},2e3)}}else if("update-description"===i){u(!0),g(m("msg_updating_desc"));try{await s(h.trim()),g(m("msg_desc_success")),setTimeout(()=>{u(!1),l()},1500)}catch(e){g(m("msg_desc_failed")),setTimeout(()=>{u(!1)},2e3)}}},disabled:!i||b,className:"flex-1 px-4 py-2.5 text-sm font-medium text-[var(--tab-popup-primary-text)] bg-[var(--tab-popup-primary-from)] rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m(b?"btn_processing":"btn_confirm")})]})]})]});var w}function F({onSelectBookmark:a,onSelectNewTab:r,onSelectTabCollection:o,onOpenOptions:s}){const[n,l]=t.useState(new Date),[i,p]=t.useState(g());t.useEffect(()=>{const e=setInterval(()=>{l(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{(async()=>{const e=await v.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");p(g(t))}})()},[]),t.useEffect(()=>{(async()=>{const e=await v.loadConfig();c(e?.preferences?.theme??"auto"),d(e?.preferences?.themeStyle??"tmarks")})()},[]);return e.jsx("div",{className:"relative h-[80vh] min-h-[580px] w-[380px] overflow-hidden bg-[var(--tab-popup-bg)] text-[var(--tab-popup-text)]",children:e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"px-5 pt-5 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] shadow-lg",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-primary-text)]",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})})}),e.jsx("h1",{className:"text-lg font-bold text-[var(--tab-popup-text)]",children:m("popup_title")})]}),e.jsx("button",{onClick:s,className:"flex h-9 w-9 items-center justify-center rounded-lg text-[var(--tab-popup-text-muted)] transition-all duration-200 hover:bg-[var(--tab-popup-action-neutral-bg)] active:scale-95",title:m("popup_open_settings"),children:e.jsxs("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),e.jsxs("main",{className:"flex-1 space-y-2 overflow-y-auto px-5 pb-[50px] bg-[var(--tab-popup-bg)]",children:[e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-[var(--tab-popup-text)]",children:[e.jsx("span",{className:"text-xs font-semibold",children:(e=>{const t=e.getHours();return m(t>=5&&t<12?"greeting_morning":t>=12&&t<14?"greeting_noon":t>=14&&t<18?"greeting_afternoon":t>=18&&t<22?"greeting_evening":"greeting_night")})(n)}),e.jsx("span",{className:"font-mono text-base font-bold tracking-wider",children:(b=n,`${String(b.getHours()).padStart(2,"0")}:${String(b.getMinutes()).padStart(2,"0")}:${String(b.getSeconds()).padStart(2,"0")}`)})]}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-xs text-[var(--tab-popup-text-muted)]",children:[e.jsx("span",{children:(e=>{const t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),o=m(`weekday_${e.getDay()}`);return h()?`${t}å¹´${a}æœˆ${r}æ—¥ ${o}`:`${o}, ${a}/${r}/${t}`})(n)}),h()&&e.jsx("span",{className:"text-[10px] text-[var(--tab-popup-text-muted)]",children:(e=>{if(!h())return"";const t=_.Lunar.fromDate(e);return`${t.getYearInGanZhi()}${t.getYearShengXiao()}å¹´${t.getMonthInChinese()}æœˆ${t.getDayInChinese()}`})(n)})]})]}),e.jsx("button",{onClick:a,className:"group w-full rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] p-4 text-left shadow-lg transition-all duration-200 hover:scale-[1.02] hover:border-[var(--tab-popup-section-blue-border)] hover:shadow-xl active:scale-[0.98]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-[var(--tab-popup-action-blue-text)] to-[var(--tab-popup-badge-indigo-text)] shadow-lg transition-transform duration-200 group-hover:scale-110",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-base font-semibold text-[var(--tab-popup-text)]",children:m("popup_save_bookmark")}),e.jsx("p",{className:"mt-0.5 text-xs text-[var(--tab-popup-text-muted)]",children:m("popup_save_bookmark_desc")}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5 text-[10px]",children:[e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-badge-blue-bg)] px-1.5 py-0.5 text-[var(--tab-popup-badge-blue-text)]",children:m("popup_ai_recommend")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-badge-indigo-bg)] px-1.5 py-0.5 text-[var(--tab-popup-badge-indigo-text)]",children:m("popup_smart_tags")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-badge-purple-bg)] px-1.5 py-0.5 text-[var(--tab-popup-badge-purple-text)]",children:m("popup_cloud_sync")})]})]}),e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-text-muted)] transition-transform duration-200 group-hover:translate-x-1 group-hover:text-[var(--tab-popup-action-blue-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{onClick:r,className:"group w-full rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] p-4 text-left shadow-lg transition-all duration-200 hover:scale-[1.02] hover:border-[var(--tab-popup-section-amber-border)] hover:shadow-xl active:scale-[0.98]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-[var(--tab-popup-action-amber-text)] to-[var(--tab-popup-primary-via)] shadow-lg transition-transform duration-200 group-hover:scale-110",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-base font-semibold text-[var(--tab-popup-text)]",children:m("popup_save_to_newtab")}),e.jsx("p",{className:"mt-0.5 text-xs text-[var(--tab-popup-text-muted)]",children:m("popup_save_to_newtab_desc")}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5 text-[10px]",children:[e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-badge-amber-bg)] px-1.5 py-0.5 text-[var(--tab-popup-badge-amber-text)]",children:m("popup_folder")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-section-amber-badge-bg)] px-1.5 py-0.5 text-[var(--tab-popup-section-amber-badge-text)]",children:m("popup_bookmark_bar")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-badge-amber-bg)] px-1.5 py-0.5 text-[var(--tab-popup-badge-amber-text)]",children:m("popup_local_sync")})]})]}),e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-text-muted)] transition-transform duration-200 group-hover:translate-x-1 group-hover:text-[var(--tab-popup-action-amber-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{onClick:o,className:"group w-full rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] p-4 text-left shadow-lg transition-all duration-200 hover:scale-[1.02] hover:border-[var(--tab-popup-section-emerald-border)] hover:shadow-xl active:scale-[0.98]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-[var(--tab-popup-action-emerald-text)] to-[var(--tab-popup-section-emerald-icon)] shadow-lg transition-transform duration-200 group-hover:scale-110",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-base font-semibold text-[var(--tab-popup-text)]",children:m("popup_collect_tabs")}),e.jsx("p",{className:"mt-0.5 text-xs text-[var(--tab-popup-text-muted)]",children:m("popup_collect_tabs_desc")}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5 text-[10px]",children:[e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-section-emerald-badge-bg)] px-1.5 py-0.5 text-[var(--tab-popup-section-emerald-badge-text)]",children:m("popup_batch_collect")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-section-emerald-badge-bg)] px-1.5 py-0.5 text-[var(--tab-popup-section-emerald-badge-text)]",children:m("popup_one_click_restore")}),e.jsx("span",{className:"rounded-md bg-[var(--tab-popup-section-emerald-badge-bg)] px-1.5 py-0.5 text-[var(--tab-popup-section-emerald-badge-text)]",children:m("popup_save_memory")})]})]}),e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-popup-text-muted)] transition-transform duration-200 group-hover:translate-x-1 group-hover:text-[var(--tab-popup-action-emerald-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})}),e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-purple-border)] bg-gradient-to-br from-[var(--tab-popup-section-purple-from)] to-[var(--tab-popup-section-blue-from)] p-3.5 shadow-lg",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--tab-popup-text)]",children:[e.jsx("span",{children:"ðŸ’¡"}),e.jsx("span",{children:m("popup_tips")})]}),e.jsxs("ul",{className:"mt-2.5 space-y-2 text-xs leading-relaxed text-[var(--tab-popup-text-muted)]",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 text-[var(--tab-popup-action-blue-text)]",children:"â€¢"}),e.jsx("span",{children:m("popup_tip_bookmark")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 text-[var(--tab-popup-action-amber-text)]",children:"â€¢"}),e.jsx("span",{children:m("popup_tip_newtab")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 text-[var(--tab-popup-action-emerald-text)]",children:"â€¢"}),e.jsx("span",{children:m("popup_tip_collect")})]})]})]})]}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-20 p-2 bg-[var(--tab-popup-footer-bg)]/80 backdrop-blur-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>chrome.tabs.create({url:i.WEB_APP}),className:"flex-1 flex items-center justify-center py-2.5 rounded-lg border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] hover:bg-[var(--tab-popup-action-neutral-bg)] transition-colors shadow-sm",children:e.jsx("span",{className:"text-sm text-[var(--tab-popup-text)]",children:m("popup_my_bookmarks")})}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:i.TAB_GROUPS}),className:"flex-1 flex items-center justify-center py-2.5 rounded-lg border border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] hover:bg-[var(--tab-popup-action-neutral-bg)] transition-colors shadow-sm",children:e.jsx("span",{className:"text-sm text-[var(--tab-popup-text)]",children:m("popup_my_collections")})})]})})]})});var b}function z({tabCount:a,groups:r,onConfirm:l,onCancel:i,onCreateFolder:c}){const[d,p]=t.useState("new"),[b,u]=t.useState(""),[x,v]=t.useState("__new__"),[g,h]=t.useState(""),[f,j]=t.useState(""),[_,N]=t.useState(!1),w=r.filter(e=>1===e.is_folder),y=r.filter(e=>0===e.is_folder);t.useEffect(()=>{"existing"===d&&y.length>0&&!b&&u(y[0].id),"folder"===d&&(w.length>0&&!x?v(w[0].id):0===w.length&&v("__new__"))},[d,y,w,b,x]);return e.jsx("div",{className:"fixed inset-0 bg-[color:var(--tab-overlay)] flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[color:var(--tab-surface)] rounded-2xl shadow-2xl w-full max-w-[680px] max-h-[520px] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-[color:var(--tab-border)] bg-[color:var(--tab-message-info-bg)]",children:[e.jsx("h2",{className:"text-base font-bold text-[var(--tab-text)]",children:m("collection_title")}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mt-0.5",children:m("collection_selected",String(a))})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-14 border-r border-[color:var(--tab-border)] bg-[color:var(--tab-surface-muted)] py-3 flex flex-col items-center space-y-2 overflow-y-auto",children:[e.jsx("button",{onClick:()=>p("new"),title:m("collection_create_group"),className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("new"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(o,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p("existing"),disabled:0===y.length,title:0===y.length?m("collection_no_groups"):m("collection_add_to_existing"),className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("existing"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":0===y.length?"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] opacity-50 cursor-not-allowed":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(s,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p("folder"),disabled:0===w.length,title:0===w.length?m("collection_no_folders"):m("collection_add_to_folder"),className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("folder"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":0===w.length?"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] opacity-50 cursor-not-allowed":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(n,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 p-5 overflow-y-auto bg-[color:var(--tab-surface)]",children:["new"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:m("collection_create_group")}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:m("collection_create_group_desc")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:m("collection_group_name_optional")}),e.jsx("input",{type:"text",placeholder:m("placeholder_group_name"),value:g,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]})]}),"existing"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:m("collection_add_to_existing")}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:m("collection_add_to_existing_desc")})]}),y.length>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:m("collection_select_target_group")}),e.jsx("select",{value:b,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent bg-[color:var(--tab-surface)] text-[var(--tab-text)]",children:y.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",m("group_item_count",String(t.item_count||0)),")"]},t.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-center",children:[e.jsx(s,{className:"w-10 h-10 text-[var(--tab-text-muted)] mb-2"}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)]",children:m("collection_no_groups")}),e.jsx("p",{className:"text-[10px] text-[var(--tab-text-muted)] mt-0.5",children:m("collection_no_groups_hint")})]})]}),"folder"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:m("collection_add_to_folder")}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:m("collection_add_to_folder_desc")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:m("collection_select_folder")}),e.jsxs("select",{value:x,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent bg-[color:var(--tab-surface)] text-[var(--tab-text)]",children:[e.jsx("option",{value:"__new__",children:m("collection_new_folder")}),w.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),"__new__"===x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:m("collection_folder_name")}),e.jsx("input",{type:"text",placeholder:m("placeholder_folder_name"),value:f,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:m("collection_new_group_name_optional")}),e.jsx("input",{type:"text",placeholder:m("placeholder_group_name"),value:g,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"px-5 py-3 border-t border-[color:var(--tab-border)] bg-[color:var(--tab-surface-muted)] flex justify-end space-x-2.5",children:[e.jsx("button",{onClick:i,disabled:_,className:"px-4 py-2 text-xs font-medium text-[var(--tab-text)] bg-[color:var(--tab-surface)] border border-[color:var(--tab-border-strong)] rounded-lg hover:bg-[color:var(--tab-surface-muted)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m("btn_cancel")}),e.jsx("button",{onClick:async()=>{const e={mode:d};if("existing"===d){if(!b)return void alert(m("alert_select_group"));e.targetId=b}else if("folder"===d)if("__new__"===x){const a=f.trim();if(!a)return void alert(m("alert_enter_folder_name"));if(!c)return void alert(m("alert_create_folder_unavailable"));try{N(!0);const t=await c(a);e.mode="folder",e.targetId=t.id,e.title=g.trim()||void 0}catch(t){return void alert(m("alert_create_folder_failed",t instanceof Error?t.message:m("error_unknown")))}finally{N(!1)}}else{if(!x)return void alert(m("alert_select_folder"));e.targetId=x,e.title=g.trim()||void 0}else e.title=g.trim()||void 0;l(e)},disabled:_,className:"px-4 py-2 text-xs font-medium text-[var(--tab-popup-primary-text)] bg-[var(--tab-popup-primary-from)] rounded-lg hover:opacity-90 shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:m(_?"btn_creating":"btn_confirm_collect")})]})]})})}function T({config:a,onBack:r}){const[o,s]=t.useState([]),[n,l]=t.useState(new Set),[i,c]=t.useState(!0),[d,x]=t.useState(!1),[v,g]=t.useState(null),[h,j]=t.useState(null),[_,C]=t.useState(!1),[L,S]=t.useState([]),[M,E]=t.useState(!1),[B,F]=t.useState([]);t.useEffect(()=>{T(),I()},[]);const T=async()=>{try{c(!0);const e=(await N()).filter(e=>e.id&&e.url&&!e.url.startsWith("chrome://")&&!e.url.startsWith("chrome-extension://")).map(e=>({id:e.id,title:e.title||"Untitled",url:e.url,favIconUrl:e.favIconUrl}));s(e),l(new Set(e.map(e=>e.id)))}catch(e){g(m("tab_collection_load_failed"))}finally{c(!1)}},I=async()=>{try{const e=k({baseUrl:f(a.apiUrl),apiKey:a.apiKey}),t=await e.tabGroups.getAllTabGroups();F(t)}catch(e){F([])}};return e.jsxs("div",{className:"relative h-[80vh] min-h-[620px] w-[380px] overflow-hidden rounded-b-2xl bg-[color:var(--tab-popup-bg)] text-[var(--tab-text)] shadow-2xl",children:[M&&e.jsx(z,{tabCount:n.size,groups:B,onConfirm:async e=>{E(!1),x(!0),g(null);try{const t=await w(a,n,e);t.success?(j(t.message||m("tab_collection_success")),S(Array.from(n)),C(!0)):g(t.error||m("tab_collection_failed"))}catch(t){g(t instanceof Error?t.message:m("tab_collection_failed"))}finally{x(!1)}},onCancel:()=>E(!1),onCreateFolder:async e=>{try{const t=k({baseUrl:f(a.apiUrl),apiKey:a.apiKey}),r=(await t.tabGroups.createFolder(e)).data.tab_group;return F([...B,r]),r}catch(t){throw new Error(t instanceof Error?t.message:m("tab_collection_create_folder_failed"))}}}),e.jsxs("div",{className:"pointer-events-none fixed top-0 left-0 right-0 z-50 px-4 pt-2 space-y-2",children:[v&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(p,{message:v,onDismiss:()=>g(null)})}),h&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(b,{message:h,onDismiss:()=>j(null)})})]}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-20 px-3 pt-2 pb-2.5 bg-[color:var(--tab-surface)] border-b border-[color:var(--tab-border)] shadow-sm rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-lg text-[var(--tab-text-muted)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",title:m("popup_back"),children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsx("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[color:var(--tab-message-success-bg)] px-2 py-1 text-[10px] text-[var(--tab-message-success-icon)] font-medium",children:m("tab_collection_total",String(o.length))}),e.jsx("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[color:var(--tab-message-success-bg)] px-2 py-1 text-[10px] text-[var(--tab-message-success-icon)] font-medium",children:m("tab_collection_selected",String(n.size))}),e.jsxs("div",{className:"ml-auto flex gap-1.5",children:[e.jsx("button",{onClick:r,className:"rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",children:m("btn_cancel")}),e.jsx("button",{onClick:()=>{0!==n.size?E(!0):g(m("tab_collection_select_at_least_one"))},disabled:d||0===n.size,className:"rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:m("tab_collection_options")}),e.jsx("button",{onClick:async()=>{if(0!==n.size){x(!0),g(null);try{const e=await w(a,n);e.success?(j(e.message||m("tab_collection_success")),S(Array.from(n)),C(!0)):g(e.error||m("tab_collection_failed"))}catch(e){g(e instanceof Error?e.message:m("tab_collection_failed"))}finally{x(!1)}}else g(m("tab_collection_select_at_least_one"))},disabled:d||0===n.size,className:"rounded-lg px-4 py-1.5 text-[11px] font-semibold shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",style:{background:"linear-gradient(90deg, var(--tab-popup-success-from), var(--tab-popup-success-to))",color:"var(--tab-popup-success-text)"},children:d?e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24",style:{color:"var(--tab-popup-success-text)"},children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m("tab_collection_collecting")]}):m("tab_collection_collect")})]})]})}),_&&e.jsx("div",{className:"fixed top-[60px] left-0 right-0 z-40 px-4 pt-2 animate-in slide-in-from-top-5 fade-in duration-300",children:e.jsxs("section",{className:"rounded-2xl border border-[color:var(--tab-message-success-border)] p-4 shadow-lg",style:{background:"linear-gradient(135deg, var(--tab-message-success-bg), var(--tab-message-success-icon-bg))"},children:[e.jsxs("div",{className:"mb-3 flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-[color:var(--tab-message-success-icon-bg)]",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-message-success-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)]",children:m("tab_collection_success")}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-text-muted)]",children:m("tab_collection_collected_count",String(L.length))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{C(!1),S([]),window.close()},className:"flex-1 rounded-xl border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-4 py-2 text-sm font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",children:m("tab_collection_keep_tabs")}),e.jsx("button",{onClick:async()=>{try{await y(L),window.close()}catch(e){g(m("tab_collection_close_tabs_failed"))}},className:"flex-1 rounded-xl px-4 py-2 text-sm font-semibold shadow-sm transition-all duration-200 hover:shadow-md active:scale-95",style:{background:"linear-gradient(90deg, var(--tab-popup-success-from), var(--tab-popup-success-to))",color:"var(--tab-popup-success-text)"},children:m("tab_collection_close_tabs")})]})]})}),e.jsx("main",{className:"relative flex-1 space-y-3 overflow-y-auto px-4 pb-5 bg-[color:var(--tab-popup-bg)] "+(_?"pt-[180px]":"pt-[60px]"),children:i?e.jsxs("section",{className:"flex items-center gap-3 rounded-2xl border border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] p-4 text-sm text-[var(--tab-text)] shadow-sm",children:[e.jsx(u,{}),e.jsx("p",{children:m("tab_collection_loading")})]}):e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"rounded-2xl border border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] p-3 shadow-sm",children:e.jsxs("button",{onClick:()=>{n.size===o.length?l(new Set):l(new Set(o.map(e=>e.id)))},className:"flex w-full items-center justify-between rounded-xl bg-[color:var(--tab-surface-muted)] px-4 py-2 text-sm font-medium text-[var(--tab-text)] transition-all duration-200 hover:opacity-90 active:scale-95",children:[e.jsx("span",{children:n.size===o.length?m("tab_collection_deselect_all"):m("tab_collection_select_all")}),e.jsxs("span",{className:"text-xs text-[var(--tab-text-muted)]",children:[n.size," / ",o.length]})]})}),e.jsx("section",{className:"space-y-2",children:o.map(t=>{const a=n.has(t.id);return e.jsx("button",{onClick:()=>(e=>{const t=new Set(n);t.has(e)?t.delete(e):t.add(e),l(t)})(t.id),className:"group w-full rounded-2xl border p-3 text-left transition-all duration-200 active:scale-[0.98] "+(a?"border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] shadow-md":"border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] hover:bg-[color:var(--tab-surface-muted)]"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 flex h-5 w-5 items-center justify-center rounded-md border-2 transition-all duration-200 "+(a?"border-[color:var(--tab-popup-success-from)] bg-[color:var(--tab-popup-success-from)]":"border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)]"),children:a&&e.jsx("svg",{className:"h-3 w-3 text-[var(--tab-popup-success-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),t.favIconUrl&&e.jsx("img",{src:t.favIconUrl,alt:"",className:"h-5 w-5 rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-[var(--tab-text)]",children:t.title}),e.jsx("p",{className:"truncate text-xs text-[var(--tab-text-muted)]",children:t.url})]})]})},t.id)})})]})})]})]})}function I({currentPage:t,titleOverride:a,setTitleOverride:r,newtabFoldersLoadError:o,enterNewtabFolder:s,loadNewtabFolders:n,newtabSuggestions:l,newtabFolders:i,currentNewtabFolderId:c,newtabRootId:d}){const p=e=>{const t=e.split("/");return t.length<=2?e:".../"+t.slice(-2).join("/")};return e.jsxs("div",{className:"flex h-full flex-col gap-2.5 pb-4",children:[e.jsxs("section",{className:"flex-shrink-0 rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"w-10 flex-shrink-0 text-xs font-medium text-[var(--tab-popup-text-muted)]",children:m("label_title")}),e.jsx("input",{type:"text",value:a,onChange:e=>r(e.target.value),placeholder:m("placeholder_bookmark_title"),className:"flex-1 rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-1.5 text-sm text-[var(--tab-popup-text)] placeholder-[var(--tab-popup-text-muted)] focus:border-[var(--tab-popup-input-focus-border)] focus:outline-none focus:ring-1 focus:ring-[var(--tab-popup-input-focus-ring)]"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"w-10 flex-shrink-0 text-xs font-medium text-[var(--tab-popup-text-muted)]",children:"URL"}),e.jsx("div",{className:"flex-1 truncate rounded-lg border border-[var(--tab-popup-border)] bg-[var(--tab-popup-bg)] px-3 py-1.5 text-xs text-[var(--tab-popup-text-muted)]",children:t?.url||m("no_url")})]})]}),e.jsxs("section",{className:"flex min-h-0 flex-1 flex-col rounded-xl border border-[var(--tab-popup-section-emerald-border)] bg-gradient-to-br from-[var(--tab-popup-section-emerald-from)] to-[var(--tab-popup-section-emerald-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>d&&s(d),className:"rounded-md bg-[var(--tab-popup-action-emerald-bg)] px-2 py-0.5 text-xs text-[var(--tab-popup-action-emerald-text)] transition-colors hover:bg-[var(--tab-popup-action-emerald-bg-hover)]",title:m("tooltip_back_to_root"),children:m("root_folder")}),e.jsxs("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:[i.find(e=>e.id===c)?.path||"TMarks","/"]})]}),e.jsx("button",{onClick:n,className:"rounded-lg p-1 text-[var(--tab-popup-section-emerald-icon)] transition-all hover:bg-[var(--tab-popup-action-emerald-bg)]",title:m("tooltip_refresh_folders"),children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),o&&e.jsx("div",{className:"mb-2 rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-1.5 text-xs text-[var(--tab-popup-text-muted)]",children:o}),l.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"mb-1.5 text-[10px] text-[var(--tab-popup-text-muted)]",children:m("popup_ai_recommend")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.map(t=>e.jsxs("button",{onClick:()=>s(t.id),className:"inline-flex items-center rounded-lg px-2 py-1 text-xs font-medium transition-colors "+(c===t.id?"bg-[var(--tab-popup-action-emerald-active-bg)] text-[var(--tab-popup-action-emerald-active-text)]":"bg-[var(--tab-popup-action-emerald-bg)] text-[var(--tab-popup-action-emerald-text)] hover:bg-[var(--tab-popup-action-emerald-bg-hover)]"),title:t.path,children:[e.jsx("span",{className:"max-w-[140px] truncate",children:p(t.path)}),c===t.id&&e.jsx("svg",{className:"ml-1 h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},t.id))})]}),e.jsxs("div",{className:"scrollbar-thin scrollbar-thumb-[var(--tab-popup-border-strong)] scrollbar-track-transparent min-h-0 flex-1 space-y-1 overflow-y-auto pr-1",children:[c&&c!==d&&e.jsxs("button",{onClick:()=>{const e=i.find(e=>e.id===c);e?.parentId&&s(e.parentId)},className:"flex w-full items-center gap-2 rounded-lg bg-[var(--tab-popup-action-emerald-bg)] px-3 py-2 text-left text-sm text-[var(--tab-popup-action-emerald-text)] transition-colors hover:bg-[var(--tab-popup-action-emerald-bg-hover)]",children:[e.jsx("svg",{className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:m("popup_back")})]}),i.filter(e=>e.parentId===(c||d)).filter(e=>e.id!==(c||d)).map(t=>e.jsxs("button",{onClick:()=>s(t.id),className:"flex w-full items-center justify-between rounded-lg bg-[var(--tab-popup-action-emerald-bg)] px-3 py-2 text-left text-sm text-[var(--tab-popup-text)] transition-colors hover:bg-[var(--tab-popup-action-emerald-bg-hover)]",children:[e.jsx("span",{className:"truncate",children:t.title}),e.jsx("svg",{className:"h-4 w-4 flex-shrink-0 text-[var(--tab-popup-section-emerald-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},t.id)),0===i.filter(e=>e.parentId===(c||d)&&e.id!==(c||d)).length&&c===d&&e.jsx("div",{className:"py-3 text-center text-xs text-[var(--tab-popup-text-muted)]",children:m("collection_no_folders")})]})]})]})}async function W(e){return new Promise((t,a)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):e?.success?t(e.data):a(new Error(e?.error||"Unknown error"))})})}async function $(e){return new Promise((t,a)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):e?.success?t(e.data):a(new Error(e?.error||"Unknown error"))})})}function D(){const{currentPage:a,recommendedTags:r,existingTags:o,selectedTags:s,isLoading:n,isSaving:l,isRecommending:i,error:v,successMessage:g,loadingMessage:h,existingBookmark:f,config:j,loadConfig:_,loadExistingTags:N,extractPageInfo:w,recommendTags:y,saveBookmark:k,setError:z,setSuccessMessage:D,setLoadingMessage:A,toggleTag:R,addCustomTag:H,setCurrentPage:U,includeThumbnail:V,setIncludeThumbnail:O,isPublic:P,setIsPublic:K,createSnapshot:G,setCreateSnapshot:Y,setExistingBookmark:q,updateExistingBookmarkTags:X,updateExistingBookmarkDescription:Z,createSnapshotForBookmark:J,lastRecommendationSource:Q,lastSaveDurationMs:ee}=x(),te=function(e){const[a,r]=t.useState(null),[o,s]=t.useState([]),[n,l]=t.useState(null),[i,c]=t.useState([]),[d,p]=t.useState([]),[b,u]=t.useState(!1),[x,v]=t.useState(!1),[g,h]=t.useState(null);return{newtabRootId:a,newtabFolders:o,currentNewtabFolderId:n,newtabBreadcrumb:i,newtabSuggestions:d,isNewtabRecommending:b,newtabFoldersLoaded:x,newtabFoldersLoadError:g,loadNewtabFolders:async()=>{try{h(null);const e=await W({type:"GET_NEWTAB_FOLDERS"});r(e.rootId),s(e.folders),l(e.rootId);const t=e.folders.find(t=>t.id===e.rootId);c(t?[{id:t.id,title:t.title}]:[]),v(!0)}catch(e){v(!1),h(e instanceof Error?e.message:m("error_load_folders")),r(null),s([]),l(null),c([])}},enterNewtabFolder:e=>{const t=o.find(t=>t.id===e);if(!t)return;l(e);const a=[];let r=t;const s=new Set;for(;r&&!s.has(r.id);)s.add(r.id),a.push({id:r.id,title:r.title}),r=r.parentId?o.find(e=>e.id===r.parentId):void 0;c(a.reverse())},handleRecommendNewtabFolder:async t=>{if(t?.url)if(x)try{u(!0);const e=await W({type:"RECOMMEND_NEWTAB_FOLDER",payload:{title:t.title,url:t.url,description:t.description}});p(e.suggestedFolders||[])}catch(a){e(a instanceof Error?a.message:m("error_ai_recommend_failed"))}finally{u(!1)}else h(m("error_folders_not_loaded"));else e(m("error_no_page_info"))}}}(z),[ae,re]=t.useState(""),[oe,se]=t.useState(""),[ne,le]=t.useState(""),[ie,ce]=t.useState(!1),[de,pe]=t.useState("selector"),[be,ue]=t.useState(!1),[xe,me]=t.useState(!1),ve=j?.preferences?.tagTheme??"classic";t.useEffect(()=>{se(a?.title??"")},[a?.title]),t.useEffect(()=>{le(a?.description??"")},[a?.description]),t.useEffect(()=>{_(),N()},[]),t.useEffect(()=>{c(j?.preferences?.theme??"auto")},[j?.preferences?.theme]),t.useEffect(()=>{d(j?.preferences?.themeStyle??"tmarks")},[j?.preferences?.themeStyle]);const ge=Boolean(j&&j.bookmarkSite.apiKey),he=Boolean(j&&j.preferences.enableAI&&j.aiConfig.apiKeys[j.aiConfig.provider]);t.useEffect(()=>{if(!j||ie||"bookmark"!==de)return;(async()=>{if(ge)try{await w();j.preferences.enableAI&&Boolean(j.aiConfig.apiKeys[j.aiConfig.provider])&&await y(),ce(!0)}catch(e){z(e instanceof Error?e.message:m("error_init_failed")),ce(!0)}else ce(!0)})()},[j,de]),t.useEffect(()=>{if(ie||"newtab"!==de)return;(async()=>{try{await w(),await te.loadNewtabFolders()}catch(e){z(e instanceof Error?e.message:m("error_init_failed"))}finally{ce(!0)}})()},[ie,de]);const fe=()=>{const e=ae.trim();e&&(H(e),re(""))},je=()=>{const e=oe.trim();e&&a&&(U({...a,title:e}),se(e))},_e=()=>{if(!a)return;const e=ne.trim();U({...a,description:e||void 0}),le(e)},Ne=()=>chrome.runtime.openOptionsPage(),we=()=>{pe("bookmark"),ce(!1)},ye=()=>pe("tabCollection"),ke=()=>{pe("newtab"),ce(!1)},Ce=()=>pe("selector"),Le=Boolean(te.currentNewtabFolderId&&te.currentNewtabFolderId!==te.newtabRootId),Se=(()=>{if(!te.newtabFoldersLoaded)return"TMarks";const e=te.newtabFolders.find(e=>e.id===te.currentNewtabFolderId);return e?.path||"TMarks"})();return"selector"===de?e.jsx(F,{onSelectBookmark:we,onSelectNewTab:ke,onSelectTabCollection:ye,onOpenOptions:Ne}):"tabCollection"===de?j?e.jsx(T,{config:j.bookmarkSite,onBack:Ce}):e.jsx("div",{children:m("loading")}):ie&&!ge?e.jsxs("div",{className:"relative h-[80vh] min-h-[580px] w-[380px] overflow-hidden rounded-2xl bg-[var(--tab-popup-onboarding-bg)] text-[var(--tab-popup-primary-text)] shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tab-popup-onboarding-radial-top),transparent_70%)] opacity-80"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_bottom,_var(--tab-popup-onboarding-radial-bottom),transparent_65%)] opacity-80"}),e.jsx("div",{className:"absolute inset-0 bg-[color:var(--tab-popup-onboarding-overlay)] backdrop-blur-2xl"}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"px-6 pt-8 pb-6",children:e.jsx("div",{className:"rounded-3xl border border-[color:var(--tab-popup-onboarding-card-border)] bg-[color:var(--tab-popup-onboarding-card-bg)] p-5 shadow-xl backdrop-blur-xl",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] shadow-lg",children:e.jsx("svg",{className:"h-6 w-6 text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-[color:var(--tab-popup-onboarding-label)]",children:"Onboarding"}),e.jsx("h1",{className:"text-2xl font-semibold",children:m("popup_welcome")}),e.jsx("p",{className:"text-sm text-[color:var(--tab-popup-onboarding-desc)]",children:m("popup_welcome_desc")})]})]})})}),e.jsx("main",{className:"flex-1 space-y-5 overflow-y-auto px-6 pb-6",children:e.jsxs("section",{className:"rounded-3xl border border-[color:var(--tab-popup-onboarding-card-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-5 backdrop-blur-xl",children:[e.jsx("h2",{className:"text-sm font-semibold",children:m("popup_required_info")}),e.jsx("p",{className:"mt-1 text-xs text-[color:var(--tab-popup-onboarding-label)]",children:m("popup_required_info_desc")}),e.jsx("ol",{className:"mt-4 space-y-3 text-xs",children:[m("popup_config_ai_key"),m("popup_config_site_url"),m("popup_config_site_key")].map((t,a)=>e.jsxs("li",{className:"flex gap-3 rounded-2xl border border-[color:var(--tab-popup-onboarding-subtle-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-3",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-xl bg-[color:var(--tab-popup-onboarding-tip-bg)] text-[11px] font-semibold",children:a+1}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold",children:t})})]},a))})]})}),e.jsx("footer",{className:"px-6 pb-6",children:e.jsxs("button",{onClick:Ne,className:"flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] via-[var(--tab-popup-primary-via)] to-[var(--tab-popup-primary-to)] px-6 py-3 text-sm font-semibold shadow-lg transition-all hover:shadow-xl active:scale-95",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),m("popup_go_settings")]})})]})]}):e.jsxs("div",{className:"relative h-[80vh] min-h-[620px] w-[380px] overflow-hidden rounded-2xl bg-[var(--tab-popup-surface)] text-[var(--tab-popup-text)] shadow-2xl",children:[e.jsxs("div",{className:"pointer-events-none fixed top-0 left-0 right-0 z-50 space-y-2 px-4 pt-2",children:[v&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(p,{message:v,onDismiss:()=>z(null),onRetry:n||"fallback"!==Q?void 0:y})}),h&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(E,{message:h})}),g&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(b,{message:g})})]}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-20 border-b border-[var(--tab-popup-border)] bg-[var(--tab-popup-surface)] px-3 pt-2 pb-2.5 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Ce,className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-lg text-[var(--tab-popup-text-muted)] transition-all hover:bg-[var(--tab-popup-action-neutral-bg)] active:scale-95",title:m("popup_back"),children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),"bookmark"===de&&he&&e.jsx("span",{className:"inline-flex flex-shrink-0 items-center rounded-full bg-[var(--tab-popup-badge-blue-bg)] px-2 py-1 text-[10px] font-medium text-[var(--tab-popup-badge-blue-text)]",children:m("popup_recommend_count",String(r.length))}),"bookmark"===de&&!he&&e.jsx("span",{className:"inline-flex flex-shrink-0 items-center rounded-full bg-[var(--tab-popup-badge-amber-bg)] px-2 py-1 text-[10px] font-medium text-[var(--tab-popup-badge-amber-text)]",children:m("popup_ai_off")}),"bookmark"===de&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex flex-shrink-0 items-center rounded-full bg-[var(--tab-popup-badge-indigo-bg)] px-2 py-1 text-[10px] font-medium text-[var(--tab-popup-badge-indigo-text)]",children:m("popup_selected_count",String(s.length))}),e.jsx("span",{className:"inline-flex flex-shrink-0 items-center rounded-full bg-[var(--tab-popup-badge-purple-bg)] px-2 py-1 text-[10px] font-medium text-[var(--tab-popup-badge-purple-text)]",children:m("popup_library_count",String(o.length))})]}),"newtab"===de&&e.jsx("button",{onClick:()=>te.handleRecommendNewtabFolder(a),disabled:te.isNewtabRecommending||!a?.url||!te.newtabFoldersLoaded,className:"rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-2.5 py-1 text-[10px] font-medium text-[var(--tab-popup-text)] transition-all hover:bg-[var(--tab-popup-action-neutral-bg)] disabled:opacity-40",children:te.isNewtabRecommending?m("popup_ai_recommending"):m("popup_ai_recommend")}),e.jsxs("div",{className:"ml-auto flex gap-1.5",children:[e.jsx("button",{onClick:()=>window.close(),className:"rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-popup-text)] transition-all hover:bg-[var(--tab-popup-action-neutral-bg)] active:scale-95",children:m("btn_cancel")}),"bookmark"===de?e.jsx("button",{onClick:async()=>{0!==s.length?await k():z(m("error_select_tag"))},disabled:l||0===s.length,className:"rounded-lg bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-[11px] font-semibold text-[var(--tab-popup-primary-text)] shadow-sm transition-all hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:l?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m("popup_saving")]}):m("popup_save_bookmark")}):e.jsx("button",{onClick:async()=>{if(!a?.url)return void z(m("error_no_page_info"));const e=oe.trim()||a.title;try{let t=te.currentNewtabFolderId||void 0;te.newtabFoldersLoaded||(t=void 0);if(!Le&&Boolean(j&&j.preferences.enableNewtabAI&&j.aiConfig.apiKeys[j.aiConfig.provider])&&te.newtabFoldersLoaded)try{A(m("msg_ai_recommending_folder"));const r=await $({type:"RECOMMEND_NEWTAB_FOLDER",payload:{title:e,url:a.url,description:a.description}});r?.suggestedFolders?.length>0&&(t=r.suggestedFolders[0].id)}catch{}A(m("msg_saving_to_newtab")),await $({type:"SAVE_TO_NEWTAB",payload:{url:a.url,title:e,parentBookmarkId:t}}),A(null);const r=te.newtabFolders.find(e=>e.id===t)?.path||"TMarks";D(m("msg_saved_to",r)),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:m("popup_title"),message:m("notification_saved",[e,r])}),setTimeout(()=>{const e=x.getState().successMessage;e?.startsWith(m("msg_saved_to","").split("$")[0])&&x.getState().setSuccessMessage(null)},2e3)}catch(t){A(null),z(t instanceof Error?t.message:m("error_save_failed"))}},disabled:l||!a?.url,className:"rounded-lg bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-[11px] font-semibold text-[var(--tab-popup-primary-text)] shadow-sm transition-all hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:m("popup_save_to_newtab")})]})]})}),"newtab"===de&&e.jsx("div",{className:"fixed top-[46px] left-0 right-0 z-20 border-b border-[var(--tab-popup-save-target-border)] bg-[var(--tab-popup-save-target-bg)] px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-[var(--tab-popup-save-target-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"text-sm font-semibold text-[var(--tab-popup-save-target-text)]",children:Se})]}),Le?e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-save-target-badge-bg)] px-2 py-0.5 text-[10px] font-medium text-[var(--tab-popup-save-target-badge-text)]",children:m("popup_selected")}):e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-save-target-badge-bg)] px-2 py-0.5 text-[10px] font-medium text-[var(--tab-popup-text-muted)]",children:m("popup_default")})]})}),e.jsxs("main",{className:"relative flex-1 overflow-hidden bg-[var(--tab-popup-bg)] px-4 "+("newtab"===de?"flex flex-col pt-[90px] pb-4":"space-y-2.5 overflow-y-auto pt-[60px] pb-[70px]"),children:["newtab"===de&&e.jsx(I,{currentPage:a,titleOverride:oe,setTitleOverride:se,newtabFoldersLoadError:te.newtabFoldersLoadError,enterNewtabFolder:te.enterNewtabFolder,loadNewtabFolders:te.loadNewtabFolders,newtabSuggestions:te.newtabSuggestions,newtabFolders:te.newtabFolders,currentNewtabFolderId:te.currentNewtabFolderId,newtabRootId:te.newtabRootId}),"bookmark"===de&&i&&e.jsxs("section",{className:"flex items-center gap-3 rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 text-sm text-[var(--tab-popup-text)] shadow-lg",children:[e.jsx(u,{}),e.jsx("p",{children:m("popup_ai_analyzing")})]}),"bookmark"===de&&!he&&!i&&0===r.length&&e.jsx("section",{className:"rounded-xl border border-[var(--tab-popup-section-amber-border)] bg-gradient-to-br from-[var(--tab-popup-section-amber-from)] to-[var(--tab-popup-section-amber-to)] p-3.5 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-[var(--tab-popup-section-amber-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--tab-popup-section-amber-title)]",children:m("popup_ai_disabled_title")}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-section-amber-text)]",children:m("popup_ai_disabled_desc")})]})]})}),"bookmark"===de&&s.length>0&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-blue-border)] bg-gradient-to-br from-[var(--tab-popup-section-blue-from)] to-[var(--tab-popup-section-blue-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:m("popup_selected_tags")}),e.jsx("span",{className:"text-[10px] text-[var(--tab-popup-text-muted)]",children:m("popup_click_to_remove")})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-blue-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-blue-badge-text)]",children:s.length})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map(t=>e.jsx("button",{onClick:()=>R(t),title:m("popup_click_to_remove"),className:C(ve),children:e.jsx("span",{className:"max-w-[120px] truncate",children:t})},t))})]}),a&&"bookmark"===de&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>K(!P),className:"flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-150 "+(P?"bg-[var(--tab-popup-action-emerald-bg)] text-[var(--tab-popup-action-emerald-text)] hover:bg-[var(--tab-popup-action-emerald-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:m(P?"tooltip_public":"tooltip_private"),children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:P?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("button",{type:"button",onClick:()=>{O(!!a?.thumbnail&&!V)},disabled:!a.thumbnail,className:`flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-150 ${V?"bg-[var(--tab-popup-action-amber-bg)] text-[var(--tab-popup-action-amber-text)] hover:bg-[var(--tab-popup-action-amber-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"} ${a.thumbnail?"":"cursor-not-allowed opacity-40"}`,title:m(V?"tooltip_include_thumbnail":"tooltip_no_thumbnail"),children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{type:"button",onClick:()=>Y(!G),className:"flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-150 "+(G?"bg-[var(--tab-popup-action-purple-bg)] text-[var(--tab-popup-action-purple-text)] hover:bg-[var(--tab-popup-action-purple-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:m(G?"tooltip_create_snapshot":"tooltip_no_snapshot"),children:e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("button",{type:"button",onClick:()=>ue(!be),className:"flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-150 "+(be?"bg-[var(--tab-popup-action-blue-bg)] text-[var(--tab-popup-action-blue-text)] hover:bg-[var(--tab-popup-action-blue-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:m(be?"tooltip_edit_title_collapse":"tooltip_edit_title_expand"),children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>me(!xe),className:"flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-150 "+(xe?"bg-[var(--tab-popup-action-blue-bg)] text-[var(--tab-popup-action-blue-text)] hover:bg-[var(--tab-popup-action-blue-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:m(xe?"tooltip_edit_desc_collapse":"tooltip_edit_desc_expand"),children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})})})]}),e.jsxs("div",{className:"mb-2.5 space-y-2",children:[be&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 fade-in flex gap-2 duration-200",children:[e.jsx("input",{type:"text",value:oe,onChange:e=>se(e.target.value),onKeyDown:e=>{"Enter"===e.key&&je()},placeholder:m("placeholder_custom_title"),className:"flex-1 rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-2 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:border-[var(--tab-popup-input-focus-border)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)]",autoFocus:!0}),e.jsx("button",{onClick:je,disabled:!oe.trim()||!a,className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-2 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:m("popup_apply")})]}),xe&&e.jsxs("div",{className:"animate-in slide-in-from-top-2 fade-in flex gap-2 duration-200",children:[e.jsx("textarea",{value:ne,onChange:e=>le(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&_e()},placeholder:m("placeholder_custom_desc"),rows:2,className:"flex-1 resize-none rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-2 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:border-[var(--tab-popup-input-focus-border)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)]",autoFocus:!0}),e.jsx("button",{onClick:_e,disabled:!a,className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-2 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:m("popup_apply")})]})]}),e.jsx(M,{title:a.title,url:a.url,description:a.description,thumbnail:V?a.thumbnail:void 0,thumbnails:V?a.thumbnails:void 0,favicon:a.favicon,onThumbnailChange:e=>U({...a,thumbnail:e})})]}),"bookmark"===de&&r.length>0&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-purple-border)] bg-gradient-to-br from-[var(--tab-popup-section-purple-from)] to-[var(--tab-popup-section-purple-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2.5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--tab-popup-text)]",children:m("ai_recommend_title")}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-text-muted)]",children:m("ai_recommend_desc")})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-purple-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-purple-badge-text)]",children:r.length})]}),e.jsx(S,{tags:r,selectedTags:s,onToggle:R,theme:ve})]}),"bookmark"===de&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-emerald-border)] bg-gradient-to-br from-[var(--tab-popup-section-emerald-from)] to-[var(--tab-popup-section-emerald-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2.5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--tab-popup-text)]",children:[e.jsx("svg",{className:"h-4 w-4 text-[var(--tab-popup-section-emerald-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),m("tag_library")]}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-text-muted)]",children:m("tag_library_desc")})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-emerald-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-emerald-badge-text)]",children:o.length})]}),e.jsx("div",{className:"scrollbar-thin scrollbar-thumb-[var(--tab-popup-border-strong)] scrollbar-track-transparent max-h-48 overflow-y-auto pr-1",children:0===o.length?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx("p",{className:"text-xs text-[var(--tab-popup-text-muted)]",children:m(n?"loading":"no_tags")})}):e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.sort((e,t)=>t.count-e.count).map(t=>{const a=s.includes(t.name);return e.jsxs("button",{onClick:()=>R(t.name),className:`inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-medium transition-all duration-200 active:scale-95 ${L(ve,a)}`,children:["bw"!==ve&&e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 flex-shrink-0 rounded-full",style:{backgroundColor:t.color||"var(--tab-message-success-icon)"}}),e.jsx("span",{className:"max-w-[110px] truncate",children:t.name}),t.count>0&&e.jsxs("span",{className:"ml-1 text-[10px] opacity-60",children:["(",t.count,")"]})]},t.id)})})})]}),null!==ee&&e.jsx("section",{className:"rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-2.5 text-xs text-[var(--tab-popup-text-muted)] shadow-sm",children:m("last_save_duration",(ee/1e3).toFixed(2))})]}),"bookmark"===de&&e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-20 rounded-t-2xl border-t border-[var(--tab-popup-footer-border)] bg-[var(--tab-popup-footer-bg)] px-3 pt-2 pb-2.5 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 flex-shrink-0 text-[var(--tab-popup-text-muted)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),e.jsx("input",{type:"text",value:ae,onChange:e=>re(e.target.value),onKeyPress:e=>{"Enter"===e.key&&fe()},placeholder:m("placeholder_add_tag"),className:"flex-1 rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-1.5 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:border-[var(--tab-popup-input-focus-border)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)]"}),e.jsx("button",{onClick:fe,disabled:!ae.trim(),className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:m("add_tag")})]})})]}),f&&f.needsDialog&&e.jsx(B,{bookmark:f,newTags:s,onUpdateTags:async e=>{f.id&&await X(f.id,e)},onUpdateDescription:async e=>{f.id&&await Z(f.id,e)},onCreateSnapshot:async()=>{f.id&&await J(f.id)},onCancel:()=>q(null)})]})}const A=document.getElementById("root");A&&j().then(()=>{l.createRoot(A).render(e.jsx(i.StrictMode,{children:e.jsx(D,{})}))});
