const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-8lkdjZ4V.js","assets/prompts-CKcm-rRX.js","assets/urls-T86wRnwx.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-YP0FEG5d.js";import{k as t,r as e,n as o,R as a}from"./react-vendor-1ZtHTM4k.js";import{L as r,u as s,a as n,i,b as l,E as d,S as p}from"./index-CjfICgkq.js";import{t as c,A as b,b as m,T as u,a as x}from"./urls-T86wRnwx.js";import{D as v}from"./prompts-CKcm-rRX.js";import{N as h}from"./newtabPrompts-Br339DSM.js";import{_ as g}from"./preload-helper-BhLMWRjL.js";import{d as f}from"./index-NQ3jknxk.js";import"./dexie-BAhLzSXZ.js";function _({connections:e,showAll:o,onToggleShowAll:a,onApply:r,onDelete:s,currentProvider:n}){const i=o?e:e.slice(0,3);return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-options-title)]",children:c("options_saved_configs")}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--tab-options-text-muted)]",children:[t.jsx("span",{children:c("options_total_count",[e.length.toString()])}),e.length>3&&t.jsx("button",{type:"button",onClick:a,className:"rounded-full border border-[color:var(--tab-options-button-border)] px-2 py-0.5 text-[11px] font-medium text-[var(--tab-options-button-text)] transition-colors hover:bg-[var(--tab-options-button-hover-bg)]",children:o?c("popup_back"):`${c("popup_more")} (${e.length-3})`})]})]}),0===e.length?t.jsx("div",{className:"rounded-xl border border-dashed border-[color:var(--tab-options-button-border)] bg-[color:var(--tab-options-card-bg)] p-6 text-sm text-[var(--tab-options-text-muted)]",children:c("options_no_saved_configs")}):t.jsx("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:i.map((e,o)=>{return t.jsxs("div",{className:"group flex flex-col justify-between gap-3 rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] p-4 shadow-sm transition-all hover:-translate-y-1 hover:border-[color:var(--tab-options-modal-border)] hover:shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm font-semibold text-[var(--tab-options-title)] truncate",title:e.label||e.apiUrl||c("options_unnamed_config"),children:e.label||c("options_unnamed_config")}),t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-[color:var(--tab-options-pill-bg)] text-[var(--tab-options-pill-text)] px-2 py-0.5 text-[11px]",children:[t.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-[var(--tab-options-button-primary-bg)]"}),(a=e.provider||n,{openai:c("provider_openai"),claude:c("provider_claude"),deepseek:c("provider_deepseek"),zhipu:c("provider_zhipu"),modelscope:c("provider_modelscope"),siliconflow:c("provider_siliconflow"),iflow:c("provider_iflow"),custom:c("provider_custom")}[a])]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>r(e,e.provider),className:"flex-1 rounded-lg bg-[var(--tab-options-button-primary-bg)] px-3 py-2 text-xs font-medium text-[var(--tab-options-button-primary-text)] transition-colors hover:bg-[var(--tab-options-button-primary-hover)]",children:c("options_use")}),t.jsx("button",{type:"button",onClick:()=>s(e,e.provider),className:"rounded-lg border border-[color:var(--tab-options-button-border)] px-3 py-2 text-xs font-medium text-[var(--tab-options-button-text)] transition-colors hover:bg-[var(--tab-options-button-hover-bg)]",children:c("options_delete")})]})]},e.id||`${e.provider||"unknown"}-${e.label||e.apiUrl||"default"}-${o}`);var a})})]})}const y={openai:"gpt-4o-mini (recommended) or gpt-4o",claude:"claude-3-5-sonnet-20241022 (recommended)",deepseek:"deepseek-chat",zhipu:"glm-4-flash (recommended) or glm-4-plus",modelscope:"qwen-plus or qwen-turbo",siliconflow:"Qwen/Qwen2.5-7B-Instruct",iflow:"spark-lite or spark-pro",custom:"Enter model name"};function j({model:o,provider:a,availableModels:r,isFetchingModels:s,modelFetchError:n,modelFetchSupported:i,apiKey:l,onModelChange:d,onRefreshModels:p}){const[b,m]=e.useState(!1),u=e.useRef(null),x=r.length>0;e.useEffect(()=>{if(!b)return;const t=t=>{u.current&&!u.current.contains(t.target)&&m(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[b]),e.useEffect(()=>{x||m(!1)},[x]);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_model")}),t.jsx("button",{type:"button",onClick:p,disabled:!i||s||!l.trim(),className:"text-xs px-3 py-1 rounded-lg transition-colors "+(i&&!s&&l.trim()?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] hover:bg-[var(--tab-options-button-primary-hover)]":"bg-[var(--tab-options-button-hover-bg)] text-[var(--tab-options-text-muted)] cursor-not-allowed"),children:c(s?"options_fetching_models":"options_refresh_models")})]}),t.jsxs("div",{className:"relative w-full",ref:u,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:o,onChange:t=>d(t.target.value),placeholder:y[a],className:"flex-1 px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]"}),x&&t.jsxs("button",{type:"button",onClick:()=>m(t=>!t),className:"px-3 py-2 rounded-lg bg-[var(--tab-options-button-hover-bg)] text-[var(--tab-options-button-text)] hover:bg-[color:var(--tab-options-button-border)] transition-colors flex items-center gap-1",children:[t.jsx("span",{className:"text-sm font-medium",children:c("options_select_model")}),t.jsx("span",{className:"transition-transform "+(b?"rotate-180":""),children:"▾"})]})]}),x&&b&&t.jsx("div",{className:"absolute z-10 mt-2 right-0 w-full max-h-[33vh] overflow-y-auto rounded-lg border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-modal-bg)] shadow-2xl",children:r.map(e=>{const a=o===e;return t.jsx("button",{type:"button",onClick:()=>(d(e),void m(!1)),className:"w-full text-left px-3 py-2 text-sm transition-colors "+(a?"bg-[color:var(--tab-options-pill-bg)] text-[var(--tab-options-pill-text)]":"text-[var(--tab-options-button-text)] hover:bg-[var(--tab-options-button-hover-bg)]"),children:e},e)})})]}),x&&t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-pill-text)]",children:c("options_models_loaded",[r.length.toString()])}),n&&t.jsxs("p",{className:"mt-2 text-xs text-[var(--tab-options-danger-text)]",children:[c("options_model_load_failed"),": ",n]}),!x&&i&&!n&&!s&&t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("options_model_fetch_hint")})]})}const w=t=>({openai:c("options_api_key_placeholder_openai"),claude:c("options_api_key_placeholder_claude"),deepseek:c("options_api_key_placeholder_deepseek"),zhipu:c("options_api_key_placeholder_zhipu"),modelscope:c("options_api_key_placeholder_modelscope"),siliconflow:c("options_api_key_placeholder_siliconflow"),iflow:c("options_api_key_placeholder_iflow"),custom:c("options_api_key_placeholder_custom")}[t]),N={openai:{name:"OpenAI Platform",url:b.OPENAI},claude:{name:"Anthropic Console",url:b.CLAUDE},deepseek:{name:"DeepSeek Platform",url:b.DEEPSEEK},zhipu:{name:"Zhipu AI Platform",url:b.ZHIPU},modelscope:{name:"ModelScope",url:b.MODELSCOPE},siliconflow:{name:"SiliconFlow",url:b.SILICONFLOW},iflow:{name:"iFlytek Platform",url:b.IFLOW}};function k({provider:e,apiKey:o,onChange:a}){const r=N[e];return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:"API Key"}),t.jsx("input",{type:"password",value:o,onChange:t=>a(t.target.value),placeholder:w(e),className:"w-full px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]"}),r&&t.jsxs("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:[c("options_get_api_key"),":",t.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--tab-options-pill-text)] hover:underline",children:r.name})]})]})}function C({formData:o,setFormData:a,handleProviderChange:r,handleTestConnection:s,isTesting:n,availableModels:i,isFetchingModels:l,modelFetchError:d,onRefreshModels:p,modelFetchSupported:b,allSavedConnections:u,onApplySavedConnection:x,onDeleteSavedConnection:v,onSaveConnectionPreset:h}){const[g,f]=e.useState(!1);e.useEffect(()=>{u.length<=3&&g&&f(!1)},[u.length,g]);const y="custom"===o.aiProvider||"siliconflow"===o.aiProvider||"deepseek"===o.aiProvider||"openai"===o.aiProvider;return t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-8 pt-12 space-y-8",children:[t.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold text-[var(--tab-options-title)]",children:c("options_ai_config_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("options_ai_config_desc")})]}),t.jsx("button",{type:"button",onClick:h,disabled:!o.apiKey.trim(),className:"inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-medium transition-colors "+(o.apiKey.trim()?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] hover:bg-[var(--tab-options-button-primary-hover)] shadow-sm":"bg-[var(--tab-options-button-hover-bg)] text-[var(--tab-options-text-muted)] cursor-not-allowed"),children:c("options_save_config")})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx(_,{connections:u,showAll:g,onToggleShowAll:()=>f(t=>!t),onApply:x,onDelete:v,currentProvider:o.aiProvider}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:c("options_ai_engine")}),t.jsxs("select",{value:o.aiProvider,onChange:t=>r(t.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]",children:[t.jsx("option",{value:"openai",children:c("provider_openai")}),t.jsx("option",{value:"claude",children:c("provider_claude")}),t.jsx("option",{value:"deepseek",children:c("provider_deepseek")}),t.jsx("option",{value:"zhipu",children:c("provider_zhipu")}),t.jsx("option",{value:"modelscope",children:c("provider_modelscope")}),t.jsx("option",{value:"siliconflow",children:c("provider_siliconflow")}),t.jsx("option",{value:"iflow",children:c("provider_iflow")}),t.jsx("option",{value:"custom",children:c("provider_custom")})]})]}),y&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:c("options_api_url")}),t.jsx("input",{type:"url",value:o.apiUrl,onChange:t=>a({...o,apiUrl:t.target.value}),placeholder:(()=>{switch(o.aiProvider){case"openai":return m.OPENAI;case"deepseek":return m.DEEPSEEK;case"siliconflow":return m.SILICONFLOW;default:return c("options_custom_api_placeholder")}})(),className:"w-full px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]"})]}),t.jsx(k,{provider:o.aiProvider,apiKey:o.apiKey,onChange:t=>a({...o,apiKey:t})}),t.jsx(j,{model:o.aiModel,provider:o.aiProvider,availableModels:i,isFetchingModels:l,modelFetchError:d,modelFetchSupported:b,apiKey:o.apiKey,onModelChange:t=>a({...o,aiModel:t}),onRefreshModels:p}),t.jsx("div",{children:t.jsx("button",{onClick:s,disabled:n||!o.apiKey,className:"px-4 py-2 bg-[var(--tab-options-button-primary-bg)] hover:bg-[var(--tab-options-button-primary-hover)] disabled:opacity-50 text-[var(--tab-options-button-primary-text)] rounded-lg transition-colors duration-200",children:c(n?"options_testing":"options_test_connection")})})]})]})]})}function S({formData:e,setFormData:o}){return t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-tmarks-card-border)] bg-[color:var(--tab-options-tmarks-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-tmarks-topbar-from)] via-[var(--tab-options-tmarks-topbar-via)] to-[var(--tab-options-tmarks-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("options_sync_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("options_sync_desc")})]}),t.jsx("span",{className:"px-3 py-1 rounded-full bg-[color:var(--tab-options-tmarks-badge-bg)] text-xs font-medium text-[var(--tab-options-tmarks-badge-text)]",children:c("options_recommended")})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:c("options_server_address")}),t.jsx("input",{type:"url",value:e.bookmarkApiUrl,onChange:t=>o({...e,bookmarkApiUrl:t.target.value}),placeholder:u.DEFAULT_BASE_URL,className:"w-full px-3 py-2 border border-[var(--tab-options-tmarks-input-border)] rounded-lg bg-[var(--tab-options-tmarks-input-bg)] text-[var(--tab-options-tmarks-input-text)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-tmarks-input-ring)]"}),t.jsxs("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:[t.jsx("span",{className:"font-medium",children:c("options_tmarks_official")}),t.jsx("code",{className:"ml-1 px-1.5 py-0.5 bg-[var(--tab-options-tmarks-code-bg)] rounded",children:u.DEFAULT_BASE_URL})]}),t.jsxs("div",{className:"mt-2 p-3 bg-[var(--tab-options-tmarks-info-bg)] rounded-lg",children:[t.jsx("p",{className:"text-xs text-[var(--tab-options-tmarks-info-text)] mb-2",children:t.jsx("span",{className:"font-semibold text-[var(--tab-options-tmarks-info-title)]",children:c("options_tmarks_info_title")})}),t.jsxs("ul",{className:"text-xs text-[var(--tab-options-tmarks-info-text)] space-y-1",children:[t.jsxs("li",{children:["• ",c("options_tmarks_info_1")]}),t.jsxs("li",{children:["• ",c("options_tmarks_info_2")]}),t.jsxs("li",{children:["• ",c("options_tmarks_info_3")]}),t.jsxs("li",{children:["• ",c("options_tmarks_info_4"),t.jsx("code",{className:"px-1 bg-[var(--tab-options-tmarks-code-bg)] rounded",children:"https://tmarks.669696.xyz"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:c("options_api_key")}),t.jsx("input",{type:"password",value:e.bookmarkApiKey,onChange:t=>o({...e,bookmarkApiKey:t.target.value}),placeholder:c("options_api_key_placeholder"),className:"w-full px-3 py-2 border border-[var(--tab-options-tmarks-input-border)] rounded-lg bg-[var(--tab-options-tmarks-input-bg)] text-[var(--tab-options-tmarks-input-text)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-tmarks-input-ring)]"}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("options_api_key_hint")})]})]})]})]})}function P({formData:e,setFormData:o}){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("pref_appearance_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("pref_appearance_desc")})]}),t.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-2",children:c("pref_theme")}),t.jsxs("div",{className:"inline-flex rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] p-1 text-sm font-medium text-[var(--tab-options-text)]",children:[t.jsx("button",{type:"button",onClick:()=>o({...e,theme:"auto"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("auto"===e.theme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_theme_auto")}),t.jsx("button",{type:"button",onClick:()=>o({...e,theme:"light"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("light"===e.theme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_theme_light")}),t.jsx("button",{type:"button",onClick:()=>o({...e,theme:"dark"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("dark"===e.theme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_theme_dark")})]}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_theme_hint")})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-2",children:c("pref_theme_style")}),t.jsxs("div",{className:"inline-flex rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] p-1 text-sm font-medium text-[var(--tab-options-text)]",children:[t.jsx("button",{type:"button",onClick:()=>o({...e,themeStyle:"default"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("default"===e.themeStyle?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_style_default")}),t.jsx("button",{type:"button",onClick:()=>o({...e,themeStyle:"bw"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("bw"===e.themeStyle?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_style_bw")}),t.jsx("button",{type:"button",onClick:()=>o({...e,themeStyle:"tmarks"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("tmarks"===e.themeStyle?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:"TMarks"})]}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_style_hint")})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-2",children:c("pref_tag_style")}),t.jsxs("div",{className:"inline-flex rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] p-1 text-sm font-medium text-[var(--tab-options-text)]",children:[t.jsx("button",{type:"button",onClick:()=>o({...e,tagTheme:"classic"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("classic"===e.tagTheme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_tag_classic")}),t.jsx("button",{type:"button",onClick:()=>o({...e,tagTheme:"mono"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("mono"===e.tagTheme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_tag_mono")}),t.jsx("button",{type:"button",onClick:()=>o({...e,tagTheme:"bw"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("bw"===e.tagTheme?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_style_bw")})]}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_tag_hint")})]})]})]})]}),t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("pref_defaults_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("pref_defaults_desc")})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-2",children:c("pref_visibility")}),t.jsxs("div",{className:"inline-flex rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] p-1 text-sm font-medium text-[var(--tab-options-text)]",children:[t.jsx("button",{type:"button",onClick:()=>o({...e,defaultVisibility:"public"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("public"===e.defaultVisibility?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_visibility_public")}),t.jsx("button",{type:"button",onClick:()=>o({...e,defaultVisibility:"private"}),className:"rounded-lg px-3 py-1.5 transition-colors "+("private"===e.defaultVisibility?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] shadow":"hover:text-[var(--tab-options-title)]"),children:c("pref_visibility_private")})]}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_visibility_hint")})]}),t.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-[color:var(--tab-options-card-border)]",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("pref_thumbnail")}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_thumbnail_hint")})]}),t.jsx("button",{type:"button",role:"switch","aria-checked":e.defaultIncludeThumbnail,onClick:()=>o({...e,defaultIncludeThumbnail:!e.defaultIncludeThumbnail}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] focus:ring-offset-2 "+(e.defaultIncludeThumbnail?"bg-[var(--tab-options-button-primary-bg)]":"bg-[var(--tab-options-button-hover-bg)]"),children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-[var(--tab-options-switch-thumb)] shadow ring-0 transition duration-200 ease-in-out "+(e.defaultIncludeThumbnail?"translate-x-5":"translate-x-0")})})]}),t.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-[color:var(--tab-options-card-border)]",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("pref_snapshot")}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("pref_snapshot_hint")})]}),t.jsx("button",{type:"button",role:"switch","aria-checked":e.defaultCreateSnapshot,onClick:()=>o({...e,defaultCreateSnapshot:!e.defaultCreateSnapshot}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] focus:ring-offset-2 "+(e.defaultCreateSnapshot?"bg-[var(--tab-options-button-primary-bg)]":"bg-[var(--tab-options-button-hover-bg)]"),children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-[var(--tab-options-switch-thumb)] shadow ring-0 transition duration-200 ease-in-out "+(e.defaultCreateSnapshot?"translate-x-5":"translate-x-0")})})]})]})]})]})]})}function A({stats:e,handleSync:o,isLoading:a,formatDate:s}){return t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("options_cache_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("options_cache_desc")})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[t.jsxs("div",{className:"rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-tag-bg)] p-4 text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-[var(--tab-options-pill-text)]",children:e.tags}),t.jsx("p",{className:"mt-1 text-xs uppercase tracking-wide text-[var(--tab-options-text-muted)]",children:c("options_tags_count")})]}),t.jsxs("div",{className:"rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-tag-bg)] p-4 text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-[var(--tab-options-pill-text)]",children:e.bookmarks}),t.jsx("p",{className:"mt-1 text-xs uppercase tracking-wide text-[var(--tab-options-text-muted)]",children:c("options_bookmarks_count")})]}),t.jsxs("div",{className:"rounded-xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-tag-bg)] p-4 text-center",children:[t.jsx("p",{className:"text-xs font-medium text-[var(--tab-options-text)]",children:s(e.lastSync)}),t.jsx("p",{className:"mt-1 text-xs uppercase tracking-wide text-[var(--tab-options-text-muted)]",children:c("options_last_sync")})]})]}),t.jsx("button",{onClick:o,disabled:a,className:"w-full px-4 py-3 bg-[var(--tab-options-button-primary-bg)] hover:bg-[var(--tab-options-button-primary-hover)] text-[var(--tab-options-button-primary-text)] rounded-lg font-medium disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",children:a?t.jsxs(t.Fragment,{children:[t.jsx(r,{}),t.jsx("span",{children:c("options_syncing")})]}):c("options_sync_now")})]})]})}function E({isOpen:e,presetLabel:o,presetError:a,isSaving:r,onClose:s,onConfirm:n,onChangeLabel:i}){return e?t.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-[color:var(--tab-options-modal-overlay)] backdrop-blur-sm px-4",children:t.jsxs("div",{className:"relative w-full max-w-md overflow-hidden rounded-2xl border border-[color:var(--tab-options-modal-border)] bg-[color:var(--tab-options-modal-bg)] shadow-xl",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--tab-options-title)]",children:c("options_save_config")}),t.jsx("p",{className:"mt-1 text-sm text-[var(--tab-options-text)]",children:c("options_save_config_desc")})]}),t.jsx("button",{type:"button",onClick:s,className:"rounded-full border border-transparent px-3 py-1 text-xl leading-none text-[var(--tab-options-modal-close-text)] transition-colors hover:border-[var(--tab-options-modal-close-hover-border)] hover:text-[var(--tab-options-modal-close-hover-text)]","aria-label":c("options_close"),children:"×"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_config_name")}),t.jsx("input",{type:"text",value:o,onChange:t=>i(t.target.value),autoFocus:!0,className:"w-full rounded-lg border border-[color:var(--tab-options-button-border)] bg-[color:var(--tab-options-card-bg)] px-3 py-2 text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]",placeholder:c("options_config_name_placeholder")})]}),a&&t.jsx("div",{className:"rounded-lg border border-[color:var(--tab-options-danger-border)] bg-[color:var(--tab-options-danger-bg)] px-3 py-2 text-sm text-[var(--tab-options-danger-text)]",children:a}),t.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:s,disabled:r,className:"rounded-lg border border-[color:var(--tab-options-button-border)] px-4 py-2 text-sm font-medium text-[var(--tab-options-button-text)] transition-colors hover:bg-[var(--tab-options-button-hover-bg)] disabled:cursor-not-allowed disabled:opacity-60",children:c("btn_cancel")}),t.jsx("button",{type:"button",onClick:n,disabled:r,className:"rounded-lg bg-[var(--tab-options-button-primary-bg)] px-4 py-2 text-sm font-medium text-[var(--tab-options-button-primary-text)] shadow-sm transition-colors hover:bg-[var(--tab-options-button-primary-hover)] disabled:cursor-not-allowed disabled:opacity-60",children:c(r?"btn_saving":"btn_confirm")})]})]})]})}):null}function F({formData:e,setFormData:o,setSuccessMessage:a}){return t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("options_tmarks_tag_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("options_tmarks_tag_desc")})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_enable_ai_tag")}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("options_enable_ai_tag_desc")})]}),t.jsx("button",{type:"button",role:"switch","aria-checked":e.enableAI,onClick:()=>o({...e,enableAI:!e.enableAI}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] focus:ring-offset-2 "+(e.enableAI?"bg-[var(--tab-options-button-primary-bg)]":"bg-[var(--tab-options-button-hover-bg)]"),children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-[var(--tab-options-switch-thumb)] shadow ring-0 transition duration-200 ease-in-out "+(e.enableAI?"translate-x-5":"translate-x-0")})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-3",children:c("options_max_tags")}),t.jsx("input",{type:"number",min:"1",max:"10",value:e.maxSuggestedTags,onChange:t=>o({...e,maxSuggestedTags:parseInt(t.target.value)}),disabled:!e.enableAI,className:"w-full px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] disabled:opacity-60"}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("options_max_tags_range")})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_tmarks_prompt")}),t.jsx("button",{type:"button",onClick:()=>o({...e,enableCustomPrompt:!e.enableCustomPrompt}),disabled:!e.enableAI,className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors "+(e.enableAI&&e.enableCustomPrompt?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)] hover:bg-[var(--tab-options-button-primary-hover)]":"bg-[var(--tab-options-button-hover-bg)] text-[var(--tab-options-button-text)] hover:bg-[color:var(--tab-options-button-border)]"),children:e.enableCustomPrompt?c("options_enabled"):c("options_disabled")})]}),e.enableAI&&e.enableCustomPrompt&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("textarea",{value:e.customPrompt,onChange:t=>o({...e,customPrompt:t.target.value}),rows:10,className:"w-full px-3 py-2 border border-[color:var(--tab-options-button-border)] rounded-lg bg-[color:var(--tab-options-card-bg)] text-[var(--tab-options-title)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] font-mono text-xs",placeholder:c("options_custom_prompt_placeholder")}),t.jsxs("div",{className:"p-3 bg-[color:var(--tab-options-tag-bg)] rounded-lg",children:[t.jsx("p",{className:"text-xs font-medium text-[var(--tab-options-pill-text)] mb-1",children:c("options_example_prompt")}),t.jsx("pre",{className:"text-xs text-[var(--tab-options-text-muted)] whitespace-pre-wrap max-h-32 overflow-y-auto",children:v}),t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>{o({...e,customPrompt:v})},className:"text-xs px-2 py-1 bg-[var(--tab-options-button-primary-bg)] hover:bg-[var(--tab-options-button-primary-hover)] text-[var(--tab-options-button-primary-text)] rounded-md transition-colors duration-200",children:c("options_use_example")}),t.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(v).then(()=>{a(c("options_example_copied")),setTimeout(()=>a(null),2e3)})},className:"text-xs px-2 py-1 bg-[var(--tab-options-button-primary-bg)] hover:bg-[var(--tab-options-button-primary-hover)] text-[var(--tab-options-button-primary-text)] rounded-md transition-colors duration-200",children:c("options_copy_example")})]})]})]})]})]})]})]})}function I({formData:o,setFormData:a,setSuccessMessage:r}){const[s,n]=e.useState(!1),[i,l]=e.useState(null),[d,p]=e.useState([]);return t.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur transition-shadow hover:shadow-lg",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[var(--tab-options-modal-topbar-from)] via-[var(--tab-options-modal-topbar-via)] to-[var(--tab-options-modal-topbar-to)]"}),t.jsxs("div",{className:"p-6 pt-10 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--tab-options-title)]",children:c("options_newtab_folder_title")}),t.jsx("p",{className:"mt-2 text-sm text-[var(--tab-options-text)]",children:c("options_newtab_folder_desc")}),t.jsx("p",{className:"mt-2 text-xs text-[var(--tab-options-text-muted)]",children:c("options_newtab_root_hint")}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("options_newtab_ai_organize_hint")})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_enable_newtab_ai")}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("options_enable_newtab_ai_desc")})]}),t.jsx("button",{type:"button",role:"switch","aria-checked":o.enableNewtabAI,onClick:()=>a({...o,enableNewtabAI:!o.enableNewtabAI}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)] focus:ring-offset-2 "+(o.enableNewtabAI?"bg-[var(--tab-options-button-primary-bg)]":"bg-[var(--tab-options-button-hover-bg)]"),children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-[var(--tab-options-switch-thumb)] shadow ring-0 transition duration-200 ease-in-out "+(o.enableNewtabAI?"translate-x-5":"translate-x-0")})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-[var(--tab-options-text)] mb-2",children:[c("options_recommend_count"),": ",o.newtabFolderRecommendCount]}),t.jsx("input",{type:"range",min:"1",max:"20",value:o.newtabFolderRecommendCount,onChange:t=>a({...o,newtabFolderRecommendCount:Number(t.target.value)}),className:"w-full"}),t.jsx("p",{className:"mt-1 text-xs text-[var(--tab-options-text-muted)]",children:c("options_recommend_count_hint")})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--tab-options-text)]",children:c("options_custom_prompt")}),t.jsx("button",{type:"button",role:"switch","aria-checked":o.enableNewtabFolderPrompt,onClick:()=>a({...o,enableNewtabFolderPrompt:!o.enableNewtabFolderPrompt}),className:"relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none "+(o.enableNewtabFolderPrompt?"bg-[var(--tab-options-button-primary-bg)]":"bg-[var(--tab-options-button-hover-bg)]"),children:t.jsx("span",{className:"pointer-events-none inline-block h-4 w-4 transform rounded-full bg-[var(--tab-options-switch-thumb)] shadow ring-0 transition duration-200 ease-in-out "+(o.enableNewtabFolderPrompt?"translate-x-4":"translate-x-0")})})]}),o.enableNewtabFolderPrompt&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("textarea",{value:o.newtabFolderPrompt,onChange:t=>a({...o,newtabFolderPrompt:t.target.value}),placeholder:h,rows:8,className:"w-full rounded-lg border border-[var(--tab-options-card-border)] bg-[var(--tab-options-card-bg)] px-3 py-2 text-sm text-[var(--tab-options-text)] placeholder-[var(--tab-options-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-options-button-primary-bg)]"}),t.jsxs("p",{className:"text-xs text-[var(--tab-options-text-muted)]",children:[c("options_prompt_variables"),": ","{{title}}",", ","{{url}}",", ","{{description}}",", ","{{folderPaths}}",","," ","{{recommendCount}}"]})]})]}),t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:async()=>{try{if(n(!0),l(null),!chrome?.runtime?.sendMessage)throw new Error(c("options_chrome_runtime_error"));const t=await chrome.runtime.sendMessage({type:"GET_NEWTAB_FOLDERS"});if(!t?.success)throw new Error(t?.error||c("options_load_paths_failed"));const e=(t.data?.folders||[]).filter(e=>e.id!==t.data?.rootId).map(t=>t.path).filter(Boolean);p(e),r(c("options_load_paths_success"))}catch(t){l(t instanceof Error?t.message:c("options_load_paths_failed")),p([])}finally{n(!1)}},disabled:s,className:"rounded-lg bg-[var(--tab-options-button-primary-bg)] px-4 py-2 text-sm font-medium text-[var(--tab-options-button-primary-text)] hover:opacity-90 disabled:opacity-50",children:c(s?"options_loading_paths":"options_load_paths")}),i&&t.jsx("p",{className:"mt-2 text-xs text-red-500",children:i}),d.length>0&&t.jsxs("div",{className:"mt-2 max-h-32 overflow-y-auto rounded-lg border border-[var(--tab-options-card-border)] bg-[var(--tab-options-card-bg)] p-2",children:[t.jsx("p",{className:"text-xs text-[var(--tab-options-text-muted)] mb-1",children:c("options_paths_loaded",[d.length.toString()])}),d.slice(0,10).map((e,o)=>t.jsx("div",{className:"text-xs text-[var(--tab-options-text)]",children:e},o)),d.length>10&&t.jsx("div",{className:"text-xs text-[var(--tab-options-text-muted)]",children:c("options_more_paths",[(d.length-10).toString()])})]})]})]})]})]})}const T={openai:m.OPENAI,deepseek:m.DEEPSEEK,siliconflow:m.SILICONFLOW},M=new Set(["openai","deepseek","siliconflow","custom"]),D=t=>{const e=t.trim();return e?e.replace(/\s+/g,"").replace(/\/chat\/completions$/,"").replace(/\/$/,""):e},K=(t,e)=>{if(!M.has(t))return!1;if("custom"===t){const t=e?.trim();return Boolean(t&&/^https?:\/\//.test(t))}return!0};async function U(t,e,o){if(!M.has(t))throw new Error(c("error_provider_not_supported"));if(!e.trim())throw new Error(c("error_missing_api_key"));const a=((t,e)=>{if(e&&e.trim())return D(e);const o=T[t];return o?D(o):void 0})(t,o);if(!a)throw new Error(c("error_missing_api_url"));return(async(t,e)=>{const o=`${t}/models`,a=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!a.ok){const t=await a.text();throw new Error(c("error_fetch_models",[String(a.status),t||a.statusText]))}const r=await a.json();if(!Array.isArray(r?.data))throw new Error(c("error_model_list_invalid"));const s=r.data.map(t=>{if(t&&"object"==typeof t&&"id"in t)return t.id}).filter(t=>"string"==typeof t&&t.length>0);if(0===s.length)throw new Error(c("error_model_list_empty"));return s})(a,e)}function L(){const{config:t,loadConfig:o,saveConfig:a,syncCache:r,error:d,successMessage:p,isLoading:b,setError:m,setSuccessMessage:u}=s(),[x,h]=e.useState({theme:"auto",themeStyle:"default",aiProvider:"openai",apiKey:"",apiUrl:"",aiModel:"",bookmarkApiUrl:"",bookmarkApiKey:"",enableCustomPrompt:!1,customPrompt:v,maxSuggestedTags:5,defaultVisibility:"public",enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1,tagTheme:"classic",newtabFolderRecommendCount:10,enableNewtabAI:!0,enableNewtabFolderPrompt:!1,newtabFolderPrompt:""}),[_,y]=e.useState({tags:0,bookmarks:0,lastSync:0}),[j,w]=e.useState(!1),[N,k]=e.useState([]),[C,S]=e.useState(!1),[P,A]=e.useState(null),[E,F]=e.useState(0),I=e.useRef(null),[T,M]=e.useState({}),[D,L]=e.useState(!1),[O,R]=e.useState(""),[$,z]=e.useState(!1),[V,B]=e.useState(null),q=()=>`${Date.now()}-${Math.random().toString(16).slice(2,10)}`;e.useEffect(()=>{(async()=>{await o();const t=await f.getStats();y(t)})()},[]),e.useEffect(()=>(n(x.theme),i(()=>x.theme)),[x.theme]),e.useEffect(()=>{l(x.themeStyle)},[x.themeStyle]),e.useEffect(()=>{if(!t)return;const e=t.aiConfig.provider,o=t.aiConfig.apiKeys[e]||"",a=t.aiConfig.apiUrls?.[e]||"";h(r=>({...r,theme:t.preferences.theme??"auto",themeStyle:t.preferences.themeStyle??"default",aiProvider:e,apiKey:o,apiUrl:a,aiModel:t.aiConfig.model||"",bookmarkApiUrl:t.bookmarkSite.apiUrl,bookmarkApiKey:t.bookmarkSite.apiKey,enableCustomPrompt:t.aiConfig.enableCustomPrompt||!1,customPrompt:t.aiConfig.customPrompt||r.customPrompt,maxSuggestedTags:t.preferences.maxSuggestedTags,defaultVisibility:t.preferences.defaultVisibility,enableAI:t.preferences.enableAI??!0,defaultIncludeThumbnail:t.preferences.defaultIncludeThumbnail??!0,defaultCreateSnapshot:t.preferences.defaultCreateSnapshot??!1,tagTheme:t.preferences.tagTheme??"classic",newtabFolderRecommendCount:Math.min(20,Math.max(1,Number(t.preferences.newtabFolderRecommendCount??10))),enableNewtabAI:t.preferences.enableNewtabAI??!0,enableNewtabFolderPrompt:t.preferences.enableNewtabFolderPrompt??!1,newtabFolderPrompt:t.preferences.newtabFolderPrompt??""}));const r=(t=>{const e={};return t?(Object.keys(t).forEach(o=>{const a=t[o]||[];e[o]=Array.isArray(a)?a.slice(0,10).map(t=>({...t,provider:t.provider||o,id:t.id||q()})):[]}),e):e})(t.aiConfig.savedConnections);M(r)},[t]);e.useEffect(()=>{const t=K(x.aiProvider,x.apiUrl),e=x.apiKey.trim();if(!t||!e)return k([]),A(null),S(!1),void(I.current=null);const o=`${x.aiProvider}|${(x.apiUrl||"").trim()}|${e}|${E}`;if(I.current===o)return;let a=!1;return(async()=>{S(!0),A(null);try{const t=await U(x.aiProvider,e,x.apiUrl);if(a)return;k(t),S(!1),A(null),I.current=o,h(e=>e.aiModel?e:{...e,aiModel:t[0]||""})}catch(t){if(a)return;k([]),A(t instanceof Error?t.message:String(t)),S(!1),I.current=o}})(),()=>{a=!0}},[x.aiProvider,x.apiUrl,x.apiKey,E]);const W=e.useMemo(()=>Object.entries(T).flatMap(([t,e])=>(e||[]).map(e=>({...e,provider:e.provider||t}))),[T]),G=K(x.aiProvider,x.apiUrl);return{config:t,error:d,successMessage:p,isLoading:b,setError:m,setSuccessMessage:u,formData:x,setFormData:h,stats:_,isTesting:j,availableModels:N,isFetchingModels:C,modelFetchError:P,modelFetchSupported:G,savedConnections:T,allSavedConnections:W,isPresetModalOpen:D,presetLabel:O,isSavingPreset:$,presetError:V,setPresetLabel:R,handleProviderChange:e=>{const o=t?.aiConfig.apiKeys[e]||"",a=t?.aiConfig.apiUrls?.[e]||"";h(t=>({...t,aiProvider:e,apiKey:o,apiUrl:a})),k([]),A(null),I.current=null},refreshModelOptions:()=>{K(x.aiProvider,x.apiUrl)&&x.apiKey.trim()&&(I.current=null,F(t=>t+1))},handleSave:async()=>{try{await a({aiConfig:{provider:x.aiProvider,apiKeys:{...t?.aiConfig.apiKeys,[x.aiProvider]:x.apiKey},apiUrls:{...t?.aiConfig.apiUrls,[x.aiProvider]:x.apiUrl},model:x.aiModel,enableCustomPrompt:x.enableCustomPrompt,customPrompt:x.customPrompt,savedConnections:T},bookmarkSite:{apiUrl:x.bookmarkApiUrl,apiKey:x.bookmarkApiKey},preferences:{theme:x.theme,themeStyle:x.themeStyle,autoSync:t?.preferences.autoSync??!0,syncInterval:t?.preferences.syncInterval??24,maxSuggestedTags:x.maxSuggestedTags,defaultVisibility:x.defaultVisibility,enableAI:x.enableAI,defaultIncludeThumbnail:x.defaultIncludeThumbnail,defaultCreateSnapshot:x.defaultCreateSnapshot,tagTheme:x.tagTheme,newtabFolderRecommendCount:Math.min(20,Math.max(1,Number(x.newtabFolderRecommendCount??10))),enableNewtabAI:x.enableNewtabAI,enableNewtabFolderPrompt:x.enableNewtabFolderPrompt,newtabFolderPrompt:x.newtabFolderPrompt}}),u(c("msg_settings_saved")),setTimeout(()=>u(null),2e3)}catch(e){m(e instanceof Error?e.message:c("error_save_failed"))}},handleSync:async()=>{try{await r();const t=await f.getStats();y(t)}catch(t){m(t instanceof Error?t.message:c("error_save_failed"))}},handleTestAPI:async()=>{try{w(!0),m(null);const{getAIProvider:t}=await g(async()=>{const{getAIProvider:t}=await import("./index-8lkdjZ4V.js").then(t=>t.i);return{getAIProvider:t}},__vite__mapDeps([0,1,2])),e=t(x.aiProvider),o={page:{title:"Claude Code - AI Programming Assistant",url:"https://claude.ai",description:"Claude is a powerful AI programming assistant",content:"Claude Code is an intelligent programming tool by Anthropic, supporting multiple programming languages and frameworks."},context:{existingTags:["Dev Tools","AI","Programming","Productivity"],recentBookmarks:[]},options:{maxTags:3,preferExisting:!0}},a=await e.generateTags(o,x.apiKey,x.aiModel||void 0,x.apiUrl||void 0,x.enableCustomPrompt?x.customPrompt:void 0);u(c("api_test_success",[String(a.suggestedTags.length),a.suggestedTags.map(t=>t.name).join(", ")])),setTimeout(()=>u(null),5e3)}catch(t){m(t instanceof Error?t.message:c("api_test_failed"))}finally{w(!1)}},formatDate:t=>t?new Date(t).toLocaleString():c("never_synced"),handleReset:()=>{confirm(c("confirm_reset"))&&(h({theme:"auto",themeStyle:"default",aiProvider:"openai",apiKey:"",apiUrl:"",aiModel:"",bookmarkApiUrl:"",bookmarkApiKey:"",enableCustomPrompt:!1,customPrompt:v,maxSuggestedTags:5,defaultVisibility:"public",enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1,tagTheme:"classic",newtabFolderRecommendCount:10,enableNewtabAI:!0,enableNewtabFolderPrompt:!1,newtabFolderPrompt:""}),u(c("msg_settings_reset")),setTimeout(()=>u(null),2e3))},handleSaveConnectionPreset:()=>{if(!x.apiKey.trim())return void m(c("error_api_key_required"));const t=c("preset_default_name",String((T[x.aiProvider]?.length||0)+1));R(t),B(null),L(!0)},handleConfirmSaveConnectionPreset:async()=>{const e=x.apiKey.trim();if(!e)return void B(c("error_api_key_required"));const o=O.trim();if(!o)return void B(c("error_preset_name_required"));if(!t)return m(c("error_config_not_loaded")),void L(!1);z(!0),B(null);const r={apiUrl:x.apiUrl,apiKey:e,model:x.aiModel,label:o,provider:x.aiProvider},s=T,n=((t,e,o)=>{const a=t[e]||[],r=(o.apiUrl||"").trim(),s=(o.apiKey||"").trim(),n=(o.model||"").trim(),i={...o,apiUrl:r||void 0,apiKey:s||void 0,model:n||void 0,provider:e,label:o.label?.trim()||o.label,lastUsedAt:Date.now(),id:o.id||q()},l=Boolean(o.id),d=l?a.findIndex(t=>t.id&&t.id===o.id):-1;let p;return l&&d>=0?(p=[...a],p[d]=i):p=[i,...a].slice(0,10),{...t,[e]:p}})(s,x.aiProvider,r);M(n);try{await a({aiConfig:{...t.aiConfig,savedConnections:n}}),u(c("msg_preset_saved",o)),setTimeout(()=>u(null),2e3),L(!1)}catch(i){M(s),B(i instanceof Error?i.message:c("error_save_preset_failed"))}finally{z(!1)}},handleClosePresetModal:()=>{$||(L(!1),B(null))},handleApplySavedConnection:(t,e)=>{const o=e||t.provider||x.aiProvider;h(e=>({...e,aiProvider:o,apiUrl:t.apiUrl||"",apiKey:t.apiKey||"",aiModel:t.model||""})),o!==x.aiProvider&&(k([]),A(null),I.current=null)},handleDeleteSavedConnection:async(e,o)=>{const r=o||e.provider||x.aiProvider;if(!r)return void m(c("error_provider_unknown"));const s=T,n=((t,e,o)=>{const a=t[e]||[],r=(o.apiUrl||"").trim(),s=(o.apiKey||"").trim(),n=(o.model||"").trim(),i=a.filter(t=>o.id&&t.id?t.id!==o.id:(t.apiUrl||"").trim()!==r||(t.apiKey||"").trim()!==s||(t.model||"").trim()!==n),l={...t};return i.length>0?l[e]=i:delete l[e],l})(s,r,e);M(n);try{if(!t)throw new Error(c("error_config_not_loaded"));await a({aiConfig:{...t.aiConfig,savedConnections:n}}),u(c("msg_connection_deleted")),setTimeout(()=>u(null),2e3)}catch(i){M(s),m(i instanceof Error?i.message:c("error_delete_connection_failed"))}}}}function O(){const{error:o,successMessage:a,isLoading:r,setError:s,setSuccessMessage:n,formData:i,setFormData:l,stats:b,isTesting:m,availableModels:u,isFetchingModels:x,modelFetchError:v,modelFetchSupported:h,allSavedConnections:g,isPresetModalOpen:f,presetLabel:_,isSavingPreset:y,presetError:j,setPresetLabel:w,handleProviderChange:N,refreshModelOptions:k,handleSave:T,handleSync:M,formatDate:D,handleReset:K,handleTestAPI:U,handleSaveConnectionPreset:O,handleConfirmSaveConnectionPreset:R,handleClosePresetModal:$,handleApplySavedConnection:z,handleDeleteSavedConnection:V}=L(),[B,q]=e.useState("ai"),W=e.useMemo(()=>[{id:"ai",label:c("options_tab_ai")},{id:"tmarkstag",label:"TMarks"},{id:"newtabtag",label:"NewTab"},{id:"preferences",label:c("options_tab_preferences")},{id:"tmarks",label:c("options_tab_tmarks")}],[]);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"min-h-screen w-screen bg-gradient-to-br from-[var(--tab-options-page-bg-from)] via-[var(--tab-options-page-bg-via)] to-[var(--tab-options-page-bg-to)]",children:t.jsxs("div",{className:"w-4/5 mx-auto px-6 py-12",children:[t.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur mb-10",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[color:var(--tab-options-hero-gradient-from)] via-[color:var(--tab-options-hero-gradient-via)] to-[color:var(--tab-options-hero-gradient-to)]"}),t.jsxs("div",{className:"relative p-10",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[color:var(--tab-options-pill-bg)] text-sm font-medium text-[var(--tab-options-pill-text)]",children:c("options_title")}),t.jsx("h1",{className:"mt-4 text-4xl font-bold text-[var(--tab-options-title)] tracking-tight",children:c("options_subtitle")}),t.jsx("p",{className:"mt-3 max-w-2xl text-base text-[var(--tab-options-text)]",children:c("options_description")}),t.jsxs("div",{className:"mt-6 flex flex-wrap gap-3 text-xs font-medium text-[var(--tab-options-text-muted)]",children:[t.jsx("span",{className:"px-3 py-1 rounded-full bg-[color:var(--tab-options-tag-bg)] border border-[color:var(--tab-options-tag-border)]",children:c("options_tag_ai")}),t.jsx("span",{className:"px-3 py-1 rounded-full bg-[color:var(--tab-options-tag-bg)] border border-[color:var(--tab-options-tag-border)]",children:c("options_tag_sync")}),t.jsx("span",{className:"px-3 py-1 rounded-full bg-[color:var(--tab-options-tag-bg)] border border-[color:var(--tab-options-tag-border)]",children:c("options_tag_security")})]})]})]}),t.jsxs("div",{className:"mb-10 space-y-4",children:[o&&t.jsx(d,{message:o,onDismiss:()=>s(null)}),a&&t.jsx(p,{message:a})]}),t.jsxs("div",{className:"grid gap-8 lg:grid-cols-12",children:[t.jsx("div",{className:"lg:col-span-3",children:t.jsxs("div",{className:"sticky top-8 space-y-4",children:[t.jsxs("div",{className:"rounded-2xl border border-[color:var(--tab-options-card-border)] bg-[color:var(--tab-options-card-bg)] shadow-sm backdrop-blur p-3",children:[t.jsx("div",{className:"space-y-2",children:W.map(e=>t.jsx("button",{type:"button",onClick:()=>q(e.id),className:"w-full text-left px-4 py-2 rounded-xl text-sm font-medium transition-colors "+(B===e.id?"bg-[var(--tab-options-button-primary-bg)] text-[var(--tab-options-button-primary-text)]":"text-[var(--tab-options-text)] hover:bg-[var(--tab-options-button-hover-bg)]"),children:e.label},e.id))}),t.jsxs("div",{className:"mt-4 border-t border-[color:var(--tab-options-card-border)] pt-4 space-y-3",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--tab-options-text-muted)]",children:c("options_save_sync")}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("button",{type:"button",onClick:K,className:"w-full rounded-lg border border-[color:var(--tab-options-button-border)] px-3 py-2 text-sm font-medium text-[var(--tab-options-button-text)] hover:bg-[var(--tab-options-button-hover-bg)] transition-colors",children:c("btn_reset")}),t.jsx("button",{type:"button",onClick:T,disabled:r,className:"w-full rounded-lg bg-[var(--tab-options-button-primary-bg)] px-3 py-2 text-sm font-medium text-[var(--tab-options-button-primary-text)] shadow-sm hover:bg-[var(--tab-options-button-primary-hover)] disabled:cursor-not-allowed disabled:opacity-60 transition-colors",children:c(r?"btn_saving":"btn_save")})]})]})]}),t.jsx(A,{stats:b,handleSync:M,isLoading:r,formatDate:D})]})}),t.jsxs("div",{className:"lg:col-span-9 space-y-8",children:["ai"===B&&t.jsx(C,{formData:i,setFormData:l,handleProviderChange:N,handleTestConnection:U,isTesting:m,availableModels:u,isFetchingModels:x,modelFetchError:v,onRefreshModels:k,modelFetchSupported:h,allSavedConnections:g,onApplySavedConnection:z,onDeleteSavedConnection:V,onSaveConnectionPreset:O}),"tmarkstag"===B&&t.jsx(F,{formData:i,setFormData:l,setSuccessMessage:n}),"newtabtag"===B&&t.jsx(I,{formData:i,setFormData:l,setSuccessMessage:n}),"preferences"===B&&t.jsx(P,{formData:i,setFormData:l}),"tmarks"===B&&t.jsx(S,{formData:i,setFormData:l})]})]})]})}),t.jsx(E,{isOpen:f,presetLabel:_,presetError:j,isSaving:y,onClose:$,onConfirm:R,onChangeLabel:w})]})}const R=document.getElementById("root");R&&x().then(()=>{o.createRoot(R).render(t.jsx(a.StrictMode,{children:t.jsx(O,{})}))});
