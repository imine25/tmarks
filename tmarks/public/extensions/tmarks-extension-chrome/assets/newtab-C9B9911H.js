import{c as e,r as t,j as n,b as r,a as s,R as o}from"./react-DmgQkRKB.js";import{_ as a}from"./preload-helper-BhLMWRjL.js";import{S as i,g as l}from"./urls-CEh1Kean.js";import{c,l as d,F as u,P as h}from"./index-DFgX45QT.js";import{c as m}from"./index-CK9CFPi6.js";const f=c("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),p=c("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),g=c("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),x=c("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),v=c("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),w=c("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),b=c("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),y=c("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),j=c("folder-input",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),k=c("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),N=c("gamepad-2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]),C=c("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),S=c("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),E=c("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),I=c("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),D=c("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),R=c("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),M=c("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),z=c("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),T=c("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),A=c("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),L=c("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),B=c("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),F=c("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),O=c("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),P=c("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),G=c("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),$=c("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),U=c("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),H=c("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),_=c("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),q=c("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Y=[{id:"google",name:"Google",url:"https://www.google.com/search?q=",icon:"https://www.google.com/favicon.ico"},{id:"bing",name:"Bing",url:"https://www.bing.com/search?q=",icon:"https://www.bing.com/favicon.ico"},{id:"zhihu",name:"知乎",url:"https://www.zhihu.com/search?type=content&q=",icon:"https://static.zhihu.com/heifetz/favicon.ico"},{id:"github",name:"GitHub",url:"https://github.com/search?q=",icon:"https://github.com/favicon.ico"},{id:"bilibili",name:"B站",url:"https://search.bilibili.com/all?keyword=",icon:"https://www.bilibili.com/favicon.ico"}],X={showClock:!0,clockFormat:"24h",showDate:!0,showSeconds:!1,showSearch:!0,searchEngine:"google",showShortcuts:!0,shortcutColumns:8,shortcutStyle:"icon",wallpaper:{type:"bing",value:"",blur:0,brightness:100,bingHistoryIndex:0,showBingInfo:!1},showPinnedBookmarks:!0,enableSearchSuggestions:!0,autoRefreshPinnedBookmarks:!0,pinnedBookmarksRefreshTime:"morning",showGreeting:!0,userName:"",showLunar:!0,showPoetry:!0,hotSearchType:"baidu"},K=[{content:"海内存知己，天涯若比邻。",author:"王勃",title:"送杜少府之任蜀州"},{content:"落霞与孤鹜齐飞，秋水共长天一色。",author:"王勃",title:"滕王阁序"},{content:"人生得意须尽欢，莫使金樽空对月。",author:"李白",title:"将进酒"},{content:"长风破浪会有时，直挂云帆济沧海。",author:"李白",title:"行路难"},{content:"会当凌绝顶，一览众山小。",author:"杜甫",title:"望岳"},{content:"读书破万卷，下笔如有神。",author:"杜甫",title:"奉赠韦左丞丈二十二韵"},{content:"春风得意马蹄疾，一日看尽长安花。",author:"孟郊",title:"登科后"},{content:"沉舟侧畔千帆过，病树前头万木春。",author:"刘禹锡",title:"酬乐天扬州初逢席上见赠"},{content:"山重水复疑无路，柳暗花明又一村。",author:"陆游",title:"游山西村"},{content:"纸上得来终觉浅，绝知此事要躬行。",author:"陆游",title:"冬夜读书示子聿"},{content:"问渠那得清如许？为有源头活水来。",author:"朱熹",title:"观书有感"},{content:"不畏浮云遮望眼，自缘身在最高层。",author:"王安石",title:"登飞来峰"}],W="newtab",V="https://www.google.com/s2/favicons?domain=",J=[{id:"home",name:"首页",icon:"Home",position:0}],Z=["Home","Briefcase","GraduationCap","Gamepad2","Wrench","Code","Music","Film","ShoppingCart","Heart","Star","Bookmark","Folder","Globe","Zap"],Q={shortcut:{type:"shortcut",name:"快捷方式",icon:"Link",description:"网站快捷方式",sizeConfig:{type:"shortcut",defaultSize:"1x1",allowedSizes:["1x1"],minWidth:1,minHeight:1}},weather:{type:"weather",name:"天气",icon:"Cloud",description:"显示当前天气和未来预报",sizeConfig:{type:"weather",defaultSize:"2x2",allowedSizes:["2x1","2x2","2x3"],minWidth:2,minHeight:1}},clock:{type:"clock",name:"时钟",icon:"Clock",description:"显示当前时间",sizeConfig:{type:"clock",defaultSize:"2x1",allowedSizes:["2x1","2x2"],minWidth:2,minHeight:1}},todo:{type:"todo",name:"待办事项",icon:"CheckSquare",description:"管理待办任务",sizeConfig:{type:"todo",defaultSize:"2x2",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},notes:{type:"notes",name:"备忘录",icon:"StickyNote",description:"快速记录笔记",sizeConfig:{type:"notes",defaultSize:"2x2",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},hotsearch:{type:"hotsearch",name:"热搜",icon:"TrendingUp",description:"显示热门搜索",sizeConfig:{type:"hotsearch",defaultSize:"2x3",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},poetry:{type:"poetry",name:"每日诗词",icon:"BookOpen",description:"显示每日诗词",sizeConfig:{type:"poetry",defaultSize:"2x1",allowedSizes:["2x1","2x2"],minWidth:2,minHeight:1}}};let ee=null;function te(e){ee&&clearTimeout(ee),ee=setTimeout(()=>{!async function(e){try{const t=await i.getBookmarkSiteApiUrl(),n=await i.getBookmarkSiteApiKey();if(!n)return;const r=t?.endsWith("/api")?t:l(t||void 0).API_BASE;(await fetch(`${r}/tab/newtab/sync`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":n},body:JSON.stringify({shortcuts:e.shortcuts.map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,group_id:e.groupId,folder_id:e.folderId,position:e.position})),groups:e.groups.map(e=>({id:e.id,name:e.name,icon:e.icon,position:e.position})),folders:e.folders.map(e=>({id:e.id,name:e.name,icon:e.icon,group_id:e.groupId,position:e.position})),settings:{columns:e.settings.shortcutColumns,style:e.settings.shortcutStyle,showTitle:!0,backgroundType:e.settings.wallpaper.type,backgroundValue:e.settings.wallpaper.value,backgroundBlur:e.settings.wallpaper.blur,backgroundDim:e.settings.wallpaper.brightness,showSearch:e.settings.showSearch,showClock:e.settings.showClock,showPinnedBookmarks:e.settings.showPinnedBookmarks,searchEngine:e.settings.searchEngine},gridItems:e.gridItems.map(e=>({id:e.id,type:e.type,size:e.size,position:e.position,group_id:e.groupId,shortcut:e.shortcut,config:e.config}))})})).ok}catch(t){}}(e)},2e3)}const ne=()=>`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,re=e((e,t)=>({shortcuts:[],shortcutGroups:J,shortcutFolders:[],activeGroupId:"home",settings:X,isLoading:!0,gridItems:[],loadData:async()=>{try{const n=(await chrome.storage.local.get(W))[W],r=n?.shortcutGroups?.length?n.shortcutGroups:J;let s=n?.activeGroupId;s&&r.some(e=>e.id===s)||(s=r[0]?.id||"home");const o={...X,...n?.settings||{}};if(e({shortcuts:n?.shortcuts||[],shortcutGroups:r,shortcutFolders:n?.shortcutFolders||[],activeGroupId:s,settings:o,gridItems:n?.gridItems||[],isLoading:!1}),!n){const{saveData:e}=t();e()}}catch(n){e({isLoading:!1})}},saveData:async()=>{const{shortcuts:e,shortcutGroups:n,shortcutFolders:r,activeGroupId:s,settings:o,gridItems:a}=t(),i={shortcuts:e,shortcutGroups:n,shortcutFolders:r,activeGroupId:s,settings:o,gridItems:a};try{await chrome.storage.local.set({[W]:i})}catch(l){}},addShortcut:n=>{const{shortcuts:r,shortcutGroups:s,settings:o,gridItems:i,saveData:l}=t(),c={...n,id:ne(),position:r.length,createdAt:Date.now(),clickCount:0},d=[...r,c];e({shortcuts:d}),l(),(async()=>{try{const{downloadFavicon:e}=await a(async()=>{const{downloadFavicon:e}=await Promise.resolve().then(()=>xr);return{downloadFavicon:e}},void 0),n=await e(c.url);if(n){const{updateShortcut:e}=t();e(c.id,{faviconBase64:n})}}catch(e){}})();const{shortcutFolders:u}=t();te({shortcuts:d,groups:s,folders:u,settings:o,gridItems:i})},updateShortcut:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=s.map(e=>e.id===n?{...e,...r}:e);e({shortcuts:d}),c(),te({shortcuts:d,groups:o,folders:a,settings:i,gridItems:l})},removeShortcut:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:a,gridItems:i,saveData:l}=t(),c=r.filter(e=>e.id!==n).map((e,t)=>({...e,position:t}));e({shortcuts:c}),l(),te({shortcuts:c,groups:s,folders:o,settings:a,gridItems:i})},reorderShortcuts:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=[...s],[u]=d.splice(n,1);d.splice(r,0,u);const h=d.map((e,t)=>({...e,position:t}));e({shortcuts:h}),c(),te({shortcuts:h,groups:o,folders:a,settings:i,gridItems:l})},incrementClickCount:n=>{const{shortcuts:r,saveData:s}=t();e({shortcuts:r.map(e=>e.id===n?{...e,clickCount:e.clickCount+1}:e)}),s()},updateSettings:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:a,gridItems:i,saveData:l}=t(),c={...a,...n};e({settings:c}),l(),te({shortcuts:r,groups:s,folders:o,settings:c,gridItems:i})},setActiveGroup:n=>{const{saveData:r}=t();e({activeGroupId:n}),r()},addGroup:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d={id:ne(),name:n,icon:r,position:o.length},u=[...o,d];e({shortcutGroups:u}),c(),te({shortcuts:s,groups:u,folders:a,settings:i,gridItems:l})},updateGroup:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=o.map(e=>e.id===n?{...e,...r}:e);e({shortcutGroups:d}),c(),te({shortcuts:s,groups:d,folders:a,settings:i,gridItems:l})},removeGroup:n=>{const{shortcutGroups:r,shortcutFolders:s,shortcuts:o,activeGroupId:a,settings:i,gridItems:l,saveData:c}=t();if("home"===n)return;const d=o.map(e=>e.groupId===n?{...e,groupId:"home"}:e),u=r.filter(e=>e.id!==n);e({shortcutGroups:u,shortcuts:d,activeGroupId:a===n?"home":a}),c(),te({shortcuts:d,groups:u,folders:s,settings:i,gridItems:l})},getFilteredShortcuts:()=>{const{shortcuts:e,activeGroupId:n}=t(),r=n??"home";return e.filter(e=>e.groupId===r&&!e.folderId)},addFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,activeGroupId:i,settings:l,gridItems:c,saveData:d}=t(),u={id:ne(),name:n,position:a.length,groupId:r??i??void 0,createdAt:Date.now()},h=[...a,u];return e({shortcutFolders:h}),d(),te({shortcuts:s,groups:o,folders:h,settings:l,gridItems:c}),u.id},updateFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=a.map(e=>e.id===n?{...e,...r}:e);e({shortcutFolders:d}),c(),te({shortcuts:s,groups:o,folders:d,settings:i,gridItems:l})},removeFolder:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:a,gridItems:i,saveData:l}=t(),c=r.map(e=>e.folderId===n?{...e,folderId:void 0}:e),d=o.filter(e=>e.id!==n);e({shortcutFolders:d,shortcuts:c}),l(),te({shortcuts:c,groups:s,folders:d,settings:a,gridItems:i})},getFolderShortcuts:e=>{const{shortcuts:n}=t();return n.filter(t=>t.folderId===e)},moveShortcutToFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=s.map(e=>e.id===n?{...e,folderId:r}:e);e({shortcuts:d}),c(),te({shortcuts:d,groups:o,folders:a,settings:i,gridItems:l})},addGridItem:(n,r={})=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:l,gridItems:c,activeGroupId:d,saveData:u}=t(),h=function(e){return Q[e]}(n),m=function(e){switch(e){case"weather":return{weather:{city:"北京",unit:"C",showForecast:!0,autoLocation:!1}};case"clock":return{clock:{format:"24h",showDate:!0,showSeconds:!1,showLunar:!1}};case"todo":return{todo:{showCompleted:!1}};case"notes":return{notes:{content:""}};case"hotsearch":return{hotsearch:{type:"baidu"}};case"poetry":return{poetry:{autoRefresh:!0}};default:return{}}}(n),f={id:ne(),type:n,size:r.size||h.sizeConfig.defaultSize,position:c.length,groupId:r.groupId??d??void 0,shortcut:r.shortcut,config:"shortcut"!==n?m:void 0,createdAt:Date.now()},p=[...c,f];e({gridItems:p}),u(),te({shortcuts:s,groups:o,folders:i,settings:l,gridItems:p}),"shortcut"===n&&r.shortcut?.url&&(async()=>{try{const{downloadFavicon:e}=await a(async()=>{const{downloadFavicon:e}=await Promise.resolve().then(()=>xr);return{downloadFavicon:e}},void 0),n=await e(r.shortcut.url);if(n){const{updateGridItem:e}=t();e(f.id,{shortcut:{...r.shortcut,faviconBase64:n}})}}catch(e){}})()},updateGridItem:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=l.map(e=>e.id===n?{...e,...r}:e);e({gridItems:d}),c(),te({shortcuts:s,groups:o,folders:a,settings:i,gridItems:d})},removeGridItem:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:a,gridItems:i,saveData:l}=t(),c=i.filter(e=>e.id!==n).map((e,t)=>({...e,position:t}));e({gridItems:c}),l(),te({shortcuts:r,groups:s,folders:o,settings:a,gridItems:c})},reorderGridItems:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:a,settings:i,gridItems:l,saveData:c}=t(),d=[...l],[u]=d.splice(n,1);d.splice(r,0,u);const h=d.map((e,t)=>({...e,position:t}));e({gridItems:h}),c(),te({shortcuts:s,groups:o,folders:a,settings:i,gridItems:h})},getFilteredGridItems:()=>{const{gridItems:e,activeGroupId:n}=t(),r=n??"home";return e.filter(e=>e.groupId===r)},migrateToGridItems:()=>{const{shortcuts:n,gridItems:r,saveData:s}=t();if(0===n.length)return;const o=new Set(r.filter(e=>"shortcut"===e.type&&e.shortcut).map(e=>e.id)),a=n.filter(e=>!o.has(e.id));if(0===a.length)return;const i=a.map((e,t)=>({id:e.id,type:"shortcut",size:"1x1",position:r.length+t,groupId:e.groupId,shortcut:{url:e.url,title:e.title,favicon:e.favicon},createdAt:e.createdAt})),l=[...r,...i];e({gridItems:l}),s()}}));function se({format:e,showDate:r,showSeconds:s,showLunar:o=!1}){const[a,i]=t.useState(new Date);t.useEffect(()=>{const e=setInterval(()=>i(new Date),1e3);return()=>clearInterval(e)},[]);const l=t.useMemo(()=>{if(!o)return null;const e=d.Lunar.fromDate(a);let t="";try{const n=e.getFestivals?.()||[],r=e.getJieQi?.()||"";t=n[0]||r||""}catch{}return{date:`${e.getMonthInChinese()}月${e.getDayInChinese()}`,festival:t}},[a,o]);return n.jsxs("div",{className:"text-center text-white select-none",children:[n.jsx("div",{className:"text-7xl font-light tracking-wider text-shadow-lg",children:(()=>{let t=a.getHours();const n=a.getMinutes().toString().padStart(2,"0"),r=a.getSeconds().toString().padStart(2,"0");let o="";"12h"===e&&(o=t>=12?" PM":" AM",t=t%12||12);let i=`${t.toString().padStart(2,"0")}:${n}`;return s&&(i+=`:${r}`),"12h"===e&&(i+=o),i})()}),(r||o)&&n.jsxs("div",{className:"mt-2 text-lg text-white/90 text-shadow flex items-center justify-center gap-3",children:[r&&n.jsx("span",{children:a.toLocaleDateString("zh-CN",{weekday:"short",month:"numeric",day:"numeric"})}),r&&o&&n.jsx("span",{className:"text-white/50",children:"|"}),o&&l&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:l.date}),l.festival&&n.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 text-sm",children:l.festival})]})]})]})}const oe="tmarks_pinned_bookmarks";async function ae(){const e=await i.getBookmarkSiteApiUrl(),t=await i.getBookmarkSiteApiKey();if(!t)throw new Error("API Key 未配置");let n;return n=e?e.endsWith("/api")?e:l(e).API_BASE:l().API_BASE,m({apiKey:t,baseUrl:n})}function ie(){const[e,n]=t.useState({isSyncing:!1,lastSyncAt:null,error:null}),[r,s]=t.useState([]),o=t.useRef(null),a=t.useCallback(async()=>{try{const e=(await chrome.storage.local.get(oe))[oe];return e&&e.bookmarks?e.bookmarks:null}catch(e){return null}},[]),i=t.useCallback(async e=>{try{const t={bookmarks:e,timestamp:Date.now()};await chrome.storage.local.set({[oe]:t})}catch(t){}},[]),l=t.useCallback(async(e=!1)=>{if(!e){const e=await a();if(e)return s(e),n({isSyncing:!1,lastSyncAt:Date.now(),error:null}),e}n(e=>({...e,isSyncing:!0,error:null}));try{const e=await ae(),t=await e.bookmarks.getPinnedBookmarks({page_size:20});if(t.data?.bookmarks){const e=t.data.bookmarks.filter(e=>!0===e.is_pinned).map(e=>({id:e.id,url:e.url,title:e.title,favicon:e.favicon||void 0,is_pinned:!0}));s(e),await i(e)}return n({isSyncing:!1,lastSyncAt:Date.now(),error:null}),t.data?.bookmarks||[]}catch(t){const e=t instanceof Error?t.message:"同步失败";return n(t=>({...t,isSyncing:!1,error:e})),[]}},[a,i]),c=t.useCallback(async e=>{if(!e.trim())return[];try{const t=await ae(),n=await t.bookmarks.searchBookmarks(e,{page_size:10});return(n.data?.bookmarks||[]).map(e=>({id:e.id,url:e.url,title:e.title,favicon:e.favicon||void 0}))}catch{return[]}},[]),d=t.useCallback(async()=>{try{const e=await ae();return await e.bookmarks.getBookmarks({page_size:1}),!0}catch{return!1}},[]);t.useEffect(()=>{o.current=l},[l]),t.useEffect(()=>{const e=e=>{"REFRESH_PINNED_BOOKMARKS"===e.type&&o.current&&o.current(!0)};return chrome.runtime.onMessage.addListener(e),()=>{chrome.runtime.onMessage.removeListener(e)}},[]);const u=t.useCallback(async e=>{try{const t=e.map(e=>r.find(t=>t.id===e)).filter(e=>void 0!==e);s(t),await i(t);const n=await ae();await n.bookmarks.reorderPinnedBookmarks(e)}catch(t){await l(!0)}},[r,i,l]);return{syncState:e,pinnedBookmarks:r,fetchPinnedBookmarks:l,searchBookmarks:c,checkApiConfigured:d,reorderPinnedBookmarks:u}}function le({icon:e,name:t,size:r="md"}){const s="sm"===r?"w-4 h-4":"w-5 h-5";return n.jsx("img",{src:e,alt:t,className:`${s} object-contain`,onError:e=>{e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t&&!t.querySelector(".fallback-icon")){const e=document.createElement("span");e.className=`fallback-icon ${s} flex items-center justify-center`,e.innerHTML=`<svg class="${s} text-white/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,t.appendChild(e)}}})}function ce({current:e,onChange:r}){const[s,o]=t.useState(!1),a=Y.find(t=>t.id===e)||Y[0];return n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>o(!s),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:[n.jsx(le,{icon:a.icon,name:a.name}),n.jsx(x,{className:"w-3 h-3 text-white/60 transition-transform "+(s?"rotate-180":"")})]}),s&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),n.jsx("div",{className:"absolute top-full left-0 mt-2 w-40 rounded-xl glass-dark overflow-hidden z-50 animate-scaleIn",children:Y.map(t=>n.jsxs("button",{onClick:()=>{r(t.id),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2.5 text-left transition-colors "+(t.id===e?"bg-white/20":"hover:bg-white/10"),children:[n.jsx(le,{icon:t.icon,name:t.name}),n.jsx("span",{className:"text-sm text-white/80",children:t.name})]},t.id))})]})]})}function de(e,t){if(e)return e;try{const e=new URL(t).hostname;return`${V}${e}&sz=64`}catch{return""}}function ue({engine:e,enableSuggestions:r=!0,onEngineChange:s}){const[o,a]=t.useState(""),[i,l]=t.useState(!1),[c,d]=t.useState([]),[u,h]=t.useState(-1),[m,p]=t.useState(!1),g=t.useRef(null),x=t.useRef(),{shortcuts:v}=re(),{searchBookmarks:w}=ie(),b=Y.find(t=>t.id===e)||Y[0],y=t.useCallback(e=>{const t=e.toLowerCase();return v.filter(e=>e.title.toLowerCase().includes(t)||e.url.toLowerCase().includes(t)).slice(0,5).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"shortcut"}))},[v]);t.useEffect(()=>{if(o.trim())return x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{if(m){const e=y(o),t=(await w(o)).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"bookmark"})),n=[...e];t.forEach(e=>{n.some(t=>t.url===e.url)||n.push(e)}),d(n.slice(0,10))}else if(r){const e=y(o),t=(await w(o)).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"bookmark"})),n=[...e];t.forEach(e=>{n.some(t=>t.url===e.url)||n.push(e)}),d(n.slice(0,8))}},200),()=>{x.current&&clearTimeout(x.current)};d([])},[o,y,w,m,r]);const j=t.useCallback(()=>{if(!o.trim())return;const e=b.url+encodeURIComponent(o.trim());window.location.href=e},[o,b]),k=e=>{window.location.href=e.url},N=(m||r)&&i&&c.length>0;return n.jsxs("div",{className:"relative",children:[n.jsxs("div",{className:`\n          flex items-center gap-3 px-4 py-3 rounded-full\n          glass transition-all duration-200\n          ${i?"ring-2 ring-white/30 bg-white/15":"hover:bg-white/15"}\n        `,children:[s?n.jsx(ce,{current:e,onChange:s}):n.jsx(L,{className:"w-5 h-5 text-white/60 flex-shrink-0"}),n.jsx("input",{ref:g,type:"text",value:o,onChange:e=>{a(e.target.value),h(-1)},onKeyDown:e=>{"Enter"===e.key?u>=0&&c[u]?k(c[u]):m||j():"ArrowDown"===e.key?(e.preventDefault(),h(e=>Math.min(e+1,c.length-1))):"ArrowUp"===e.key?(e.preventDefault(),h(e=>Math.max(e-1,-1))):"Escape"===e.key&&(d([]),h(-1))},onFocus:()=>l(!0),onBlur:()=>setTimeout(()=>l(!1),150),placeholder:m?"搜索书签...":`在 ${b.name} 中搜索...`,className:"flex-1 bg-transparent text-white placeholder-white/50 outline-none text-base"}),n.jsx("button",{onClick:()=>p(!m),className:"p-2 rounded-full transition-all "+(m?"bg-blue-500/30 text-blue-400":"text-white/40 hover:text-white/70 hover:bg-white/10"),title:m?"切换到搜索引擎":"切换到书签搜索",children:n.jsx(f,{className:"w-4 h-4"})})]}),N&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 rounded-xl glass-dark overflow-hidden animate-scaleIn z-[100]",children:c.map((e,t)=>n.jsxs("button",{onClick:()=>k(e),className:`\n                w-full flex items-center gap-3 px-4 py-3 text-left\n                transition-colors\n                ${t===u?"bg-white/20":"hover:bg-white/10"}\n              `,children:[n.jsx("img",{src:de(e.favicon,e.url),alt:"",className:"w-5 h-5 rounded",onError:e=>{e.target.style.display="none"}}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-white truncate",children:e.title}),n.jsx("div",{className:"text-xs text-white/50 truncate",children:e.url})]}),n.jsx("span",{className:"text-xs text-white/30",children:"shortcut"===e.source?"快捷方式":"书签"})]},e.id))})]})}var he=r();const me="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function fe(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function pe(e){return"nodeType"in e}function ge(e){var t,n;return e?fe(e)?e:pe(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function xe(e){const{Document:t}=ge(e);return e instanceof t}function ve(e){return!fe(e)&&e instanceof ge(e).HTMLElement}function we(e){return e instanceof ge(e).SVGElement}function be(e){return e?fe(e)?e.document:pe(e)?xe(e)?e:ve(e)||we(e)?e.ownerDocument:document:document:document}const ye=me?t.useLayoutEffect:t.useEffect;function je(e){const n=t.useRef(e);return ye(()=>{n.current=e}),t.useCallback(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function ke(e,n){void 0===n&&(n=[e]);const r=t.useRef(e);return ye(()=>{r.current!==e&&(r.current=e)},n),r}function Ne(e,n){const r=t.useRef();return t.useMemo(()=>{const t=e(r.current);return r.current=t,t},[...n])}function Ce(e){const n=je(e),r=t.useRef(null),s=t.useCallback(e=>{e!==r.current&&(null==n||n(e,r.current)),r.current=e},[]);return[r,s]}function Se(e){const n=t.useRef();return t.useEffect(()=>{n.current=e},[e]),n.current}let Ee={};function Ie(e,n){return t.useMemo(()=>{if(n)return n;const t=null==Ee[e]?0:Ee[e]+1;return Ee[e]=t,e+"-"+t},[e,n])}function De(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((t,n)=>{const r=Object.entries(n);for(const[s,o]of r){const n=t[s];null!=n&&(t[s]=n+e*o)}return t},{...t})}}const Re=De(1),Me=De(-1);function ze(e){if(!e)return!1;const{KeyboardEvent:t}=ge(e.target);return t&&e instanceof t}function Te(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=ge(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const Ae=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Ae.Translate.toString(e),Ae.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Le="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Be(e){return e.matches(Le)?e:e.querySelector(Le)}const Fe={display:"none"};function Oe(e){let{id:t,value:n}=e;return s.createElement("div",{id:t,style:Fe},n)}function Pe(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return s.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}const Ge=t.createContext(null);const $e={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Ue={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function He(e){let{announcements:n=Ue,container:r,hiddenTextDescribedById:o,screenReaderInstructions:a=$e}=e;const{announce:i,announcement:l}=function(){const[e,n]=t.useState("");return{announce:t.useCallback(e=>{null!=e&&n(e)},[]),announcement:e}}(),c=Ie("DndLiveRegion"),[d,u]=t.useState(!1);if(t.useEffect(()=>{u(!0)},[]),function(e){const n=t.useContext(Ge);t.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}(t.useMemo(()=>({onDragStart(e){let{active:t}=e;i(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&i(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;i(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;i(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;i(n.onDragCancel({active:t,over:r}))}}),[i,n])),!d)return null;const h=s.createElement(s.Fragment,null,s.createElement(Oe,{id:o,value:a.draggable}),s.createElement(Pe,{id:c,announcement:l}));return r?he.createPortal(h,r):h}var _e,qe;function Ye(){}function Xe(e,n){return t.useMemo(()=>({sensor:e,options:null!=n?n:{}}),[e,n])}function Ke(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.useMemo(()=>[...n].filter(e=>null!=e),[...n])}(qe=_e||(_e={})).DragStart="dragStart",qe.DragMove="dragMove",qe.DragEnd="dragEnd",qe.DragCancel="dragCancel",qe.DragOver="dragOver",qe.RegisterDroppable="registerDroppable",qe.SetDroppableDisabled="setDroppableDisabled",qe.UnregisterDroppable="unregisterDroppable";const We=Object.freeze({x:0,y:0});function Ve(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Je(e,t){const n=Te(e);if(!n)return"0 0";return(n.x-t.left)/t.width*100+"% "+(n.y-t.top)/t.height*100+"%"}function Ze(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Qe(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function et(e){let{left:t,top:n,height:r,width:s}=e;return[{x:t,y:n},{x:t+s,y:n},{x:t,y:n+r},{x:t+s,y:n+r}]}function tt(e,t){if(!e||0===e.length)return null;const[n]=e;return n[t]}function nt(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}const rt=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=nt(t,t.left,t.top),o=[];for(const a of r){const{id:e}=a,t=n.get(e);if(t){const n=Ve(nt(t),s);o.push({id:e,data:{droppableContainer:a,value:n}})}}return o.sort(Ze)};function st(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=s-r,i=o-n;if(r<s&&n<o){const n=t.width*t.height,r=e.width*e.height,s=a*i;return Number((s/(n+r-s)).toFixed(4))}return 0}const ot=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:e}=o,r=n.get(e);if(r){const n=st(r,t);n>0&&s.push({id:e,data:{droppableContainer:o,value:n}})}}return s.sort(Qe)};function at(e,t){const{top:n,left:r,bottom:s,right:o}=t;return n<=e.y&&e.y<=s&&r<=e.x&&e.x<=o}function it(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:We}function lt(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}const ct=lt(1);function dt(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}const ut={ignoreTransform:!1};function ht(e,t){void 0===t&&(t=ut);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=ge(e).getComputedStyle(e);t&&(n=function(e,t,n){const r=dt(t);if(!r)return e;const{scaleX:s,scaleY:o,x:a,y:i}=r,l=e.left-a-(1-s)*parseFloat(n),c=e.top-i-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),d=s?e.width/s:e.width,u=o?e.height/o:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(n,t,r))}const{top:r,left:s,width:o,height:a,bottom:i,right:l}=n;return{top:r,left:s,width:o,height:a,bottom:i,right:l}}function mt(e){return ht(e,{ignoreTransform:!0})}function ft(e,t){const n=[];return e?function r(s){if(null!=t&&n.length>=t)return n;if(!s)return n;if(xe(s)&&null!=s.scrollingElement&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!ve(s)||we(s))return n;if(n.includes(s))return n;const o=ge(e).getComputedStyle(s);return s!==e&&function(e,t){void 0===t&&(t=ge(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&n.test(r)})}(s,o)&&n.push(s),function(e,t){return void 0===t&&(t=ge(e).getComputedStyle(e)),"fixed"===t.position}(s,o)?n:r(s.parentNode)}(e):n}function pt(e){const[t]=ft(e,1);return null!=t?t:null}function gt(e){return me&&e?fe(e)?e:pe(e)?xe(e)||e===be(e).scrollingElement?window:ve(e)?e:null:null:null}function xt(e){return fe(e)?e.scrollX:e.scrollLeft}function vt(e){return fe(e)?e.scrollY:e.scrollTop}function wt(e){return{x:xt(e),y:vt(e)}}var bt,yt;function jt(e){return!(!me||!e)&&e===document.scrollingElement}function kt(e){const t={x:0,y:0},n=jt(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(yt=bt||(bt={}))[yt.Forward=1]="Forward",yt[yt.Backward=-1]="Backward";const Nt={x:.2,y:.2};function Ct(e,t,n,r,s){let{top:o,left:a,right:i,bottom:l}=n;void 0===r&&(r=10),void 0===s&&(s=Nt);const{isTop:c,isBottom:d,isLeft:u,isRight:h}=kt(e),m={x:0,y:0},f={x:0,y:0},p=t.height*s.y,g=t.width*s.x;return!c&&o<=t.top+p?(m.y=bt.Backward,f.y=r*Math.abs((t.top+p-o)/p)):!d&&l>=t.bottom-p&&(m.y=bt.Forward,f.y=r*Math.abs((t.bottom-p-l)/p)),!h&&i>=t.right-g?(m.x=bt.Forward,f.x=r*Math.abs((t.right-g-i)/g)):!u&&a<=t.left+g&&(m.x=bt.Backward,f.x=r*Math.abs((t.left+g-a)/g)),{direction:m,speed:f}}function St(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function Et(e){return e.reduce((e,t)=>Re(e,wt(t)),We)}function It(e,t){if(void 0===t&&(t=ht),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);pt(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Dt=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+xt(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+vt(t),0)}]];class Rt{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=ft(t),r=Et(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[s,o,a]of Dt)for(const e of o)Object.defineProperty(this,e,{get:()=>{const t=a(n),o=r[s]-t;return this.rect[e]+o},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Mt{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function zt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}var Tt,At,Lt,Bt;function Ft(e){e.preventDefault()}function Ot(e){e.stopPropagation()}(At=Tt||(Tt={})).Click="click",At.DragStart="dragstart",At.Keydown="keydown",At.ContextMenu="contextmenu",At.Resize="resize",At.SelectionChange="selectionchange",At.VisibilityChange="visibilitychange",(Bt=Lt||(Lt={})).Space="Space",Bt.Down="ArrowDown",Bt.Right="ArrowRight",Bt.Left="ArrowLeft",Bt.Up="ArrowUp",Bt.Esc="Escape",Bt.Enter="Enter",Bt.Tab="Tab";const Pt={start:[Lt.Space,Lt.Enter],cancel:[Lt.Esc],end:[Lt.Space,Lt.Enter,Lt.Tab]},Gt=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case Lt.Right:return{...n,x:n.x+25};case Lt.Left:return{...n,x:n.x-25};case Lt.Down:return{...n,y:n.y+25};case Lt.Up:return{...n,y:n.y-25}}};class $t{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Mt(be(t)),this.windowListeners=new Mt(ge(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Tt.Resize,this.handleCancel),this.windowListeners.add(Tt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Tt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&It(n),t(We)}handleKeyDown(e){if(ze(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:s=Pt,coordinateGetter:o=Gt,scrollBehavior:a="smooth"}=r,{code:i}=e;if(s.end.includes(i))return void this.handleEnd(e);if(s.cancel.includes(i))return void this.handleCancel(e);const{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:We;this.referenceCoordinates||(this.referenceCoordinates=c);const d=o(e,{active:t,context:n.current,currentCoordinates:c});if(d){const t=Me(d,c),r={x:0,y:0},{scrollableAncestors:s}=n.current;for(const n of s){const s=e.code,{isTop:o,isRight:i,isLeft:l,isBottom:c,maxScroll:u,minScroll:h}=kt(n),m=St(n),f={x:Math.min(s===Lt.Right?m.right-m.width/2:m.right,Math.max(s===Lt.Right?m.left:m.left+m.width/2,d.x)),y:Math.min(s===Lt.Down?m.bottom-m.height/2:m.bottom,Math.max(s===Lt.Down?m.top:m.top+m.height/2,d.y))},p=s===Lt.Right&&!i||s===Lt.Left&&!l,g=s===Lt.Down&&!c||s===Lt.Up&&!o;if(p&&f.x!==d.x){const e=n.scrollLeft+t.x,o=s===Lt.Right&&e<=u.x||s===Lt.Left&&e>=h.x;if(o&&!t.y)return void n.scrollTo({left:e,behavior:a});r.x=o?n.scrollLeft-e:s===Lt.Right?n.scrollLeft-u.x:n.scrollLeft-h.x,r.x&&n.scrollBy({left:-r.x,behavior:a});break}if(g&&f.y!==d.y){const e=n.scrollTop+t.y,o=s===Lt.Down&&e<=u.y||s===Lt.Up&&e>=h.y;if(o&&!t.x)return void n.scrollTo({top:e,behavior:a});r.y=o?n.scrollTop-e:s===Lt.Down?n.scrollTop-u.y:n.scrollTop-h.y,r.y&&n.scrollBy({top:-r.y,behavior:a});break}}this.handleMove(e,Re(Me(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function Ut(e){return Boolean(e&&"distance"in e)}function Ht(e){return Boolean(e&&"delay"in e)}$t.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Pt,onActivation:s}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const t=o.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==s||s({event:e.nativeEvent}),!0)}return!1}}];class _t{constructor(e,t,n){var r;void 0===n&&(n=function(e){const{EventTarget:t}=ge(e);return e instanceof t?e:be(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:s}=e,{target:o}=s;this.props=e,this.events=t,this.document=be(o),this.documentListeners=new Mt(this.document),this.listeners=new Mt(n),this.windowListeners=new Mt(ge(o)),this.initialCoordinates=null!=(r=Te(s))?r:We,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Tt.Resize,this.handleCancel),this.windowListeners.add(Tt.DragStart,Ft),this.windowListeners.add(Tt.VisibilityChange,this.handleCancel),this.windowListeners.add(Tt.ContextMenu,Ft),this.documentListeners.add(Tt.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Ht(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(Ut(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Tt.Click,Ot,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Tt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:s}=this,{onMove:o,options:{activationConstraint:a}}=s;if(!r)return;const i=null!=(t=Te(e))?t:We,l=Me(r,i);if(!n&&a){if(Ut(a)){if(null!=a.tolerance&&zt(l,a.tolerance))return this.handleCancel();if(zt(l,a.distance))return this.handleStart()}return Ht(a)&&zt(l,a.tolerance)?this.handleCancel():void this.handlePending(a,l)}e.cancelable&&e.preventDefault(),o(i)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Lt.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const qt={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Yt extends _t{constructor(e){const{event:t}=e,n=be(t.target);super(e,qt,n)}}Yt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!(!n.isPrimary||0!==n.button)&&(null==r||r({event:n}),!0)}}];const Xt={move:{name:"mousemove"},end:{name:"mouseup"}};var Kt,Wt;(Wt=Kt||(Kt={}))[Wt.RightClick=2]="RightClick";(class extends _t{constructor(e){super(e,Xt,be(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button!==Kt.RightClick&&(null==r||r({event:n}),!0)}}];const Vt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Jt,Zt,Qt,en;function tn(e){let{acceleration:n,activator:r=Jt.Pointer,canScroll:s,draggingRect:o,enabled:a,interval:i=5,order:l=Qt.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:h,threshold:m}=e;const f=function(e){let{delta:t,disabled:n}=e;const r=Se(t);return Ne(e=>{if(n||!r||!e)return nn;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[bt.Backward]:e.x[bt.Backward]||-1===s.x,[bt.Forward]:e.x[bt.Forward]||1===s.x},y:{[bt.Backward]:e.y[bt.Backward]||-1===s.y,[bt.Forward]:e.y[bt.Forward]||1===s.y}}},[n,t,r])}({delta:h,disabled:!a}),[p,g]=function(){const e=t.useRef(null);return[t.useCallback((t,n)=>{e.current=setInterval(t,n)},[]),t.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),x=t.useRef({x:0,y:0}),v=t.useRef({x:0,y:0}),w=t.useMemo(()=>{switch(r){case Jt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Jt.DraggableRect:return o}},[r,o,c]),b=t.useRef(null),y=t.useCallback(()=>{const e=b.current;if(!e)return;const t=x.current.x*v.current.x,n=x.current.y*v.current.y;e.scrollBy(t,n)},[]),j=t.useMemo(()=>l===Qt.TreeOrder?[...d].reverse():d,[l,d]);t.useEffect(()=>{if(a&&d.length&&w){for(const e of j){if(!1===(null==s?void 0:s(e)))continue;const t=d.indexOf(e),r=u[t];if(!r)continue;const{direction:o,speed:a}=Ct(e,r,w,n,m);for(const e of["x","y"])f[e][o[e]]||(a[e]=0,o[e]=0);if(a.x>0||a.y>0)return g(),b.current=e,p(y,i),x.current=a,void(v.current=o)}x.current={x:0,y:0},v.current={x:0,y:0},g()}else g()},[n,y,s,g,a,i,JSON.stringify(w),JSON.stringify(f),p,d,j,u,JSON.stringify(m)])}(class extends _t{constructor(e){super(e,Vt)}static setup(){return window.addEventListener(Vt.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Vt.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return!(s.length>1)&&(null==r||r({event:n}),!0)}}],(Zt=Jt||(Jt={}))[Zt.Pointer=0]="Pointer",Zt[Zt.DraggableRect=1]="DraggableRect",(en=Qt||(Qt={}))[en.TreeOrder=0]="TreeOrder",en[en.ReversedTreeOrder=1]="ReversedTreeOrder";const nn={x:{[bt.Backward]:!1,[bt.Forward]:!1},y:{[bt.Backward]:!1,[bt.Forward]:!1}};var rn,sn,on;(sn=rn||(rn={}))[sn.Always=0]="Always",sn[sn.BeforeDragging=1]="BeforeDragging",sn[sn.WhileDragging=2]="WhileDragging",(on||(on={})).Optimized="optimized";const an=new Map;function ln(e,t){return Ne(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function cn(e){let{callback:n,disabled:r}=e;const s=je(n),o=t.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(s)},[r]);return t.useEffect(()=>()=>null==o?void 0:o.disconnect(),[o]),o}function dn(e){return new Rt(ht(e),e)}function un(e,n,r){void 0===n&&(n=dn);const[s,o]=t.useState(null);function a(){o(t=>{if(!e)return null;var s;if(!1===e.isConnected)return null!=(s=null!=t?t:r)?s:null;const o=n(e);return JSON.stringify(t)===JSON.stringify(o)?t:o})}const i=function(e){let{callback:n,disabled:r}=e;const s=je(n),o=t.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(s)},[s,r]);return t.useEffect(()=>()=>null==o?void 0:o.disconnect(),[o]),o}({callback(t){if(e)for(const n of t){const{type:t,target:r}=n;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){a();break}}}}),l=cn({callback:a});return ye(()=>{a(),e?(null==l||l.observe(e),null==i||i.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==i||i.disconnect())},[e]),s}const hn=[];function mn(e,n){void 0===n&&(n=[]);const r=t.useRef(null);return t.useEffect(()=>{r.current=null},n),t.useEffect(()=>{const t=e!==We;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?Me(e,r.current):We}function fn(e){return t.useMemo(()=>e?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(e):null,[e])}const pn=[];function gn(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ve(t)?t:e}const xn=[{sensor:Yt,options:{}},{sensor:$t,options:{}}],vn={current:{}},wn={draggable:{measure:mt},droppable:{measure:mt,strategy:rn.WhileDragging,frequency:on.Optimized},dragOverlay:{measure:ht}};class bn extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}const yn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new bn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ye},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:wn,measureDroppableContainers:Ye,windowRect:null,measuringScheduled:!1},jn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ye,draggableNodes:new Map,over:null,measureDroppableContainers:Ye},kn=t.createContext(jn),Nn=t.createContext(yn);function Cn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new bn}}}function Sn(e,t){switch(t.type){case _e.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case _e.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case _e.DragEnd:case _e.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case _e.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new bn(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case _e.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new bn(e.droppable.containers);return a.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:a}}}case _e.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new bn(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function En(e){let{disabled:n}=e;const{active:r,activatorEvent:s,draggableNodes:o}=t.useContext(kn),a=Se(s),i=Se(null==r?void 0:r.id);return t.useEffect(()=>{if(!n&&!s&&a&&null!=i){if(!ze(a))return;if(document.activeElement===a.target)return;const e=o.get(i);if(!e)return;const{activatorNode:t,node:n}=e;if(!t.current&&!n.current)return;requestAnimationFrame(()=>{for(const e of[t.current,n.current]){if(!e)continue;const t=Be(e);if(t){t.focus();break}}})}},[s,n,o,i,a]),null}function In(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}const Dn=t.createContext({...We,scaleX:1,scaleY:1});var Rn,Mn;(Mn=Rn||(Rn={}))[Mn.Uninitialized=0]="Uninitialized",Mn[Mn.Initializing=1]="Initializing",Mn[Mn.Initialized=2]="Initialized";const zn=t.memo(function(e){var n,r,o,a;let{id:i,accessibility:l,autoScroll:c=!0,children:d,sensors:u=xn,collisionDetection:h=ot,measuring:m,modifiers:f,...p}=e;const g=t.useReducer(Sn,void 0,Cn),[x,v]=g,[w,b]=function(){const[e]=t.useState(()=>new Set),n=t.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[t.useCallback(t=>{let{type:n,event:r}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[e]),n]}(),[y,j]=t.useState(Rn.Uninitialized),k=y===Rn.Initialized,{draggable:{active:N,nodes:C,translate:S},droppable:{containers:E}}=x,I=null!=N?C.get(N):null,D=t.useRef({initial:null,translated:null}),R=t.useMemo(()=>{var e;return null!=N?{id:N,data:null!=(e=null==I?void 0:I.data)?e:vn,rect:D}:null},[N,I]),M=t.useRef(null),[z,T]=t.useState(null),[A,L]=t.useState(null),B=ke(p,Object.values(p)),F=Ie("DndDescribedBy",i),O=t.useMemo(()=>E.getEnabled(),[E]),P=(G=m,t.useMemo(()=>({draggable:{...wn.draggable,...null==G?void 0:G.draggable},droppable:{...wn.droppable,...null==G?void 0:G.droppable},dragOverlay:{...wn.dragOverlay,...null==G?void 0:G.dragOverlay}}),[null==G?void 0:G.draggable,null==G?void 0:G.droppable,null==G?void 0:G.dragOverlay]));var G;const{droppableRects:$,measureDroppableContainers:U,measuringScheduled:H}=function(e,n){let{dragging:r,dependencies:s,config:o}=n;const[a,i]=t.useState(null),{frequency:l,measure:c,strategy:d}=o,u=t.useRef(e),h=function(){switch(d){case rn.Always:return!1;case rn.BeforeDragging:return r;default:return!r}}(),m=ke(h),f=t.useCallback(function(e){void 0===e&&(e=[]),m.current||i(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[m]),p=t.useRef(null),g=Ne(t=>{if(h&&!r)return an;if(!t||t===an||u.current!==e||null!=a){const t=new Map;for(let n of e){if(!n)continue;if(a&&a.length>0&&!a.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}const e=n.node.current,r=e?new Rt(c(e),e):null;n.rect.current=r,r&&t.set(n.id,r)}return t}return t},[e,a,r,h,c]);return t.useEffect(()=>{u.current=e},[e]),t.useEffect(()=>{h||f()},[r,h]),t.useEffect(()=>{a&&a.length>0&&i(null)},[JSON.stringify(a)]),t.useEffect(()=>{h||"number"!=typeof l||null!==p.current||(p.current=setTimeout(()=>{f(),p.current=null},l))},[l,h,f,...s]),{droppableRects:g,measureDroppableContainers:f,measuringScheduled:null!=a}}(O,{dragging:k,dependencies:[S.x,S.y],config:P.droppable}),_=function(e,t){const n=null!=t?e.get(t):void 0,r=n?n.node.current:null;return Ne(e=>{var n;return null==t?null:null!=(n=null!=r?r:e)?n:null},[r,t])}(C,N),q=t.useMemo(()=>A?Te(A):null,[A]),Y=function(){const e=!1===(null==z?void 0:z.autoScrollEnabled),t="object"==typeof c?!1===c.enabled:!1===c,n=k&&!e&&!t;if("object"==typeof c)return{...c,enabled:n};return{enabled:n}}(),X=function(e,t){return ln(e,t)}(_,P.draggable.measure);!function(e){let{activeNode:n,measure:r,initialRect:s,config:o=!0}=e;const a=t.useRef(!1),{x:i,y:l}="boolean"==typeof o?{x:o,y:o}:o;ye(()=>{if(!i&&!l||!n)return void(a.current=!1);if(a.current||!s)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const t=it(r(e),s);if(i||(t.x=0),l||(t.y=0),a.current=!0,Math.abs(t.x)>0||Math.abs(t.y)>0){const n=pt(e);n&&n.scrollBy({top:t.y,left:t.x})}},[n,i,l,s,r])}({activeNode:null!=N?C.get(N):null,config:Y.layoutShiftCompensation,initialRect:X,measure:P.draggable.measure});const K=un(_,P.draggable.measure,X),W=un(_?_.parentElement:null),V=t.useRef({activatorEvent:null,active:null,activeNode:_,collisionRect:null,collisions:null,droppableRects:$,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=E.getNodeFor(null==(n=V.current.over)?void 0:n.id),Z=function(e){let{measure:n}=e;const[r,s]=t.useState(null),o=cn({callback:t.useCallback(e=>{for(const{target:t}of e)if(ve(t)){s(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),a=t.useCallback(e=>{const t=gn(e);null==o||o.disconnect(),t&&(null==o||o.observe(t)),s(t?n(t):null)},[n,o]),[i,l]=Ce(a);return t.useMemo(()=>({nodeRef:i,rect:r,setRef:l}),[r,i,l])}({measure:P.dragOverlay.measure}),Q=null!=(r=Z.nodeRef.current)?r:_,ee=k?null!=(o=Z.rect)?o:K:null,te=Boolean(Z.nodeRef.current&&Z.rect),ne=it(re=te?null:K,ln(re));var re;const se=fn(Q?ge(Q):null),oe=function(e){const n=t.useRef(e),r=Ne(t=>e?t&&t!==hn&&e&&n.current&&e.parentNode===n.current.parentNode?t:ft(e):hn,[e]);return t.useEffect(()=>{n.current=e},[e]),r}(k?null!=J?J:_:null),ae=function(e,n){void 0===n&&(n=ht);const[r]=e,s=fn(r?ge(r):null),[o,a]=t.useState(pn);function i(){a(()=>e.length?e.map(e=>jt(e)?s:new Rt(n(e),e)):pn)}const l=cn({callback:i});return ye(()=>{null==l||l.disconnect(),i(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),o}(oe),ie=In(f,{transform:{x:S.x-ne.x,y:S.y-ne.y,scaleX:1,scaleY:1},activatorEvent:A,active:R,activeNodeRect:K,containerNodeRect:W,draggingNodeRect:ee,over:V.current.over,overlayNodeRect:Z.rect,scrollableAncestors:oe,scrollableAncestorRects:ae,windowRect:se}),le=q?Re(q,S):null,ce=function(e){const[n,r]=t.useState(null),s=t.useRef(e),o=t.useCallback(e=>{const t=gt(e.target);t&&r(e=>e?(e.set(t,wt(t)),new Map(e)):null)},[]);return t.useEffect(()=>{const t=s.current;if(e!==t){n(t);const a=e.map(e=>{const t=gt(e);return t?(t.addEventListener("scroll",o,{passive:!0}),[t,wt(t)]):null}).filter(e=>null!=e);r(a.length?new Map(a):null),s.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=gt(e);null==t||t.removeEventListener("scroll",o)})}},[o,e]),t.useMemo(()=>e.length?n?Array.from(n.values()).reduce((e,t)=>Re(e,t),We):Et(e):We,[e,n])}(oe),de=mn(ce),ue=mn(ce,[K]),fe=Re(ie,de),pe=ee?ct(ee,ie):null,xe=R&&pe?h({active:R,collisionRect:pe,droppableRects:$,droppableContainers:O,pointerCoordinates:le}):null,we=tt(xe,"id"),[be,je]=t.useState(null),Se=function(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}(te?ie:Re(ie,ue),null!=(a=null==be?void 0:be.rect)?a:null,K),Ee=t.useRef(null),De=t.useCallback((e,t)=>{let{sensor:n,options:r}=t;if(null==M.current)return;const s=C.get(M.current);if(!s)return;const o=e.nativeEvent,a=new n({active:M.current,activeNode:s,event:o,options:r,context:V,onAbort(e){if(!C.get(e))return;const{onDragAbort:t}=B.current,n={id:e};null==t||t(n),w({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!C.get(e))return;const{onDragPending:s}=B.current,o={id:e,constraint:t,initialCoordinates:n,offset:r};null==s||s(o),w({type:"onDragPending",event:o})},onStart(e){const t=M.current;if(null==t)return;const n=C.get(t);if(!n)return;const{onDragStart:r}=B.current,s={activatorEvent:o,active:{id:t,data:n.data,rect:D}};he.unstable_batchedUpdates(()=>{null==r||r(s),j(Rn.Initializing),v({type:_e.DragStart,initialCoordinates:e,active:t}),w({type:"onDragStart",event:s}),T(Ee.current),L(o)})},onMove(e){v({type:_e.DragMove,coordinates:e})},onEnd:i(_e.DragEnd),onCancel:i(_e.DragCancel)});function i(e){return async function(){const{active:t,collisions:n,over:r,scrollAdjustedTranslate:s}=V.current;let a=null;if(t&&s){const{cancelDrop:i}=B.current;if(a={activatorEvent:o,active:t,collisions:n,delta:s,over:r},e===_e.DragEnd&&"function"==typeof i){await Promise.resolve(i(a))&&(e=_e.DragCancel)}}M.current=null,he.unstable_batchedUpdates(()=>{v({type:e}),j(Rn.Uninitialized),je(null),T(null),L(null),Ee.current=null;const t=e===_e.DragEnd?"onDragEnd":"onDragCancel";if(a){const e=B.current[t];null==e||e(a),w({type:t,event:a})}})}}Ee.current=a},[C]),Me=function(e,n){return t.useMemo(()=>e.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[e,n])}(u,t.useCallback((e,t)=>(n,r)=>{const s=n.nativeEvent,o=C.get(r);if(null!==M.current||!o||s.dndKit||s.defaultPrevented)return;const a={active:o};!0===e(n,t.options,a)&&(s.dndKit={capturedBy:t.sensor},M.current=r,De(n,t))},[C,De]));!function(e){t.useEffect(()=>{if(!me)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(u),ye(()=>{K&&y===Rn.Initializing&&j(Rn.Initialized)},[K,y]),t.useEffect(()=>{const{onDragMove:e}=B.current,{active:t,activatorEvent:n,collisions:r,over:s}=V.current;if(!t||!n)return;const o={active:t,activatorEvent:n,collisions:r,delta:{x:fe.x,y:fe.y},over:s};he.unstable_batchedUpdates(()=>{null==e||e(o),w({type:"onDragMove",event:o})})},[fe.x,fe.y]),t.useEffect(()=>{const{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:s}=V.current;if(!e||null==M.current||!t||!s)return;const{onDragOver:o}=B.current,a=r.get(we),i=a&&a.rect.current?{id:a.id,rect:a.rect.current,data:a.data,disabled:a.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:s.x,y:s.y},over:i};he.unstable_batchedUpdates(()=>{je(i),null==o||o(l),w({type:"onDragOver",event:l})})},[we]),ye(()=>{V.current={activatorEvent:A,active:R,activeNode:_,collisionRect:pe,collisions:xe,droppableRects:$,draggableNodes:C,draggingNode:Q,draggingNodeRect:ee,droppableContainers:E,over:be,scrollableAncestors:oe,scrollAdjustedTranslate:fe},D.current={initial:ee,translated:pe}},[R,_,xe,pe,C,Q,ee,$,E,be,oe,fe]),tn({...Y,delta:S,draggingRect:pe,pointerCoordinates:le,scrollableAncestors:oe,scrollableAncestorRects:ae});const ze=t.useMemo(()=>({active:R,activeNode:_,activeNodeRect:K,activatorEvent:A,collisions:xe,containerNodeRect:W,dragOverlay:Z,draggableNodes:C,droppableContainers:E,droppableRects:$,over:be,measureDroppableContainers:U,scrollableAncestors:oe,scrollableAncestorRects:ae,measuringConfiguration:P,measuringScheduled:H,windowRect:se}),[R,_,K,A,xe,W,Z,C,E,$,be,U,oe,ae,P,H,se]),Ae=t.useMemo(()=>({activatorEvent:A,activators:Me,active:R,activeNodeRect:K,ariaDescribedById:{draggable:F},dispatch:v,draggableNodes:C,over:be,measureDroppableContainers:U}),[A,Me,R,K,v,F,C,be,U]);return s.createElement(Ge.Provider,{value:b},s.createElement(kn.Provider,{value:Ae},s.createElement(Nn.Provider,{value:ze},s.createElement(Dn.Provider,{value:Se},d)),s.createElement(En,{disabled:!1===(null==l?void 0:l.restoreFocus)})),s.createElement(He,{...l,hiddenTextDescribedById:F}))}),Tn=t.createContext(null),An="button";function Ln(e){let{id:n,data:r,disabled:s=!1,attributes:o}=e;const a=Ie("Draggable"),{activators:i,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:h,over:m}=t.useContext(kn),{role:f=An,roleDescription:p="draggable",tabIndex:g=0}=null!=o?o:{},x=(null==c?void 0:c.id)===n,v=t.useContext(x?Dn:Tn),[w,b]=Ce(),[y,j]=Ce(),k=function(e,n){return t.useMemo(()=>e.reduce((e,t)=>{let{eventName:r,handler:s}=t;return e[r]=e=>{s(e,n)},e},{}),[e,n])}(i,n),N=ke(r);ye(()=>(h.set(n,{id:n,key:a,node:w,activatorNode:y,data:N}),()=>{const e=h.get(n);e&&e.key===a&&h.delete(n)}),[h,n]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:t.useMemo(()=>({role:f,tabIndex:g,"aria-disabled":s,"aria-pressed":!(!x||f!==An)||void 0,"aria-roledescription":p,"aria-describedby":u.draggable}),[s,f,g,x,p,u.draggable]),isDragging:x,listeners:s?void 0:k,node:w,over:m,setNodeRef:b,setActivatorNodeRef:j,transform:v}}function Bn(){return t.useContext(Nn)}const Fn={timeout:25};function On(e){let{animation:n,children:r}=e;const[o,a]=t.useState(null),[i,l]=t.useState(null),c=Se(r);return r||o||!c||a(c),ye(()=>{if(!i)return;const e=null==o?void 0:o.key,t=null==o?void 0:o.props.id;null!=e&&null!=t?Promise.resolve(n(t,i)).then(()=>{a(null)}):a(null)},[n,o,i]),s.createElement(s.Fragment,null,r,o?t.cloneElement(o,{ref:l}):null)}const Pn={x:0,y:0,scaleX:1,scaleY:1};function Gn(e){let{children:t}=e;return s.createElement(kn.Provider,{value:jn},s.createElement(Dn.Provider,{value:Pn},t))}const $n={position:"fixed",touchAction:"none"},Un=e=>ze(e)?"transform 250ms ease":void 0,Hn=t.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:o,children:a,className:i,rect:l,style:c,transform:d,transition:u=Un}=e;if(!l)return null;const h=o?d:{...d,scaleX:1,scaleY:1},m={...$n,width:l.width,height:l.height,top:l.top,left:l.left,transform:Ae.Transform.toString(h),transformOrigin:o&&r?Je(r,l):void 0,transition:"function"==typeof u?u(r):u,...c};return s.createElement(n,{className:i,style:m,ref:t},a)}),_n={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:t,final:n}}=e;return[{transform:Ae.Transform.toString(t)},{transform:Ae.Transform.toString(n)}]},sideEffects:(e=>t=>{let{active:n,dragOverlay:r}=t;const s={},{styles:o,className:a}=e;if(null!=o&&o.active)for(const[e,i]of Object.entries(o.active))void 0!==i&&(s[e]=n.node.style.getPropertyValue(e),n.node.style.setProperty(e,i));if(null!=o&&o.dragOverlay)for(const[e,i]of Object.entries(o.dragOverlay))void 0!==i&&r.node.style.setProperty(e,i);return null!=a&&a.active&&n.node.classList.add(a.active),null!=a&&a.dragOverlay&&r.node.classList.add(a.dragOverlay),function(){for(const[e,t]of Object.entries(s))n.node.style.setProperty(e,t);null!=a&&a.active&&n.node.classList.remove(a.active)}})({styles:{active:{opacity:"0"}}})};function qn(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:s}=e;return je((e,o)=>{if(null===t)return;const a=n.get(e);if(!a)return;const i=a.node.current;if(!i)return;const l=gn(o);if(!l)return;const{transform:c}=ge(o).getComputedStyle(o),d=dt(c);if(!d)return;const u="function"==typeof t?t:function(e){const{duration:t,easing:n,sideEffects:r,keyframes:s}={..._n,...e};return e=>{let{active:o,dragOverlay:a,transform:i,...l}=e;if(!t)return;const c={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},d={scaleX:1!==i.scaleX?o.rect.width*i.scaleX/a.rect.width:1,scaleY:1!==i.scaleY?o.rect.height*i.scaleY/a.rect.height:1},u={x:i.x-c.x,y:i.y-c.y,...d},h=s({...l,active:o,dragOverlay:a,transform:{initial:i,final:u}}),[m]=h,f=h[h.length-1];if(JSON.stringify(m)===JSON.stringify(f))return;const p=null==r?void 0:r({active:o,dragOverlay:a,...l}),g=a.node.animate(h,{duration:t,easing:n,fill:"forwards"});return new Promise(e=>{g.onfinish=()=>{null==p||p(),e()}})}}(t);return It(i,s.draggable.measure),u({active:{id:e,data:a.data,node:i,rect:s.draggable.measure(i)},draggableNodes:n,dragOverlay:{node:o,rect:s.dragOverlay.measure(l)},droppableContainers:r,measuringConfiguration:s,transform:d})})}let Yn=0;const Xn=s.memo(e=>{let{adjustScale:n=!1,children:r,dropAnimation:o,style:a,transition:i,modifiers:l,wrapperElement:c="div",className:d,zIndex:u=999}=e;const{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:p,draggableNodes:g,droppableContainers:x,dragOverlay:v,over:w,measuringConfiguration:b,scrollableAncestors:y,scrollableAncestorRects:j,windowRect:k}=Bn(),N=t.useContext(Dn),C=(S=null==m?void 0:m.id,t.useMemo(()=>{if(null!=S)return Yn++,Yn},[S]));var S;const E=In(l,{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:p,draggingNodeRect:v.rect,over:w,overlayNodeRect:v.rect,scrollableAncestors:y,scrollableAncestorRects:j,transform:N,windowRect:k}),I=ln(f),D=qn({config:o,draggableNodes:g,droppableContainers:x,measuringConfiguration:b}),R=I?v.setRef:void 0;return s.createElement(Gn,null,s.createElement(On,{animation:D},m&&C?s.createElement(Hn,{key:C,id:m.id,ref:R,as:c,activatorEvent:h,adjustScale:n,className:d,transition:i,rect:I,style:{zIndex:u,...a},transform:E},r):null))});function Kn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Wn(e,t){return e.reduce((e,n,r)=>{const s=t.get(n);return s&&(e[r]=s),e},Array(e.length))}function Vn(e){return null!==e&&e>=0}const Jn={scaleX:1,scaleY:1},Zn=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:s,overIndex:o,index:a}=e;const i=null!=(t=n[s])?t:r;if(!i)return null;const l=function(e,t,n){const r=e[t],s=e[t-1],o=e[t+1];if(!r||!s&&!o)return 0;if(n<t)return s?r.left-(s.left+s.width):o.left-(r.left+r.width);return o?o.left-(r.left+r.width):r.left-(s.left+s.width)}(n,a,s);if(a===s){const e=n[o];return e?{x:s<o?e.left+e.width-(i.left+i.width):e.left-i.left,y:0,...Jn}:null}return a>s&&a<=o?{x:-i.width-l,y:0,...Jn}:a<s&&a>=o?{x:i.width+l,y:0,...Jn}:{x:0,y:0,...Jn}};const Qn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:s}=e;const o=Kn(t,r,n),a=t[s],i=o[s];return i&&a?{x:i.left-a.left,y:i.top-a.top,scaleX:i.width/a.width,scaleY:i.height/a.height}:null},er="Sortable",tr=s.createContext({activeIndex:-1,containerId:er,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Qn,disabled:{draggable:!1,droppable:!1}});function nr(e){let{children:n,id:r,items:o,strategy:a=Qn,disabled:i=!1}=e;const{active:l,dragOverlay:c,droppableRects:d,over:u,measureDroppableContainers:h}=Bn(),m=Ie(er,r),f=Boolean(null!==c.rect),p=t.useMemo(()=>o.map(e=>"object"==typeof e&&"id"in e?e.id:e),[o]),g=null!=l,x=l?p.indexOf(l.id):-1,v=u?p.indexOf(u.id):-1,w=t.useRef(p),b=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,w.current),y=-1!==v&&-1===x||b,j=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(i);ye(()=>{b&&g&&h(p)},[b,p,g,h]),t.useEffect(()=>{w.current=p},[p]);const k=t.useMemo(()=>({activeIndex:x,containerId:m,disabled:j,disableTransforms:y,items:p,overIndex:v,useDragOverlay:f,sortedRects:Wn(p,d),strategy:a}),[x,m,j.draggable,j.droppable,y,p,v,d,f,a]);return s.createElement(tr.Provider,{value:k},n)}const rr=e=>{let{id:t,items:n,activeIndex:r,overIndex:s}=e;return Kn(n,r,s).indexOf(t)},sr=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:s,items:o,newIndex:a,previousItems:i,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((i===o||s!==a)&&(!!n||a!==s&&t===l))},or={duration:200,easing:"ease"},ar="transform",ir=Ae.Transition.toString({property:ar,duration:0,easing:"linear"}),lr={roleDescription:"sortable"};function cr(e){let{animateLayoutChanges:n=sr,attributes:r,disabled:s,data:o,getNewIndex:a=rr,id:i,strategy:l,resizeObserverConfig:c,transition:d=or}=e;const{items:u,containerId:h,activeIndex:m,disabled:f,disableTransforms:p,sortedRects:g,overIndex:x,useDragOverlay:v,strategy:w}=t.useContext(tr),b=function(e,t){var n,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(n=null==e?void 0:e.draggable)?n:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(s,f),y=u.indexOf(i),j=t.useMemo(()=>({sortable:{containerId:h,index:y,items:u},...o}),[h,o,y,u]),k=t.useMemo(()=>u.slice(u.indexOf(i)),[u,i]),{rect:N,node:C,isOver:S,setNodeRef:E}=function(e){let{data:n,disabled:r=!1,id:s,resizeObserverConfig:o}=e;const a=Ie("Droppable"),{active:i,dispatch:l,over:c,measureDroppableContainers:d}=t.useContext(kn),u=t.useRef({disabled:r}),h=t.useRef(!1),m=t.useRef(null),f=t.useRef(null),{disabled:p,updateMeasurementsFor:g,timeout:x}={...Fn,...o},v=ke(null!=g?g:s),w=cn({callback:t.useCallback(()=>{h.current?(null!=f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{d(Array.isArray(v.current)?v.current:[v.current]),f.current=null},x)):h.current=!0},[x]),disabled:p||!i}),b=t.useCallback((e,t)=>{w&&(t&&(w.unobserve(t),h.current=!1),e&&w.observe(e))},[w]),[y,j]=Ce(b),k=ke(n);return t.useEffect(()=>{w&&y.current&&(w.disconnect(),h.current=!1,w.observe(y.current))},[y,w]),t.useEffect(()=>(l({type:_e.RegisterDroppable,element:{id:s,key:a,disabled:r,node:y,rect:m,data:k}}),()=>l({type:_e.UnregisterDroppable,key:a,id:s})),[s]),t.useEffect(()=>{r!==u.current.disabled&&(l({type:_e.SetDroppableDisabled,id:s,key:a,disabled:r}),u.current.disabled=r)},[s,a,r,l]),{active:i,rect:m,isOver:(null==c?void 0:c.id)===s,node:y,over:c,setNodeRef:j}}({id:i,data:j,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:k,...c}}),{active:I,activatorEvent:D,activeNodeRect:R,attributes:M,setNodeRef:z,listeners:T,isDragging:A,over:L,setActivatorNodeRef:B,transform:F}=Ln({id:i,data:j,attributes:{...lr,...r},disabled:b.draggable}),O=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.useMemo(()=>e=>{n.forEach(t=>t(e))},n)}(E,z),P=Boolean(I),G=P&&!p&&Vn(m)&&Vn(x),$=!v&&A,U=$&&G?F:null,H=G?null!=U?U:(null!=l?l:w)({rects:g,activeNodeRect:R,activeIndex:m,overIndex:x,index:y}):null,_=Vn(m)&&Vn(x)?a({id:i,items:u,activeIndex:m,overIndex:x}):y,q=null==I?void 0:I.id,Y=t.useRef({activeId:q,items:u,newIndex:_,containerId:h}),X=u!==Y.current.items,K=n({active:I,containerId:h,isDragging:A,isSorting:P,id:i,index:y,items:u,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:d,wasDragging:null!=Y.current.activeId}),W=function(e){let{disabled:n,index:r,node:s,rect:o}=e;const[a,i]=t.useState(null),l=t.useRef(r);return ye(()=>{if(!n&&r!==l.current&&s.current){const e=o.current;if(e){const t=ht(s.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&i(n)}}r!==l.current&&(l.current=r)},[n,r,s,o]),t.useEffect(()=>{a&&i(null)},[a]),a}({disabled:!K,index:y,node:C,rect:N});return t.useEffect(()=>{P&&Y.current.newIndex!==_&&(Y.current.newIndex=_),h!==Y.current.containerId&&(Y.current.containerId=h),u!==Y.current.items&&(Y.current.items=u)},[P,_,h,u]),t.useEffect(()=>{if(q===Y.current.activeId)return;if(null!=q&&null==Y.current.activeId)return void(Y.current.activeId=q);const e=setTimeout(()=>{Y.current.activeId=q},50);return()=>clearTimeout(e)},[q]),{active:I,activeIndex:m,attributes:M,data:j,rect:N,index:y,newIndex:_,items:u,isOver:S,isSorting:P,isDragging:A,listeners:T,node:C,overIndex:x,over:L,setNodeRef:O,setActivatorNodeRef:B,setDroppableNodeRef:E,setDraggableNodeRef:z,transform:null!=W?W:H,transition:function(){if(W||X&&Y.current.newIndex===y)return ir;if($&&!ze(D)||!d)return;if(P||K)return Ae.Transition.toString({...d,property:ar});return}()}}function dr(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const ur=[Lt.Down,Lt.Right,Lt.Up,Lt.Left],hr=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:s,droppableContainers:o,over:a,scrollableAncestors:i}}=t;if(ur.includes(e.code)){if(e.preventDefault(),!n||!r)return;const t=[];o.getEnabled().forEach(n=>{if(!n||null!=n&&n.disabled)return;const o=s.get(n.id);if(o)switch(e.code){case Lt.Down:r.top<o.top&&t.push(n);break;case Lt.Up:r.top>o.top&&t.push(n);break;case Lt.Left:r.left>o.left&&t.push(n);break;case Lt.Right:r.left<o.left&&t.push(n)}});const l=(e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=et(t),o=[];for(const a of r){const{id:e}=a,t=n.get(e);if(t){const n=et(t),r=s.reduce((e,t,r)=>e+Ve(n[r],t),0),i=Number((r/4).toFixed(4));o.push({id:e,data:{droppableContainer:a,value:i}})}}return o.sort(Ze)})({collisionRect:r,droppableRects:s,droppableContainers:t});let c=tt(l,"id");if(c===(null==a?void 0:a.id)&&l.length>1&&(c=l[1].id),null!=c){const e=o.get(n.id),t=o.get(c),a=t?s.get(t.id):null,l=null==t?void 0:t.node.current;if(l&&a&&e&&t){const n=ft(l).some((e,t)=>i[t]!==e),s=mr(e,t),o=function(e,t){if(!dr(e)||!dr(t))return!1;if(!mr(e,t))return!1;return e.data.current.sortable.index<t.data.current.sortable.index}(e,t),c=n||!s?{x:0,y:0}:{x:o?r.width-a.width:0,y:o?r.height-a.height:0},d={x:a.left,y:a.top};return c.x&&c.y?d:Me(d,c)}}}};function mr(e,t){return!(!dr(e)||!dr(t))&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}async function fr(e,t=10){try{if(e.size<=1024*t)return await async function(e){return new Promise((t,n)=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)})}(e);const n=new Image,r=URL.createObjectURL(e);await new Promise((e,t)=>{n.onload=e,n.onerror=t,n.src=r});const s=document.createElement("canvas"),o=s.getContext("2d");if(!o)return null;s.width=n.width,s.height=n.height,o.drawImage(n,0,0);let a=.8,i="";for(;a>.1;){i=s.toDataURL("image/jpeg",a);if(3*i.length/4/1024<=t)break;a-=.1}URL.revokeObjectURL(r);return 3*i.length/4/1024>1.5*t?null:i}catch(n){return null}}async function pr(e,t=10){try{const n=`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=32`,r=await fetch(n);if(!r.ok)return null;const s=await r.blob();if(s.size<100)return null;return await fr(s,t)}catch(n){return null}}function gr(e){if(e.faviconBase64)return e.faviconBase64;if(e.favicon)return e.favicon;try{return`https://www.google.com/s2/favicons?domain=${new URL(e.url).hostname}&sz=64`}catch{return""}}const xr=Object.freeze(Object.defineProperty({__proto__:null,batchDownloadFavicons:async function(e,t){const n=new Map;let r=0;for(const s of e){if(s.faviconBase64){r++,t?.(r,e.length);continue}const o=await pr(s.url);o&&n.set(s.id,o),r++,t?.(r,e.length),await new Promise(e=>setTimeout(e,100))}return n},downloadFavicon:pr,getFaviconUrl:gr},Symbol.toStringTag,{value:"Module"}));function vr({shortcut:e,onContextMenu:r,isMergeTarget:s=!1}){const{incrementClickCount:o}=re(),a=t.useRef(null),{attributes:i,listeners:l,setNodeRef:c,transform:d,transition:u,isDragging:h}=cr({id:e.id}),m={transform:Ae.Transform.toString(d),transition:u,opacity:h?0:1,zIndex:h?10:1};t.useEffect(()=>{const e=a.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]);const f=gr(e);return n.jsxs("div",{ref:c,style:m,...i,...l,"data-shortcut-id":e.id,className:"\n        relative flex flex-col items-center gap-2 cursor-grab active:cursor-grabbing\n        w-16 min-w-[64px] group\n        transition-all duration-300 hover:scale-105 hover:z-10\n      ",onClick:()=>{h||(o(e.id),window.location.href=e.url)},onContextMenu:t=>{t.preventDefault(),r&&r(t,e)},children:[n.jsxs("div",{ref:a,className:`\n          relative w-14 h-14 rounded-[18px] liquid-glass-icon flex items-center justify-center overflow-hidden\n          transition-all duration-200\n          ${h?"shadow-xl ring-2 ring-white/30 scale-105":""}\n        `,children:[n.jsx("div",{className:"glass-refraction"}),f?n.jsx("img",{src:f,alt:e.title,className:"w-[85%] h-[85%] object-contain rounded-xl relative z-10",draggable:!1,onError:t=>{const n=t.target;n.style.display="none";const r=n.parentElement;if(r&&!r.querySelector(".fallback-letter")){const t=document.createElement("div");t.className="fallback-letter w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl",t.innerHTML=`<span class="text-2xl font-bold text-white">${e.title.charAt(0).toUpperCase()}</span>`,r.appendChild(t)}}}):n.jsx("div",{className:"w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl relative z-10",children:n.jsx("span",{className:"text-2xl font-bold text-white",children:e.title.charAt(0).toUpperCase()})}),s&&n.jsx("div",{className:"merge-target-highlight"})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full px-1 select-none",children:e.title})]})}function wr({shortcut:e}){const t=gr(e);return n.jsx("div",{className:"aspect-square rounded-md overflow-hidden liquid-glass-mini flex items-center justify-center",children:t?n.jsx("img",{src:t,alt:"",className:"w-full h-full object-cover rounded-md",onError:t=>{const n=t.target;n.style.display="none",n.parentElement&&(n.parentElement.classList.add("bg-gradient-to-br","from-blue-500","to-purple-600"),n.parentElement.innerHTML=`<span class="text-[8px] font-bold text-white">${(e.title?.[0]||"A").toUpperCase()}</span>`)}}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-md",children:n.jsx("span",{className:"text-[8px] font-bold text-white",children:(e.title?.[0]||"A").toUpperCase()})})})}function br({folder:e,shortcuts:r,onOpen:s,isMergeTarget:o=!1}){const a=t.useRef(null),{attributes:i,listeners:l,setNodeRef:c,transform:d,transition:h,isDragging:m}=cr({id:e.id}),f={transform:Ae.Transform.toString(d),transition:h,opacity:m?.5:1,zIndex:m?10:1};t.useEffect(()=>{const e=a.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]);const p=r.slice(0,9);return n.jsxs("div",{ref:c,style:f,...i,...l,"data-shortcut-id":e.id,className:"relative flex flex-col items-center gap-2 cursor-grab active:cursor-grabbing w-16 min-w-[64px]",onClick:()=>!m&&s(e.id),children:[n.jsxs("div",{ref:a,className:`\n          relative liquid-glass-folder rounded-[18px] overflow-hidden\n          hover:scale-110 transition-all duration-200\n          ${m?"shadow-xl ring-2 ring-white/30 scale-105":""}\n        `,style:{width:"56px",height:"56px",padding:"6.72px"},children:[n.jsx("div",{className:"glass-refraction"}),p.length>0?n.jsxs("div",{className:"w-full h-full grid grid-cols-3 gap-0.5 content-start relative z-10",children:[p.map(e=>n.jsx(wr,{shortcut:e},e.id)),Array.from({length:Math.max(0,9-p.length)}).map((e,t)=>n.jsx("div",{className:"aspect-square rounded-md bg-white/5"},`empty-${t}`))]}):n.jsx("div",{className:"w-full h-full flex items-center justify-center relative z-10",children:n.jsx(u,{className:"w-6 h-6 text-white/60"})}),o&&n.jsx("div",{className:"merge-target-highlight"})]}),n.jsx("span",{className:"text-xs text-white truncate w-full text-center px-1 text-shadow-sm",children:e.name})]})}const yr=100,jr=110;function kr({shortcut:e,onRemove:r,onClick:s}){const o=t.useRef(null),{attributes:a,listeners:i,setNodeRef:l,transform:c,transition:d,isDragging:u}=cr({id:e.id}),h={transform:Ae.Transform.toString(c),transition:d,opacity:u?0:1,zIndex:u?50:"auto"};return t.useEffect(()=>{const e=o.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]),n.jsxs("div",{ref:l,style:h,...a,...i,className:"group relative flex flex-col items-center gap-1.5 p-2 rounded-xl cursor-pointer transition-colors hover:bg-white/5",onClick:()=>!u&&s(e),children:[n.jsxs("div",{className:"relative w-16 h-16",children:[n.jsxs("div",{ref:o,className:"w-full h-full rounded-xl liquid-glass-icon flex items-center justify-center overflow-hidden",children:[n.jsx("div",{className:"glass-refraction"}),e.favicon?n.jsx("img",{src:e.favicon,alt:e.title,className:"w-4/5 h-4/5 object-contain rounded-lg relative z-10",draggable:!1}):n.jsx("div",{className:"w-4/5 h-4/5 flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg relative z-10",children:n.jsx("span",{className:"text-xl font-bold text-white",children:e.title.charAt(0).toUpperCase()})})]}),n.jsx("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"absolute -top-2 -right-2 p-1.5 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-red-400 z-20",title:"移出文件夹",children:n.jsx(G,{className:"w-3 h-3"})})]}),n.jsx("span",{className:"text-xs text-white/90 truncate w-full text-center select-none",children:e.title})]})}function Nr({folder:e,shortcuts:r,onClose:s,onDeleteFolder:o}){const{incrementClickCount:a,updateShortcut:i,updateFolder:l}=re(),[c,d]=t.useState(!1),[u,h]=t.useState(r),[m,f]=t.useState(e.name),[p,g]=t.useState(!1),x=t.useRef(null);t.useEffect(()=>{h(r)},[r]),t.useEffect(()=>{f(e.name)},[e.name]),t.useEffect(()=>{requestAnimationFrame(()=>d(!0))},[]),t.useEffect(()=>{p&&x.current&&(x.current.focus(),x.current.select())},[p]);const v=Ke(Xe(Yt,{activationConstraint:{distance:5}})),w=e=>{a(e.id),window.location.href=e.url},b=e=>{i(e,{folderId:void 0})},y=()=>{g(!1);const t=m.trim();t&&t!==e.name?l(e.id,{name:t}):f(e.name)};return he.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4 transition-all duration-300 "+(c?"bg-black/70 backdrop-blur-md opacity-100":"opacity-0"),style:{zIndex:yr},onClick:()=>{d(!1),setTimeout(s,200)},children:n.jsxs("div",{className:"liquid-glass rounded-3xl w-full max-w-2xl p-6 shadow-2xl transition-all duration-300 ease-[cubic-bezier(0.33,1,0.68,1)] "+(c?"opacity-100 scale-100":"opacity-0 scale-95"),style:{zIndex:jr},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("div",{className:"flex items-center gap-3 flex-1",children:p?n.jsx("input",{ref:x,type:"text",value:m,onChange:e=>f(e.target.value),onBlur:y,onKeyDown:t=>{"Enter"===t.key&&y(),"Escape"===t.key&&(f(e.name),g(!1))},className:"liquid-glass-mini border border-white/30 rounded-lg px-3 py-1.5 text-white text-xl font-semibold focus:outline-none focus:ring-2 focus:ring-white/40 w-full max-w-[300px] transition-all"}):n.jsxs("h2",{className:"text-xl font-semibold text-white cursor-pointer hover:text-blue-400 flex items-center gap-2 transition-colors",onClick:()=>g(!0),title:"点击编辑标题",children:[m,n.jsx(T,{className:"w-4 h-4 opacity-50"})]})}),n.jsx("button",{onClick:o,className:"p-2 rounded-full liquid-glass-mini hover:border-red-400/50 text-red-400 hover:text-red-300 transition-all hover:scale-110",title:"删除文件夹",children:n.jsx(G,{className:"w-5 h-5"})})]}),n.jsx(zn,{sensors:v,collisionDetection:rt,onDragEnd:e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return;const r=u.findIndex(e=>e.id===t.id),s=u.findIndex(e=>e.id===n.id);if(-1!==r&&-1!==s){const e=Kn(u,r,s);h(e),e.forEach((e,t)=>{i(e.id,{position:t})})}},children:n.jsx(nr,{items:u.map(e=>e.id),strategy:Qn,children:n.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-4 min-h-[120px]",children:0===u.length?n.jsx("div",{className:"col-span-full text-center py-12 text-white/50 text-sm",children:"文件夹为空"}):u.map(e=>n.jsx(kr,{shortcut:e,onRemove:b,onClick:w},e.id))})})})]})}),document.body)}function Cr({isOpen:e,onClose:r,onSave:s,folder:o}){const[a,i]=t.useState("");if(t.useEffect(()=>{i(o?o.name:"")},[o,e]),!e)return null;return he.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:yr},onClick:r,children:n.jsxs("div",{className:"relative w-80 rounded-2xl glass-modal-dark overflow-hidden",style:{zIndex:jr,animation:"modalScale 0.2s ease-out"},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(u,{className:"w-5 h-5 text-white/70"}),n.jsx("h3",{className:"text-base font-medium text-white",children:o?"编辑文件夹":"新建文件夹"})]}),n.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-4 h-4 text-white/60"})})]}),n.jsxs("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&(s(a.trim()),i(""),r())},className:"p-4",children:[n.jsx("input",{type:"text",value:a,onChange:e=>i(e.target.value),placeholder:"文件夹名称",className:"w-full bg-white/10 text-white text-sm rounded-lg px-3 py-2.5 outline-none border border-white/10 focus:border-white/30 placeholder-white/40",autoFocus:!0}),n.jsxs("div",{className:"flex gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:r,className:"flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors text-white/70 text-sm",children:"取消"}),n.jsx("button",{type:"submit",disabled:!a.trim(),className:"flex-1 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-white text-sm",children:o?"保存":"创建"})]})]})]})}),document.body)}function Sr({isOpen:e,onClose:r,onAdd:s,groupName:o}){const[a,i]=t.useState(""),[l,c]=t.useState(""),[d,u]=t.useState("");if(!e)return null;const h=()=>{if(u(""),a.trim())try{const e=a.startsWith("http")?a:`https://${a}`;new URL(e);const t=new URL(e).hostname,n=l.trim()||t;s(e,n),i(""),c(""),r()}catch{u("无效的网址格式")}else u("请输入网址")},m=e=>{"Enter"===e.key?h():"Escape"===e.key&&r()};return he.createPortal(n.jsxs("div",{className:"fixed inset-0 flex items-center justify-center animate-fadeIn",style:{zIndex:yr},children:[n.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:r}),n.jsx("div",{className:"relative w-[400px] max-w-[90vw]",style:{zIndex:jr,animation:"modalScale 0.2s ease-out"},children:n.jsxs("div",{className:"glass-modal rounded-2xl p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-medium text-white",children:["添加快捷方式",o&&n.jsxs("span",{className:"ml-2 text-sm text-white/50",children:["到 ",o]})]}),n.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-5 h-5 text-white/60"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-white/60 mb-2",children:[n.jsx(R,{className:"w-4 h-4"}),"网址"]}),n.jsx("input",{type:"text",value:a,onChange:e=>i(e.target.value),onKeyDown:m,placeholder:"https://example.com",className:"w-full bg-white/10 text-white text-sm rounded-xl px-4 py-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/30 transition-colors",autoFocus:!0})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-white/60 mb-2",children:[n.jsx($,{className:"w-4 h-4"}),"名称 ",n.jsx("span",{className:"text-white/30",children:"(可选)"})]}),n.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:"自动获取域名",className:"w-full bg-white/10 text-white text-sm rounded-xl px-4 py-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/30 transition-colors"})]}),d&&n.jsx("p",{className:"text-sm text-red-400",children:d})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:r,className:"flex-1 py-2.5 rounded-xl bg-white/10 hover:bg-white/20 text-white/70 text-sm transition-colors",children:"取消"}),n.jsx("button",{onClick:h,className:"flex-1 py-2.5 rounded-xl bg-blue-500/80 hover:bg-blue-500 text-white text-sm transition-colors",children:"添加"})]})]})})]}),document.body)}function Er({item:e,shortcuts:t=[]}){if("folder"===e.itemType){const r=e,s=t.slice(0,9),o=56,a=.12*o;return n.jsxs("div",{className:"flex flex-col items-center gap-2 w-16 opacity-90 cursor-grabbing",children:[n.jsxs("div",{className:"relative liquid-glass-folder rounded-[18px] overflow-hidden shadow-2xl scale-110",style:{width:`${o}px`,height:`${o}px`,padding:`${a}px`},children:[n.jsx("div",{className:"glass-refraction"}),s.length>0?n.jsx("div",{className:"w-full h-full grid grid-cols-3 gap-0.5 content-start relative z-10",children:s.map(e=>{const t=gr(e);return n.jsx("div",{className:"aspect-square rounded-md overflow-hidden liquid-glass-mini flex items-center justify-center",children:t?n.jsx("img",{src:t,alt:"",className:"w-full h-full object-cover rounded-md"}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-md",children:n.jsx("span",{className:"text-[8px] font-bold text-white",children:(e.title?.[0]||"A").toUpperCase()})})},e.id)})}):n.jsx("div",{className:"w-full h-full flex items-center justify-center relative z-10",children:n.jsx(u,{className:"w-6 h-6 text-white/60"})})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full",children:r.name})]})}const r=e,s=gr(r);return n.jsxs("div",{className:"flex flex-col items-center gap-2 w-16 opacity-90 cursor-grabbing",children:[n.jsxs("div",{className:"relative w-14 h-14 rounded-[18px] liquid-glass-icon flex items-center justify-center overflow-hidden shadow-2xl scale-110",children:[n.jsx("div",{className:"glass-refraction"}),s?n.jsx("img",{src:s,alt:r.title,className:"w-[85%] h-[85%] object-contain rounded-xl relative z-10",draggable:!1}):n.jsx("div",{className:"w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl relative z-10",children:n.jsx("span",{className:"text-2xl font-bold text-white",children:r.title.charAt(0).toUpperCase()})})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full",children:r.title})]})}function Ir({columns:e,style:r,onAddClick:s,onBatchEditClick:o}){const{shortcuts:a,reorderShortcuts:i,getFilteredShortcuts:l,shortcutFolders:c,activeGroupId:d,getFolderShortcuts:u,addFolder:m,updateFolder:f,removeFolder:p,addShortcut:g,moveShortcutToFolder:x}=re(),[v,w]=t.useState(null),[b,y]=t.useState(!1),[j,N]=t.useState(null),[C,S]=t.useState(!1),[E,I]=t.useState(null),[D,M]=t.useState(null),z=t.useRef(null),T=t.useRef(null),[A,L]=t.useState(0),B=t.useRef(null),F=t.useRef(0),O=t.useRef(0),P=t.useRef(!1),G=l(),$=c.filter(e=>e.groupId===(d??"home")),U=v?c.find(e=>e.id===v):null,H=v?u(v):[],_=[...$.map(e=>({...e,itemType:"folder"})),...G.map(e=>({...e,itemType:"shortcut"}))],q=3*e,Y=Math.ceil(_.length/q),X=[];for(let t=0;t<Math.max(1,Y);t++){const e=t*q;X.push(_.slice(e,e+q))}const K=Ke(Xe(Yt,{activationConstraint:{distance:10}}),Xe($t,{coordinateGetter:hr})),W=t.useCallback(e=>{const t=(e=>{let{droppableContainers:t,droppableRects:n,pointerCoordinates:r}=e;if(!r)return[];const s=[];for(const o of t){const{id:e}=o,t=n.get(e);if(t&&at(r,t)){const n=et(t).reduce((e,t)=>e+Ve(r,t),0),a=Number((n/4).toFixed(4));s.push({id:e,data:{droppableContainer:o,value:a}})}}return s.sort(Ze)})(e);return t&&t.length>0?t:rt(e)},[]),J={6:"grid-cols-4 sm:grid-cols-6",8:"grid-cols-4 sm:grid-cols-6 md:grid-cols-8",10:"grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10"},Z=t.useCallback(e=>{const t=Math.max(0,Math.min(Y-1,e));t===A||P.current||(P.current=!0,L(t),setTimeout(()=>{P.current=!1,F.current=0},400))},[Y,A]);t.useEffect(()=>{if(Y<=1)return;const e=e=>{if(P.current)return;const t=Date.now();t-O.current>200&&(F.current=0),O.current=t;const n=Math.abs(e.deltaX)>Math.abs(e.deltaY),r=0===e.deltaX&&0!==e.deltaY;let s=0;if(n)s=e.deltaX;else{if(!r)return;s=e.deltaY}F.current+=s;F.current>50?(Z(A+1),F.current=0):F.current<-50&&(Z(A-1),F.current=0)};return window.addEventListener("wheel",e,{passive:!0}),()=>window.removeEventListener("wheel",e)},[Y,A,Z]),t.useEffect(()=>{const e=e=>{"ArrowLeft"===e.key?Z(A-1):"ArrowRight"===e.key&&Z(A+1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A,Z]),t.useEffect(()=>{A>=Y&&Y>0&&L(Y-1)},[_.length,Y,A]);const Q=E?_.find(e=>e.id===E):null,[ee,te]=t.useState(!1),ne=()=>{te(!ee)},se=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative flex flex-col items-center gap-2 w-16",children:[n.jsx("button",{onClick:ne,onContextMenu:e=>{e.preventDefault(),o&&o()},className:"w-14 h-14 rounded-[18px] bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all border border-white/10 cursor-pointer group",title:"添加 | 右键批量编辑",children:n.jsx(h,{className:"w-6 h-6 text-white/60 transition-transform "+(ee?"rotate-45":"")})}),n.jsx("span",{className:"text-sm text-white/60",children:"添加"})]}),ee&&he.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:yr},onClick:()=>te(!1),children:n.jsxs("div",{className:"relative w-64 rounded-2xl glass-modal-dark overflow-hidden",style:{zIndex:jr,animation:"modalScale 0.2s ease-out"},onClick:e=>e.stopPropagation(),children:[n.jsx("div",{className:"px-4 py-3 border-b border-white/10",children:n.jsx("h3",{className:"text-base font-medium text-white",children:"选择类型"})}),n.jsxs("div",{className:"p-2",children:[n.jsxs("button",{onClick:e=>{e.stopPropagation(),te(!1),s&&s()},className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-white/80 hover:bg-white/10 transition-colors rounded-lg",children:[n.jsx(R,{className:"w-5 h-5 text-blue-400"}),n.jsx("span",{children:"新建快捷方式"})]}),n.jsxs("button",{onClick:e=>{e.stopPropagation(),te(!1),y(!0)},className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-white/80 hover:bg-white/10 transition-colors rounded-lg",children:[n.jsx(k,{className:"w-5 h-5 text-amber-400"}),n.jsx("span",{children:"新建文件夹"})]})]})]})}),document.body)]});return n.jsxs(n.Fragment,{children:[n.jsxs(zn,{sensors:K,collisionDetection:W,onDragStart:e=>{I(e.active.id)},onDragOver:e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return z.current&&(clearTimeout(z.current),z.current=null),M(null),void(T.current=null);if(T.current!==n.id){T.current=n.id,z.current&&(clearTimeout(z.current),z.current=null),M(null);const e=_.find(e=>e.id===t.id),r=_.find(e=>e.id===n.id);if(!e||!r)return;if("shortcut"===e.itemType){("folder"===r.itemType||"shortcut"===r.itemType)&&(z.current=setTimeout(()=>{M(n.id)},600))}}},onDragEnd:e=>{const{active:t,over:n}=e;z.current&&(clearTimeout(z.current),z.current=null);const r=D&&n&&D===n.id;if(I(null),M(null),T.current=null,n){if(r){const e=_.find(e=>e.id===t.id),r=_.find(e=>e.id===n.id);if(!e||!r)return;if("shortcut"===e.itemType&&"folder"===r.itemType)return void x(t.id,n.id);if("shortcut"===e.itemType&&"shortcut"===r.itemType){const e=m("新文件夹",d??void 0);return x(n.id,e),void x(t.id,e)}}if(t.id!==n.id){const e=a.findIndex(e=>e.id===t.id),r=a.findIndex(e=>e.id===n.id);-1!==e&&-1!==r&&i(e,r)}}},children:[n.jsx("div",{ref:B,className:"w-full overflow-hidden",children:n.jsx("div",{className:"flex transition-transform duration-300 ease-out",style:{transform:`translateX(${100*-A}%)`},children:X.map((t,s)=>n.jsx("div",{className:"shrink-0 w-full flex justify-center",children:n.jsx(nr,{items:t.map(e=>e.id),strategy:Qn,children:n.jsxs("div",{className:`grid ${J[e]} gap-x-6 gap-y-4 justify-items-center py-4`,children:[t.map(e=>"folder"===e.itemType?n.jsx(br,{folder:e,shortcuts:u(e.id),onOpen:w,isMergeTarget:D===e.id},e.id):n.jsx(vr,{shortcut:e,style:r,isMergeTarget:D===e.id,onContextMenu:o?()=>o():void 0},e.id)),s===X.length-1&&n.jsx(se,{})]})})},s))})}),Y>1&&n.jsx("div",{className:"flex justify-center gap-2 mt-4",children:Array.from({length:Y}).map((e,t)=>n.jsx("button",{onClick:()=>Z(t),className:"w-2 h-2 rounded-full transition-all "+(t===A?"bg-white/80 w-4":"bg-white/30 hover:bg-white/50")},t))}),n.jsx(Xn,{children:Q&&n.jsx(Er,{item:Q,shortcuts:"folder"===Q.itemType?u(Q.id):[]})})]}),U&&n.jsx(Nr,{folder:U,shortcuts:H,onClose:()=>w(null),onDeleteFolder:()=>{v&&confirm("删除文件夹后，其中的快捷方式将移出。确定删除？")&&(p(v),w(null))}}),n.jsx(Cr,{isOpen:b,onClose:()=>{y(!1),N(null)},onSave:e=>{j?(f(j.id,{name:e}),N(null)):m(e,d??void 0)},folder:j??void 0}),C&&n.jsx(Sr,{isOpen:C,onClose:()=>S(!1),onAdd:(e,t)=>{if(v){const n=new URL(e).hostname;g({url:e,title:t,favicon:`${V}${n}&sz=64`,groupId:d??void 0,folderId:v})}S(!1)},groupName:U?.name})]})}const Dr="newtab_wallpaper_cache",Rr="newtab_bing_info_cache";function Mr({config:e,onRefresh:r}){const[s,o]=t.useState(null),[a,i]=t.useState(null),[l,c]=t.useState(!1),[d,u]=t.useState(!1);t.useEffect(()=>{"bing"===e.type?h():"unsplash"===e.type?m():"image"===e.type&&o(e.value)},[e.type,e.value,e.bingHistoryIndex]);const h=async(t=!1)=>{try{const n=e.bingHistoryIndex||0,r=`bing_${n}`;if(!t){const e=await f(r),t=await g(n);if(e&&t)return o(e),void i(t)}const s=`https://www.bing.com/HPImageArchive.aspx?format=js&idx=${n}&n=1&mkt=zh-CN`,a=await fetch(s),l=await a.json();if(l.images?.[0]){const e=l.images[0];let s=`https://www.bing.com${e.url}`;t&&(s+=`${s.includes("?")?"&":"?"}t=${Date.now()}`);const a={url:s,title:e.title||"",copyright:e.copyright||"",date:e.startdate||""};o(s),i(a),await p(r,s),await x(n,a)}}catch(n){}},m=async(e=!1)=>{try{if(!e){const e=await f("unsplash");if(e)return void o(e)}const t=`https://picsum.photos/1920/1080?random=${Date.now()}`;o(t),await p("unsplash",t)}catch(t){}},f=async e=>{try{const t=(await chrome.storage.local.get(Dr))[Dr];if(t?.[e]){const n=Date.now()-t[e].timestamp;if(n<(e.startsWith("bing")?216e5:36e5))return t[e].url}}catch{}return null},p=async(e,t)=>{try{const n=(await chrome.storage.local.get(Dr))[Dr]||{};n[e]={url:t,timestamp:Date.now()},await chrome.storage.local.set({[Dr]:n})}catch(n){}},g=async e=>{try{const t=(await chrome.storage.local.get(Rr))[Rr];if(t?.[e]){const n=Date.now()-t[e].timestamp;if(n<216e5)return t[e].info}}catch{}return null},x=async(e,t)=>{try{const n=(await chrome.storage.local.get(Rr))[Rr]||{};n[e]={info:t,timestamp:Date.now()},await chrome.storage.local.set({[Rr]:n})}catch(n){}},v={filter:`blur(${e.blur}px) brightness(${e.brightness}%)`};if("color"===e.type)return n.jsx("div",{className:"absolute inset-0 z-0",style:{...v,backgroundColor:e.value}});const w="bing"===e.type||"unsplash"===e.type?s:e.value;return w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-0 z-0 bg-cover bg-center bg-no-repeat",style:{...v,backgroundImage:`url(${w})`}}),("bing"===e.type||"unsplash"===e.type)&&n.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex items-center gap-2",children:["bing"===e.type&&e.showBingInfo&&a&&n.jsx("button",{onClick:()=>c(!l),className:"p-2 rounded-full glass-light hover:bg-white/20 transition-all group",title:"图片信息",children:n.jsx(D,{className:"w-4 h-4 text-white/80 group-hover:text-white"})}),n.jsx("button",{onClick:async()=>{if(!d){u(!0);try{"bing"===e.type?await h(!0):"unsplash"===e.type&&await m(!0),r?.()}catch(t){}finally{setTimeout(()=>u(!1),1e3)}}},disabled:d,className:"p-2 rounded-full glass-light hover:bg-white/20 transition-all group disabled:opacity-50",title:"刷新壁纸",children:n.jsx(A,{className:"w-4 h-4 text-white/80 group-hover:text-white "+(d?"animate-spin":"")})})]}),"bing"===e.type&&e.showBingInfo&&l&&a&&n.jsxs("div",{className:"fixed bottom-20 right-6 z-50 w-80 glass-modal-dark rounded-xl p-4 animate-fadeIn",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsx("h3",{className:"text-sm font-medium text-white",children:"图片信息"}),n.jsx("button",{onClick:()=>c(!1),className:"p-1 rounded-full hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-4 h-4 text-white/70"})})]}),n.jsxs("div",{className:"space-y-2 text-xs",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-white/50 mb-1",children:"标题"}),n.jsx("div",{className:"text-white/90",children:a.title})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-white/50 mb-1",children:"版权信息"}),n.jsx("div",{className:"text-white/90 leading-relaxed",children:a.copyright})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-white/50 mb-1",children:"日期"}),n.jsx("div",{className:"text-white/90",children:a.date.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")})]})]})]})]}):n.jsx("div",{className:"absolute inset-0 z-0 bg-[#1a1a2e]"})}function zr(e,t){if(t)return t;try{return`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=64`}catch{return""}}function Tr({bookmark:e,isHovered:t,onHover:r,wasDragged:s}){const{attributes:o,listeners:a,setNodeRef:i,transform:l,transition:c,isDragging:d}=cr({id:e.id}),u={transform:Ae.Transform.toString(l),transition:d?"none":c||"transform 0.2s",opacity:d?.5:1};return n.jsx("div",{ref:i,style:u,...o,...a,className:"relative cursor-grab active:cursor-grabbing",children:n.jsxs("a",{href:e.url,className:"relative block w-11 h-11 rounded-xl bg-white/10 hover:bg-white/20 transition-all duration-200 overflow-hidden",style:{transform:t&&!d?"translateY(-8px) scale(1.15)":"translateY(0) scale(1)"},onMouseEnter:()=>r(e.id),onMouseLeave:()=>r(null),onClick:e=>{(d||s)&&e.preventDefault()},children:[t&&!d&&n.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-lg bg-black/90 text-white text-xs whitespace-nowrap z-50 animate-fadeIn pointer-events-none",children:e.title}),n.jsx("img",{src:zr(e.url,e.favicon),alt:e.title,className:"w-full h-full object-cover",onError:t=>{const n=t.currentTarget,r=`https://www.google.com/s2/favicons?domain=${new URL(e.url).hostname}&sz=64`;if(n.src.includes("google.com/s2/favicons")){n.style.display="none";const t=n.parentElement;if(t&&!t.querySelector(".fallback-letter")){const n=document.createElement("span");n.className="fallback-letter text-lg font-medium text-white/70",n.textContent=e.title.charAt(0).toUpperCase(),t.appendChild(n)}}else n.src=r}})]})})}function Ar(){const{syncState:e,pinnedBookmarks:r,fetchPinnedBookmarks:s,reorderPinnedBookmarks:o}=ie(),[a,i]=t.useState(!1),[l,c]=t.useState(null),[d,u]=t.useState(!1),[h,m]=t.useState(!1),[f,p]=t.useState([]),[g,x]=t.useState(!1),v=t.useRef(!0),w=t.useRef(),b=Ke(Xe(Yt,{activationConstraint:{distance:8}}),Xe($t,{coordinateGetter:hr}));t.useEffect(()=>{p(r)},[r]),t.useEffect(()=>{s().finally(()=>{i(!0),v.current&&(v.current=!1,requestAnimationFrame(()=>{m(!0)}))})},[s]);return!a||e.error||0===f.length?null:n.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-40 transition-opacity duration-300 "+(h?"opacity-100":"opacity-0"),children:n.jsx(zn,{sensors:b,collisionDetection:rt,onDragEnd:async e=>{const{active:t,over:n}=e;if(x(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{x(!1)},200),!n||t.id===n.id)return;const r=f.findIndex(e=>e.id===t.id),s=f.findIndex(e=>e.id===n.id);if(-1!==r&&-1!==s){const e=[...f],[t]=e.splice(r,1);e.splice(s,0,t),p(e),await o(e.map(e=>e.id))}},children:n.jsx(nr,{items:f.map(e=>e.id),strategy:Zn,children:n.jsx("div",{className:"flex items-center gap-2 px-4 py-3 rounded-2xl glass-dark "+(d?"animate-pulse":""),onDoubleClick:async()=>{d||(u(!0),await s(!0),setTimeout(()=>u(!1),500))},title:"拖拽排序 | 双击同步最新",children:f.map(e=>n.jsx(Tr,{bookmark:e,isHovered:l===e.id,onHover:c,wasDragged:g},e.id))})})})})}function Lr({userName:e}){const r=t.useMemo(()=>{const e=(new Date).getHours();return e>=5&&e<12?{text:"早上好",icon:"🌅"}:e>=12&&e<14?{text:"中午好",icon:"☀️"}:e>=14&&e<18?{text:"下午好",icon:"🌤️"}:e>=18&&e<22?{text:"晚上好",icon:"🌆"}:{text:"夜深了",icon:"🌙"}},[]);return n.jsx("div",{className:"text-center text-white select-none",children:n.jsxs("h2",{className:"text-2xl font-light text-shadow",children:[r.text,e&&n.jsx("span",{className:"ml-2",children:e})]})})}function Br(){const e=t.useMemo(()=>{const e=d.Lunar.fromDate(new Date);let t="";try{const n=e.getFestivals?.()||[],r=e.getJieQi?.()||"";t=n[0]||r||""}catch{}return{date:`${e.getMonthInChinese()}月${e.getDayInChinese()}`,year:`${e.getYearInGanZhi()}${e.getYearShengXiao()}年`,festival:t}},[]);return n.jsxs("div",{className:"text-center text-white/70 text-sm select-none",children:[n.jsxs("span",{children:[e.year," ",e.date]}),e.festival&&n.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-white/10 text-xs",children:e.festival})]})}const Fr="newtab_poetry";function Or(){const[e,r]=t.useState(null),s=()=>{const e=Math.floor(Math.random()*K.length),t=K[e];r(t);const n=(new Date).toDateString();chrome.storage.local.set({[Fr]:{poetry:t,date:n}})};return t.useEffect(()=>{chrome.storage.local.get(Fr).then(e=>{const t=e[Fr],n=(new Date).toDateString();t&&t.date===n?r(t.poetry):s()})},[]),e?n.jsxs("div",{className:"text-center text-white select-none group flex items-center justify-center gap-2",children:[n.jsxs("span",{className:"text-sm font-light tracking-wide text-shadow-sm",children:["「",e.content,"」"]}),n.jsxs("span",{className:"text-xs text-white/70 text-shadow-sm",children:["—— ",e.author,"《",e.title,"》"]}),n.jsx("button",{onClick:s,className:"p-1 rounded-full opacity-0 group-hover:opacity-100 hover:bg-white/10 transition-all inline-flex items-center",title:"换一首",children:n.jsx(A,{className:"w-3 h-3 text-white/50"})})]}):null}const Pr={Home:I,Briefcase:g,GraduationCap:S,Gamepad2:N,Wrench:H,Code:w,Music:M,Film:y,ShoppingCart:F,Heart:E,Star:P,Bookmark:p,Folder:u,Globe:C,Zap:q};function Gr(e){return Pr[e]||u}function $r({onOpenSettings:e}){const{shortcutGroups:r,activeGroupId:s,setActiveGroup:o,addGroup:a,removeGroup:c}=re(),[d,u]=t.useState(!1),[m,p]=t.useState(""),[g,x]=t.useState("Folder"),[v,w]=t.useState(""),[b,y]=t.useState(null);t.useEffect(()=>{(async()=>{const e=await i.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");w(t)}else w(l().BASE_URL)})()},[]);const j=()=>{m.trim()&&(a(m.trim(),g),p(""),x("Folder"),u(!1))},k=(e,t)=>{e.stopPropagation(),e.preventDefault(),confirm('删除分组后，该分组的快捷方式将移到"首页"。确定删除？')&&c(t)};return n.jsxs("div",{className:"fixed left-3 top-1/2 -translate-y-1/2 z-20 glass rounded-2xl p-2 animate-fadeIn flex flex-col gap-1",children:[r.map(e=>{const t="home"!==e.id,r=Gr(e.icon);return n.jsxs("button",{onClick:()=>o(e.id),onMouseEnter:()=>y(e.id),onMouseLeave:()=>y(null),onContextMenu:t=>k(t,e.id),className:"relative w-10 h-10 rounded-xl flex items-center justify-center transition-all "+(s===e.id?"bg-white/20 text-white":"text-white/50 hover:text-white/80 hover:bg-white/10"),title:e.name,children:[n.jsx(r,{className:"w-4 h-4"}),b===e.id&&n.jsxs("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50 flex items-center gap-2",children:[e.name,t&&n.jsx(_,{className:"w-3 h-3 hover:text-red-400 cursor-pointer",onClick:t=>k(t,e.id)})]})]},e.id)}),n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>u(!d),onMouseEnter:()=>y("add"),onMouseLeave:()=>y(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/50 hover:text-white/80 hover:bg-white/10 transition-all",title:"新建分组",children:[n.jsx(h,{className:"w-4 h-4"}),"add"===b&&!d&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"新建分组"})]}),d&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),n.jsxs("div",{className:"absolute left-full top-0 ml-2 w-56 p-3 rounded-xl bg-gray-900/95 border border-white/10 shadow-2xl z-50 animate-scaleIn",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:"新建分组"}),n.jsx("button",{onClick:()=>u(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-3 h-3 text-white/60"})})]}),n.jsx("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"分组名称",className:"w-full bg-white/10 text-white text-sm rounded-lg px-3 py-2 mb-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/40",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&j()}),n.jsx("div",{className:"grid grid-cols-5 gap-1.5 mb-3",children:Z.map(e=>{const t=Gr(e);return n.jsx("button",{onClick:()=>x(e),className:"p-1.5 rounded-lg transition-all "+(g===e?"bg-blue-500/30 text-blue-400 ring-1 ring-blue-500/50":"text-white/50 hover:bg-white/10 hover:text-white/80"),children:n.jsx(t,{className:"w-4 h-4 mx-auto"})},e)})}),n.jsx("button",{onClick:j,disabled:!m.trim(),className:"w-full py-1.5 rounded-lg bg-blue-500/80 hover:bg-blue-500 text-white text-sm transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"创建"})]})]})]}),v&&n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),v&&n.jsxs("button",{onClick:()=>window.open(v,"_blank"),onMouseEnter:()=>y("tmarks"),onMouseLeave:()=>y(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/50 hover:text-white/80 hover:bg-white/10 transition-all",title:"TMarks 书签",children:[n.jsx(f,{className:"w-4 h-4"}),"tmarks"===b&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"书签管理"})]}),n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),n.jsxs("button",{onClick:e,onMouseEnter:()=>y("settings"),onMouseLeave:()=>y(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/50 hover:text-white/80 hover:bg-white/10 transition-all",title:"设置",children:[n.jsx(B,{className:"w-4 h-4"}),"settings"===b&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"设置"})]})]})}const Ur=[{id:"general",label:"常规",icon:U},{id:"appearance",label:"外观",icon:z},{id:"sync",label:"同步",icon:v}];function Hr({onClose:e}){const{settings:r,updateSettings:s}=re(),[o,a]=t.useState(""),[c,d]=t.useState("general");return t.useEffect(()=>{(async()=>{const e=await i.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");a(t)}else a(l().BASE_URL)})()},[]),he.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:yr},onClick:e,children:n.jsxs("div",{className:"relative w-full max-w-4xl h-[600px] rounded-2xl glass-modal-dark flex flex-col overflow-hidden",style:{zIndex:jr,animation:"modalScale 0.2s ease-out"},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[n.jsx("h2",{className:"text-lg font-medium text-white",children:"设置"}),n.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsx("div",{className:"w-48 flex-shrink-0 border-r border-white/10 py-2",children:Ur.map(e=>{const t=e.icon;return n.jsxs("button",{onClick:()=>d(e.id),className:"w-full flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors relative "+(c===e.id?"text-white bg-white/10":"text-white/60 hover:text-white hover:bg-white/5"),children:[n.jsx(t,{className:"w-4 h-4"}),e.label,c===e.id&&n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-blue-500"})]},e.id)})}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:["general"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(_r,{title:"个性化",children:[n.jsx(qr,{label:"显示问候语",checked:r.showGreeting,onChange:e=>s({showGreeting:e})}),n.jsx(Kr,{label:"你的名字",value:r.userName,placeholder:"可选",onChange:e=>s({userName:e})})]}),n.jsxs(_r,{title:"时钟",children:[n.jsx(qr,{label:"显示时钟",checked:r.showClock,onChange:e=>s({showClock:e})}),r.showClock&&n.jsxs(n.Fragment,{children:[n.jsx(qr,{label:"显示日期",checked:r.showDate,onChange:e=>s({showDate:e})}),n.jsx(qr,{label:"显示秒数",checked:r.showSeconds,onChange:e=>s({showSeconds:e})}),n.jsx(qr,{label:"显示农历",checked:r.showLunar,onChange:e=>s({showLunar:e})}),n.jsx(Yr,{label:"时间格式",value:r.clockFormat,options:[{value:"24h",label:"24 小时制"},{value:"12h",label:"12 小时制"}],onChange:e=>s({clockFormat:e})})]})]}),n.jsx(_r,{title:"诗词",children:n.jsx(qr,{label:"显示每日诗词",checked:r.showPoetry,onChange:e=>s({showPoetry:e})})}),n.jsxs(_r,{title:"搜索",children:[n.jsx(qr,{label:"显示搜索框",checked:r.showSearch,onChange:e=>s({showSearch:e})}),n.jsx(Yr,{label:"搜索引擎",value:r.searchEngine,options:Y.map(e=>({value:e.id,label:e.name})),onChange:e=>s({searchEngine:e})})]}),n.jsx(_r,{title:"离线缓存",children:n.jsx(Vr,{})})]}),"appearance"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(_r,{title:"快捷方式",children:[n.jsx(qr,{label:"显示快捷方式",checked:r.showShortcuts,onChange:e=>s({showShortcuts:e})}),n.jsx(Yr,{label:"每行数量",value:String(r.shortcutColumns),options:[{value:"6",label:"6 个"},{value:"8",label:"8 个"},{value:"10",label:"10 个"}],onChange:e=>s({shortcutColumns:Number(e)})})]}),n.jsxs(_r,{title:"壁纸",children:[n.jsx(Yr,{label:"壁纸类型",value:r.wallpaper.type,options:[{value:"color",label:"纯色"},{value:"bing",label:"Bing 每日壁纸"},{value:"unsplash",label:"随机风景"},{value:"image",label:"自定义图片"}],onChange:e=>s({wallpaper:{...r.wallpaper,type:e}})}),"color"===r.wallpaper.type&&n.jsx(Xr,{label:"背景颜色",value:r.wallpaper.value,onChange:e=>s({wallpaper:{...r.wallpaper,value:e}})}),"bing"===r.wallpaper.type&&n.jsxs(n.Fragment,{children:[n.jsx(Yr,{label:"历史图片",value:String(r.wallpaper.bingHistoryIndex||0),options:[{value:"0",label:"今天"},{value:"1",label:"昨天"},{value:"2",label:"2 天前"},{value:"3",label:"3 天前"},{value:"4",label:"4 天前"},{value:"5",label:"5 天前"},{value:"6",label:"6 天前"},{value:"7",label:"7 天前"}],onChange:e=>s({wallpaper:{...r.wallpaper,bingHistoryIndex:Number(e)}})}),n.jsx(qr,{label:"显示图片信息",checked:r.wallpaper.showBingInfo||!1,onChange:e=>s({wallpaper:{...r.wallpaper,showBingInfo:e}})})]}),"image"===r.wallpaper.type&&n.jsx(Kr,{label:"图片 URL",value:r.wallpaper.value,placeholder:"https://...",onChange:e=>s({wallpaper:{...r.wallpaper,value:e}})}),n.jsx(Wr,{label:"模糊",value:r.wallpaper.blur,min:0,max:20,onChange:e=>s({wallpaper:{...r.wallpaper,blur:e}})}),n.jsx(Wr,{label:"亮度",value:r.wallpaper.brightness,min:20,max:100,onChange:e=>s({wallpaper:{...r.wallpaper,brightness:e}})})]})]}),"sync"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(_r,{title:"TMarks 同步",children:[n.jsx(qr,{label:"显示置顶书签",checked:r.showPinnedBookmarks,onChange:e=>s({showPinnedBookmarks:e})}),n.jsx(qr,{label:"搜索建议",checked:r.enableSearchSuggestions,onChange:e=>s({enableSearchSuggestions:e})}),o&&n.jsxs("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 mt-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[n.jsx("span",{className:"text-sm text-white/70",children:"打开 TMarks 网站"}),n.jsx(b,{className:"w-4 h-4 text-white/50"})]}),n.jsx("div",{className:"text-xs text-white/40 mt-2",children:"在扩展设置中配置 API Key 以启用同步功能"})]}),n.jsxs(_r,{title:"自动刷新",children:[n.jsx(qr,{label:"定时刷新置顶书签",checked:r.autoRefreshPinnedBookmarks,onChange:e=>s({autoRefreshPinnedBookmarks:e})}),r.autoRefreshPinnedBookmarks&&n.jsxs(n.Fragment,{children:[n.jsx(Yr,{label:"刷新时间",value:r.pinnedBookmarksRefreshTime,options:[{value:"morning",label:"早上 8:00"},{value:"evening",label:"晚上 22:00"}],onChange:e=>s({pinnedBookmarksRefreshTime:e})}),n.jsx("div",{className:"text-xs text-white/40 -mt-1 ml-1",children:"每天自动更新置顶书签缓存，保持数据最新"})]})]})]})]})]})]})}),document.body)}function _r({title:e,children:t}){return n.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[n.jsx("h3",{className:"text-sm font-medium text-white/80 mb-4",children:e}),n.jsx("div",{className:"space-y-3",children:t})]})}function qr({label:e,checked:t,onChange:r}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("button",{onClick:()=>r(!t),className:"w-10 h-6 rounded-full transition-colors "+(t?"bg-blue-500":"bg-white/20"),children:n.jsx("div",{className:"w-4 h-4 rounded-full bg-white transition-transform mx-1 "+(t?"translate-x-4":"translate-x-0")})})]})}function Yr({label:e,value:t,options:r,onChange:s}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("select",{value:t,onChange:e=>s(e.target.value),className:"bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 outline-none border border-white/10",children:r.map(e=>n.jsx("option",{value:e.value,className:"bg-gray-800",children:e.label},e.value))})]})}function Xr({label:e,value:t,onChange:r}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("input",{type:"color",value:t,onChange:e=>r(e.target.value),className:"w-8 h-8 rounded cursor-pointer"})]})}function Kr({label:e,value:t,placeholder:r,onChange:s}){return n.jsxs("div",{className:"flex items-center justify-between gap-4",children:[n.jsx("span",{className:"text-sm text-white/80 flex-shrink-0",children:e}),n.jsx("input",{type:"text",value:t,placeholder:r,onChange:e=>s(e.target.value),className:"flex-1 bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 outline-none border border-white/10"})]})}function Wr({label:e,value:t,min:r,max:s,onChange:o}){return n.jsxs("div",{className:"flex items-center justify-between gap-4",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"range",value:t,min:r,max:s,onChange:e=>o(Number(e.target.value)),className:"w-24"}),n.jsx("span",{className:"text-xs text-white/60 w-8",children:t})]})]})}function Vr(){const{shortcuts:e,updateShortcut:r,gridItems:s,updateGridItem:o}=re(),[i,l]=t.useState(!1),[c,d]=t.useState({current:0,total:0}),[u,h]=t.useState(null);t.useEffect(()=>{(async()=>{try{const e=await chrome.storage.local.getBytesInUse(),t=chrome.storage.local.QUOTA_BYTES||10485760;h({used:e,total:t})}catch(e){}})()},[i]);const m=e.length+s.filter(e=>"shortcut"===e.type).length,f=e.filter(e=>e.faviconBase64).length+s.filter(e=>"shortcut"===e.type&&e.shortcut?.faviconBase64).length,p=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1024/1024).toFixed(2)} MB`;return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-sm text-white/80",children:"下载并缓存所有图标"}),n.jsxs("div",{className:"text-xs text-white/50 mt-1",children:["已缓存 ",f," / ",m," 个图标"]}),u&&n.jsxs("div",{className:"text-xs text-white/40 mt-0.5",children:["存储占用: ",p(u.used)," / ",p(u.total),"(",(u.used/u.total*100).toFixed(1),"%)"]})]}),n.jsx("button",{onClick:async()=>{l(!0),d({current:0,total:0});try{const{batchDownloadFavicons:t}=await a(async()=>{const{batchDownloadFavicons:e}=await Promise.resolve().then(()=>xr);return{batchDownloadFavicons:e}},void 0);let n=0;if(e.length>0){const s=await t(e,(e,t)=>{d({current:e,total:t})});s.forEach((e,t)=>{r(t,{faviconBase64:e})}),n+=s.size}const i=s.filter(e=>"shortcut"===e.type&&e.shortcut);if(i.length>0){const r=await t(i.map(e=>({id:e.id,url:e.shortcut.url,favicon:e.shortcut.favicon,faviconBase64:e.shortcut.faviconBase64})),(t,n)=>{d({current:t+e.length,total:n+e.length})});r.forEach((e,t)=>{const n=s.find(e=>e.id===t);n?.shortcut&&o(t,{shortcut:{...n.shortcut,faviconBase64:e}})}),n+=r.size}alert(`成功缓存 ${n} 个图标`)}catch(t){alert("缓存图标失败，请重试")}finally{l(!1),d({current:0,total:0})}},disabled:i,className:"px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 disabled:bg-white/20 text-white text-sm transition-colors",children:i?"缓存中...":"立即缓存"})]}),i&&c.total>0&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:n.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:c.current/c.total*100+"%"}})}),n.jsxs("div",{className:"text-xs text-white/50 text-center",children:[c.current," / ",c.total]})]}),n.jsx("div",{className:"text-xs text-white/40 leading-relaxed",children:"图标会自动压缩到 10KB 以内，离线时可正常显示"})]})}function Jr({isOpen:e,onClose:r}){const{shortcutGroups:s,removeShortcut:o,updateShortcut:a,getFilteredShortcuts:i}=re(),[l,c]=t.useState(new Set),[d,u]=t.useState(""),h=i();if(t.useEffect(()=>{e||(c(new Set),u(""))},[e]),!e)return null;return he.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:yr},onClick:r,children:n.jsxs("div",{className:"relative w-full max-w-2xl max-h-[80vh] rounded-2xl glass-modal-dark flex flex-col overflow-hidden",style:{zIndex:jr},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[n.jsx("h2",{className:"text-lg font-medium text-white",children:"批量编辑快捷方式"}),n.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:n.jsx(_,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{className:"flex items-center gap-4 px-6 py-3 border-b border-white/10 bg-white/5",children:[n.jsx("button",{onClick:()=>{l.size===h.length?c(new Set):c(new Set(h.map(e=>e.id)))},className:"text-sm text-white/70 hover:text-white transition-colors",children:l.size===h.length?"取消全选":"全选"}),n.jsxs("span",{className:"text-sm text-white/50",children:["已选择 ",l.size," 项"]}),n.jsx("div",{className:"flex-1"}),n.jsxs("button",{onClick:()=>{0!==l.size&&confirm(`确定要删除选中的 ${l.size} 个快捷方式吗？`)&&(l.forEach(e=>o(e)),c(new Set))},disabled:0===l.size,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsx(G,{className:"w-4 h-4"}),"删除选中"]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n.jsx("div",{className:"grid grid-cols-4 gap-4",children:h.map(e=>n.jsxs("div",{onClick:()=>(e=>{const t=new Set(l);t.has(e)?t.delete(e):t.add(e),c(t)})(e.id),className:`\n                  relative flex flex-col items-center gap-2 p-4 rounded-xl cursor-pointer transition-all\n                  ${l.has(e.id)?"bg-blue-500/20 border-2 border-blue-500":"glass hover:bg-white/10 border-2 border-transparent"}\n                `,children:[l.has(e.id)&&n.jsx("div",{className:"absolute top-2 right-2 w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center",children:n.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center overflow-hidden",children:n.jsx("img",{src:e.favicon,alt:e.title,className:"w-8 h-8 object-contain",onError:t=>{const n=t.currentTarget;n.style.display="none";const r=n.parentElement;if(r&&!r.querySelector(".fallback-letter")){const t=document.createElement("span");t.className="fallback-letter text-lg font-medium text-white/70",t.textContent=e.title.charAt(0).toUpperCase(),r.appendChild(t)}}})}),n.jsx("span",{className:"text-xs text-white/80 truncate max-w-full text-center",children:e.title})]},e.id))})}),l.size>0&&n.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-t border-white/10 bg-white/5",children:[n.jsx(j,{className:"w-5 h-5 text-white/70"}),n.jsx("span",{className:"text-sm text-white/70",children:"移动到："}),n.jsxs("select",{value:d,onChange:e=>u(e.target.value),className:"flex-1 bg-white/10 text-white text-sm rounded-lg px-3 py-2 outline-none border border-white/10",children:[n.jsx("option",{value:"",children:"选择分组"}),s.map(e=>n.jsx("option",{value:e.id,className:"bg-gray-800",children:e.name},e.id))]}),n.jsx("button",{onClick:()=>{0!==l.size&&d&&(l.forEach(e=>{a(e,{groupId:d})}),c(new Set),r())},disabled:!d,className:"px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"移动"})]})]})}),document.body)}function Zr({x:e,y:r,items:s,onClose:o}){const a=t.useRef(null);return t.useEffect(()=>{const e=e=>{a.current&&!a.current.contains(e.target)&&o()},t=e=>{"Escape"===e.key&&o()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),document.addEventListener("contextmenu",o),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),document.removeEventListener("contextmenu",o)}},[o]),t.useEffect(()=>{if(a.current){const t=a.current.getBoundingClientRect(),n=e+t.width>window.innerWidth?window.innerWidth-t.width-10:e,s=r+t.height>window.innerHeight?window.innerHeight-t.height-10:r;a.current.style.left=`${n}px`,a.current.style.top=`${s}px`}},[e,r]),he.createPortal(n.jsx("div",{ref:a,className:"fixed z-[9999] min-w-[180px] rounded-lg glass-dark border border-white/10 shadow-xl py-1 animate-fadeIn",style:{left:e,top:r},children:s.map((e,t)=>n.jsxs("div",{children:[n.jsxs("button",{onClick:()=>{e.onClick(),o()},className:`\n              w-full flex items-center gap-3 px-4 py-2 text-sm transition-colors\n              ${e.danger?"text-red-400 hover:bg-red-500/20":"text-white/80 hover:bg-white/10"}\n            `,children:[n.jsx("span",{className:"w-4 h-4 flex-shrink-0",children:e.icon}),n.jsx("span",{children:e.label})]}),e.divider&&n.jsx("div",{className:"h-px bg-white/10 my-1"})]},t))}),document.body)}function Qr(){const{settings:e,isLoading:r,loadData:s,updateSettings:o,shortcutGroups:a,activeGroupId:i,setActiveGroup:l,addShortcut:c,addFolder:d}=re(),[u,m]=t.useState(!1),[f,p]=t.useState(!1),[g,x]=t.useState(!1),[v,w]=t.useState(!1),[b,y]=t.useState(null),j=t.useRef(),N=t.useRef(!1),C=t.useRef({shortcutGroups:a,activeGroupId:i,setActiveGroup:l});C.current={shortcutGroups:a,activeGroupId:i,setActiveGroup:l},t.useEffect(()=>{s()},[s]);const S=t.useCallback(e=>{const{shortcutGroups:t,activeGroupId:n,setActiveGroup:r}=C.current;if(N.current)return;const s=e.target.closest(".overflow-y-auto, .overflow-auto");if(s){const{scrollTop:t,scrollHeight:n,clientHeight:r}=s;if(n>r){if(e.deltaY<0&&t>0)return;if(e.deltaY>0&&t+r<n)return}}const o=t.map(e=>e.id);if(0===o.length)return;const a=o.indexOf(n||"");if(-1===a)return void r(o[0]);let i=a;e.deltaY>0?i=Math.min(a+1,o.length-1):e.deltaY<0&&(i=Math.max(a-1,0)),i!==a&&(e.preventDefault(),r(o[i]),N.current=!0,j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{N.current=!1},300))},[]),E=t.useCallback(e=>{const t=e.target,n=t.closest('[role="dialog"]')||t.closest(".glass-modal")||t.closest(".glass-modal-dark"),r="INPUT"===t.tagName||"TEXTAREA"===t.tagName;n||r||(e.preventDefault(),y({x:e.clientX,y:e.clientY}))},[]);t.useEffect(()=>{if(e.showShortcuts)return window.addEventListener("wheel",S,{passive:!1}),()=>{window.removeEventListener("wheel",S),j.current&&clearTimeout(j.current)}},[S,e.showShortcuts]),t.useEffect(()=>(window.addEventListener("contextmenu",E),()=>{window.removeEventListener("contextmenu",E)}),[E]);const I=t.useCallback(()=>{},[]);return r?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-[#1a1a2e]",children:n.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):n.jsxs("div",{className:"relative w-full h-full overflow-hidden",children:[n.jsx(Mr,{config:e.wallpaper,onRefresh:I}),n.jsxs("div",{className:"relative z-10 w-full h-full flex flex-col items-center px-4 pt-[12vh] pb-8 overflow-y-auto",children:[e.showGreeting&&n.jsx("div",{className:"mb-1 animate-fadeIn",children:n.jsx(Lr,{userName:e.userName})}),e.showClock&&n.jsx("div",{className:"mb-3 animate-fadeIn",children:n.jsx(se,{format:e.clockFormat,showDate:e.showDate,showSeconds:e.showSeconds,showLunar:e.showLunar})}),!e.showClock&&e.showLunar&&n.jsx("div",{className:"mb-3 animate-fadeIn",children:n.jsx(Br,{})}),e.showPoetry&&n.jsx("div",{className:"mb-6 animate-fadeIn",children:n.jsx(Or,{})}),e.showSearch&&n.jsx("div",{className:"w-full max-w-2xl mb-6 animate-fadeIn px-4 relative z-50",children:n.jsx(ue,{engine:e.searchEngine,enableSuggestions:e.enableSearchSuggestions,onEngineChange:e=>o({searchEngine:e})})}),e.showShortcuts&&n.jsx("div",{className:"w-full max-w-5xl animate-fadeIn px-4 shortcut-area",children:n.jsx("div",{className:"flex items-start gap-4",children:n.jsx(Ir,{columns:e.shortcutColumns,style:e.shortcutStyle,onAddClick:()=>p(!0),onBatchEditClick:()=>w(!0)})})})]}),n.jsx($r,{onOpenSettings:()=>m(!0)}),e.showPinnedBookmarks&&n.jsx(Ar,{}),u&&n.jsx(Hr,{onClose:()=>m(!1)}),f&&n.jsx(Sr,{isOpen:f,onClose:()=>p(!1),onAdd:(e,t)=>{const n=new URL(e).hostname;c({url:e,title:t,favicon:`${V}${n}&sz=64`,groupId:i||void 0})},groupName:i?a.find(e=>e.id===i)?.name:void 0}),n.jsx(Jr,{isOpen:v,onClose:()=>w(!1)}),n.jsx(Cr,{isOpen:g,onClose:()=>x(!1),onSave:e=>d(e,i??void 0)}),b&&n.jsx(Zr,{x:b.x,y:b.y,items:[{label:"添加快捷方式",icon:n.jsx(h,{className:"w-4 h-4"}),onClick:()=>p(!0)},{label:"添加文件夹",icon:n.jsx(k,{className:"w-4 h-4"}),onClick:()=>x(!0)},{label:"批量编辑",icon:n.jsx(O,{className:"w-4 h-4"}),onClick:()=>w(!0),divider:!0}],onClose:()=>y(null)})]})}const es=document.getElementById("root");es&&o.createRoot(es).render(n.jsx(s.StrictMode,{children:n.jsx(Qr,{})}));
