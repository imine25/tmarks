import{c as e,r as t,j as n,b as r,a as s,R as o}from"./react-DmgQkRKB.js";import{S as i,g as a}from"./urls-CEh1Kean.js";import{c as l,l as c}from"./index-BbZ5549T.js";import{c as d}from"./index-CLpTKzGv.js";const u=l("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]),h=l("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),m=l("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),f=l("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),p=l("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),g=l("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),x=l("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),v=l("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),w=l("folder-input",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),b=l("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),y=l("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),j=l("gamepad-2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]),k=l("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),N=l("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),C=l("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),S=l("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),E=l("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),D=l("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),I=l("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),M=l("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),R=l("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),z=l("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),A=l("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),T=l("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),L=l("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),O=l("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),F=l("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),B=l("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),P=l("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]),G=l("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),$=l("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),H=l("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),U=l("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),q=[{id:"google",name:"Google",url:"https://www.google.com/search?q=",icon:"https://www.google.com/favicon.ico"},{id:"bing",name:"Bing",url:"https://www.bing.com/search?q=",icon:"https://www.bing.com/favicon.ico"},{id:"zhihu",name:"知乎",url:"https://www.zhihu.com/search?type=content&q=",icon:"https://static.zhihu.com/heifetz/favicon.ico"},{id:"github",name:"GitHub",url:"https://github.com/search?q=",icon:"https://github.com/favicon.ico"},{id:"bilibili",name:"B站",url:"https://search.bilibili.com/all?keyword=",icon:"https://www.bilibili.com/favicon.ico"}],Y={showClock:!0,clockFormat:"24h",showDate:!0,showSeconds:!1,showSearch:!0,searchEngine:"google",showShortcuts:!0,shortcutColumns:8,shortcutStyle:"icon",wallpaper:{type:"bing",value:"",blur:0,brightness:100},showPinnedBookmarks:!0,enableSearchSuggestions:!0,autoRefreshPinnedBookmarks:!0,pinnedBookmarksRefreshTime:"morning",showGreeting:!0,userName:"",showLunar:!0,showPoetry:!0,hotSearchType:"baidu"},X=[{content:"海内存知己，天涯若比邻。",author:"王勃",title:"送杜少府之任蜀州"},{content:"落霞与孤鹜齐飞，秋水共长天一色。",author:"王勃",title:"滕王阁序"},{content:"人生得意须尽欢，莫使金樽空对月。",author:"李白",title:"将进酒"},{content:"长风破浪会有时，直挂云帆济沧海。",author:"李白",title:"行路难"},{content:"会当凌绝顶，一览众山小。",author:"杜甫",title:"望岳"},{content:"读书破万卷，下笔如有神。",author:"杜甫",title:"奉赠韦左丞丈二十二韵"},{content:"春风得意马蹄疾，一日看尽长安花。",author:"孟郊",title:"登科后"},{content:"沉舟侧畔千帆过，病树前头万木春。",author:"刘禹锡",title:"酬乐天扬州初逢席上见赠"},{content:"山重水复疑无路，柳暗花明又一村。",author:"陆游",title:"游山西村"},{content:"纸上得来终觉浅，绝知此事要躬行。",author:"陆游",title:"冬夜读书示子聿"},{content:"问渠那得清如许？为有源头活水来。",author:"朱熹",title:"观书有感"},{content:"不畏浮云遮望眼，自缘身在最高层。",author:"王安石",title:"登飞来峰"}],W="newtab",K="https://www.google.com/s2/favicons?domain=",_=[{id:"home",name:"首页",icon:"Home",position:0}],V=["Home","Briefcase","GraduationCap","Gamepad2","Wrench","Code","Music","Film","ShoppingCart","Heart","Star","Bookmark","Folder","Globe","Zap"],J={shortcut:{type:"shortcut",name:"快捷方式",icon:"Link",description:"网站快捷方式",sizeConfig:{type:"shortcut",defaultSize:"1x1",allowedSizes:["1x1"],minWidth:1,minHeight:1}},weather:{type:"weather",name:"天气",icon:"Cloud",description:"显示当前天气和未来预报",sizeConfig:{type:"weather",defaultSize:"2x2",allowedSizes:["2x1","2x2","2x3"],minWidth:2,minHeight:1}},clock:{type:"clock",name:"时钟",icon:"Clock",description:"显示当前时间",sizeConfig:{type:"clock",defaultSize:"2x1",allowedSizes:["2x1","2x2"],minWidth:2,minHeight:1}},todo:{type:"todo",name:"待办事项",icon:"CheckSquare",description:"管理待办任务",sizeConfig:{type:"todo",defaultSize:"2x2",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},notes:{type:"notes",name:"备忘录",icon:"StickyNote",description:"快速记录笔记",sizeConfig:{type:"notes",defaultSize:"2x2",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},hotsearch:{type:"hotsearch",name:"热搜",icon:"TrendingUp",description:"显示热门搜索",sizeConfig:{type:"hotsearch",defaultSize:"2x3",allowedSizes:["2x2","2x3","2x4"],minWidth:2,minHeight:2}},poetry:{type:"poetry",name:"每日诗词",icon:"BookOpen",description:"显示每日诗词",sizeConfig:{type:"poetry",defaultSize:"2x1",allowedSizes:["2x1","2x2"],minWidth:2,minHeight:1}}};let Z=null;function Q(e){Z&&clearTimeout(Z),Z=setTimeout(()=>{!async function(e){try{const t=await i.getBookmarkSiteApiUrl(),n=await i.getBookmarkSiteApiKey();if(!n)return;const r=t?.endsWith("/api")?t:a(t||void 0).API_BASE;(await fetch(`${r}/tab/newtab/sync`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":n},body:JSON.stringify({shortcuts:e.shortcuts.map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,group_id:e.groupId,folder_id:e.folderId,position:e.position})),groups:e.groups.map(e=>({id:e.id,name:e.name,icon:e.icon,position:e.position})),folders:e.folders.map(e=>({id:e.id,name:e.name,icon:e.icon,group_id:e.groupId,position:e.position})),settings:{columns:e.settings.shortcutColumns,style:e.settings.shortcutStyle,showTitle:!0,backgroundType:e.settings.wallpaper.type,backgroundValue:e.settings.wallpaper.value,backgroundBlur:e.settings.wallpaper.blur,backgroundDim:e.settings.wallpaper.brightness,showSearch:e.settings.showSearch,showClock:e.settings.showClock,showPinnedBookmarks:e.settings.showPinnedBookmarks,searchEngine:e.settings.searchEngine},gridItems:e.gridItems.map(e=>({id:e.id,type:e.type,size:e.size,position:e.position,group_id:e.groupId,shortcut:e.shortcut,config:e.config}))})})).ok}catch(t){}}(e)},2e3)}const ee=()=>`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,te=e((e,t)=>({shortcuts:[],shortcutGroups:_,shortcutFolders:[],activeGroupId:"home",settings:Y,isLoading:!0,gridItems:[],loadData:async()=>{try{const n=(await chrome.storage.local.get(W))[W],r=n?.shortcutGroups?.length?n.shortcutGroups:_;let s=n?.activeGroupId;s&&r.some(e=>e.id===s)||(s=r[0]?.id||"home");const o={...Y,...n?.settings||{}};if(e({shortcuts:n?.shortcuts||[],shortcutGroups:r,shortcutFolders:n?.shortcutFolders||[],activeGroupId:s,settings:o,gridItems:n?.gridItems||[],isLoading:!1}),!n){const{saveData:e}=t();e()}}catch(n){e({isLoading:!1})}},saveData:async()=>{const{shortcuts:e,shortcutGroups:n,shortcutFolders:r,activeGroupId:s,settings:o,gridItems:i}=t(),a={shortcuts:e,shortcutGroups:n,shortcutFolders:r,activeGroupId:s,settings:o,gridItems:i};try{await chrome.storage.local.set({[W]:a})}catch(l){}},addShortcut:n=>{const{shortcuts:r,shortcutGroups:s,settings:o,gridItems:i,saveData:a}=t(),l={...n,id:ee(),position:r.length,createdAt:Date.now(),clickCount:0},c=[...r,l];e({shortcuts:c}),a();const{shortcutFolders:d}=t();Q({shortcuts:c,groups:s,folders:d,settings:o,gridItems:i})},updateShortcut:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=s.map(e=>e.id===n?{...e,...r}:e);e({shortcuts:d}),c(),Q({shortcuts:d,groups:o,folders:i,settings:a,gridItems:l})},removeShortcut:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:i,gridItems:a,saveData:l}=t(),c=r.filter(e=>e.id!==n).map((e,t)=>({...e,position:t}));e({shortcuts:c}),l(),Q({shortcuts:c,groups:s,folders:o,settings:i,gridItems:a})},reorderShortcuts:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=[...s],[u]=d.splice(n,1);d.splice(r,0,u);const h=d.map((e,t)=>({...e,position:t}));e({shortcuts:h}),c(),Q({shortcuts:h,groups:o,folders:i,settings:a,gridItems:l})},incrementClickCount:n=>{const{shortcuts:r,saveData:s}=t();e({shortcuts:r.map(e=>e.id===n?{...e,clickCount:e.clickCount+1}:e)}),s()},updateSettings:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:i,gridItems:a,saveData:l}=t(),c={...i,...n};e({settings:c}),l(),Q({shortcuts:r,groups:s,folders:o,settings:c,gridItems:a})},setActiveGroup:n=>{const{saveData:r}=t();e({activeGroupId:n}),r()},addGroup:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d={id:ee(),name:n,icon:r,position:o.length},u=[...o,d];e({shortcutGroups:u}),c(),Q({shortcuts:s,groups:u,folders:i,settings:a,gridItems:l})},updateGroup:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=o.map(e=>e.id===n?{...e,...r}:e);e({shortcutGroups:d}),c(),Q({shortcuts:s,groups:d,folders:i,settings:a,gridItems:l})},removeGroup:n=>{const{shortcutGroups:r,shortcutFolders:s,shortcuts:o,activeGroupId:i,settings:a,gridItems:l,saveData:c}=t();if("home"===n)return;const d=o.map(e=>e.groupId===n?{...e,groupId:"home"}:e),u=r.filter(e=>e.id!==n);e({shortcutGroups:u,shortcuts:d,activeGroupId:i===n?"home":i}),c(),Q({shortcuts:d,groups:u,folders:s,settings:a,gridItems:l})},getFilteredShortcuts:()=>{const{shortcuts:e,activeGroupId:n}=t(),r=n??"home";return e.filter(e=>e.groupId===r&&!e.folderId)},addFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,activeGroupId:a,settings:l,gridItems:c,saveData:d}=t(),u={id:ee(),name:n,position:i.length,groupId:r??a??void 0,createdAt:Date.now()},h=[...i,u];return e({shortcutFolders:h}),d(),Q({shortcuts:s,groups:o,folders:h,settings:l,gridItems:c}),u.id},updateFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=i.map(e=>e.id===n?{...e,...r}:e);e({shortcutFolders:d}),c(),Q({shortcuts:s,groups:o,folders:d,settings:a,gridItems:l})},removeFolder:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:i,gridItems:a,saveData:l}=t(),c=r.map(e=>e.folderId===n?{...e,folderId:void 0}:e),d=o.filter(e=>e.id!==n);e({shortcutFolders:d,shortcuts:c}),l(),Q({shortcuts:c,groups:s,folders:d,settings:i,gridItems:a})},getFolderShortcuts:e=>{const{shortcuts:n}=t();return n.filter(t=>t.folderId===e)},moveShortcutToFolder:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=s.map(e=>e.id===n?{...e,folderId:r}:e);e({shortcuts:d}),c(),Q({shortcuts:d,groups:o,folders:i,settings:a,gridItems:l})},addGridItem:(n,r={})=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,activeGroupId:c,saveData:d}=t(),u=function(e){return J[e]}(n),h=function(e){switch(e){case"weather":return{weather:{city:"北京",unit:"C",showForecast:!0,autoLocation:!1}};case"clock":return{clock:{format:"24h",showDate:!0,showSeconds:!1,showLunar:!1}};case"todo":return{todo:{showCompleted:!1}};case"notes":return{notes:{content:""}};case"hotsearch":return{hotsearch:{type:"baidu"}};case"poetry":return{poetry:{autoRefresh:!0}};default:return{}}}(n),m={id:ee(),type:n,size:r.size||u.sizeConfig.defaultSize,position:l.length,groupId:r.groupId??c??void 0,shortcut:r.shortcut,config:"shortcut"!==n?h:void 0,createdAt:Date.now()},f=[...l,m];e({gridItems:f}),d(),Q({shortcuts:s,groups:o,folders:i,settings:a,gridItems:f})},updateGridItem:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=l.map(e=>e.id===n?{...e,...r}:e);e({gridItems:d}),c(),Q({shortcuts:s,groups:o,folders:i,settings:a,gridItems:d})},removeGridItem:n=>{const{shortcuts:r,shortcutGroups:s,shortcutFolders:o,settings:i,gridItems:a,saveData:l}=t(),c=a.filter(e=>e.id!==n).map((e,t)=>({...e,position:t}));e({gridItems:c}),l(),Q({shortcuts:r,groups:s,folders:o,settings:i,gridItems:c})},reorderGridItems:(n,r)=>{const{shortcuts:s,shortcutGroups:o,shortcutFolders:i,settings:a,gridItems:l,saveData:c}=t(),d=[...l],[u]=d.splice(n,1);d.splice(r,0,u);const h=d.map((e,t)=>({...e,position:t}));e({gridItems:h}),c(),Q({shortcuts:s,groups:o,folders:i,settings:a,gridItems:h})},getFilteredGridItems:()=>{const{gridItems:e,activeGroupId:n}=t(),r=n??"home";return e.filter(e=>e.groupId===r)},migrateToGridItems:()=>{const{shortcuts:n,gridItems:r,saveData:s}=t();if(0===n.length)return;const o=new Set(r.filter(e=>"shortcut"===e.type&&e.shortcut).map(e=>e.id)),i=n.filter(e=>!o.has(e.id));if(0===i.length)return;const a=i.map((e,t)=>({id:e.id,type:"shortcut",size:"1x1",position:r.length+t,groupId:e.groupId,shortcut:{url:e.url,title:e.title,favicon:e.favicon},createdAt:e.createdAt})),l=[...r,...a];e({gridItems:l}),s()}}));function ne({format:e,showDate:r,showSeconds:s,showLunar:o=!1}){const[i,a]=t.useState(new Date);t.useEffect(()=>{const e=setInterval(()=>a(new Date),1e3);return()=>clearInterval(e)},[]);const l=t.useMemo(()=>{if(!o)return null;const e=c.Lunar.fromDate(i);let t="";try{const n=e.getFestivals?.()||[],r=e.getJieQi?.()||"";t=n[0]||r||""}catch{}return{date:`${e.getMonthInChinese()}月${e.getDayInChinese()}`,festival:t}},[i,o]);return n.jsxs("div",{className:"text-center text-white select-none",children:[n.jsx("div",{className:"text-7xl font-light tracking-wider text-shadow-lg",children:(()=>{let t=i.getHours();const n=i.getMinutes().toString().padStart(2,"0"),r=i.getSeconds().toString().padStart(2,"0");let o="";"12h"===e&&(o=t>=12?" PM":" AM",t=t%12||12);let a=`${t.toString().padStart(2,"0")}:${n}`;return s&&(a+=`:${r}`),"12h"===e&&(a+=o),a})()}),(r||o)&&n.jsxs("div",{className:"mt-2 text-lg text-white/90 text-shadow flex items-center justify-center gap-3",children:[r&&n.jsx("span",{children:i.toLocaleDateString("zh-CN",{weekday:"short",month:"numeric",day:"numeric"})}),r&&o&&n.jsx("span",{className:"text-white/50",children:"|"}),o&&l&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:l.date}),l.festival&&n.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/10 text-sm",children:l.festival})]})]})]})}const re="tmarks_pinned_bookmarks";async function se(){const e=await i.getBookmarkSiteApiUrl(),t=await i.getBookmarkSiteApiKey();if(!t)throw new Error("API Key 未配置");let n;return n=e?e.endsWith("/api")?e:a(e).API_BASE:a().API_BASE,d({apiKey:t,baseUrl:n})}function oe(){const[e,n]=t.useState({isSyncing:!1,lastSyncAt:null,error:null}),[r,s]=t.useState([]),o=t.useRef(null),i=t.useCallback(async()=>{try{const e=(await chrome.storage.local.get(re))[re];return e&&e.bookmarks?e.bookmarks:null}catch(e){return null}},[]),a=t.useCallback(async e=>{try{const t={bookmarks:e,timestamp:Date.now()};await chrome.storage.local.set({[re]:t})}catch(t){}},[]),l=t.useCallback(async(e=!1)=>{if(!e){const e=await i();if(e)return s(e),n({isSyncing:!1,lastSyncAt:Date.now(),error:null}),e}n(e=>({...e,isSyncing:!0,error:null}));try{const e=await se(),t=await e.bookmarks.getPinnedBookmarks({page_size:20});if(t.data?.bookmarks){const e=t.data.bookmarks.filter(e=>!0===e.is_pinned).map(e=>({id:e.id,url:e.url,title:e.title,favicon:e.favicon||void 0,is_pinned:!0}));s(e),await a(e)}return n({isSyncing:!1,lastSyncAt:Date.now(),error:null}),t.data?.bookmarks||[]}catch(t){const e=t instanceof Error?t.message:"同步失败";return n(t=>({...t,isSyncing:!1,error:e})),[]}},[i,a]),c=t.useCallback(async e=>{if(!e.trim())return[];try{const t=await se(),n=await t.bookmarks.searchBookmarks(e,{page_size:10});return(n.data?.bookmarks||[]).map(e=>({id:e.id,url:e.url,title:e.title,favicon:e.favicon||void 0}))}catch{return[]}},[]),d=t.useCallback(async()=>{try{const e=await se();return await e.bookmarks.getBookmarks({page_size:1}),!0}catch{return!1}},[]);t.useEffect(()=>{o.current=l},[l]),t.useEffect(()=>{const e=e=>{"REFRESH_PINNED_BOOKMARKS"===e.type&&o.current&&o.current(!0)};return chrome.runtime.onMessage.addListener(e),()=>{chrome.runtime.onMessage.removeListener(e)}},[]);const u=t.useCallback(async e=>{try{const t=e.map(e=>r.find(t=>t.id===e)).filter(e=>void 0!==e);s(t),await a(t);const n=await se();await n.bookmarks.reorderPinnedBookmarks(e)}catch(t){await l(!0)}},[r,a,l]);return{syncState:e,pinnedBookmarks:r,fetchPinnedBookmarks:l,searchBookmarks:c,checkApiConfigured:d,reorderPinnedBookmarks:u}}function ie({icon:e,name:t,size:r="md"}){const s="sm"===r?"w-4 h-4":"w-5 h-5";return n.jsx("img",{src:e,alt:t,className:`${s} object-contain`,onError:e=>{e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t&&!t.querySelector(".fallback-icon")){const e=document.createElement("span");e.className=`fallback-icon ${s} flex items-center justify-center`,e.innerHTML=`<svg class="${s} text-white/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,t.appendChild(e)}}})}function ae({current:e,onChange:r}){const[s,o]=t.useState(!1),i=q.find(t=>t.id===e)||q[0];return n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>o(!s),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:[n.jsx(ie,{icon:i.icon,name:i.name}),n.jsx(f,{className:"w-3 h-3 text-white/60 transition-transform "+(s?"rotate-180":"")})]}),s&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),n.jsx("div",{className:"absolute top-full left-0 mt-2 w-40 rounded-xl glass-dark overflow-hidden z-50 animate-scaleIn",children:q.map(t=>n.jsxs("button",{onClick:()=>{r(t.id),o(!1)},className:"w-full flex items-center gap-3 px-3 py-2.5 text-left transition-colors "+(t.id===e?"bg-white/20":"hover:bg-white/10"),children:[n.jsx(ie,{icon:t.icon,name:t.name}),n.jsx("span",{className:"text-sm text-white/80",children:t.name})]},t.id))})]})]})}function le(e,t){if(e)return e;try{const e=new URL(t).hostname;return`${K}${e}&sz=64`}catch{return""}}function ce({engine:e,enableSuggestions:r=!0,onEngineChange:s}){const[o,i]=t.useState(""),[a,l]=t.useState(!1),[c,d]=t.useState([]),[h,m]=t.useState(-1),[f,p]=t.useState(!1),g=t.useRef(null),x=t.useRef(),{shortcuts:v}=te(),{searchBookmarks:w}=oe(),b=q.find(t=>t.id===e)||q[0],y=t.useCallback(e=>{const t=e.toLowerCase();return v.filter(e=>e.title.toLowerCase().includes(t)||e.url.toLowerCase().includes(t)).slice(0,5).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"shortcut"}))},[v]);t.useEffect(()=>{if(o.trim())return x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{if(f){const e=y(o),t=(await w(o)).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"bookmark"})),n=[...e];t.forEach(e=>{n.some(t=>t.url===e.url)||n.push(e)}),d(n.slice(0,10))}else if(r){const e=y(o),t=(await w(o)).map(e=>({id:e.id,title:e.title,url:e.url,favicon:e.favicon,source:"bookmark"})),n=[...e];t.forEach(e=>{n.some(t=>t.url===e.url)||n.push(e)}),d(n.slice(0,8))}},200),()=>{x.current&&clearTimeout(x.current)};d([])},[o,y,w,f,r]);const j=t.useCallback(()=>{if(!o.trim())return;const e=b.url+encodeURIComponent(o.trim());window.location.href=e},[o,b]),k=e=>{window.location.href=e.url},N=(f||r)&&a&&c.length>0;return n.jsxs("div",{className:"relative",children:[n.jsxs("div",{className:`\n          flex items-center gap-3 px-4 py-3 rounded-full\n          glass transition-all duration-200\n          ${a?"ring-2 ring-white/30 bg-white/15":"hover:bg-white/15"}\n        `,children:[s?n.jsx(ae,{current:e,onChange:s}):n.jsx(A,{className:"w-5 h-5 text-white/60 flex-shrink-0"}),n.jsx("input",{ref:g,type:"text",value:o,onChange:e=>{i(e.target.value),m(-1)},onKeyDown:e=>{"Enter"===e.key?h>=0&&c[h]?k(c[h]):f||j():"ArrowDown"===e.key?(e.preventDefault(),m(e=>Math.min(e+1,c.length-1))):"ArrowUp"===e.key?(e.preventDefault(),m(e=>Math.max(e-1,-1))):"Escape"===e.key&&(d([]),m(-1))},onFocus:()=>l(!0),onBlur:()=>setTimeout(()=>l(!1),150),placeholder:f?"搜索书签...":`在 ${b.name} 中搜索...`,className:"flex-1 bg-transparent text-white placeholder-white/50 outline-none text-base"}),n.jsx("button",{onClick:()=>p(!f),className:"p-2 rounded-full transition-all "+(f?"bg-blue-500/30 text-blue-400":"text-white/40 hover:text-white/70 hover:bg-white/10"),title:f?"切换到搜索引擎":"切换到书签搜索",children:n.jsx(u,{className:"w-4 h-4"})})]}),N&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 rounded-xl glass-dark overflow-hidden animate-scaleIn z-[100]",children:c.map((e,t)=>n.jsxs("button",{onClick:()=>k(e),className:`\n                w-full flex items-center gap-3 px-4 py-3 text-left\n                transition-colors\n                ${t===h?"bg-white/20":"hover:bg-white/10"}\n              `,children:[n.jsx("img",{src:le(e.favicon,e.url),alt:"",className:"w-5 h-5 rounded",onError:e=>{e.target.style.display="none"}}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-white truncate",children:e.title}),n.jsx("div",{className:"text-xs text-white/50 truncate",children:e.url})]}),n.jsx("span",{className:"text-xs text-white/30",children:"shortcut"===e.source?"快捷方式":"书签"})]},e.id))})]})}var de=r();const ue="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function he(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function me(e){return"nodeType"in e}function fe(e){var t,n;return e?he(e)?e:me(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function pe(e){const{Document:t}=fe(e);return e instanceof t}function ge(e){return!he(e)&&e instanceof fe(e).HTMLElement}function xe(e){return e instanceof fe(e).SVGElement}function ve(e){return e?he(e)?e.document:me(e)?pe(e)?e:ge(e)||xe(e)?e.ownerDocument:document:document:document}const we=ue?t.useLayoutEffect:t.useEffect;function be(e){const n=t.useRef(e);return we(()=>{n.current=e}),t.useCallback(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function ye(e,n){void 0===n&&(n=[e]);const r=t.useRef(e);return we(()=>{r.current!==e&&(r.current=e)},n),r}function je(e,n){const r=t.useRef();return t.useMemo(()=>{const t=e(r.current);return r.current=t,t},[...n])}function ke(e){const n=be(e),r=t.useRef(null),s=t.useCallback(e=>{e!==r.current&&(null==n||n(e,r.current)),r.current=e},[]);return[r,s]}function Ne(e){const n=t.useRef();return t.useEffect(()=>{n.current=e},[e]),n.current}let Ce={};function Se(e,n){return t.useMemo(()=>{if(n)return n;const t=null==Ce[e]?0:Ce[e]+1;return Ce[e]=t,e+"-"+t},[e,n])}function Ee(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((t,n)=>{const r=Object.entries(n);for(const[s,o]of r){const n=t[s];null!=n&&(t[s]=n+e*o)}return t},{...t})}}const De=Ee(1),Ie=Ee(-1);function Me(e){if(!e)return!1;const{KeyboardEvent:t}=fe(e.target);return t&&e instanceof t}function Re(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=fe(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const ze=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[ze.Translate.toString(e),ze.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Ae="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Te(e){return e.matches(Ae)?e:e.querySelector(Ae)}const Le={display:"none"};function Oe(e){let{id:t,value:n}=e;return s.createElement("div",{id:t,style:Le},n)}function Fe(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return s.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}const Be=t.createContext(null);const Pe={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Ge={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function $e(e){let{announcements:n=Ge,container:r,hiddenTextDescribedById:o,screenReaderInstructions:i=Pe}=e;const{announce:a,announcement:l}=function(){const[e,n]=t.useState("");return{announce:t.useCallback(e=>{null!=e&&n(e)},[]),announcement:e}}(),c=Se("DndLiveRegion"),[d,u]=t.useState(!1);if(t.useEffect(()=>{u(!0)},[]),function(e){const n=t.useContext(Be);t.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}(t.useMemo(()=>({onDragStart(e){let{active:t}=e;a(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&a(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;a(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;a(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;a(n.onDragCancel({active:t,over:r}))}}),[a,n])),!d)return null;const h=s.createElement(s.Fragment,null,s.createElement(Oe,{id:o,value:i.draggable}),s.createElement(Fe,{id:c,announcement:l}));return r?de.createPortal(h,r):h}var He,Ue;function qe(){}function Ye(e,n){return t.useMemo(()=>({sensor:e,options:null!=n?n:{}}),[e,n])}function Xe(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.useMemo(()=>[...n].filter(e=>null!=e),[...n])}(Ue=He||(He={})).DragStart="dragStart",Ue.DragMove="dragMove",Ue.DragEnd="dragEnd",Ue.DragCancel="dragCancel",Ue.DragOver="dragOver",Ue.RegisterDroppable="registerDroppable",Ue.SetDroppableDisabled="setDroppableDisabled",Ue.UnregisterDroppable="unregisterDroppable";const We=Object.freeze({x:0,y:0});function Ke(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function _e(e,t){const n=Re(e);if(!n)return"0 0";return(n.x-t.left)/t.width*100+"% "+(n.y-t.top)/t.height*100+"%"}function Ve(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Je(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Ze(e){let{left:t,top:n,height:r,width:s}=e;return[{x:t,y:n},{x:t+s,y:n},{x:t,y:n+r},{x:t+s,y:n+r}]}function Qe(e,t){if(!e||0===e.length)return null;const[n]=e;return n[t]}function et(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}const tt=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=et(t,t.left,t.top),o=[];for(const i of r){const{id:e}=i,t=n.get(e);if(t){const n=Ke(et(t),s);o.push({id:e,data:{droppableContainer:i,value:n}})}}return o.sort(Ve)};function nt(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),i=s-r,a=o-n;if(r<s&&n<o){const n=t.width*t.height,r=e.width*e.height,s=i*a;return Number((s/(n+r-s)).toFixed(4))}return 0}const rt=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:e}=o,r=n.get(e);if(r){const n=nt(r,t);n>0&&s.push({id:e,data:{droppableContainer:o,value:n}})}}return s.sort(Je)};function st(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:We}function ot(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}const it=ot(1);function at(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}const lt={ignoreTransform:!1};function ct(e,t){void 0===t&&(t=lt);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=fe(e).getComputedStyle(e);t&&(n=function(e,t,n){const r=at(t);if(!r)return e;const{scaleX:s,scaleY:o,x:i,y:a}=r,l=e.left-i-(1-s)*parseFloat(n),c=e.top-a-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),d=s?e.width/s:e.width,u=o?e.height/o:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(n,t,r))}const{top:r,left:s,width:o,height:i,bottom:a,right:l}=n;return{top:r,left:s,width:o,height:i,bottom:a,right:l}}function dt(e){return ct(e,{ignoreTransform:!0})}function ut(e,t){const n=[];return e?function r(s){if(null!=t&&n.length>=t)return n;if(!s)return n;if(pe(s)&&null!=s.scrollingElement&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!ge(s)||xe(s))return n;if(n.includes(s))return n;const o=fe(e).getComputedStyle(s);return s!==e&&function(e,t){void 0===t&&(t=fe(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&n.test(r)})}(s,o)&&n.push(s),function(e,t){return void 0===t&&(t=fe(e).getComputedStyle(e)),"fixed"===t.position}(s,o)?n:r(s.parentNode)}(e):n}function ht(e){const[t]=ut(e,1);return null!=t?t:null}function mt(e){return ue&&e?he(e)?e:me(e)?pe(e)||e===ve(e).scrollingElement?window:ge(e)?e:null:null:null}function ft(e){return he(e)?e.scrollX:e.scrollLeft}function pt(e){return he(e)?e.scrollY:e.scrollTop}function gt(e){return{x:ft(e),y:pt(e)}}var xt,vt;function wt(e){return!(!ue||!e)&&e===document.scrollingElement}function bt(e){const t={x:0,y:0},n=wt(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(vt=xt||(xt={}))[vt.Forward=1]="Forward",vt[vt.Backward=-1]="Backward";const yt={x:.2,y:.2};function jt(e,t,n,r,s){let{top:o,left:i,right:a,bottom:l}=n;void 0===r&&(r=10),void 0===s&&(s=yt);const{isTop:c,isBottom:d,isLeft:u,isRight:h}=bt(e),m={x:0,y:0},f={x:0,y:0},p=t.height*s.y,g=t.width*s.x;return!c&&o<=t.top+p?(m.y=xt.Backward,f.y=r*Math.abs((t.top+p-o)/p)):!d&&l>=t.bottom-p&&(m.y=xt.Forward,f.y=r*Math.abs((t.bottom-p-l)/p)),!h&&a>=t.right-g?(m.x=xt.Forward,f.x=r*Math.abs((t.right-g-a)/g)):!u&&i<=t.left+g&&(m.x=xt.Backward,f.x=r*Math.abs((t.left+g-i)/g)),{direction:m,speed:f}}function kt(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function Nt(e){return e.reduce((e,t)=>De(e,gt(t)),We)}function Ct(e,t){if(void 0===t&&(t=ct),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);ht(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const St=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+ft(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+pt(t),0)}]];class Et{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=ut(t),r=Nt(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[s,o,i]of St)for(const e of o)Object.defineProperty(this,e,{get:()=>{const t=i(n),o=r[s]-t;return this.rect[e]+o},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Dt{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function It(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}var Mt,Rt,zt,At;function Tt(e){e.preventDefault()}function Lt(e){e.stopPropagation()}(Rt=Mt||(Mt={})).Click="click",Rt.DragStart="dragstart",Rt.Keydown="keydown",Rt.ContextMenu="contextmenu",Rt.Resize="resize",Rt.SelectionChange="selectionchange",Rt.VisibilityChange="visibilitychange",(At=zt||(zt={})).Space="Space",At.Down="ArrowDown",At.Right="ArrowRight",At.Left="ArrowLeft",At.Up="ArrowUp",At.Esc="Escape",At.Enter="Enter",At.Tab="Tab";const Ot={start:[zt.Space,zt.Enter],cancel:[zt.Esc],end:[zt.Space,zt.Enter,zt.Tab]},Ft=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case zt.Right:return{...n,x:n.x+25};case zt.Left:return{...n,x:n.x-25};case zt.Down:return{...n,y:n.y+25};case zt.Up:return{...n,y:n.y-25}}};class Bt{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Dt(ve(t)),this.windowListeners=new Dt(fe(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Mt.Resize,this.handleCancel),this.windowListeners.add(Mt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Mt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&Ct(n),t(We)}handleKeyDown(e){if(Me(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:s=Ot,coordinateGetter:o=Ft,scrollBehavior:i="smooth"}=r,{code:a}=e;if(s.end.includes(a))return void this.handleEnd(e);if(s.cancel.includes(a))return void this.handleCancel(e);const{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:We;this.referenceCoordinates||(this.referenceCoordinates=c);const d=o(e,{active:t,context:n.current,currentCoordinates:c});if(d){const t=Ie(d,c),r={x:0,y:0},{scrollableAncestors:s}=n.current;for(const n of s){const s=e.code,{isTop:o,isRight:a,isLeft:l,isBottom:c,maxScroll:u,minScroll:h}=bt(n),m=kt(n),f={x:Math.min(s===zt.Right?m.right-m.width/2:m.right,Math.max(s===zt.Right?m.left:m.left+m.width/2,d.x)),y:Math.min(s===zt.Down?m.bottom-m.height/2:m.bottom,Math.max(s===zt.Down?m.top:m.top+m.height/2,d.y))},p=s===zt.Right&&!a||s===zt.Left&&!l,g=s===zt.Down&&!c||s===zt.Up&&!o;if(p&&f.x!==d.x){const e=n.scrollLeft+t.x,o=s===zt.Right&&e<=u.x||s===zt.Left&&e>=h.x;if(o&&!t.y)return void n.scrollTo({left:e,behavior:i});r.x=o?n.scrollLeft-e:s===zt.Right?n.scrollLeft-u.x:n.scrollLeft-h.x,r.x&&n.scrollBy({left:-r.x,behavior:i});break}if(g&&f.y!==d.y){const e=n.scrollTop+t.y,o=s===zt.Down&&e<=u.y||s===zt.Up&&e>=h.y;if(o&&!t.x)return void n.scrollTo({top:e,behavior:i});r.y=o?n.scrollTop-e:s===zt.Down?n.scrollTop-u.y:n.scrollTop-h.y,r.y&&n.scrollBy({top:-r.y,behavior:i});break}}this.handleMove(e,De(Ie(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function Pt(e){return Boolean(e&&"distance"in e)}function Gt(e){return Boolean(e&&"delay"in e)}Bt.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Ot,onActivation:s}=t,{active:o}=n;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const t=o.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==s||s({event:e.nativeEvent}),!0)}return!1}}];class $t{constructor(e,t,n){var r;void 0===n&&(n=function(e){const{EventTarget:t}=fe(e);return e instanceof t?e:ve(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:s}=e,{target:o}=s;this.props=e,this.events=t,this.document=ve(o),this.documentListeners=new Dt(this.document),this.listeners=new Dt(n),this.windowListeners=new Dt(fe(o)),this.initialCoordinates=null!=(r=Re(s))?r:We,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Mt.Resize,this.handleCancel),this.windowListeners.add(Mt.DragStart,Tt),this.windowListeners.add(Mt.VisibilityChange,this.handleCancel),this.windowListeners.add(Mt.ContextMenu,Tt),this.documentListeners.add(Mt.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Gt(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(Pt(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Mt.Click,Lt,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Mt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:s}=this,{onMove:o,options:{activationConstraint:i}}=s;if(!r)return;const a=null!=(t=Re(e))?t:We,l=Ie(r,a);if(!n&&i){if(Pt(i)){if(null!=i.tolerance&&It(l,i.tolerance))return this.handleCancel();if(It(l,i.distance))return this.handleStart()}return Gt(i)&&It(l,i.tolerance)?this.handleCancel():void this.handlePending(i,l)}e.cancelable&&e.preventDefault(),o(a)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===zt.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const Ht={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ut extends $t{constructor(e){const{event:t}=e,n=ve(t.target);super(e,Ht,n)}}Ut.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!(!n.isPrimary||0!==n.button)&&(null==r||r({event:n}),!0)}}];const qt={move:{name:"mousemove"},end:{name:"mouseup"}};var Yt,Xt;(Xt=Yt||(Yt={}))[Xt.RightClick=2]="RightClick";(class extends $t{constructor(e){super(e,qt,ve(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button!==Yt.RightClick&&(null==r||r({event:n}),!0)}}];const Wt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Kt,_t,Vt,Jt;function Zt(e){let{acceleration:n,activator:r=Kt.Pointer,canScroll:s,draggingRect:o,enabled:i,interval:a=5,order:l=Vt.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:h,threshold:m}=e;const f=function(e){let{delta:t,disabled:n}=e;const r=Ne(t);return je(e=>{if(n||!r||!e)return Qt;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[xt.Backward]:e.x[xt.Backward]||-1===s.x,[xt.Forward]:e.x[xt.Forward]||1===s.x},y:{[xt.Backward]:e.y[xt.Backward]||-1===s.y,[xt.Forward]:e.y[xt.Forward]||1===s.y}}},[n,t,r])}({delta:h,disabled:!i}),[p,g]=function(){const e=t.useRef(null);return[t.useCallback((t,n)=>{e.current=setInterval(t,n)},[]),t.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),x=t.useRef({x:0,y:0}),v=t.useRef({x:0,y:0}),w=t.useMemo(()=>{switch(r){case Kt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Kt.DraggableRect:return o}},[r,o,c]),b=t.useRef(null),y=t.useCallback(()=>{const e=b.current;if(!e)return;const t=x.current.x*v.current.x,n=x.current.y*v.current.y;e.scrollBy(t,n)},[]),j=t.useMemo(()=>l===Vt.TreeOrder?[...d].reverse():d,[l,d]);t.useEffect(()=>{if(i&&d.length&&w){for(const e of j){if(!1===(null==s?void 0:s(e)))continue;const t=d.indexOf(e),r=u[t];if(!r)continue;const{direction:o,speed:i}=jt(e,r,w,n,m);for(const e of["x","y"])f[e][o[e]]||(i[e]=0,o[e]=0);if(i.x>0||i.y>0)return g(),b.current=e,p(y,a),x.current=i,void(v.current=o)}x.current={x:0,y:0},v.current={x:0,y:0},g()}else g()},[n,y,s,g,i,a,JSON.stringify(w),JSON.stringify(f),p,d,j,u,JSON.stringify(m)])}(class extends $t{constructor(e){super(e,Wt)}static setup(){return window.addEventListener(Wt.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Wt.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return!(s.length>1)&&(null==r||r({event:n}),!0)}}],(_t=Kt||(Kt={}))[_t.Pointer=0]="Pointer",_t[_t.DraggableRect=1]="DraggableRect",(Jt=Vt||(Vt={}))[Jt.TreeOrder=0]="TreeOrder",Jt[Jt.ReversedTreeOrder=1]="ReversedTreeOrder";const Qt={x:{[xt.Backward]:!1,[xt.Forward]:!1},y:{[xt.Backward]:!1,[xt.Forward]:!1}};var en,tn,nn;(tn=en||(en={}))[tn.Always=0]="Always",tn[tn.BeforeDragging=1]="BeforeDragging",tn[tn.WhileDragging=2]="WhileDragging",(nn||(nn={})).Optimized="optimized";const rn=new Map;function sn(e,t){return je(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function on(e){let{callback:n,disabled:r}=e;const s=be(n),o=t.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(s)},[r]);return t.useEffect(()=>()=>null==o?void 0:o.disconnect(),[o]),o}function an(e){return new Et(ct(e),e)}function ln(e,n,r){void 0===n&&(n=an);const[s,o]=t.useState(null);function i(){o(t=>{if(!e)return null;var s;if(!1===e.isConnected)return null!=(s=null!=t?t:r)?s:null;const o=n(e);return JSON.stringify(t)===JSON.stringify(o)?t:o})}const a=function(e){let{callback:n,disabled:r}=e;const s=be(n),o=t.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(s)},[s,r]);return t.useEffect(()=>()=>null==o?void 0:o.disconnect(),[o]),o}({callback(t){if(e)for(const n of t){const{type:t,target:r}=n;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){i();break}}}}),l=on({callback:i});return we(()=>{i(),e?(null==l||l.observe(e),null==a||a.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==a||a.disconnect())},[e]),s}const cn=[];function dn(e,n){void 0===n&&(n=[]);const r=t.useRef(null);return t.useEffect(()=>{r.current=null},n),t.useEffect(()=>{const t=e!==We;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?Ie(e,r.current):We}function un(e){return t.useMemo(()=>e?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(e):null,[e])}const hn=[];function mn(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ge(t)?t:e}const fn=[{sensor:Ut,options:{}},{sensor:Bt,options:{}}],pn={current:{}},gn={draggable:{measure:dt},droppable:{measure:dt,strategy:en.WhileDragging,frequency:nn.Optimized},dragOverlay:{measure:ct}};class xn extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}const vn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new xn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:qe},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:gn,measureDroppableContainers:qe,windowRect:null,measuringScheduled:!1},wn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:qe,draggableNodes:new Map,over:null,measureDroppableContainers:qe},bn=t.createContext(wn),yn=t.createContext(vn);function jn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new xn}}}function kn(e,t){switch(t.type){case He.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case He.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case He.DragEnd:case He.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case He.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new xn(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case He.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new xn(e.droppable.containers);return i.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:i}}}case He.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new xn(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Nn(e){let{disabled:n}=e;const{active:r,activatorEvent:s,draggableNodes:o}=t.useContext(bn),i=Ne(s),a=Ne(null==r?void 0:r.id);return t.useEffect(()=>{if(!n&&!s&&i&&null!=a){if(!Me(i))return;if(document.activeElement===i.target)return;const e=o.get(a);if(!e)return;const{activatorNode:t,node:n}=e;if(!t.current&&!n.current)return;requestAnimationFrame(()=>{for(const e of[t.current,n.current]){if(!e)continue;const t=Te(e);if(t){t.focus();break}}})}},[s,n,o,a,i]),null}function Cn(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}const Sn=t.createContext({...We,scaleX:1,scaleY:1});var En,Dn;(Dn=En||(En={}))[Dn.Uninitialized=0]="Uninitialized",Dn[Dn.Initializing=1]="Initializing",Dn[Dn.Initialized=2]="Initialized";const In=t.memo(function(e){var n,r,o,i;let{id:a,accessibility:l,autoScroll:c=!0,children:d,sensors:u=fn,collisionDetection:h=rt,measuring:m,modifiers:f,...p}=e;const g=t.useReducer(kn,void 0,jn),[x,v]=g,[w,b]=function(){const[e]=t.useState(()=>new Set),n=t.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[t.useCallback(t=>{let{type:n,event:r}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[e]),n]}(),[y,j]=t.useState(En.Uninitialized),k=y===En.Initialized,{draggable:{active:N,nodes:C,translate:S},droppable:{containers:E}}=x,D=null!=N?C.get(N):null,I=t.useRef({initial:null,translated:null}),M=t.useMemo(()=>{var e;return null!=N?{id:N,data:null!=(e=null==D?void 0:D.data)?e:pn,rect:I}:null},[N,D]),R=t.useRef(null),[z,A]=t.useState(null),[T,L]=t.useState(null),O=ye(p,Object.values(p)),F=Se("DndDescribedBy",a),B=t.useMemo(()=>E.getEnabled(),[E]),P=(G=m,t.useMemo(()=>({draggable:{...gn.draggable,...null==G?void 0:G.draggable},droppable:{...gn.droppable,...null==G?void 0:G.droppable},dragOverlay:{...gn.dragOverlay,...null==G?void 0:G.dragOverlay}}),[null==G?void 0:G.draggable,null==G?void 0:G.droppable,null==G?void 0:G.dragOverlay]));var G;const{droppableRects:$,measureDroppableContainers:H,measuringScheduled:U}=function(e,n){let{dragging:r,dependencies:s,config:o}=n;const[i,a]=t.useState(null),{frequency:l,measure:c,strategy:d}=o,u=t.useRef(e),h=function(){switch(d){case en.Always:return!1;case en.BeforeDragging:return r;default:return!r}}(),m=ye(h),f=t.useCallback(function(e){void 0===e&&(e=[]),m.current||a(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[m]),p=t.useRef(null),g=je(t=>{if(h&&!r)return rn;if(!t||t===rn||u.current!==e||null!=i){const t=new Map;for(let n of e){if(!n)continue;if(i&&i.length>0&&!i.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}const e=n.node.current,r=e?new Et(c(e),e):null;n.rect.current=r,r&&t.set(n.id,r)}return t}return t},[e,i,r,h,c]);return t.useEffect(()=>{u.current=e},[e]),t.useEffect(()=>{h||f()},[r,h]),t.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),t.useEffect(()=>{h||"number"!=typeof l||null!==p.current||(p.current=setTimeout(()=>{f(),p.current=null},l))},[l,h,f,...s]),{droppableRects:g,measureDroppableContainers:f,measuringScheduled:null!=i}}(B,{dragging:k,dependencies:[S.x,S.y],config:P.droppable}),q=function(e,t){const n=null!=t?e.get(t):void 0,r=n?n.node.current:null;return je(e=>{var n;return null==t?null:null!=(n=null!=r?r:e)?n:null},[r,t])}(C,N),Y=t.useMemo(()=>T?Re(T):null,[T]),X=function(){const e=!1===(null==z?void 0:z.autoScrollEnabled),t="object"==typeof c?!1===c.enabled:!1===c,n=k&&!e&&!t;if("object"==typeof c)return{...c,enabled:n};return{enabled:n}}(),W=function(e,t){return sn(e,t)}(q,P.draggable.measure);!function(e){let{activeNode:n,measure:r,initialRect:s,config:o=!0}=e;const i=t.useRef(!1),{x:a,y:l}="boolean"==typeof o?{x:o,y:o}:o;we(()=>{if(!a&&!l||!n)return void(i.current=!1);if(i.current||!s)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const t=st(r(e),s);if(a||(t.x=0),l||(t.y=0),i.current=!0,Math.abs(t.x)>0||Math.abs(t.y)>0){const n=ht(e);n&&n.scrollBy({top:t.y,left:t.x})}},[n,a,l,s,r])}({activeNode:null!=N?C.get(N):null,config:X.layoutShiftCompensation,initialRect:W,measure:P.draggable.measure});const K=ln(q,P.draggable.measure,W),_=ln(q?q.parentElement:null),V=t.useRef({activatorEvent:null,active:null,activeNode:q,collisionRect:null,collisions:null,droppableRects:$,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=E.getNodeFor(null==(n=V.current.over)?void 0:n.id),Z=function(e){let{measure:n}=e;const[r,s]=t.useState(null),o=on({callback:t.useCallback(e=>{for(const{target:t}of e)if(ge(t)){s(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),i=t.useCallback(e=>{const t=mn(e);null==o||o.disconnect(),t&&(null==o||o.observe(t)),s(t?n(t):null)},[n,o]),[a,l]=ke(i);return t.useMemo(()=>({nodeRef:a,rect:r,setRef:l}),[r,a,l])}({measure:P.dragOverlay.measure}),Q=null!=(r=Z.nodeRef.current)?r:q,ee=k?null!=(o=Z.rect)?o:K:null,te=Boolean(Z.nodeRef.current&&Z.rect),ne=st(re=te?null:K,sn(re));var re;const se=un(Q?fe(Q):null),oe=function(e){const n=t.useRef(e),r=je(t=>e?t&&t!==cn&&e&&n.current&&e.parentNode===n.current.parentNode?t:ut(e):cn,[e]);return t.useEffect(()=>{n.current=e},[e]),r}(k?null!=J?J:q:null),ie=function(e,n){void 0===n&&(n=ct);const[r]=e,s=un(r?fe(r):null),[o,i]=t.useState(hn);function a(){i(()=>e.length?e.map(e=>wt(e)?s:new Et(n(e),e)):hn)}const l=on({callback:a});return we(()=>{null==l||l.disconnect(),a(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),o}(oe),ae=Cn(f,{transform:{x:S.x-ne.x,y:S.y-ne.y,scaleX:1,scaleY:1},activatorEvent:T,active:M,activeNodeRect:K,containerNodeRect:_,draggingNodeRect:ee,over:V.current.over,overlayNodeRect:Z.rect,scrollableAncestors:oe,scrollableAncestorRects:ie,windowRect:se}),le=Y?De(Y,S):null,ce=function(e){const[n,r]=t.useState(null),s=t.useRef(e),o=t.useCallback(e=>{const t=mt(e.target);t&&r(e=>e?(e.set(t,gt(t)),new Map(e)):null)},[]);return t.useEffect(()=>{const t=s.current;if(e!==t){n(t);const i=e.map(e=>{const t=mt(e);return t?(t.addEventListener("scroll",o,{passive:!0}),[t,gt(t)]):null}).filter(e=>null!=e);r(i.length?new Map(i):null),s.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=mt(e);null==t||t.removeEventListener("scroll",o)})}},[o,e]),t.useMemo(()=>e.length?n?Array.from(n.values()).reduce((e,t)=>De(e,t),We):Nt(e):We,[e,n])}(oe),he=dn(ce),me=dn(ce,[K]),pe=De(ae,he),xe=ee?it(ee,ae):null,ve=M&&xe?h({active:M,collisionRect:xe,droppableRects:$,droppableContainers:B,pointerCoordinates:le}):null,be=Qe(ve,"id"),[Ne,Ce]=t.useState(null),Ee=function(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}(te?ae:De(ae,me),null!=(i=null==Ne?void 0:Ne.rect)?i:null,K),Ie=t.useRef(null),Me=t.useCallback((e,t)=>{let{sensor:n,options:r}=t;if(null==R.current)return;const s=C.get(R.current);if(!s)return;const o=e.nativeEvent,i=new n({active:R.current,activeNode:s,event:o,options:r,context:V,onAbort(e){if(!C.get(e))return;const{onDragAbort:t}=O.current,n={id:e};null==t||t(n),w({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!C.get(e))return;const{onDragPending:s}=O.current,o={id:e,constraint:t,initialCoordinates:n,offset:r};null==s||s(o),w({type:"onDragPending",event:o})},onStart(e){const t=R.current;if(null==t)return;const n=C.get(t);if(!n)return;const{onDragStart:r}=O.current,s={activatorEvent:o,active:{id:t,data:n.data,rect:I}};de.unstable_batchedUpdates(()=>{null==r||r(s),j(En.Initializing),v({type:He.DragStart,initialCoordinates:e,active:t}),w({type:"onDragStart",event:s}),A(Ie.current),L(o)})},onMove(e){v({type:He.DragMove,coordinates:e})},onEnd:a(He.DragEnd),onCancel:a(He.DragCancel)});function a(e){return async function(){const{active:t,collisions:n,over:r,scrollAdjustedTranslate:s}=V.current;let i=null;if(t&&s){const{cancelDrop:a}=O.current;if(i={activatorEvent:o,active:t,collisions:n,delta:s,over:r},e===He.DragEnd&&"function"==typeof a){await Promise.resolve(a(i))&&(e=He.DragCancel)}}R.current=null,de.unstable_batchedUpdates(()=>{v({type:e}),j(En.Uninitialized),Ce(null),A(null),L(null),Ie.current=null;const t=e===He.DragEnd?"onDragEnd":"onDragCancel";if(i){const e=O.current[t];null==e||e(i),w({type:t,event:i})}})}}Ie.current=i},[C]),ze=function(e,n){return t.useMemo(()=>e.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[e,n])}(u,t.useCallback((e,t)=>(n,r)=>{const s=n.nativeEvent,o=C.get(r);if(null!==R.current||!o||s.dndKit||s.defaultPrevented)return;const i={active:o};!0===e(n,t.options,i)&&(s.dndKit={capturedBy:t.sensor},R.current=r,Me(n,t))},[C,Me]));!function(e){t.useEffect(()=>{if(!ue)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(u),we(()=>{K&&y===En.Initializing&&j(En.Initialized)},[K,y]),t.useEffect(()=>{const{onDragMove:e}=O.current,{active:t,activatorEvent:n,collisions:r,over:s}=V.current;if(!t||!n)return;const o={active:t,activatorEvent:n,collisions:r,delta:{x:pe.x,y:pe.y},over:s};de.unstable_batchedUpdates(()=>{null==e||e(o),w({type:"onDragMove",event:o})})},[pe.x,pe.y]),t.useEffect(()=>{const{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:s}=V.current;if(!e||null==R.current||!t||!s)return;const{onDragOver:o}=O.current,i=r.get(be),a=i&&i.rect.current?{id:i.id,rect:i.rect.current,data:i.data,disabled:i.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:s.x,y:s.y},over:a};de.unstable_batchedUpdates(()=>{Ce(a),null==o||o(l),w({type:"onDragOver",event:l})})},[be]),we(()=>{V.current={activatorEvent:T,active:M,activeNode:q,collisionRect:xe,collisions:ve,droppableRects:$,draggableNodes:C,draggingNode:Q,draggingNodeRect:ee,droppableContainers:E,over:Ne,scrollableAncestors:oe,scrollAdjustedTranslate:pe},I.current={initial:ee,translated:xe}},[M,q,ve,xe,C,Q,ee,$,E,Ne,oe,pe]),Zt({...X,delta:S,draggingRect:xe,pointerCoordinates:le,scrollableAncestors:oe,scrollableAncestorRects:ie});const Ae=t.useMemo(()=>({active:M,activeNode:q,activeNodeRect:K,activatorEvent:T,collisions:ve,containerNodeRect:_,dragOverlay:Z,draggableNodes:C,droppableContainers:E,droppableRects:$,over:Ne,measureDroppableContainers:H,scrollableAncestors:oe,scrollableAncestorRects:ie,measuringConfiguration:P,measuringScheduled:U,windowRect:se}),[M,q,K,T,ve,_,Z,C,E,$,Ne,H,oe,ie,P,U,se]),Te=t.useMemo(()=>({activatorEvent:T,activators:ze,active:M,activeNodeRect:K,ariaDescribedById:{draggable:F},dispatch:v,draggableNodes:C,over:Ne,measureDroppableContainers:H}),[T,ze,M,K,v,F,C,Ne,H]);return s.createElement(Be.Provider,{value:b},s.createElement(bn.Provider,{value:Te},s.createElement(yn.Provider,{value:Ae},s.createElement(Sn.Provider,{value:Ee},d)),s.createElement(Nn,{disabled:!1===(null==l?void 0:l.restoreFocus)})),s.createElement($e,{...l,hiddenTextDescribedById:F}))}),Mn=t.createContext(null),Rn="button";function zn(e){let{id:n,data:r,disabled:s=!1,attributes:o}=e;const i=Se("Draggable"),{activators:a,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:h,over:m}=t.useContext(bn),{role:f=Rn,roleDescription:p="draggable",tabIndex:g=0}=null!=o?o:{},x=(null==c?void 0:c.id)===n,v=t.useContext(x?Sn:Mn),[w,b]=ke(),[y,j]=ke(),k=function(e,n){return t.useMemo(()=>e.reduce((e,t)=>{let{eventName:r,handler:s}=t;return e[r]=e=>{s(e,n)},e},{}),[e,n])}(a,n),N=ye(r);we(()=>(h.set(n,{id:n,key:i,node:w,activatorNode:y,data:N}),()=>{const e=h.get(n);e&&e.key===i&&h.delete(n)}),[h,n]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:t.useMemo(()=>({role:f,tabIndex:g,"aria-disabled":s,"aria-pressed":!(!x||f!==Rn)||void 0,"aria-roledescription":p,"aria-describedby":u.draggable}),[s,f,g,x,p,u.draggable]),isDragging:x,listeners:s?void 0:k,node:w,over:m,setNodeRef:b,setActivatorNodeRef:j,transform:v}}function An(){return t.useContext(yn)}const Tn={timeout:25};function Ln(e){let{animation:n,children:r}=e;const[o,i]=t.useState(null),[a,l]=t.useState(null),c=Ne(r);return r||o||!c||i(c),we(()=>{if(!a)return;const e=null==o?void 0:o.key,t=null==o?void 0:o.props.id;null!=e&&null!=t?Promise.resolve(n(t,a)).then(()=>{i(null)}):i(null)},[n,o,a]),s.createElement(s.Fragment,null,r,o?t.cloneElement(o,{ref:l}):null)}const On={x:0,y:0,scaleX:1,scaleY:1};function Fn(e){let{children:t}=e;return s.createElement(bn.Provider,{value:wn},s.createElement(Sn.Provider,{value:On},t))}const Bn={position:"fixed",touchAction:"none"},Pn=e=>Me(e)?"transform 250ms ease":void 0,Gn=t.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:o,children:i,className:a,rect:l,style:c,transform:d,transition:u=Pn}=e;if(!l)return null;const h=o?d:{...d,scaleX:1,scaleY:1},m={...Bn,width:l.width,height:l.height,top:l.top,left:l.left,transform:ze.Transform.toString(h),transformOrigin:o&&r?_e(r,l):void 0,transition:"function"==typeof u?u(r):u,...c};return s.createElement(n,{className:a,style:m,ref:t},i)}),$n={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:t,final:n}}=e;return[{transform:ze.Transform.toString(t)},{transform:ze.Transform.toString(n)}]},sideEffects:(e=>t=>{let{active:n,dragOverlay:r}=t;const s={},{styles:o,className:i}=e;if(null!=o&&o.active)for(const[e,a]of Object.entries(o.active))void 0!==a&&(s[e]=n.node.style.getPropertyValue(e),n.node.style.setProperty(e,a));if(null!=o&&o.dragOverlay)for(const[e,a]of Object.entries(o.dragOverlay))void 0!==a&&r.node.style.setProperty(e,a);return null!=i&&i.active&&n.node.classList.add(i.active),null!=i&&i.dragOverlay&&r.node.classList.add(i.dragOverlay),function(){for(const[e,t]of Object.entries(s))n.node.style.setProperty(e,t);null!=i&&i.active&&n.node.classList.remove(i.active)}})({styles:{active:{opacity:"0"}}})};function Hn(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:s}=e;return be((e,o)=>{if(null===t)return;const i=n.get(e);if(!i)return;const a=i.node.current;if(!a)return;const l=mn(o);if(!l)return;const{transform:c}=fe(o).getComputedStyle(o),d=at(c);if(!d)return;const u="function"==typeof t?t:function(e){const{duration:t,easing:n,sideEffects:r,keyframes:s}={...$n,...e};return e=>{let{active:o,dragOverlay:i,transform:a,...l}=e;if(!t)return;const c={x:i.rect.left-o.rect.left,y:i.rect.top-o.rect.top},d={scaleX:1!==a.scaleX?o.rect.width*a.scaleX/i.rect.width:1,scaleY:1!==a.scaleY?o.rect.height*a.scaleY/i.rect.height:1},u={x:a.x-c.x,y:a.y-c.y,...d},h=s({...l,active:o,dragOverlay:i,transform:{initial:a,final:u}}),[m]=h,f=h[h.length-1];if(JSON.stringify(m)===JSON.stringify(f))return;const p=null==r?void 0:r({active:o,dragOverlay:i,...l}),g=i.node.animate(h,{duration:t,easing:n,fill:"forwards"});return new Promise(e=>{g.onfinish=()=>{null==p||p(),e()}})}}(t);return Ct(a,s.draggable.measure),u({active:{id:e,data:i.data,node:a,rect:s.draggable.measure(a)},draggableNodes:n,dragOverlay:{node:o,rect:s.dragOverlay.measure(l)},droppableContainers:r,measuringConfiguration:s,transform:d})})}let Un=0;const qn=s.memo(e=>{let{adjustScale:n=!1,children:r,dropAnimation:o,style:i,transition:a,modifiers:l,wrapperElement:c="div",className:d,zIndex:u=999}=e;const{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:p,draggableNodes:g,droppableContainers:x,dragOverlay:v,over:w,measuringConfiguration:b,scrollableAncestors:y,scrollableAncestorRects:j,windowRect:k}=An(),N=t.useContext(Sn),C=(S=null==m?void 0:m.id,t.useMemo(()=>{if(null!=S)return Un++,Un},[S]));var S;const E=Cn(l,{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:p,draggingNodeRect:v.rect,over:w,overlayNodeRect:v.rect,scrollableAncestors:y,scrollableAncestorRects:j,transform:N,windowRect:k}),D=sn(f),I=Hn({config:o,draggableNodes:g,droppableContainers:x,measuringConfiguration:b}),M=D?v.setRef:void 0;return s.createElement(Fn,null,s.createElement(Ln,{animation:I},m&&C?s.createElement(Gn,{key:C,id:m.id,ref:M,as:c,activatorEvent:h,adjustScale:n,className:d,transition:a,rect:D,style:{zIndex:u,...i},transform:E},r):null))});function Yn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Xn(e,t){return e.reduce((e,n,r)=>{const s=t.get(n);return s&&(e[r]=s),e},Array(e.length))}function Wn(e){return null!==e&&e>=0}const Kn={scaleX:1,scaleY:1},_n=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:s,overIndex:o,index:i}=e;const a=null!=(t=n[s])?t:r;if(!a)return null;const l=function(e,t,n){const r=e[t],s=e[t-1],o=e[t+1];if(!r||!s&&!o)return 0;if(n<t)return s?r.left-(s.left+s.width):o.left-(r.left+r.width);return o?o.left-(r.left+r.width):r.left-(s.left+s.width)}(n,i,s);if(i===s){const e=n[o];return e?{x:s<o?e.left+e.width-(a.left+a.width):e.left-a.left,y:0,...Kn}:null}return i>s&&i<=o?{x:-a.width-l,y:0,...Kn}:i<s&&i>=o?{x:a.width+l,y:0,...Kn}:{x:0,y:0,...Kn}};const Vn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:s}=e;const o=Yn(t,r,n),i=t[s],a=o[s];return a&&i?{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}:null},Jn="Sortable",Zn=s.createContext({activeIndex:-1,containerId:Jn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Vn,disabled:{draggable:!1,droppable:!1}});function Qn(e){let{children:n,id:r,items:o,strategy:i=Vn,disabled:a=!1}=e;const{active:l,dragOverlay:c,droppableRects:d,over:u,measureDroppableContainers:h}=An(),m=Se(Jn,r),f=Boolean(null!==c.rect),p=t.useMemo(()=>o.map(e=>"object"==typeof e&&"id"in e?e.id:e),[o]),g=null!=l,x=l?p.indexOf(l.id):-1,v=u?p.indexOf(u.id):-1,w=t.useRef(p),b=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,w.current),y=-1!==v&&-1===x||b,j=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(a);we(()=>{b&&g&&h(p)},[b,p,g,h]),t.useEffect(()=>{w.current=p},[p]);const k=t.useMemo(()=>({activeIndex:x,containerId:m,disabled:j,disableTransforms:y,items:p,overIndex:v,useDragOverlay:f,sortedRects:Xn(p,d),strategy:i}),[x,m,j.draggable,j.droppable,y,p,v,d,f,i]);return s.createElement(Zn.Provider,{value:k},n)}const er=e=>{let{id:t,items:n,activeIndex:r,overIndex:s}=e;return Yn(n,r,s).indexOf(t)},tr=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:s,items:o,newIndex:i,previousItems:a,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((a===o||s!==i)&&(!!n||i!==s&&t===l))},nr={duration:200,easing:"ease"},rr="transform",sr=ze.Transition.toString({property:rr,duration:0,easing:"linear"}),or={roleDescription:"sortable"};function ir(e){let{animateLayoutChanges:n=tr,attributes:r,disabled:s,data:o,getNewIndex:i=er,id:a,strategy:l,resizeObserverConfig:c,transition:d=nr}=e;const{items:u,containerId:h,activeIndex:m,disabled:f,disableTransforms:p,sortedRects:g,overIndex:x,useDragOverlay:v,strategy:w}=t.useContext(Zn),b=function(e,t){var n,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(n=null==e?void 0:e.draggable)?n:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(s,f),y=u.indexOf(a),j=t.useMemo(()=>({sortable:{containerId:h,index:y,items:u},...o}),[h,o,y,u]),k=t.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:N,node:C,isOver:S,setNodeRef:E}=function(e){let{data:n,disabled:r=!1,id:s,resizeObserverConfig:o}=e;const i=Se("Droppable"),{active:a,dispatch:l,over:c,measureDroppableContainers:d}=t.useContext(bn),u=t.useRef({disabled:r}),h=t.useRef(!1),m=t.useRef(null),f=t.useRef(null),{disabled:p,updateMeasurementsFor:g,timeout:x}={...Tn,...o},v=ye(null!=g?g:s),w=on({callback:t.useCallback(()=>{h.current?(null!=f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{d(Array.isArray(v.current)?v.current:[v.current]),f.current=null},x)):h.current=!0},[x]),disabled:p||!a}),b=t.useCallback((e,t)=>{w&&(t&&(w.unobserve(t),h.current=!1),e&&w.observe(e))},[w]),[y,j]=ke(b),k=ye(n);return t.useEffect(()=>{w&&y.current&&(w.disconnect(),h.current=!1,w.observe(y.current))},[y,w]),t.useEffect(()=>(l({type:He.RegisterDroppable,element:{id:s,key:i,disabled:r,node:y,rect:m,data:k}}),()=>l({type:He.UnregisterDroppable,key:i,id:s})),[s]),t.useEffect(()=>{r!==u.current.disabled&&(l({type:He.SetDroppableDisabled,id:s,key:i,disabled:r}),u.current.disabled=r)},[s,i,r,l]),{active:a,rect:m,isOver:(null==c?void 0:c.id)===s,node:y,over:c,setNodeRef:j}}({id:a,data:j,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:k,...c}}),{active:D,activatorEvent:I,activeNodeRect:M,attributes:R,setNodeRef:z,listeners:A,isDragging:T,over:L,setActivatorNodeRef:O,transform:F}=zn({id:a,data:j,attributes:{...or,...r},disabled:b.draggable}),B=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.useMemo(()=>e=>{n.forEach(t=>t(e))},n)}(E,z),P=Boolean(D),G=P&&!p&&Wn(m)&&Wn(x),$=!v&&T,H=$&&G?F:null,U=G?null!=H?H:(null!=l?l:w)({rects:g,activeNodeRect:M,activeIndex:m,overIndex:x,index:y}):null,q=Wn(m)&&Wn(x)?i({id:a,items:u,activeIndex:m,overIndex:x}):y,Y=null==D?void 0:D.id,X=t.useRef({activeId:Y,items:u,newIndex:q,containerId:h}),W=u!==X.current.items,K=n({active:D,containerId:h,isDragging:T,isSorting:P,id:a,index:y,items:u,newIndex:X.current.newIndex,previousItems:X.current.items,previousContainerId:X.current.containerId,transition:d,wasDragging:null!=X.current.activeId}),_=function(e){let{disabled:n,index:r,node:s,rect:o}=e;const[i,a]=t.useState(null),l=t.useRef(r);return we(()=>{if(!n&&r!==l.current&&s.current){const e=o.current;if(e){const t=ct(s.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&a(n)}}r!==l.current&&(l.current=r)},[n,r,s,o]),t.useEffect(()=>{i&&a(null)},[i]),i}({disabled:!K,index:y,node:C,rect:N});return t.useEffect(()=>{P&&X.current.newIndex!==q&&(X.current.newIndex=q),h!==X.current.containerId&&(X.current.containerId=h),u!==X.current.items&&(X.current.items=u)},[P,q,h,u]),t.useEffect(()=>{if(Y===X.current.activeId)return;if(null!=Y&&null==X.current.activeId)return void(X.current.activeId=Y);const e=setTimeout(()=>{X.current.activeId=Y},50);return()=>clearTimeout(e)},[Y]),{active:D,activeIndex:m,attributes:R,data:j,rect:N,index:y,newIndex:q,items:u,isOver:S,isSorting:P,isDragging:T,listeners:A,node:C,overIndex:x,over:L,setNodeRef:B,setActivatorNodeRef:O,setDroppableNodeRef:E,setDraggableNodeRef:z,transform:null!=_?_:U,transition:function(){if(_||W&&X.current.newIndex===y)return sr;if($&&!Me(I)||!d)return;if(P||K)return ze.Transition.toString({...d,property:rr});return}()}}function ar(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const lr=[zt.Down,zt.Right,zt.Up,zt.Left],cr=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:s,droppableContainers:o,over:i,scrollableAncestors:a}}=t;if(lr.includes(e.code)){if(e.preventDefault(),!n||!r)return;const t=[];o.getEnabled().forEach(n=>{if(!n||null!=n&&n.disabled)return;const o=s.get(n.id);if(o)switch(e.code){case zt.Down:r.top<o.top&&t.push(n);break;case zt.Up:r.top>o.top&&t.push(n);break;case zt.Left:r.left>o.left&&t.push(n);break;case zt.Right:r.left<o.left&&t.push(n)}});const l=(e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=Ze(t),o=[];for(const i of r){const{id:e}=i,t=n.get(e);if(t){const n=Ze(t),r=s.reduce((e,t,r)=>e+Ke(n[r],t),0),a=Number((r/4).toFixed(4));o.push({id:e,data:{droppableContainer:i,value:a}})}}return o.sort(Ve)})({collisionRect:r,droppableRects:s,droppableContainers:t});let c=Qe(l,"id");if(c===(null==i?void 0:i.id)&&l.length>1&&(c=l[1].id),null!=c){const e=o.get(n.id),t=o.get(c),i=t?s.get(t.id):null,l=null==t?void 0:t.node.current;if(l&&i&&e&&t){const n=ut(l).some((e,t)=>a[t]!==e),s=dr(e,t),o=function(e,t){if(!ar(e)||!ar(t))return!1;if(!dr(e,t))return!1;return e.data.current.sortable.index<t.data.current.sortable.index}(e,t),c=n||!s?{x:0,y:0}:{x:o?r.width-i.width:0,y:o?r.height-i.height:0},d={x:i.left,y:i.top};return c.x&&c.y?d:Ie(d,c)}}}};function dr(e,t){return!(!ar(e)||!ar(t))&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}function ur({shortcut:e,onContextMenu:r,isMergeTarget:s=!1}){const{incrementClickCount:o}=te(),i=t.useRef(null),{attributes:a,listeners:l,setNodeRef:c,transform:d,transition:u,isDragging:h}=ir({id:e.id}),m={transform:ze.Transform.toString(d),transition:u,opacity:h?0:1,zIndex:h?10:1};t.useEffect(()=>{const e=i.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]);const f=()=>{if(e.favicon)return e.favicon;try{return`https://www.google.com/s2/favicons?domain=${new URL(e.url).hostname}&sz=64`}catch{return""}};return n.jsxs("div",{ref:c,style:m,...a,...l,"data-shortcut-id":e.id,className:"\n        relative flex flex-col items-center gap-2 cursor-grab active:cursor-grabbing\n        w-16 min-w-[64px] group\n        transition-all duration-300 hover:scale-105 hover:z-10\n      ",onClick:()=>{h||(o(e.id),window.location.href=e.url)},onContextMenu:t=>{t.preventDefault(),r&&r(t,e)},children:[n.jsxs("div",{ref:i,className:`\n          relative w-14 h-14 rounded-[18px] liquid-glass-icon flex items-center justify-center overflow-hidden\n          transition-all duration-200\n          ${h?"shadow-xl ring-2 ring-white/30 scale-105":""}\n        `,children:[n.jsx("div",{className:"glass-refraction"}),f()?n.jsx("img",{src:f(),alt:e.title,className:"w-[85%] h-[85%] object-contain rounded-xl relative z-10",draggable:!1,onError:t=>{const n=t.target;n.style.display="none";const r=n.parentElement;if(r&&!r.querySelector(".fallback-letter")){const t=document.createElement("div");t.className="fallback-letter w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl",t.innerHTML=`<span class="text-2xl font-bold text-white">${e.title.charAt(0).toUpperCase()}</span>`,r.appendChild(t)}}}):n.jsx("div",{className:"w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl relative z-10",children:n.jsx("span",{className:"text-2xl font-bold text-white",children:e.title.charAt(0).toUpperCase()})}),s&&n.jsx("div",{className:"merge-target-highlight"})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full px-1 select-none",children:e.title})]})}function hr({shortcut:e}){return n.jsx("div",{className:"aspect-square rounded-md overflow-hidden liquid-glass-mini flex items-center justify-center",children:e.favicon?n.jsx("img",{src:e.favicon,alt:"",className:"w-full h-full object-cover rounded-md",onError:t=>{const n=t.target;n.style.display="none",n.parentElement&&(n.parentElement.classList.add("bg-gradient-to-br","from-blue-500","to-purple-600"),n.parentElement.innerHTML=`<span class="text-[8px] font-bold text-white">${(e.title?.[0]||"A").toUpperCase()}</span>`)}}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-md",children:n.jsx("span",{className:"text-[8px] font-bold text-white",children:(e.title?.[0]||"A").toUpperCase()})})})}function mr({folder:e,shortcuts:r,onOpen:s,isMergeTarget:o=!1}){const i=t.useRef(null),{attributes:a,listeners:l,setNodeRef:c,transform:d,transition:u,isDragging:h}=ir({id:e.id}),m={transform:ze.Transform.toString(d),transition:u,opacity:h?.5:1,zIndex:h?10:1};t.useEffect(()=>{const e=i.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]);const f=r.slice(0,9);return n.jsxs("div",{ref:c,style:m,...a,...l,"data-shortcut-id":e.id,className:"relative flex flex-col items-center gap-2 cursor-grab active:cursor-grabbing w-16 min-w-[64px]",onClick:()=>!h&&s(e.id),children:[n.jsxs("div",{ref:i,className:`\n          relative liquid-glass-folder rounded-[18px] overflow-hidden\n          hover:scale-110 transition-all duration-200\n          ${h?"shadow-xl ring-2 ring-white/30 scale-105":""}\n        `,style:{width:"56px",height:"56px",padding:"6.72px"},children:[n.jsx("div",{className:"glass-refraction"}),f.length>0?n.jsxs("div",{className:"w-full h-full grid grid-cols-3 gap-0.5 content-start relative z-10",children:[f.map(e=>n.jsx(hr,{shortcut:e},e.id)),Array.from({length:Math.max(0,9-f.length)}).map((e,t)=>n.jsx("div",{className:"aspect-square rounded-md bg-white/5"},`empty-${t}`))]}):n.jsx("div",{className:"w-full h-full flex items-center justify-center relative z-10",children:n.jsx(y,{className:"w-6 h-6 text-white/60"})}),o&&n.jsx("div",{className:"merge-target-highlight"})]}),n.jsx("span",{className:"text-xs text-white truncate w-full text-center px-1 text-shadow-sm",children:e.name}),r.length>0&&n.jsx("div",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-blue-500/90 text-white text-[10px] flex items-center justify-center font-medium",children:r.length})]})}const fr=100,pr=110;function gr({shortcut:e,onRemove:r,onClick:s}){const o=t.useRef(null),{attributes:i,listeners:a,setNodeRef:l,transform:c,transition:d,isDragging:u}=ir({id:e.id}),h={transform:ze.Transform.toString(c),transition:d,opacity:u?0:1,zIndex:u?50:"auto"};return t.useEffect(()=>{const e=o.current;if(!e)return;const t=t=>{const n=e.getBoundingClientRect(),r=(t.clientX-n.left)/n.width*100,s=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${r}%`),e.style.setProperty("--mouse-y",`${s}%`)};return e.addEventListener("mousemove",t),()=>e.removeEventListener("mousemove",t)},[]),n.jsxs("div",{ref:l,style:h,...i,...a,className:"group relative flex flex-col items-center gap-1.5 p-2 rounded-xl cursor-pointer transition-colors hover:bg-white/5",onClick:()=>!u&&s(e),children:[n.jsxs("div",{className:"relative w-12 h-12",children:[n.jsxs("div",{ref:o,className:"w-full h-full rounded-xl liquid-glass-icon flex items-center justify-center overflow-hidden",children:[n.jsx("div",{className:"glass-refraction"}),e.favicon?n.jsx("img",{src:e.favicon,alt:e.title,className:"w-[80%] h-[80%] object-contain rounded-lg relative z-10",draggable:!1}):n.jsx("div",{className:"w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg relative z-10",children:n.jsx("span",{className:"text-lg font-bold text-white",children:e.title.charAt(0).toUpperCase()})})]}),n.jsx("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center shadow-lg",title:"移出文件夹",children:n.jsx(H,{className:"w-3 h-3"})})]}),n.jsx("span",{className:"text-[11px] text-white/80 truncate w-full text-center select-none",children:e.title})]})}function xr({folder:e,shortcuts:r,onClose:s,onAddShortcut:o,onEditFolder:i,onDeleteFolder:a}){const{incrementClickCount:l,updateShortcut:c}=te(),[d,u]=t.useState(!1),[h,m]=t.useState(r);t.useEffect(()=>{m(r)},[r]),t.useEffect(()=>{requestAnimationFrame(()=>u(!0))},[]);const f=Xe(Ye(Ut,{activationConstraint:{distance:5}})),p=e=>{l(e.id),window.location.href=e.url},g=e=>{c(e,{folderId:void 0})},x=()=>{u(!1),setTimeout(s,200)};return de.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center transition-all duration-200 "+(d?"bg-black/60 backdrop-blur-sm":"bg-transparent"),style:{zIndex:fr},onClick:x,children:n.jsxs("div",{className:"relative w-[340px] max-h-[70vh] rounded-2xl overflow-hidden flex flex-col transition-all duration-200 "+(d?"opacity-100 scale-100":"opacity-0 scale-95"),style:{zIndex:pr,background:"linear-gradient(145deg, rgba(40, 40, 60, 0.95), rgba(30, 30, 45, 0.98))",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[n.jsxs("h3",{className:"text-base font-medium text-white flex items-center gap-2",children:[e.name,n.jsxs("span",{className:"text-xs text-white/50",children:["(",r.length,")"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",title:"编辑文件夹",children:n.jsx(M,{className:"w-4 h-4 text-white/60"})}),n.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",title:"删除文件夹",children:n.jsx(B,{className:"w-4 h-4 text-white/60"})}),n.jsx("button",{onClick:x,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-4 h-4 text-white/60"})})]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:0===h.length?n.jsx("div",{className:"text-center py-8 text-white/50 text-sm",children:"文件夹为空，点击下方添加快捷方式"}):n.jsx(In,{sensors:f,collisionDetection:tt,onDragEnd:e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return;const r=h.findIndex(e=>e.id===t.id),s=h.findIndex(e=>e.id===n.id);if(-1!==r&&-1!==s){const e=Yn(h,r,s);m(e),e.forEach((e,t)=>{c(e.id,{position:t})})}},children:n.jsx(Qn,{items:h.map(e=>e.id),strategy:Vn,children:n.jsx("div",{className:"grid grid-cols-4 gap-2",children:h.map(e=>n.jsx(gr,{shortcut:e,onRemove:g,onClick:p},e.id))})})})}),n.jsx("div",{className:"px-4 py-3 border-t border-white/10",children:n.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 py-2.5 rounded-xl bg-white/10 hover:bg-white/15 transition-colors text-white/80 text-sm",children:[n.jsx(R,{className:"w-4 h-4"}),"添加快捷方式"]})})]})}),document.body)}function vr({isOpen:e,onClose:r,onSave:s,folder:o}){const[i,a]=t.useState("");if(t.useEffect(()=>{a(o?o.name:"")},[o,e]),!e)return null;return de.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:fr},onClick:r,children:n.jsxs("div",{className:"relative w-80 rounded-2xl glass-modal-dark overflow-hidden",style:{zIndex:pr,animation:"modalScale 0.2s ease-out"},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(y,{className:"w-5 h-5 text-white/70"}),n.jsx("h3",{className:"text-base font-medium text-white",children:o?"编辑文件夹":"新建文件夹"})]}),n.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-4 h-4 text-white/60"})})]}),n.jsxs("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&(s(i.trim()),a(""),r())},className:"p-4",children:[n.jsx("input",{type:"text",value:i,onChange:e=>a(e.target.value),placeholder:"文件夹名称",className:"w-full bg-white/10 text-white text-sm rounded-lg px-3 py-2.5 outline-none border border-white/10 focus:border-white/30 placeholder-white/40",autoFocus:!0}),n.jsxs("div",{className:"flex gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:r,className:"flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors text-white/70 text-sm",children:"取消"}),n.jsx("button",{type:"submit",disabled:!i.trim(),className:"flex-1 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-white text-sm",children:o?"保存":"创建"})]})]})]})}),document.body)}function wr({isOpen:e,onClose:r,onAdd:s,groupName:o}){const[i,a]=t.useState(""),[l,c]=t.useState(""),[d,u]=t.useState("");if(!e)return null;const h=()=>{if(u(""),i.trim())try{const e=i.startsWith("http")?i:`https://${i}`;new URL(e);const t=new URL(e).hostname,n=l.trim()||t;s(e,n),a(""),c(""),r()}catch{u("无效的网址格式")}else u("请输入网址")},m=e=>{"Enter"===e.key?h():"Escape"===e.key&&r()};return de.createPortal(n.jsxs("div",{className:"fixed inset-0 flex items-center justify-center animate-fadeIn",style:{zIndex:fr},children:[n.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:r}),n.jsx("div",{className:"relative w-[400px] max-w-[90vw]",style:{zIndex:pr,animation:"modalScale 0.2s ease-out"},children:n.jsxs("div",{className:"glass-modal rounded-2xl p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-medium text-white",children:["添加快捷方式",o&&n.jsxs("span",{className:"ml-2 text-sm text-white/50",children:["到 ",o]})]}),n.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-5 h-5 text-white/60"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-white/60 mb-2",children:[n.jsx(E,{className:"w-4 h-4"}),"网址"]}),n.jsx("input",{type:"text",value:i,onChange:e=>a(e.target.value),onKeyDown:m,placeholder:"https://example.com",className:"w-full bg-white/10 text-white text-sm rounded-xl px-4 py-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/30 transition-colors",autoFocus:!0})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm text-white/60 mb-2",children:[n.jsx(P,{className:"w-4 h-4"}),"名称 ",n.jsx("span",{className:"text-white/30",children:"(可选)"})]}),n.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:"自动获取域名",className:"w-full bg-white/10 text-white text-sm rounded-xl px-4 py-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/30 transition-colors"})]}),d&&n.jsx("p",{className:"text-sm text-red-400",children:d})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:r,className:"flex-1 py-2.5 rounded-xl bg-white/10 hover:bg-white/20 text-white/70 text-sm transition-colors",children:"取消"}),n.jsx("button",{onClick:h,className:"flex-1 py-2.5 rounded-xl bg-blue-500/80 hover:bg-blue-500 text-white text-sm transition-colors",children:"添加"})]})]})})]}),document.body)}function br({item:e,shortcuts:t=[]}){if("folder"===e.itemType){const r=e,s=t.slice(0,9),o=56,i=.12*o;return n.jsxs("div",{className:"flex flex-col items-center gap-2 w-16 opacity-90 cursor-grabbing",children:[n.jsxs("div",{className:"relative liquid-glass-folder rounded-[18px] overflow-hidden shadow-2xl scale-110",style:{width:`${o}px`,height:`${o}px`,padding:`${i}px`},children:[n.jsx("div",{className:"glass-refraction"}),s.length>0?n.jsx("div",{className:"w-full h-full grid grid-cols-3 gap-0.5 content-start relative z-10",children:s.map(e=>n.jsx("div",{className:"aspect-square rounded-md overflow-hidden liquid-glass-mini flex items-center justify-center",children:e.favicon?n.jsx("img",{src:e.favicon,alt:"",className:"w-full h-full object-cover rounded-md"}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-md",children:n.jsx("span",{className:"text-[8px] font-bold text-white",children:(e.title?.[0]||"A").toUpperCase()})})},e.id))}):n.jsx("div",{className:"w-full h-full flex items-center justify-center relative z-10",children:n.jsx(y,{className:"w-6 h-6 text-white/60"})})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full",children:r.name})]})}const r=e,s=()=>{if(r.favicon)return r.favicon;try{return`https://www.google.com/s2/favicons?domain=${new URL(r.url).hostname}&sz=64`}catch{return""}};return n.jsxs("div",{className:"flex flex-col items-center gap-2 w-16 opacity-90 cursor-grabbing",children:[n.jsxs("div",{className:"relative w-14 h-14 rounded-[18px] liquid-glass-icon flex items-center justify-center overflow-hidden shadow-2xl scale-110",children:[n.jsx("div",{className:"glass-refraction"}),s()?n.jsx("img",{src:s(),alt:r.title,className:"w-[85%] h-[85%] object-contain rounded-xl relative z-10",draggable:!1}):n.jsx("div",{className:"w-[80%] h-[80%] flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl relative z-10",children:n.jsx("span",{className:"text-2xl font-bold text-white",children:r.title.charAt(0).toUpperCase()})})]}),n.jsx("span",{className:"text-sm font-medium text-white/90 drop-shadow-md truncate text-center w-full",children:r.title})]})}function yr({columns:e,style:r,onAddClick:s,onBatchEditClick:o}){const{shortcuts:i,reorderShortcuts:a,getFilteredShortcuts:l,shortcutFolders:c,activeGroupId:d,getFolderShortcuts:u,addFolder:h,updateFolder:m,removeFolder:f,addShortcut:p,moveShortcutToFolder:g}=te(),[x,v]=t.useState(null),[w,y]=t.useState(!1),[j,k]=t.useState(null),[N,C]=t.useState(!1),[S,E]=t.useState(null),[D,I]=t.useState(null),M=t.useRef(null),z=t.useRef(null),[A,T]=t.useState(0),L=t.useRef(null),O=t.useRef(0),F=t.useRef(0),B=t.useRef(!1),P=l(),G=c.filter(e=>e.groupId===(d??"home")),$=x?c.find(e=>e.id===x):null,H=x?u(x):[],U=[...G.map(e=>({...e,itemType:"folder"})),...P.map(e=>({...e,itemType:"shortcut"}))],q=3*e,Y=Math.ceil(U.length/q),X=[];for(let t=0;t<Math.max(1,Y);t++){const e=t*q;X.push(U.slice(e,e+q))}const W=Xe(Ye(Ut,{activationConstraint:{distance:10}}),Ye(Bt,{coordinateGetter:cr})),_=t.useCallback(e=>{const t=rt(e);return t.length>0?t:tt(e)},[]),V={6:"grid-cols-4 sm:grid-cols-6",8:"grid-cols-4 sm:grid-cols-6 md:grid-cols-8",10:"grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10"},J=t.useCallback(e=>{const t=Math.max(0,Math.min(Y-1,e));t===A||B.current||(B.current=!0,T(t),setTimeout(()=>{B.current=!1,O.current=0},400))},[Y,A]);t.useEffect(()=>{if(Y<=1)return;const e=e=>{if(B.current)return;const t=Date.now();t-F.current>200&&(O.current=0),F.current=t;const n=Math.abs(e.deltaX)>Math.abs(e.deltaY),r=0===e.deltaX&&0!==e.deltaY;let s=0;if(n)s=e.deltaX;else{if(!r)return;s=e.deltaY}O.current+=s;O.current>50?(J(A+1),O.current=0):O.current<-50&&(J(A-1),O.current=0)};return window.addEventListener("wheel",e,{passive:!0}),()=>window.removeEventListener("wheel",e)},[Y,A,J]),t.useEffect(()=>{const e=e=>{"ArrowLeft"===e.key?J(A-1):"ArrowRight"===e.key&&J(A+1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A,J]),t.useEffect(()=>{A>=Y&&Y>0&&T(Y-1)},[U.length,Y,A]);const Z=S?U.find(e=>e.id===S):null,Q=()=>n.jsxs("button",{onClick:s,onContextMenu:e=>{e.preventDefault(),o&&o()},className:"flex flex-col items-center gap-2 cursor-pointer group w-16",title:"添加快捷方式 | 右键批量编辑",children:[n.jsx("div",{className:"w-14 h-14 rounded-[18px] bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all border border-white/10",children:n.jsx(R,{className:"w-6 h-6 text-white/60"})}),n.jsx("span",{className:"text-sm text-white/60",children:"添加"})]}),ee=()=>n.jsxs("button",{onClick:()=>y(!0),className:"flex flex-col items-center gap-2 cursor-pointer group w-16",title:"新建文件夹",children:[n.jsx("div",{className:"w-14 h-14 rounded-[18px] bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-all border border-white/10",children:n.jsx(b,{className:"w-6 h-6 text-white/60"})}),n.jsx("span",{className:"text-sm text-white/60",children:"文件夹"})]});return n.jsxs(n.Fragment,{children:[n.jsxs(In,{sensors:W,collisionDetection:_,onDragStart:e=>{E(e.active.id)},onDragOver:e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return M.current&&(clearTimeout(M.current),M.current=null),I(null),void(z.current=null);if(z.current!==n.id){z.current=n.id,M.current&&(clearTimeout(M.current),M.current=null),I(null);const e=U.find(e=>e.id===t.id),r=U.find(e=>e.id===n.id);if(!e||!r)return;if("shortcut"===e.itemType){("folder"===r.itemType||"shortcut"===r.itemType)&&(M.current=setTimeout(()=>{I(n.id)},600))}}},onDragEnd:e=>{const{active:t,over:n}=e;M.current&&(clearTimeout(M.current),M.current=null);const r=D&&n&&D===n.id;if(E(null),I(null),z.current=null,n){if(r){const e=U.find(e=>e.id===t.id),r=U.find(e=>e.id===n.id);if(!e||!r)return;if("shortcut"===e.itemType&&"folder"===r.itemType)return void g(t.id,n.id);if("shortcut"===e.itemType&&"shortcut"===r.itemType){const e=h("新文件夹",d??void 0);return g(n.id,e),void g(t.id,e)}}if(t.id!==n.id){const e=i.findIndex(e=>e.id===t.id),r=i.findIndex(e=>e.id===n.id);-1!==e&&-1!==r&&a(e,r)}}},children:[n.jsx("div",{ref:L,className:"w-full overflow-hidden",children:n.jsx("div",{className:"flex transition-transform duration-300 ease-out",style:{transform:`translateX(${100*-A}%)`},children:X.map((t,i)=>n.jsx("div",{className:"shrink-0 w-full flex justify-center",children:n.jsx(Qn,{items:t.map(e=>e.id),strategy:Vn,children:n.jsxs("div",{className:`grid ${V[e]} gap-x-6 gap-y-4 justify-items-center py-4`,children:[t.map(e=>"folder"===e.itemType?n.jsx(mr,{folder:e,shortcuts:u(e.id),onOpen:v,isMergeTarget:D===e.id},e.id):n.jsx(ur,{shortcut:e,style:r,isMergeTarget:D===e.id,onContextMenu:o?()=>o():void 0},e.id)),i===X.length-1&&n.jsxs(n.Fragment,{children:[s&&n.jsx(Q,{}),n.jsx(ee,{})]})]})})},i))})}),Y>1&&n.jsx("div",{className:"flex justify-center gap-2 mt-4",children:Array.from({length:Y}).map((e,t)=>n.jsx("button",{onClick:()=>J(t),className:"w-2 h-2 rounded-full transition-all "+(t===A?"bg-white/80 w-4":"bg-white/30 hover:bg-white/50")},t))}),n.jsx(qn,{children:Z&&n.jsx(br,{item:Z,shortcuts:"folder"===Z.itemType?u(Z.id):[]})})]}),$&&n.jsx(xr,{folder:$,shortcuts:H,onClose:()=>v(null),onAddShortcut:()=>C(!0),onEditFolder:()=>{$&&(k($),v(null),y(!0))},onDeleteFolder:()=>{x&&confirm("删除文件夹后，其中的快捷方式将移出。确定删除？")&&(f(x),v(null))}}),n.jsx(vr,{isOpen:w,onClose:()=>{y(!1),k(null)},onSave:e=>{j?(m(j.id,{name:e}),k(null)):h(e,d??void 0)},folder:j??void 0}),N&&n.jsx(wr,{isOpen:N,onClose:()=>C(!1),onAdd:(e,t)=>{if(x){const n=new URL(e).hostname;p({url:e,title:t,favicon:`${K}${n}&sz=64`,groupId:d??void 0,folderId:x})}C(!1)},groupName:$?.name})]})}const jr="newtab_wallpaper_cache";function kr({config:e}){const[r,s]=t.useState(null);t.useEffect(()=>{"bing"===e.type?o():"unsplash"===e.type?i():"image"===e.type&&s(e.value)},[e.type,e.value]);const o=async()=>{try{const e=await a("bing");if(e)return void s(e);const t=await fetch("https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1"),n=await t.json();if(n.images?.[0]?.url){const e=`https://www.bing.com${n.images[0].url}`;s(e),l("bing",e)}}catch(e){}},i=async()=>{try{const e=await a("unsplash");if(e)return void s(e);const t=`https://picsum.photos/1920/1080?random=${Date.now()}`;s(t),l("unsplash",t)}catch(e){}},a=async e=>{try{const t=(await chrome.storage.local.get(jr))[jr];if(t&&t.type===e){const n=Date.now()-t.timestamp;if(n<("bing"===e?216e5:36e5))return t.url}}catch{}return null},l=(e,t)=>{chrome.storage.local.set({[jr]:{type:e,url:t,timestamp:Date.now()}})},c={filter:`blur(${e.blur}px) brightness(${e.brightness}%)`};if("color"===e.type)return n.jsx("div",{className:"absolute inset-0 z-0",style:{...c,backgroundColor:e.value}});const d="bing"===e.type||"unsplash"===e.type?r:e.value;return d?n.jsx("div",{className:"absolute inset-0 z-0 bg-cover bg-center bg-no-repeat",style:{...c,backgroundImage:`url(${d})`}}):n.jsx("div",{className:"absolute inset-0 z-0 bg-[#1a1a2e]"})}function Nr(e,t){if(t)return t;try{return`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=64`}catch{return""}}function Cr({bookmark:e,isHovered:t,onHover:r,wasDragged:s}){const{attributes:o,listeners:i,setNodeRef:a,transform:l,transition:c,isDragging:d}=ir({id:e.id}),u={transform:ze.Transform.toString(l),transition:d?"none":c||"transform 0.2s",opacity:d?.5:1};return n.jsx("div",{ref:a,style:u,...o,...i,className:"relative cursor-grab active:cursor-grabbing",children:n.jsxs("a",{href:e.url,className:"relative block w-11 h-11 rounded-xl bg-white/10 hover:bg-white/20 transition-all duration-200 overflow-hidden",style:{transform:t&&!d?"translateY(-8px) scale(1.15)":"translateY(0) scale(1)"},onMouseEnter:()=>r(e.id),onMouseLeave:()=>r(null),onClick:e=>{(d||s)&&e.preventDefault()},children:[t&&!d&&n.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-lg bg-black/90 text-white text-xs whitespace-nowrap z-50 animate-fadeIn pointer-events-none",children:e.title}),n.jsx("img",{src:Nr(e.url,e.favicon),alt:e.title,className:"w-full h-full object-cover",onError:t=>{const n=t.currentTarget,r=`https://www.google.com/s2/favicons?domain=${new URL(e.url).hostname}&sz=64`;if(n.src.includes("google.com/s2/favicons")){n.style.display="none";const t=n.parentElement;if(t&&!t.querySelector(".fallback-letter")){const n=document.createElement("span");n.className="fallback-letter text-lg font-medium text-white/70",n.textContent=e.title.charAt(0).toUpperCase(),t.appendChild(n)}}else n.src=r}})]})})}function Sr(){const{syncState:e,pinnedBookmarks:r,fetchPinnedBookmarks:s,reorderPinnedBookmarks:o}=oe(),[i,a]=t.useState(!1),[l,c]=t.useState(null),[d,u]=t.useState(!1),[h,m]=t.useState(!1),[f,p]=t.useState([]),[g,x]=t.useState(!1),v=t.useRef(!0),w=t.useRef(),b=Xe(Ye(Ut,{activationConstraint:{distance:8}}),Ye(Bt,{coordinateGetter:cr}));t.useEffect(()=>{p(r)},[r]),t.useEffect(()=>{s().finally(()=>{a(!0),v.current&&(v.current=!1,requestAnimationFrame(()=>{m(!0)}))})},[s]);return!i||e.error||0===f.length?null:n.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-40 transition-opacity duration-300 "+(h?"opacity-100":"opacity-0"),children:n.jsx(In,{sensors:b,collisionDetection:tt,onDragEnd:async e=>{const{active:t,over:n}=e;if(x(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{x(!1)},200),!n||t.id===n.id)return;const r=f.findIndex(e=>e.id===t.id),s=f.findIndex(e=>e.id===n.id);if(-1!==r&&-1!==s){const e=[...f],[t]=e.splice(r,1);e.splice(s,0,t),p(e),await o(e.map(e=>e.id))}},children:n.jsx(Qn,{items:f.map(e=>e.id),strategy:_n,children:n.jsx("div",{className:"flex items-center gap-2 px-4 py-3 rounded-2xl glass-dark "+(d?"animate-pulse":""),onDoubleClick:async()=>{d||(u(!0),await s(!0),setTimeout(()=>u(!1),500))},title:"拖拽排序 | 双击同步最新",children:f.map(e=>n.jsx(Cr,{bookmark:e,isHovered:l===e.id,onHover:c,wasDragged:g},e.id))})})})})}function Er({userName:e}){const r=t.useMemo(()=>{const e=(new Date).getHours();return e>=5&&e<12?{text:"早上好",icon:"🌅"}:e>=12&&e<14?{text:"中午好",icon:"☀️"}:e>=14&&e<18?{text:"下午好",icon:"🌤️"}:e>=18&&e<22?{text:"晚上好",icon:"🌆"}:{text:"夜深了",icon:"🌙"}},[]);return n.jsx("div",{className:"text-center text-white select-none",children:n.jsxs("h2",{className:"text-2xl font-light text-shadow",children:[r.text,e&&n.jsx("span",{className:"ml-2",children:e})]})})}function Dr(){const e=t.useMemo(()=>{const e=c.Lunar.fromDate(new Date);let t="";try{const n=e.getFestivals?.()||[],r=e.getJieQi?.()||"";t=n[0]||r||""}catch{}return{date:`${e.getMonthInChinese()}月${e.getDayInChinese()}`,year:`${e.getYearInGanZhi()}${e.getYearShengXiao()}年`,festival:t}},[]);return n.jsxs("div",{className:"text-center text-white/70 text-sm select-none",children:[n.jsxs("span",{children:[e.year," ",e.date]}),e.festival&&n.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-white/10 text-xs",children:e.festival})]})}const Ir="newtab_poetry";function Mr(){const[e,r]=t.useState(null),s=()=>{const e=Math.floor(Math.random()*X.length),t=X[e];r(t);const n=(new Date).toDateString();chrome.storage.local.set({[Ir]:{poetry:t,date:n}})};return t.useEffect(()=>{chrome.storage.local.get(Ir).then(e=>{const t=e[Ir],n=(new Date).toDateString();t&&t.date===n?r(t.poetry):s()})},[]),e?n.jsxs("div",{className:"text-center text-white select-none group flex items-center justify-center gap-2",children:[n.jsxs("span",{className:"text-sm font-light tracking-wide text-shadow-sm",children:["「",e.content,"」"]}),n.jsxs("span",{className:"text-xs text-white/70 text-shadow-sm",children:["—— ",e.author,"《",e.title,"》"]}),n.jsx("button",{onClick:s,className:"p-1 rounded-full opacity-0 group-hover:opacity-100 hover:bg-white/10 transition-all inline-flex items-center",title:"换一首",children:n.jsx(z,{className:"w-3 h-3 text-white/50"})})]}):null}const Rr={Home:S,Briefcase:m,GraduationCap:N,Gamepad2:j,Wrench:$,Code:g,Music:D,Film:v,ShoppingCart:L,Heart:C,Star:F,Bookmark:h,Folder:y,Globe:k,Zap:U};function zr(e){return Rr[e]||y}function Ar({onOpenSettings:e}){const{shortcutGroups:r,activeGroupId:s,setActiveGroup:o,addGroup:l,removeGroup:c}=te(),[d,h]=t.useState(!1),[m,f]=t.useState(""),[p,g]=t.useState("Folder"),[x,v]=t.useState(""),[w,b]=t.useState(null);t.useEffect(()=>{(async()=>{const e=await i.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");v(t)}else v(a().BASE_URL)})()},[]);const y=()=>{m.trim()&&(l(m.trim(),p),f(""),g("Folder"),h(!1))},j=(e,t)=>{e.stopPropagation(),e.preventDefault(),confirm('删除分组后，该分组的快捷方式将移到"首页"。确定删除？')&&c(t)};return n.jsxs("div",{className:"fixed left-3 top-1/2 -translate-y-1/2 z-20 glass rounded-2xl p-2 animate-fadeIn flex flex-col gap-1",children:[r.map(e=>{const t="home"!==e.id,r=zr(e.icon);return n.jsxs("button",{onClick:()=>o(e.id),onMouseEnter:()=>b(e.id),onMouseLeave:()=>b(null),onContextMenu:t=>j(t,e.id),className:"relative w-10 h-10 rounded-xl flex items-center justify-center transition-all "+(s===e.id?"bg-white/25 text-white":"text-white/60 hover:text-white hover:bg-white/15"),title:e.name,children:[n.jsx(r,{className:"w-5 h-5"}),w===e.id&&n.jsxs("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50 flex items-center gap-2",children:[e.name,t&&n.jsx(H,{className:"w-3 h-3 hover:text-red-400 cursor-pointer",onClick:t=>j(t,e.id)})]})]},e.id)}),n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>h(!d),onMouseEnter:()=>b("add"),onMouseLeave:()=>b(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/40 hover:text-white/70 hover:bg-white/10 transition-all",title:"新建分组",children:[n.jsx(R,{className:"w-5 h-5"}),"add"===w&&!d&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"新建分组"})]}),d&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),n.jsxs("div",{className:"absolute left-full top-0 ml-2 w-56 p-3 rounded-xl bg-gray-900/95 border border-white/10 shadow-2xl z-50 animate-scaleIn",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:"新建分组"}),n.jsx("button",{onClick:()=>h(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-3 h-3 text-white/60"})})]}),n.jsx("input",{type:"text",value:m,onChange:e=>f(e.target.value),placeholder:"分组名称",className:"w-full bg-white/10 text-white text-sm rounded-lg px-3 py-2 mb-3 outline-none border border-white/20 focus:border-blue-500/50 placeholder:text-white/40",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&y()}),n.jsx("div",{className:"grid grid-cols-5 gap-1.5 mb-3",children:V.map(e=>{const t=zr(e);return n.jsx("button",{onClick:()=>g(e),className:"p-1.5 rounded-lg transition-all "+(p===e?"bg-blue-500/30 text-blue-400 ring-1 ring-blue-500/50":"text-white/50 hover:bg-white/10 hover:text-white/80"),children:n.jsx(t,{className:"w-4 h-4 mx-auto"})},e)})}),n.jsx("button",{onClick:y,disabled:!m.trim(),className:"w-full py-1.5 rounded-lg bg-blue-500/80 hover:bg-blue-500 text-white text-sm transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"创建"})]})]})]}),x&&n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),x&&n.jsxs("button",{onClick:()=>window.open(x,"_blank"),onMouseEnter:()=>b("tmarks"),onMouseLeave:()=>b(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/60 hover:text-white hover:bg-white/15 transition-all",title:"TMarks 书签",children:[n.jsx(u,{className:"w-5 h-5"}),"tmarks"===w&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"书签管理"})]}),n.jsx("div",{className:"w-6 h-px bg-white/20 mx-auto my-1"}),n.jsxs("button",{onClick:e,onMouseEnter:()=>b("settings"),onMouseLeave:()=>b(null),className:"relative w-10 h-10 rounded-xl flex items-center justify-center text-white/60 hover:text-white hover:bg-white/15 transition-all",title:"设置",children:[n.jsx(T,{className:"w-5 h-5"}),"settings"===w&&n.jsx("div",{className:"absolute left-full ml-2 px-2 py-1 rounded-lg bg-black/80 text-white text-xs whitespace-nowrap z-50",children:"设置"})]})]})}const Tr=[{id:"general",label:"常规",icon:G},{id:"appearance",label:"外观",icon:I},{id:"sync",label:"同步",icon:p}];function Lr({onClose:e}){const{settings:r,updateSettings:s}=te(),[o,l]=t.useState(""),[c,d]=t.useState("general");return t.useEffect(()=>{(async()=>{const e=await i.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");l(t)}else l(a().BASE_URL)})()},[]),de.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:fr},onClick:e,children:n.jsxs("div",{className:"relative w-full max-w-4xl h-[600px] rounded-2xl glass-modal-dark flex flex-col overflow-hidden",style:{zIndex:pr,animation:"modalScale 0.2s ease-out"},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[n.jsx("h2",{className:"text-lg font-medium text-white",children:"设置"}),n.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[n.jsx("div",{className:"w-48 flex-shrink-0 border-r border-white/10 py-2",children:Tr.map(e=>{const t=e.icon;return n.jsxs("button",{onClick:()=>d(e.id),className:"w-full flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors relative "+(c===e.id?"text-white bg-white/10":"text-white/60 hover:text-white hover:bg-white/5"),children:[n.jsx(t,{className:"w-4 h-4"}),e.label,c===e.id&&n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-blue-500"})]},e.id)})}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:["general"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(Or,{title:"个性化",children:[n.jsx(Fr,{label:"显示问候语",checked:r.showGreeting,onChange:e=>s({showGreeting:e})}),n.jsx(Gr,{label:"你的名字",value:r.userName,placeholder:"可选",onChange:e=>s({userName:e})})]}),n.jsxs(Or,{title:"时钟",children:[n.jsx(Fr,{label:"显示时钟",checked:r.showClock,onChange:e=>s({showClock:e})}),r.showClock&&n.jsxs(n.Fragment,{children:[n.jsx(Fr,{label:"显示日期",checked:r.showDate,onChange:e=>s({showDate:e})}),n.jsx(Fr,{label:"显示秒数",checked:r.showSeconds,onChange:e=>s({showSeconds:e})}),n.jsx(Fr,{label:"显示农历",checked:r.showLunar,onChange:e=>s({showLunar:e})}),n.jsx(Br,{label:"时间格式",value:r.clockFormat,options:[{value:"24h",label:"24 小时制"},{value:"12h",label:"12 小时制"}],onChange:e=>s({clockFormat:e})})]})]}),n.jsx(Or,{title:"诗词",children:n.jsx(Fr,{label:"显示每日诗词",checked:r.showPoetry,onChange:e=>s({showPoetry:e})})}),n.jsxs(Or,{title:"搜索",children:[n.jsx(Fr,{label:"显示搜索框",checked:r.showSearch,onChange:e=>s({showSearch:e})}),n.jsx(Br,{label:"搜索引擎",value:r.searchEngine,options:q.map(e=>({value:e.id,label:e.name})),onChange:e=>s({searchEngine:e})})]})]}),"appearance"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(Or,{title:"快捷方式",children:[n.jsx(Fr,{label:"显示快捷方式",checked:r.showShortcuts,onChange:e=>s({showShortcuts:e})}),n.jsx(Br,{label:"每行数量",value:String(r.shortcutColumns),options:[{value:"6",label:"6 个"},{value:"8",label:"8 个"},{value:"10",label:"10 个"}],onChange:e=>s({shortcutColumns:Number(e)})})]}),n.jsxs(Or,{title:"壁纸",children:[n.jsx(Br,{label:"壁纸类型",value:r.wallpaper.type,options:[{value:"color",label:"纯色"},{value:"bing",label:"Bing 每日壁纸"},{value:"unsplash",label:"随机风景"},{value:"image",label:"自定义图片"}],onChange:e=>s({wallpaper:{...r.wallpaper,type:e}})}),"color"===r.wallpaper.type&&n.jsx(Pr,{label:"背景颜色",value:r.wallpaper.value,onChange:e=>s({wallpaper:{...r.wallpaper,value:e}})}),"image"===r.wallpaper.type&&n.jsx(Gr,{label:"图片 URL",value:r.wallpaper.value,placeholder:"https://...",onChange:e=>s({wallpaper:{...r.wallpaper,value:e}})}),n.jsx($r,{label:"模糊",value:r.wallpaper.blur,min:0,max:20,onChange:e=>s({wallpaper:{...r.wallpaper,blur:e}})}),n.jsx($r,{label:"亮度",value:r.wallpaper.brightness,min:20,max:100,onChange:e=>s({wallpaper:{...r.wallpaper,brightness:e}})})]})]}),"sync"===c&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(Or,{title:"TMarks 同步",children:[n.jsx(Fr,{label:"显示置顶书签",checked:r.showPinnedBookmarks,onChange:e=>s({showPinnedBookmarks:e})}),n.jsx(Fr,{label:"搜索建议",checked:r.enableSearchSuggestions,onChange:e=>s({enableSearchSuggestions:e})}),o&&n.jsxs("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 mt-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[n.jsx("span",{className:"text-sm text-white/70",children:"打开 TMarks 网站"}),n.jsx(x,{className:"w-4 h-4 text-white/50"})]}),n.jsx("div",{className:"text-xs text-white/40 mt-2",children:"在扩展设置中配置 API Key 以启用同步功能"})]}),n.jsxs(Or,{title:"自动刷新",children:[n.jsx(Fr,{label:"定时刷新置顶书签",checked:r.autoRefreshPinnedBookmarks,onChange:e=>s({autoRefreshPinnedBookmarks:e})}),r.autoRefreshPinnedBookmarks&&n.jsxs(n.Fragment,{children:[n.jsx(Br,{label:"刷新时间",value:r.pinnedBookmarksRefreshTime,options:[{value:"morning",label:"早上 8:00"},{value:"evening",label:"晚上 22:00"}],onChange:e=>s({pinnedBookmarksRefreshTime:e})}),n.jsx("div",{className:"text-xs text-white/40 -mt-1 ml-1",children:"每天自动更新置顶书签缓存，保持数据最新"})]})]})]})]})]})]})}),document.body)}function Or({title:e,children:t}){return n.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[n.jsx("h3",{className:"text-sm font-medium text-white/80 mb-4",children:e}),n.jsx("div",{className:"space-y-3",children:t})]})}function Fr({label:e,checked:t,onChange:r}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("button",{onClick:()=>r(!t),className:"w-10 h-6 rounded-full transition-colors "+(t?"bg-blue-500":"bg-white/20"),children:n.jsx("div",{className:"w-4 h-4 rounded-full bg-white transition-transform mx-1 "+(t?"translate-x-4":"translate-x-0")})})]})}function Br({label:e,value:t,options:r,onChange:s}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("select",{value:t,onChange:e=>s(e.target.value),className:"bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 outline-none border border-white/10",children:r.map(e=>n.jsx("option",{value:e.value,className:"bg-gray-800",children:e.label},e.value))})]})}function Pr({label:e,value:t,onChange:r}){return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsx("input",{type:"color",value:t,onChange:e=>r(e.target.value),className:"w-8 h-8 rounded cursor-pointer"})]})}function Gr({label:e,value:t,placeholder:r,onChange:s}){return n.jsxs("div",{className:"flex items-center justify-between gap-4",children:[n.jsx("span",{className:"text-sm text-white/80 flex-shrink-0",children:e}),n.jsx("input",{type:"text",value:t,placeholder:r,onChange:e=>s(e.target.value),className:"flex-1 bg-white/10 text-white text-sm rounded-lg px-3 py-1.5 outline-none border border-white/10"})]})}function $r({label:e,value:t,min:r,max:s,onChange:o}){return n.jsxs("div",{className:"flex items-center justify-between gap-4",children:[n.jsx("span",{className:"text-sm text-white/80",children:e}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"range",value:t,min:r,max:s,onChange:e=>o(Number(e.target.value)),className:"w-24"}),n.jsx("span",{className:"text-xs text-white/60 w-8",children:t})]})]})}function Hr({isOpen:e,onClose:r}){const{shortcutGroups:s,removeShortcut:o,updateShortcut:i,getFilteredShortcuts:a}=te(),[l,c]=t.useState(new Set),[d,u]=t.useState(""),h=a();if(t.useEffect(()=>{e||(c(new Set),u(""))},[e]),!e)return null;return de.createPortal(n.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 animate-fadeIn",style:{zIndex:fr},onClick:r,children:n.jsxs("div",{className:"relative w-full max-w-2xl max-h-[80vh] rounded-2xl glass-modal-dark flex flex-col overflow-hidden",style:{zIndex:pr},onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[n.jsx("h2",{className:"text-lg font-medium text-white",children:"批量编辑快捷方式"}),n.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:n.jsx(H,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{className:"flex items-center gap-4 px-6 py-3 border-b border-white/10 bg-white/5",children:[n.jsx("button",{onClick:()=>{l.size===h.length?c(new Set):c(new Set(h.map(e=>e.id)))},className:"text-sm text-white/70 hover:text-white transition-colors",children:l.size===h.length?"取消全选":"全选"}),n.jsxs("span",{className:"text-sm text-white/50",children:["已选择 ",l.size," 项"]}),n.jsx("div",{className:"flex-1"}),n.jsxs("button",{onClick:()=>{0!==l.size&&confirm(`确定要删除选中的 ${l.size} 个快捷方式吗？`)&&(l.forEach(e=>o(e)),c(new Set))},disabled:0===l.size,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsx(B,{className:"w-4 h-4"}),"删除选中"]})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n.jsx("div",{className:"grid grid-cols-4 gap-4",children:h.map(e=>n.jsxs("div",{onClick:()=>(e=>{const t=new Set(l);t.has(e)?t.delete(e):t.add(e),c(t)})(e.id),className:`\n                  relative flex flex-col items-center gap-2 p-4 rounded-xl cursor-pointer transition-all\n                  ${l.has(e.id)?"bg-blue-500/20 border-2 border-blue-500":"glass hover:bg-white/10 border-2 border-transparent"}\n                `,children:[l.has(e.id)&&n.jsx("div",{className:"absolute top-2 right-2 w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center",children:n.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center overflow-hidden",children:n.jsx("img",{src:e.favicon,alt:e.title,className:"w-8 h-8 object-contain",onError:t=>{const n=t.currentTarget;n.style.display="none";const r=n.parentElement;if(r&&!r.querySelector(".fallback-letter")){const t=document.createElement("span");t.className="fallback-letter text-lg font-medium text-white/70",t.textContent=e.title.charAt(0).toUpperCase(),r.appendChild(t)}}})}),n.jsx("span",{className:"text-xs text-white/80 truncate max-w-full text-center",children:e.title})]},e.id))})}),l.size>0&&n.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-t border-white/10 bg-white/5",children:[n.jsx(w,{className:"w-5 h-5 text-white/70"}),n.jsx("span",{className:"text-sm text-white/70",children:"移动到："}),n.jsxs("select",{value:d,onChange:e=>u(e.target.value),className:"flex-1 bg-white/10 text-white text-sm rounded-lg px-3 py-2 outline-none border border-white/10",children:[n.jsx("option",{value:"",children:"选择分组"}),s.map(e=>n.jsx("option",{value:e.id,className:"bg-gray-800",children:e.name},e.id))]}),n.jsx("button",{onClick:()=>{0!==l.size&&d&&(l.forEach(e=>{i(e,{groupId:d})}),c(new Set),r())},disabled:!d,className:"px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"移动"})]})]})}),document.body)}function Ur({x:e,y:r,items:s,onClose:o}){const i=t.useRef(null);return t.useEffect(()=>{const e=e=>{i.current&&!i.current.contains(e.target)&&o()},t=e=>{"Escape"===e.key&&o()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),document.addEventListener("contextmenu",o),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),document.removeEventListener("contextmenu",o)}},[o]),t.useEffect(()=>{if(i.current){const t=i.current.getBoundingClientRect(),n=e+t.width>window.innerWidth?window.innerWidth-t.width-10:e,s=r+t.height>window.innerHeight?window.innerHeight-t.height-10:r;i.current.style.left=`${n}px`,i.current.style.top=`${s}px`}},[e,r]),de.createPortal(n.jsx("div",{ref:i,className:"fixed z-[9999] min-w-[180px] rounded-lg glass-dark border border-white/10 shadow-xl py-1 animate-fadeIn",style:{left:e,top:r},children:s.map((e,t)=>n.jsxs("div",{children:[n.jsxs("button",{onClick:()=>{e.onClick(),o()},className:`\n              w-full flex items-center gap-3 px-4 py-2 text-sm transition-colors\n              ${e.danger?"text-red-400 hover:bg-red-500/20":"text-white/80 hover:bg-white/10"}\n            `,children:[n.jsx("span",{className:"w-4 h-4 flex-shrink-0",children:e.icon}),n.jsx("span",{children:e.label})]}),e.divider&&n.jsx("div",{className:"h-px bg-white/10 my-1"})]},t))}),document.body)}function qr(){const{settings:e,isLoading:r,loadData:s,updateSettings:o,shortcutGroups:i,activeGroupId:a,setActiveGroup:l,addShortcut:c}=te(),[d,u]=t.useState(!1),[h,m]=t.useState(!1),[f,p]=t.useState(!1),[g,x]=t.useState(null),v=t.useRef(),w=t.useRef(!1),b=t.useRef({shortcutGroups:i,activeGroupId:a,setActiveGroup:l});b.current={shortcutGroups:i,activeGroupId:a,setActiveGroup:l},t.useEffect(()=>{s()},[s]);const y=t.useCallback(e=>{const{shortcutGroups:t,activeGroupId:n,setActiveGroup:r}=b.current;if(w.current)return;const s=e.target.closest(".overflow-y-auto, .overflow-auto");if(s){const{scrollTop:t,scrollHeight:n,clientHeight:r}=s;if(n>r){if(e.deltaY<0&&t>0)return;if(e.deltaY>0&&t+r<n)return}}const o=t.map(e=>e.id);if(0===o.length)return;const i=o.indexOf(n||"");if(-1===i)return void r(o[0]);let a=i;e.deltaY>0?a=Math.min(i+1,o.length-1):e.deltaY<0&&(a=Math.max(i-1,0)),a!==i&&(e.preventDefault(),r(o[a]),w.current=!0,v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{w.current=!1},300))},[]),j=t.useCallback(e=>{const t=e.target,n=t.closest('[role="dialog"]')||t.closest(".glass-modal")||t.closest(".glass-modal-dark"),r="INPUT"===t.tagName||"TEXTAREA"===t.tagName;n||r||(e.preventDefault(),x({x:e.clientX,y:e.clientY}))},[]);return t.useEffect(()=>{if(e.showShortcuts)return window.addEventListener("wheel",y,{passive:!1}),()=>{window.removeEventListener("wheel",y),v.current&&clearTimeout(v.current)}},[y,e.showShortcuts]),t.useEffect(()=>(window.addEventListener("contextmenu",j),()=>{window.removeEventListener("contextmenu",j)}),[j]),r?n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-[#1a1a2e]",children:n.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):n.jsxs("div",{className:"relative w-full h-full overflow-hidden",children:[n.jsx(kr,{config:e.wallpaper}),n.jsxs("div",{className:"relative z-10 w-full h-full flex flex-col items-center px-4 pt-[12vh] pb-8 overflow-y-auto",children:[e.showGreeting&&n.jsx("div",{className:"mb-1 animate-fadeIn",children:n.jsx(Er,{userName:e.userName})}),e.showClock&&n.jsx("div",{className:"mb-3 animate-fadeIn",children:n.jsx(ne,{format:e.clockFormat,showDate:e.showDate,showSeconds:e.showSeconds,showLunar:e.showLunar})}),!e.showClock&&e.showLunar&&n.jsx("div",{className:"mb-3 animate-fadeIn",children:n.jsx(Dr,{})}),e.showPoetry&&n.jsx("div",{className:"mb-6 animate-fadeIn",children:n.jsx(Mr,{})}),e.showSearch&&n.jsx("div",{className:"w-full max-w-2xl mb-6 animate-fadeIn px-4 relative z-50",children:n.jsx(ce,{engine:e.searchEngine,enableSuggestions:e.enableSearchSuggestions,onEngineChange:e=>o({searchEngine:e})})}),e.showShortcuts&&n.jsx("div",{className:"w-full max-w-5xl animate-fadeIn px-4 shortcut-area",children:n.jsx("div",{className:"flex items-start gap-4",children:n.jsx(yr,{columns:e.shortcutColumns,style:e.shortcutStyle,onAddClick:()=>m(!0),onBatchEditClick:()=>p(!0)})})})]}),n.jsx(Ar,{onOpenSettings:()=>u(!0)}),e.showPinnedBookmarks&&n.jsx(Sr,{}),d&&n.jsx(Lr,{onClose:()=>u(!1)}),h&&n.jsx(wr,{isOpen:h,onClose:()=>m(!1),onAdd:(e,t)=>{const n=new URL(e).hostname;c({url:e,title:t,favicon:`${K}${n}&sz=64`,groupId:a||void 0})},groupName:a?i.find(e=>e.id===a)?.name:void 0}),n.jsx(Hr,{isOpen:f,onClose:()=>p(!1)}),g&&n.jsx(Ur,{x:g.x,y:g.y,items:[{label:"添加快捷方式",icon:n.jsx(R,{className:"w-4 h-4"}),onClick:()=>m(!0)},{label:"批量编辑",icon:n.jsx(O,{className:"w-4 h-4"}),onClick:()=>p(!0),divider:!0}],onClose:()=>x(null)})]})}const Yr=document.getElementById("root");Yr&&o.createRoot(Yr).render(n.jsx(s.StrictMode,{children:n.jsx(qr,{})}));
