import{_ as t}from"./preload-helper-BhLMWRjL.js";const e=new class{extract(){const t=this.getAllThumbnails();return{title:this.getTitle(),url:window.location.href,description:this.getDescription(),content:this.getMainContent(),thumbnail:t[0]||"",thumbnails:t,favicon:this.getFavicon()}}getTitle(){return document.title||this.getMeta("og:title")||document.querySelector("h1")?.textContent?.trim()||"Untitled"}getDescription(){return this.getMeta("description")||this.getMeta("og:description")||this.getMeta("twitter:description")||""}getMainContent(){const t=document.querySelector("article")||document.querySelector("main")||document.querySelector('[role="main"]')||document.body;if(!t)return"";const e=t.cloneNode(!0);e.querySelectorAll("script, style, nav, header, footer, iframe, noscript").forEach(t=>{t.remove()});return(e.textContent||"").replace(/\s+/g," ").trim().substring(0,1e3)}getFavicon(){const t=(t,e)=>{if(!t||"string"!=typeof t)return"";try{if(!(t=t.trim()))return"";const r=new URL(t,e||window.location.href);return"http:"!==r.protocol&&"https:"!==r.protocol?"":r.href}catch(r){return""}};try{const e=Array.from(document.querySelectorAll('link[rel="apple-touch-icon"]'));if(e.length>0){let r,n=0;for(const t of e)if(t.href){const e=t.getAttribute("sizes");if(e){const o=parseInt(e.split("x")[0]);!isNaN(o)&&o>n&&(n=o,r=t)}else r||(r=t)}if(r&&r.href){const e=t(r.href);if(e)return e}}}catch(e){}try{const e=Array.from(document.querySelectorAll('link[rel*="icon"]'));if(e.length>0){let r,n=0;for(const t of e)if(t.href){const e=t.getAttribute("type")||"",o=t.getAttribute("sizes"),i=t.href.toLowerCase();if(e.includes("svg")||i.endsWith(".svg")){r=t;break}if(e.includes("png")||i.endsWith(".png"))if(o){const e=parseInt(o.split("x")[0]);!isNaN(e)&&e>n&&(n=e,r=t)}else r&&0!==n||(r=t);r||(r=t)}if(r&&r.href){const e=t(r.href);if(e)return e}}}catch(e){}try{const t=window.location.origin;return`chrome://favicon/size/64@2x/${t}`}catch(e){}try{return new URL("/favicon.ico",window.location.origin).href}catch(e){}return""}getAllThumbnails(){const t=[],e=(t,e)=>{if(!t||"string"!=typeof t)return"";try{if(!(t=t.trim()))return"";const r=new URL(t,e||window.location.href);return"http:"!==r.protocol&&"https:"!==r.protocol?"":r.href}catch(r){return""}};try{const r=document.querySelector('meta[property="og:image"]');if(r instanceof HTMLMetaElement&&r.content){const n=e(r.content);n&&!t.includes(n)&&t.push(n)}}catch(r){}try{const r=document.querySelector('meta[name="twitter:image"]');if(r instanceof HTMLMetaElement&&r.content){const n=e(r.content);n&&!t.includes(n)&&t.push(n)}}catch(r){}try{const r=[document.querySelector("main"),document.querySelector('[role="main"]'),document.querySelector("article"),document.body].filter(Boolean),o=[];for(const t of r){if(!t)continue;const r=t.querySelectorAll("img");for(const t of r)try{if(!t.src)continue;if(t.src.startsWith("data:")||t.src.startsWith("blob:"))continue;let r=t.naturalWidth,n=t.naturalHeight;if(0===r||0===n){const e=t.getAttribute("width"),o=t.getAttribute("height");if(e&&o){const t=parseInt(e),i=parseInt(o);isNaN(t)||isNaN(i)||(r=t,n=i)}0!==r&&0!==n||(r=t.width||t.offsetWidth||t.clientWidth,n=t.height||t.offsetHeight||t.clientHeight)}if(r>200&&n>200&&r<5e3&&n<5e3){const i=e(t.src);i&&!o.some(t=>t.url===i)&&o.push({url:i,area:r*n})}}catch(n){continue}}o.sort((t,e)=>e.area-t.area);const i=o.slice(0,5);for(const{url:e}of i)t.includes(e)||t.push(e)}catch(r){}return t}getMeta(t){const e=document.querySelector(`meta[name="${t}"]`)||document.querySelector(`meta[property="${t}"]`);return e?.getAttribute("content")||""}};window.__AITMARKS_CONTENT_SCRIPT_LOADED__||(window.__AITMARKS_CONTENT_SCRIPT_LOADED__=!0,chrome.runtime.onMessage.addListener((r,n,o)=>{if("PING"===r.type){try{o({success:!0,data:"pong"})}catch(i){}return!0}return"EXTRACT_PAGE_INFO"===r.type?((async()=>{try{"loading"===document.readyState&&await new Promise(t=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t(null)});const t=e.extract();t.url||(t.url=window.location.href),t.title||(t.title=document.title||"Untitled"),o({success:!0,data:t})}catch(i){o({success:!0,data:{title:document.title||"Untitled",url:window.location.href,description:"",content:"",thumbnail:""}})}})(),!0):"CAPTURE_PAGE"===r.type?((async()=>{try{const{capturePage:e}=await t(async()=>{const{capturePage:t}=await import("./singlefile-capture-Bkt_j5oF.js");return{capturePage:t}},[]),n=await e(r.options||{}),i=new Blob([n]).size;o({success:!0,html:n,size:i})}catch(i){o({success:!1,error:i instanceof Error?i.message:"Unknown error"})}})(),!0):"CAPTURE_PAGE_V2"===r.type&&((async()=>{try{const{capturePageV2:e}=await t(async()=>{const{capturePageV2:t}=await import("./singlefile-capture-v2-DXdSZKa8.js");return{capturePageV2:t}},[]),n=await e(r.options||{}),i=await Promise.all(n.images.map(async t=>{const e=new FileReader,r=await new Promise((r,n)=>{e.onloadend=()=>r(e.result),e.onerror=n,e.readAsDataURL(t.blob)});return{hash:t.hash,data:r,type:t.blob.type,size:t.blob.size}}));o({success:!0,data:{html:n.html,images:i}})}catch(i){o({success:!1,error:i instanceof Error?i.message:"Unknown error"})}})(),!0)}));
