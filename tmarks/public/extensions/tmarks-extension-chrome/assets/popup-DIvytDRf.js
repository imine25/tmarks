import"./modulepreload-polyfill-YP0FEG5d.js";import{k as e,r as t,l as a,m as r,P as s,L as o,F as n,n as l,R as i}from"./react-vendor-1ZtHTM4k.js";import{a as c,b as d,E as p,S as b,L as x,u}from"./index-DMyYRnJd.js";import{S as m,g as v,n as h}from"./urls-DpCSGfkZ.js";import{l as g}from"./vendor-BSnXPJO2.js";import{g as f,c as j,a as y}from"./tab-collection-B4T4yCDu.js";import{c as N}from"./index-xzwELVx1.js";import"./dexie-BAhLzSXZ.js";import"./index-NQ3jknxk.js";function w(e){const t="inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-semibold border transition-all duration-200 active:scale-95";return"bw"===e?`${t} border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] hover:opacity-90`:"mono"===e?`${t} border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-message-info-bg)] text-[var(--tab-message-info-icon)] hover:opacity-90`:`${t} border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-surface)] text-[var(--tab-message-info-icon)] shadow-sm hover:bg-[color:var(--tab-surface-muted)]`}function k(e,t){const a="border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] text-[var(--tab-text)] hover:bg-[color:var(--tab-surface-muted)]",r="border border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] text-[var(--tab-message-success-icon)] shadow-sm hover:opacity-90";return"bw"===e?t?"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] shadow-sm hover:opacity-90":"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-unselected-bg)] text-[var(--tab-tag-unselected-text)] hover:bg-[color:var(--tab-surface-muted)]":t?r:a}function C({tags:t,selectedTags:a,onToggle:r,theme:s="classic"}){return e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(t=>{const o=a.includes(t.name),n=t.isNew,l=function(e,t,a){const r="border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] text-[var(--tab-text)] hover:bg-[color:var(--tab-surface-muted)]",s="border border-[color:var(--tab-message-info-border)] bg-[color:var(--tab-message-info-bg)] text-[var(--tab-message-info-icon)] hover:opacity-90",o="border border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] text-[var(--tab-message-success-icon)] hover:opacity-90",n="border border-[color:var(--tab-message-warning-border)] bg-[color:var(--tab-message-warning-bg)] text-[var(--tab-message-warning-icon)] hover:opacity-90";return"bw"===e?t?"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-selected-bg)] text-[var(--tab-tag-selected-text)] hover:opacity-90":"border border-[color:var(--tab-tag-border)] bg-[color:var(--tab-tag-unselected-bg)] text-[var(--tab-tag-unselected-text)] hover:bg-[color:var(--tab-surface-muted)]":t?a?n:o:a?s:r}(s,o,n);return e.jsxs("button",{onClick:()=>r(t.name),className:`inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-medium transition-all duration-200 active:scale-95 ${l}`,children:[e.jsx("span",{className:"truncate max-w-[110px]",children:t.name}),n&&e.jsx("span",{className:"ml-1 text-[10px] italic uppercase tracking-widest "+("bw"===s?o?"text-[var(--tab-tag-selected-text)]":"text-[var(--tab-tag-new-indicator)]":o?"text-[var(--tab-message-warning-icon)]":"text-[var(--tab-message-info-icon)]"),children:" NEW "})]},t.name)})})}function S({title:s,url:o,description:n,thumbnail:l,thumbnails:i,favicon:c,onThumbnailChange:d}){const[p,b]=t.useState(0),[x,u]=t.useState(!1),m=i&&i.length>0?i:l?[l]:[],v=m[p],h=m.length>1;return e.jsxs("div",{className:"bg-[color:var(--tab-surface)] border border-[color:var(--tab-border)] rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200",children:[v&&!x&&e.jsxs("div",{className:"relative h-32 bg-[color:var(--tab-surface-muted)] group",children:[e.jsx("img",{src:v,alt:"",className:"w-full h-full object-cover",onError:e=>{u(!0),e.currentTarget.style.display="none"}}),h&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const e=p>0?p-1:m.length-1;b(e),u(!1),d&&m[e]&&d(m[e])},className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:opacity-90 active:scale-95",title:"ä¸Šä¸€å¼ ",children:e.jsx(a,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{const e=p<m.length-1?p+1:0;b(e),u(!1),d&&m[e]&&d(m[e])},className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:opacity-90 active:scale-95",title:"ä¸‹ä¸€å¼ ",children:e.jsx(r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute bottom-2 right-2 px-2 py-1 rounded-full bg-[color:var(--tab-overlay)] text-[var(--tab-message-info-icon-bg)] text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[p+1," / ",m.length]})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[c&&e.jsx("img",{src:c,alt:"",className:"w-5 h-5 flex-shrink-0 mt-0.5 rounded",onError:e=>{e.currentTarget.style.display="none"}}),e.jsx("h3",{className:"flex-1 text-base font-semibold text-[var(--tab-text)] line-clamp-2 "+(l&&!c?"text-center":""),children:s})]}),e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] truncate",title:o,children:o}),n&&e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] line-clamp-3",children:n})]})]})}function L({message:t}){return e.jsx("div",{className:"bg-[color:var(--tab-message-info-bg)] border border-[color:var(--tab-message-info-border)] rounded-lg p-3 shadow-lg animate-in slide-in-from-top-5 fade-in duration-300 text-[var(--tab-message-info-icon)]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-[color:var(--tab-message-info-icon-bg)] rounded-full p-1.5 flex-shrink-0",children:e.jsxs("svg",{className:"w-5 h-5 text-[var(--tab-message-info-icon)] animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("div",{className:"flex-1 pt-0.5",children:[e.jsx("p",{className:"text-sm font-medium",children:t}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-[var(--tab-message-info-icon)] rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})]})})}function M({bookmark:a,newTags:r,onUpdateTags:s,onUpdateDescription:o,onCreateSnapshot:n,onCancel:l}){const[i,c]=t.useState(null),[d,p]=t.useState(""),[b,x]=t.useState(!1),[u,v]=t.useState(""),[h,g]=t.useState(a.description||"");t.useEffect(()=>{m.getBookmarkSiteApiUrl().then(e=>{if(e){const t=e.replace(/\/api$/,"");p(t)}})},[]);const f=a.tags.map(e=>e.name),j=r.filter(e=>!f.includes(e)),y=j.length>0;return e.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-[color:var(--tab-overlay)] backdrop-blur-sm animate-in fade-in duration-200",children:[b&&e.jsx("div",{className:"absolute top-4 left-0 right-0 px-4 z-50",children:e.jsx(L,{message:u})}),e.jsxs("div",{className:"bg-[color:var(--tab-surface)] rounded-xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto animate-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"sticky top-0 bg-[color:var(--tab-surface)] border-b border-[color:var(--tab-border)] px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-[color:var(--tab-message-warning-icon-bg)] rounded-full p-2 flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-[var(--tab-message-warning-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--tab-text)]",children:"ä¹¦ç­¾å·²å­˜åœ¨"}),e.jsx("p",{className:"text-sm text-[var(--tab-text-muted)] mt-1",children:"è¯¥ç½‘å€å·²ç»ä¿å­˜è¿‡äº†ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹æ“ä½œ"})]})]})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"bg-[color:var(--tab-surface-muted)] rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:"æ ‡é¢˜"}),e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:a.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:"åˆ›å»ºæ—¶é—´"}),e.jsx("div",{className:"text-sm text-[var(--tab-text)]",children:(N=a.created_at,new Date(N).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),a.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-1",children:"æè¿°"}),e.jsx("div",{className:"text-sm text-[var(--tab-text)]",children:a.description})]}),a.tags.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mb-2",children:"ç°æœ‰æ ‡ç­¾"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(t=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[color:var(--tab-message-info-icon-bg)] text-[var(--tab-message-info-icon)]",style:t.color?{backgroundColor:`${t.color}20`,color:t.color}:void 0,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-[var(--tab-text-muted)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-[var(--tab-text)]",children:a.has_snapshot?`å·²æœ‰ ${a.snapshot_count||0} ä¸ªå¿«ç…§`:"æš‚æ— å¿«ç…§"})]}),a.has_snapshot&&d&&e.jsxs("a",{href:`${d}/bookmarks/${a.id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-[var(--tab-message-info-icon)] hover:opacity-90 hover:bg-[color:var(--tab-message-info-icon-bg)] rounded transition-colors",onClick:e=>e.stopPropagation(),children:["æŸ¥çœ‹å¿«ç…§",e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})]}),y&&e.jsxs("div",{className:"bg-[color:var(--tab-message-success-bg)] border border-[color:var(--tab-message-success-border)] rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-[var(--tab-message-success-icon)] mb-2",children:"æ£€æµ‹åˆ°æ–°æ ‡ç­¾"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(t=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[color:var(--tab-message-success-icon-bg)] text-[var(--tab-message-success-icon)]",children:t},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)] mb-3",children:"è¯·é€‰æ‹©æ“ä½œï¼š"}),e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("snapshot"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"snapshot",checked:"snapshot"===i,onChange:()=>c("snapshot"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:"åˆ›å»ºæ–°å¿«ç…§"}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:"ä¸ºè¿™ä¸ªä¹¦ç­¾ä¿å­˜å½“å‰é¡µé¢çš„å¿«ç…§"})]})]}),y&&e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("update-tags"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"update-tags",checked:"update-tags"===i,onChange:()=>c("update-tags"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:"æ·»åŠ æ–°æ ‡ç­¾"}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:"å°†æ–°æ ‡ç­¾æ·»åŠ åˆ°ç°æœ‰ä¹¦ç­¾"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all "+("update-description"===i?"border-[color:var(--tab-message-info-icon)] bg-[color:var(--tab-message-info-bg)]":"border-[color:var(--tab-border)] hover:border-[color:var(--tab-border-strong)]"),children:[e.jsx("input",{type:"radio",name:"action",value:"update-description",checked:"update-description"===i,onChange:()=>c("update-description"),className:"mt-0.5 w-4 h-4 text-[var(--tab-message-info-icon)] focus:ring-[var(--tab-message-info-icon)]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-[var(--tab-text)]",children:"æ›´æ–°æè¿°"}),e.jsx("div",{className:"text-xs text-[var(--tab-text-muted)] mt-1",children:"ä¿®æ”¹ä¹¦ç­¾çš„æè¿°ä¿¡æ¯"}),"update-description"===i&&e.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"è¾“å…¥æ–°çš„æè¿°...",rows:3,className:"mt-2 w-full rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-2 text-sm text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] resize-none",onClick:e=>e.stopPropagation()})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-[color:var(--tab-surface-muted)] border-t border-[color:var(--tab-border)] px-6 py-4 rounded-b-xl flex gap-3",children:[e.jsx("button",{onClick:l,disabled:b,className:"flex-1 px-4 py-2.5 text-sm font-medium text-[var(--tab-text)] bg-[color:var(--tab-surface)] border border-[color:var(--tab-border-strong)] rounded-lg hover:bg-[color:var(--tab-surface-muted)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:async()=>{if("snapshot"===i){x(!0),v("æ­£åœ¨æ•è·é¡µé¢å†…å®¹...");try{await n(),v("å¿«ç…§åˆ›å»ºæˆåŠŸï¼"),setTimeout(()=>{x(!1),l()},1500)}catch(e){v("å¿«ç…§åˆ›å»ºå¤±è´¥"),setTimeout(()=>{x(!1)},2e3)}}else if("update-tags"===i){x(!0),v("æ­£åœ¨æ›´æ–°æ ‡ç­¾...");try{await s(r),v("æ ‡ç­¾æ›´æ–°æˆåŠŸï¼"),setTimeout(()=>{x(!1),l()},1500)}catch(e){v("æ ‡ç­¾æ›´æ–°å¤±è´¥"),setTimeout(()=>{x(!1)},2e3)}}else if("update-description"===i){x(!0),v("æ­£åœ¨æ›´æ–°æè¿°...");try{await o(h.trim()),v("æè¿°æ›´æ–°æˆåŠŸï¼"),setTimeout(()=>{x(!1),l()},1500)}catch(e){v("æè¿°æ›´æ–°å¤±è´¥"),setTimeout(()=>{x(!1)},2e3)}}},disabled:!i||b,className:"flex-1 px-4 py-2.5 text-sm font-medium text-[var(--tab-popup-primary-text)] bg-[var(--tab-popup-primary-from)] rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b?"å¤„ç†ä¸­...":"ç¡®è®¤"})]})]})]});var N}const T=[{id:"bookmark",title:"ä¿å­˜ä¹¦ç­¾",description:"ä¸ºå½“å‰é¡µé¢ç”Ÿæˆ AI æ ‡ç­¾å¹¶ä¿å­˜åˆ°ä¹¦ç­¾åº“",icon:e.jsx("svg",{className:"h-7 w-7 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),gradient:"from-blue-500 to-indigo-500",shadowColor:"shadow-blue-500/30",hoverBorder:"hover:border-blue-300",hoverArrow:"group-hover:text-blue-500",tags:[{text:"AI æ¨è",bg:"bg-blue-50",color:"text-blue-600"},{text:"æ™ºèƒ½æ ‡ç­¾",bg:"bg-indigo-50",color:"text-indigo-600"},{text:"äº‘ç«¯åŒæ­¥",bg:"bg-purple-50",color:"text-purple-600"}]},{id:"newtab",title:"ä¿å­˜åˆ° NewTab",description:"ä¿å­˜å½“å‰é¡µé¢åˆ°æµè§ˆå™¨ä¹¦ç­¾ï¼ˆNewTab åŒå‘åŒæ­¥ï¼‰",icon:e.jsx("svg",{className:"h-7 w-7 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),gradient:"from-amber-500 to-orange-500",shadowColor:"shadow-amber-500/30",hoverBorder:"hover:border-amber-300",hoverArrow:"group-hover:text-amber-500",tags:[{text:"æ–‡ä»¶å¤¹",bg:"bg-amber-50",color:"text-amber-600"},{text:"ä¹¦ç­¾æ ",bg:"bg-orange-50",color:"text-orange-600"},{text:"æœ¬åœ°åŒæ­¥",bg:"bg-yellow-50",color:"text-yellow-600"}]},{id:"tabCollection",title:"æ”¶çº³æ ‡ç­¾é¡µ",description:"ä¸€é”®æ”¶çº³å½“å‰çª—å£æ‰€æœ‰æ ‡ç­¾é¡µï¼Œé‡Šæ”¾å†…å­˜",icon:e.jsx("svg",{className:"h-7 w-7 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),gradient:"from-emerald-500 to-teal-500",shadowColor:"shadow-emerald-500/30",hoverBorder:"hover:border-emerald-300",hoverArrow:"group-hover:text-emerald-500",tags:[{text:"æ‰¹é‡æ”¶çº³",bg:"bg-emerald-50",color:"text-emerald-600"},{text:"ä¸€é”®æ¢å¤",bg:"bg-teal-50",color:"text-teal-600"},{text:"èŠ‚çœå†…å­˜",bg:"bg-cyan-50",color:"text-cyan-600"}]}];function E({onSelectBookmark:a,onSelectNewTab:r,onSelectTabCollection:s,onOpenOptions:o}){const[n,l]=t.useState(new Date),[i,p]=t.useState(v()),[b,x]=t.useState(0),u=t.useRef(null),h=t.useRef(0),f=t.useRef(0),j=T.length;t.useEffect(()=>{const e=setInterval(()=>{l(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{(async()=>{const e=await m.getTMarksConfig();if(e?.bookmarkApiUrl){const t=e.bookmarkApiUrl.replace(/\/api\/?$/,"");p(v(t))}})()},[]),t.useEffect(()=>{(async()=>{const e=await m.loadConfig();c(e?.preferences?.theme??"auto"),d(e?.preferences?.themeStyle??"tmarks")})()},[]);return e.jsx("div",{className:"relative h-[80vh] min-h-[580px] w-[380px] overflow-hidden bg-white text-gray-900",children:e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"px-5 pt-5 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 shadow-lg shadow-blue-500/40",children:e.jsx("svg",{className:"h-5 w-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})})}),e.jsx("h1",{className:"text-lg font-bold text-gray-800",children:"AI æ ‡ç­¾åŠ©æ‰‹"})]}),e.jsx("button",{onClick:o,className:"flex h-9 w-9 items-center justify-center rounded-lg text-gray-600 transition-all duration-200 hover:bg-gray-100 active:scale-95",title:"æ‰“å¼€è®¾ç½®",children:e.jsxs("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden px-5 pb-[50px]",children:[e.jsxs("section",{className:"rounded-xl border border-gray-200 bg-white p-3 shadow-lg mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-gray-800",children:[e.jsx("span",{className:"text-xs font-semibold",children:(e=>{const t=e.getHours();return t>=5&&t<12?"æ—©ä¸Šå¥½":t>=12&&t<14?"ä¸­åˆå¥½":t>=14&&t<18?"ä¸‹åˆå¥½":t>=18&&t<22?"æ™šä¸Šå¥½":"å¤œæ·±äº†"})(n)}),e.jsx("span",{className:"font-mono text-base font-bold tracking-wider",children:(y=n,`${String(y.getHours()).padStart(2,"0")}:${String(y.getMinutes()).padStart(2,"0")}:${String(y.getSeconds()).padStart(2,"0")}`)})]}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{children:(e=>`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ ${["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"][e.getDay()]}`)(n)}),e.jsx("span",{className:"text-[10px] text-gray-500",children:(e=>{const t=g.Lunar.fromDate(e);return`${t.getYearInGanZhi()}${t.getYearShengXiao()}å¹´${t.getMonthInChinese()}æœˆ${t.getDayInChinese()}`})(n)})]})]}),e.jsx("div",{ref:u,className:"flex-1 relative overflow-hidden",onTouchStart:e=>{h.current=e.touches[0].clientX},onTouchMove:e=>{f.current=e.touches[0].clientX},onTouchEnd:()=>{const e=h.current-f.current;e>50&&b<j-1?x(e=>e+1):e<-50&&b>0&&x(e=>e-1)},onWheel:e=>{Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(e.deltaX>30&&b<j-1?x(e=>e+1):e.deltaX<-30&&b>0&&x(e=>e-1))},children:e.jsx("div",{className:"flex h-full transition-transform duration-300 ease-out",style:{transform:`translateX(-${100*b}%)`},children:T.map(t=>e.jsx("div",{className:"w-full flex-shrink-0 px-1",children:e.jsx("button",{onClick:()=>{var e;"bookmark"===(e=t.id)?a():"newtab"===e?r():"tabCollection"===e&&s()},className:`group w-full h-full rounded-2xl border border-gray-200 bg-white p-5 text-left shadow-lg transition-all duration-300 hover:scale-[1.02] ${t.hoverBorder} hover:shadow-xl active:scale-[0.98]`,children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`flex h-20 w-20 items-center justify-center rounded-[22px] bg-gradient-to-br ${t.gradient} shadow-xl ${t.shadowColor} transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3`,children:t.icon}),e.jsx("h2",{className:"mt-4 text-lg font-semibold text-gray-800",children:t.title}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 leading-relaxed",children:t.description}),e.jsx("div",{className:"mt-4 flex flex-wrap justify-center gap-2",children:t.tags.map((t,a)=>e.jsx("span",{className:`rounded-full ${t.bg} px-3 py-1 text-xs font-medium ${t.color}`,children:t.text},a))}),e.jsx("div",{className:"mt-auto pt-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs text-gray-400 transition-colors ${t.hoverArrow}`,children:["ç‚¹å‡»è¿›å…¥",e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})})]})})},t.id))})}),e.jsx("div",{className:"flex justify-center gap-2 py-3",children:T.map((t,a)=>e.jsx("button",{onClick:()=>x(a),className:"h-2 rounded-full transition-all duration-300 "+(a===b?"w-6 bg-gray-800":"w-2 bg-gray-300 hover:bg-gray-400"),"aria-label":`åˆ‡æ¢åˆ°ç¬¬ ${a+1} é¡µ`},a))}),e.jsxs("section",{className:"rounded-xl border border-gray-200 bg-gradient-to-br from-purple-50 to-blue-50 p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-1.5 text-xs font-semibold text-gray-700",children:[e.jsx("span",{children:"ğŸ’¡"}),e.jsx("span",{children:"å°è´´å£«"})]}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"å·¦å³æ»‘åŠ¨åˆ‡æ¢"})]}),e.jsxs("p",{className:"mt-1.5 text-[11px] text-gray-500 leading-relaxed",children:[0===b&&"ä¿å­˜ä¹¦ç­¾ï¼šé€‚åˆæ”¶è—é‡è¦ç½‘é¡µï¼Œæ”¯æŒ AI æ™ºèƒ½æ ‡ç­¾æ¨è",1===b&&"ä¿å­˜åˆ° NewTabï¼šå¿«é€Ÿä¿å­˜åˆ°æµè§ˆå™¨ä¹¦ç­¾ï¼Œä¸ NewTab åŒå‘åŒæ­¥",2===b&&"æ”¶çº³æ ‡ç­¾é¡µï¼šä¸€é”®æ”¶çº³æ‰€æœ‰æ ‡ç­¾é¡µï¼Œé‡Šæ”¾å†…å­˜ï¼Œéšæ—¶æ¢å¤"]})]})]}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-20 p-2 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>chrome.tabs.create({url:i.WEB_APP}),className:"flex-1 flex items-center justify-center py-2.5 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 transition-colors shadow-sm",children:e.jsx("span",{className:"text-sm text-gray-700",children:"æˆ‘çš„ä¹¦ç­¾"})}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:i.TAB_GROUPS}),className:"flex-1 flex items-center justify-center py-2.5 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 transition-colors shadow-sm",children:e.jsx("span",{className:"text-sm text-gray-700",children:"æˆ‘çš„æ”¶çº³"})})]})})]})});var y}function B({tabCount:a,groups:r,onConfirm:l,onCancel:i,onCreateFolder:c}){const[d,p]=t.useState("new"),[b,x]=t.useState(""),[u,m]=t.useState("__new__"),[v,h]=t.useState(""),[g,f]=t.useState(""),[j,y]=t.useState(!1),N=r.filter(e=>1===e.is_folder),w=r.filter(e=>0===e.is_folder);t.useEffect(()=>{"existing"===d&&w.length>0&&!b&&x(w[0].id),"folder"===d&&(N.length>0&&!u?m(N[0].id):0===N.length&&m("__new__"))},[d,w,N,b,u]);return e.jsx("div",{className:"fixed inset-0 bg-[color:var(--tab-overlay)] flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[color:var(--tab-surface)] rounded-2xl shadow-2xl w-full max-w-[680px] max-h-[520px] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-[color:var(--tab-border)] bg-[color:var(--tab-message-info-bg)]",children:[e.jsx("h2",{className:"text-base font-bold text-[var(--tab-text)]",children:"æ”¶çº³æ ‡ç­¾é¡µ"}),e.jsxs("p",{className:"text-xs text-[var(--tab-text-muted)] mt-0.5",children:["å·²é€‰æ‹© ",e.jsx("span",{className:"font-semibold text-[var(--tab-message-info-icon)]",children:a})," ä¸ªæ ‡ç­¾é¡µ"]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-14 border-r border-[color:var(--tab-border)] bg-[color:var(--tab-surface-muted)] py-3 flex flex-col items-center space-y-2 overflow-y-auto",children:[e.jsx("button",{onClick:()=>p("new"),title:"åˆ›å»ºæ–°åˆ†ç»„",className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("new"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(s,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p("existing"),disabled:0===w.length,title:0===w.length?"æš‚æ— å¯ç”¨åˆ†ç»„":"æ·»åŠ åˆ°ç°æœ‰åˆ†ç»„",className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("existing"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":0===w.length?"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] opacity-50 cursor-not-allowed":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(o,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p("folder"),disabled:0===N.length,title:0===N.length?"æš‚æ— å¯ç”¨æ–‡ä»¶å¤¹":"æ”¾å…¥æ–‡ä»¶å¤¹",className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all "+("folder"===d?"bg-[var(--tab-popup-primary-from)] text-[var(--tab-popup-primary-text)] shadow-md":0===N.length?"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] opacity-50 cursor-not-allowed":"bg-[color:var(--tab-surface)] text-[var(--tab-text-muted)] hover:bg-[color:var(--tab-surface-muted)] hover:text-[var(--tab-text)] border border-[color:var(--tab-border)]"),children:e.jsx(n,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 p-5 overflow-y-auto bg-[color:var(--tab-surface)]",children:["new"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:"åˆ›å»ºæ–°åˆ†ç»„"}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:"å°†é€‰ä¸­çš„æ ‡ç­¾é¡µä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„åˆ†ç»„"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:"åˆ†ç»„åç§°ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",placeholder:"ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³åç§°",value:v,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]})]}),"existing"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:"æ·»åŠ åˆ°ç°æœ‰åˆ†ç»„"}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:"å°†æ ‡ç­¾é¡µæ·»åŠ åˆ°å·²æœ‰çš„åˆ†ç»„ä¸­"})]}),w.length>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:"é€‰æ‹©ç›®æ ‡åˆ†ç»„"}),e.jsx("select",{value:b,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent bg-[color:var(--tab-surface)] text-[var(--tab-text)]",children:w.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",t.item_count||0," é¡¹)"]},t.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-center",children:[e.jsx(o,{className:"w-10 h-10 text-[var(--tab-text-muted)] mb-2"}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)]",children:"æš‚æ— å¯ç”¨åˆ†ç»„"}),e.jsx("p",{className:"text-[10px] text-[var(--tab-text-muted)] mt-0.5",children:"è¯·å…ˆåˆ›å»ºä¸€ä¸ªåˆ†ç»„"})]})]}),"folder"===d&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)] mb-1.5",children:"æ”¾å…¥æ–‡ä»¶å¤¹"}),e.jsx("p",{className:"text-xs text-[var(--tab-text-muted)] mb-3",children:"åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–°åˆ†ç»„"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:"é€‰æ‹©æ–‡ä»¶å¤¹"}),e.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent bg-[color:var(--tab-surface)] text-[var(--tab-text)]",children:[e.jsx("option",{value:"__new__",children:"+ æ–°å»ºæ–‡ä»¶å¤¹"}),N.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),"__new__"===u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:"æ–‡ä»¶å¤¹åç§°"}),e.jsx("input",{type:"text",placeholder:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°",value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--tab-text)] mb-1.5",children:"æ–°åˆ†ç»„åç§°ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",placeholder:"ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³åç§°",value:v,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-[color:var(--tab-border-strong)] rounded-lg text-xs bg-[color:var(--tab-surface)] text-[var(--tab-text)] placeholder:text-[var(--tab-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-message-info-icon)] focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"px-5 py-3 border-t border-[color:var(--tab-border)] bg-[color:var(--tab-surface-muted)] flex justify-end space-x-2.5",children:[e.jsx("button",{onClick:i,disabled:j,className:"px-4 py-2 text-xs font-medium text-[var(--tab-text)] bg-[color:var(--tab-surface)] border border-[color:var(--tab-border-strong)] rounded-lg hover:bg-[color:var(--tab-surface-muted)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:async()=>{const e={mode:d};if("existing"===d){if(!b)return void alert("è¯·é€‰æ‹©ä¸€ä¸ªåˆ†ç»„");e.targetId=b}else if("folder"===d)if("__new__"===u){const a=g.trim();if(!a)return void alert("è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°");if(!c)return void alert("åˆ›å»ºæ–‡ä»¶å¤¹åŠŸèƒ½ä¸å¯ç”¨");try{y(!0);const t=await c(a);e.mode="folder",e.targetId=t.id,e.title=v.trim()||void 0}catch(t){return void alert("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼š"+(t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯"))}finally{y(!1)}}else{if(!u)return void alert("è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹");e.targetId=u,e.title=v.trim()||void 0}else e.title=v.trim()||void 0;l(e)},disabled:j,className:"px-4 py-2 text-xs font-medium text-[var(--tab-popup-primary-text)] bg-[var(--tab-popup-primary-from)] rounded-lg hover:opacity-90 shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:j?"åˆ›å»ºä¸­...":"ç¡®è®¤æ”¶çº³"})]})]})})}function A({config:a,onBack:r}){const[s,o]=t.useState([]),[n,l]=t.useState(new Set),[i,c]=t.useState(!0),[d,u]=t.useState(!1),[m,v]=t.useState(null),[g,w]=t.useState(null),[k,C]=t.useState(!1),[S,L]=t.useState([]),[M,T]=t.useState(!1),[E,A]=t.useState([]);t.useEffect(()=>{I(),z()},[]);const I=async()=>{try{c(!0);const e=(await f()).filter(e=>e.id&&e.url&&!e.url.startsWith("chrome://")&&!e.url.startsWith("chrome-extension://")).map(e=>({id:e.id,title:e.title||"Untitled",url:e.url,favIconUrl:e.favIconUrl}));o(e),l(new Set(e.map(e=>e.id)))}catch(e){v("åŠ è½½æ ‡ç­¾é¡µå¤±è´¥")}finally{c(!1)}},z=async()=>{try{const e=N({baseUrl:h(a.apiUrl),apiKey:a.apiKey}),t=await e.tabGroups.getAllTabGroups();A(t)}catch(e){A([])}};return e.jsxs("div",{className:"relative h-[80vh] min-h-[620px] w-[380px] overflow-hidden rounded-b-2xl bg-[color:var(--tab-popup-bg)] text-[var(--tab-text)] shadow-2xl",children:[M&&e.jsx(B,{tabCount:n.size,groups:E,onConfirm:async e=>{T(!1),u(!0),v(null);try{const t=await j(a,n,e);t.success?(w(t.message||"æ”¶çº³æˆåŠŸ"),L(Array.from(n)),C(!0)):v(t.error||"æ”¶çº³å¤±è´¥")}catch(t){v(t instanceof Error?t.message:"æ”¶çº³å¤±è´¥")}finally{u(!1)}},onCancel:()=>T(!1),onCreateFolder:async e=>{try{const t=N({baseUrl:h(a.apiUrl),apiKey:a.apiKey}),r=(await t.tabGroups.createFolder(e)).data.tab_group;return A([...E,r]),r}catch(t){throw new Error(t instanceof Error?t.message:"åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥")}}}),e.jsxs("div",{className:"pointer-events-none fixed top-0 left-0 right-0 z-50 px-4 pt-2 space-y-2",children:[m&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(p,{message:m,onDismiss:()=>v(null)})}),g&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(b,{message:g,onDismiss:()=>w(null)})})]}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-20 px-3 pt-2 pb-2.5 bg-[color:var(--tab-surface)] border-b border-[color:var(--tab-border)] shadow-sm rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-lg text-[var(--tab-text-muted)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",title:"è¿”å›",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[color:var(--tab-message-success-bg)] px-2 py-1 text-[10px] text-[var(--tab-message-success-icon)] font-medium",children:["å…± ",s.length," ä¸ª"]}),e.jsxs("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[color:var(--tab-message-success-bg)] px-2 py-1 text-[10px] text-[var(--tab-message-success-icon)] font-medium",children:["å·²é€‰ ",n.size," ä¸ª"]}),e.jsxs("div",{className:"ml-auto flex gap-1.5",children:[e.jsx("button",{onClick:r,className:"rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{0!==n.size?T(!0):v("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ ‡ç­¾é¡µ")},disabled:d||0===n.size,className:"rounded-lg border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:"é€‰é¡¹"}),e.jsx("button",{onClick:async()=>{if(0!==n.size){u(!0),v(null);try{const e=await j(a,n);e.success?(w(e.message||"æ”¶çº³æˆåŠŸ"),L(Array.from(n)),C(!0)):v(e.error||"æ”¶çº³å¤±è´¥")}catch(e){v(e instanceof Error?e.message:"æ”¶çº³å¤±è´¥")}finally{u(!1)}}else v("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ ‡ç­¾é¡µ")},disabled:d||0===n.size,className:"rounded-lg px-4 py-1.5 text-[11px] font-semibold shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",style:{background:"linear-gradient(90deg, var(--tab-popup-success-from), var(--tab-popup-success-to))",color:"var(--tab-popup-success-text)"},children:d?e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24",style:{color:"var(--tab-popup-success-text)"},children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"æ”¶çº³ä¸­"]}):"æ”¶çº³"})]})]})}),k&&e.jsx("div",{className:"fixed top-[60px] left-0 right-0 z-40 px-4 pt-2 animate-in slide-in-from-top-5 fade-in duration-300",children:e.jsxs("section",{className:"rounded-2xl border border-[color:var(--tab-message-success-border)] p-4 shadow-lg",style:{background:"linear-gradient(135deg, var(--tab-message-success-bg), var(--tab-message-success-icon-bg))"},children:[e.jsxs("div",{className:"mb-3 flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-[color:var(--tab-message-success-icon-bg)]",children:e.jsx("svg",{className:"h-5 w-5 text-[var(--tab-message-success-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--tab-text)]",children:"æ”¶çº³æˆåŠŸ"}),e.jsxs("p",{className:"mt-1 text-xs text-[var(--tab-text-muted)]",children:["å·²æˆåŠŸæ”¶çº³ ",S.length," ä¸ªæ ‡ç­¾é¡µã€‚æ˜¯å¦å…³é—­è¿™äº›æ ‡ç­¾é¡µï¼Ÿ"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{C(!1),L([]),window.close()},className:"flex-1 rounded-xl border border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)] px-4 py-2 text-sm font-medium text-[var(--tab-text)] transition-all duration-200 hover:bg-[color:var(--tab-surface-muted)] active:scale-95",children:"ä¿ç•™æ ‡ç­¾é¡µ"}),e.jsx("button",{onClick:async()=>{try{await y(S),window.close()}catch(e){v("å…³é—­æ ‡ç­¾é¡µå¤±è´¥")}},className:"flex-1 rounded-xl px-4 py-2 text-sm font-semibold shadow-sm transition-all duration-200 hover:shadow-md active:scale-95",style:{background:"linear-gradient(90deg, var(--tab-popup-success-from), var(--tab-popup-success-to))",color:"var(--tab-popup-success-text)"},children:"å…³é—­æ ‡ç­¾é¡µ"})]})]})}),e.jsx("main",{className:"relative flex-1 space-y-3 overflow-y-auto px-4 pb-5 bg-[color:var(--tab-popup-bg)] "+(k?"pt-[180px]":"pt-[60px]"),children:i?e.jsxs("section",{className:"flex items-center gap-3 rounded-2xl border border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] p-4 text-sm text-[var(--tab-text)] shadow-sm",children:[e.jsx(x,{}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½æ ‡ç­¾é¡µ..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"rounded-2xl border border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] p-3 shadow-sm",children:e.jsxs("button",{onClick:()=>{n.size===s.length?l(new Set):l(new Set(s.map(e=>e.id)))},className:"flex w-full items-center justify-between rounded-xl bg-[color:var(--tab-surface-muted)] px-4 py-2 text-sm font-medium text-[var(--tab-text)] transition-all duration-200 hover:opacity-90 active:scale-95",children:[e.jsx("span",{children:n.size===s.length?"å–æ¶ˆå…¨é€‰":"å…¨é€‰"}),e.jsxs("span",{className:"text-xs text-[var(--tab-text-muted)]",children:[n.size," / ",s.length]})]})}),e.jsx("section",{className:"space-y-2",children:s.map(t=>{const a=n.has(t.id);return e.jsx("button",{onClick:()=>(e=>{const t=new Set(n);t.has(e)?t.delete(e):t.add(e),l(t)})(t.id),className:"group w-full rounded-2xl border p-3 text-left transition-all duration-200 active:scale-[0.98] "+(a?"border-[color:var(--tab-message-success-border)] bg-[color:var(--tab-message-success-bg)] shadow-md":"border-[color:var(--tab-border)] bg-[color:var(--tab-surface)] hover:bg-[color:var(--tab-surface-muted)]"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 flex h-5 w-5 items-center justify-center rounded-md border-2 transition-all duration-200 "+(a?"border-[color:var(--tab-popup-success-from)] bg-[color:var(--tab-popup-success-from)]":"border-[color:var(--tab-border-strong)] bg-[color:var(--tab-surface)]"),children:a&&e.jsx("svg",{className:"h-3 w-3 text-[var(--tab-popup-success-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),t.favIconUrl&&e.jsx("img",{src:t.favIconUrl,alt:"",className:"h-5 w-5 rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-[var(--tab-text)]",children:t.title}),e.jsx("p",{className:"truncate text-xs text-[var(--tab-text-muted)]",children:t.url})]})]})},t.id)})})]})})]})]})}async function I(e){return new Promise((t,a)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):e?.success?t(e.data):a(new Error(e?.error||"Unknown error"))})})}function z(){const{currentPage:a,recommendedTags:r,existingTags:s,selectedTags:o,isLoading:n,isSaving:l,isRecommending:i,error:m,successMessage:v,loadingMessage:h,existingBookmark:g,config:f,loadConfig:j,loadExistingTags:y,extractPageInfo:N,recommendTags:T,saveBookmark:B,setError:z,setSuccessMessage:_,setLoadingMessage:W,toggleTag:$,addCustomTag:D,setCurrentPage:F,includeThumbnail:P,setIncludeThumbnail:U,isPublic:H,setIsPublic:V,createSnapshot:K,setCreateSnapshot:R,setExistingBookmark:O,updateExistingBookmarkTags:X,updateExistingBookmarkDescription:G,createSnapshotForBookmark:Y,lastRecommendationSource:Z,lastSaveDurationMs:q}=u(),[J,Q]=t.useState(null),[ee,te]=t.useState([]),[ae,re]=t.useState(null),[se,oe]=t.useState([]),[ne,le]=t.useState([]),[ie,ce]=t.useState(!1),[de,pe]=t.useState(!1),[be,xe]=t.useState(null),[ue,me]=t.useState(""),[ve,he]=t.useState(""),[ge,fe]=t.useState(""),[je,ye]=t.useState(!1),[Ne,we]=t.useState("selector"),[ke,Ce]=t.useState(!1),[Se,Le]=t.useState(!1),Me=f?.preferences?.tagTheme??"classic";t.useEffect(()=>{he(a?.title??"")},[a?.title]),t.useEffect(()=>{fe(a?.description??"")},[a?.description]),t.useEffect(()=>{j(),y()},[]),t.useEffect(()=>{c(f?.preferences?.theme??"auto")},[f?.preferences?.theme]),t.useEffect(()=>{d(f?.preferences?.themeStyle??"tmarks")},[f?.preferences?.themeStyle]);const Te=Boolean(f&&f.bookmarkSite.apiKey),Ee=Boolean(f&&f.preferences.enableAI&&f.aiConfig.apiKeys[f.aiConfig.provider]);t.useEffect(()=>{if(!f||je||"bookmark"!==Ne)return;(async()=>{if(Te)try{await N();f.preferences.enableAI&&Boolean(f.aiConfig.apiKeys[f.aiConfig.provider])&&await T(),ye(!0)}catch(e){z(e instanceof Error?e.message:"Failed to initialize"),ye(!0)}else ye(!0)})()},[f,Ne]),t.useEffect(()=>{if(je||"newtab"!==Ne)return;(async()=>{try{await N(),await Ae()}catch(e){z(e instanceof Error?e.message:"Failed to initialize")}finally{ye(!0)}})()},[je,Ne]);const Be=()=>{const e=ue.trim();e&&(D(e),me(""))},Ae=async()=>{try{xe(null);const e=await I({type:"GET_NEWTAB_FOLDERS"});Q(e.rootId),te(e.folders),re(e.rootId);const t=e.folders.find(t=>t.id===e.rootId);oe(t?[{id:t.id,title:t.title}]:[]),pe(!0)}catch(e){pe(!1),xe(e instanceof Error?e.message:"åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥"),Q(null),te([]),re(null),oe([])}},Ie=e=>{const t=ee.find(t=>t.id===e);if(!t)return;re(e);const a=[];let r=t;const s=new Set;for(;r&&!s.has(r.id);)s.add(r.id),a.push({id:r.id,title:r.title}),r=r.parentId?ee.find(e=>e.id===r.parentId):void 0;oe(a.reverse())},ze=()=>{const e=ve.trim();e&&a&&(F({...a,title:e}),he(e))},_e=()=>{if(!a)return;const e=ge.trim();F({...a,description:e||void 0}),fe(e)},We=()=>{chrome.runtime.openOptionsPage()},$e=()=>{we("bookmark"),ye(!1)},De=()=>{we("tabCollection")},Fe=()=>{we("newtab"),ye(!1)},Pe=()=>{we("selector")};return"selector"===Ne?e.jsx(E,{onSelectBookmark:$e,onSelectNewTab:Fe,onSelectTabCollection:De,onOpenOptions:We}):"tabCollection"===Ne?f?e.jsx(A,{config:f.bookmarkSite,onBack:Pe}):e.jsx("div",{children:"Loading..."}):je&&!Te?e.jsxs("div",{className:"relative h-[80vh] min-h-[580px] w-[380px] overflow-hidden rounded-2xl bg-[var(--tab-popup-onboarding-bg)] text-[var(--tab-popup-primary-text)] shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tab-popup-onboarding-radial-top),transparent_70%)] opacity-80"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_bottom,_var(--tab-popup-onboarding-radial-bottom),transparent_65%)] opacity-80"}),e.jsx("div",{className:"absolute inset-0 bg-[color:var(--tab-popup-onboarding-overlay)] backdrop-blur-2xl"}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"px-6 pt-8 pb-6",children:e.jsx("div",{className:"rounded-3xl border border-[color:var(--tab-popup-onboarding-card-border)] bg-[color:var(--tab-popup-onboarding-card-bg)] p-5 shadow-xl shadow-[color:var(--tab-popup-onboarding-shadow)] backdrop-blur-xl",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] shadow-lg shadow-[color:var(--tab-popup-primary-shadow-strong)]",children:e.jsx("svg",{className:"h-6 w-6 text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-[color:var(--tab-popup-onboarding-label)]",children:"Onboarding"}),e.jsx("h1",{className:"text-2xl font-semibold text-[var(--tab-popup-primary-text)]",children:"æ¬¢è¿ä½¿ç”¨ AI ä¹¦ç­¾åŠ©æ‰‹"}),e.jsx("p",{className:"text-sm text-[color:var(--tab-popup-onboarding-desc)]",children:"å®ŒæˆåŸºç¡€é…ç½®ï¼Œå³å¯ä¸ºä»»æ„ç½‘é¡µç”Ÿæˆæ™ºèƒ½æ ‡ç­¾ä¸åˆ†ç±»å»ºè®®ã€‚"})]})]})})}),e.jsxs("main",{className:"flex-1 space-y-5 overflow-y-auto px-6 pb-6",children:[e.jsxs("section",{className:"rounded-3xl border border-[color:var(--tab-popup-onboarding-card-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-5 shadow-inner shadow-[color:var(--tab-popup-onboarding-shadow)] backdrop-blur-xl",children:[e.jsx("h2",{className:"text-sm font-semibold text-[var(--tab-popup-primary-text)]",children:"å¿…å¤‡ä¿¡æ¯"}),e.jsx("p",{className:"mt-1 text-xs text-[color:var(--tab-popup-onboarding-label)]",children:"å‡†å¤‡ä»¥ä¸‹ä¸‰é¡¹é…ç½®ï¼ŒåŠ©æ‰‹å³å¯ç«‹å³å¼€å§‹å·¥ä½œï¼š"}),e.jsxs("ol",{className:"mt-4 space-y-3 text-xs text-[color:var(--tab-popup-onboarding-desc)]",children:[e.jsxs("li",{className:"flex gap-3 rounded-2xl border border-[color:var(--tab-popup-onboarding-subtle-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-3",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-xl bg-[color:var(--tab-popup-onboarding-tip-bg)] text-[11px] font-semibold text-[var(--tab-popup-onboarding-tip-text)]",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--tab-popup-primary-text)]",children:"AI æœåŠ¡ API Key"}),e.jsx("p",{className:"mt-1 text-[11px] text-[color:var(--tab-popup-onboarding-label)]",children:"ç”¨äºç”Ÿæˆæ™ºèƒ½æ ‡ç­¾çš„æ¨¡å‹å‡­è¯ï¼Œæ”¯æŒå¤šä¸ªä¸»æµæœåŠ¡å•†ã€‚"})]})]}),e.jsxs("li",{className:"flex gap-3 rounded-2xl border border-[color:var(--tab-popup-onboarding-subtle-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-3",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-xl bg-[color:var(--tab-popup-onboarding-tip-bg)] text-[11px] font-semibold text-[var(--tab-popup-onboarding-tip-text)]",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--tab-popup-primary-text)]",children:"ä¹¦ç­¾ç«™ç‚¹ API åœ°å€"}),e.jsx("p",{className:"mt-1 text-[11px] text-[color:var(--tab-popup-onboarding-label)]",children:"æŒ‡å‘ä½ çš„ä¹¦ç­¾æœåŠ¡ç«¯ç‚¹ï¼Œé»˜è®¤ä¸º TMarks å®˜æ–¹åœ°å€ã€‚"})]})]}),e.jsxs("li",{className:"flex gap-3 rounded-2xl border border-[color:var(--tab-popup-onboarding-subtle-border)] bg-[color:var(--tab-popup-onboarding-subtle-bg)] p-3",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-xl bg-[color:var(--tab-popup-onboarding-tip-bg)] text-[11px] font-semibold text-[var(--tab-popup-onboarding-tip-text)]",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--tab-popup-primary-text)]",children:"ä¹¦ç­¾ç«™ç‚¹ API Key"}),e.jsx("p",{className:"mt-1 text-[11px] text-[color:var(--tab-popup-onboarding-label)]",children:"ç”¨äºåŒæ­¥ä¸ä¿å­˜ä¹¦ç­¾æ•°æ®ï¼Œè¯·åœ¨æœåŠ¡ç«¯æ§åˆ¶å°ç”Ÿæˆå¯†é’¥ã€‚"})]})]})]})]}),e.jsxs("section",{className:"rounded-3xl border border-[color:var(--tab-popup-onboarding-card-border)] bg-gradient-to-br from-[color:var(--tab-popup-onboarding-tip-bg)] via-[color:var(--tab-popup-onboarding-tip-bg)] to-[color:var(--tab-popup-onboarding-tip-bg)] p-5 shadow-lg shadow-[color:var(--tab-popup-onboarding-shadow)] backdrop-blur-xl",children:[e.jsx("h2",{className:"text-sm font-semibold text-[var(--tab-popup-primary-text)]",children:"å°è´´å£«"}),e.jsxs("ul",{className:"mt-3 list-disc space-y-2 pl-5 text-[11px] text-[color:var(--tab-popup-onboarding-desc)]",children:[e.jsx("li",{children:"å¯åœ¨è®¾ç½®é¡µä¿å­˜å¤šä¸ª API ä¸æ¨¡å‹ç»„åˆï¼Œä¸€é”®åˆ‡æ¢åœºæ™¯ã€‚"}),e.jsx("li",{children:"æ”¯æŒè‡ªå®šä¹‰ Promptï¼Œæ»¡è¶³ä¸åŒæ ‡ç­¾é£æ ¼æˆ–è¯­è¨€éœ€æ±‚ã€‚"}),e.jsx("li",{children:"é…ç½®å®Œæˆåï¼ŒåŠ©æ‰‹ä¼šè‡ªåŠ¨æŠ“å–å½“å‰æ ‡ç­¾é¡µå¹¶ç”Ÿæˆæ¨èã€‚"})]})]})]}),e.jsx("footer",{className:"px-6 pb-6",children:e.jsxs("button",{onClick:We,className:"flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] via-[var(--tab-popup-primary-via)] to-[var(--tab-popup-primary-to)] px-6 py-3 text-sm font-semibold text-[var(--tab-popup-primary-text)] shadow-lg shadow-[color:var(--tab-popup-primary-shadow)] transition-all duration-200 hover:shadow-xl hover:shadow-[color:var(--tab-popup-primary-shadow-strong)] active:scale-95",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"å‰å¾€è®¾ç½®"]})})]})]}):e.jsxs("div",{className:"relative h-[80vh] min-h-[620px] w-[380px] overflow-hidden rounded-2xl bg-[var(--tab-popup-surface)] text-[var(--tab-popup-text)] shadow-2xl",children:[e.jsxs("div",{className:"pointer-events-none fixed top-0 left-0 right-0 z-50 px-4 pt-2 space-y-2",children:[m&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(p,{message:m,onDismiss:()=>z(null),onRetry:n||"fallback"!==Z?void 0:T})}),h&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(L,{message:h})}),v&&e.jsx("div",{className:"pointer-events-auto",children:e.jsx(b,{message:v})})]}),e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-20 px-3 pt-2 pb-2.5 bg-[var(--tab-popup-surface)] border-b border-[var(--tab-popup-border)] shadow-sm rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Pe,className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-lg text-[var(--tab-popup-text-muted)] transition-all duration-200 hover:bg-[var(--tab-popup-action-neutral-bg)] active:scale-95",title:"è¿”å›",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),"bookmark"===Ne&&Ee?e.jsxs("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[var(--tab-popup-badge-blue-bg)] px-2 py-1 text-[10px] text-[var(--tab-popup-badge-blue-text)] font-medium",children:["æ¨è ",r.length]}):"bookmark"===Ne?e.jsx("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[var(--tab-popup-badge-amber-bg)] px-2 py-1 text-[10px] text-[var(--tab-popup-badge-amber-text)] font-medium",children:"AI å…³é—­"}):null,"bookmark"===Ne&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[var(--tab-popup-badge-indigo-bg)] px-2 py-1 text-[10px] text-[var(--tab-popup-badge-indigo-text)] font-medium",children:["å·²é€‰ ",o.length]}),e.jsxs("span",{className:"inline-flex flex-shrink-0 items-center gap-1 rounded-full bg-[var(--tab-popup-badge-purple-bg)] px-2 py-1 text-[10px] text-[var(--tab-popup-badge-purple-text)] font-medium",children:["åº“ ",s.length]})]}),e.jsxs("div",{className:"ml-auto flex gap-1.5",children:[e.jsx("button",{onClick:()=>window.close(),className:"rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-1.5 text-[11px] font-medium text-[var(--tab-popup-text)] transition-all duration-200 hover:bg-[var(--tab-popup-action-neutral-bg)] active:scale-95",children:"å–æ¶ˆ"}),"bookmark"===Ne?e.jsx("button",{onClick:async()=>{0!==o.length?await B():z("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ ‡ç­¾")},disabled:l||0===o.length,className:"rounded-lg bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-[11px] font-semibold text-[var(--tab-popup-primary-text)] shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:l?e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 animate-spin text-[var(--tab-popup-primary-text)]",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ä¿å­˜ä¸­"]}):"ä¿å­˜ä¹¦ç­¾"}):e.jsx("button",{onClick:async()=>{if(a?.url)try{W("æ­£åœ¨å‡†å¤‡ä¿å­˜åˆ° NewTab...");let e=ae||void 0;de||(e=void 0);if(Boolean(f&&f.preferences.enableNewtabAI&&f.aiConfig.apiKeys[f.aiConfig.provider])&&de)try{W("AI æ­£åœ¨æ¨è NewTab æ–‡ä»¶å¤¹...");const t=await I({type:"RECOMMEND_NEWTAB_FOLDER",payload:{title:a.title,url:a.url,description:a.description}}),r=t?.suggestedFolders||[];le(r),r.length>0&&(e=r[0].id)}catch{}W("æ­£åœ¨ä¿å­˜åˆ° NewTab..."),await I({type:"SAVE_TO_NEWTAB",payload:{url:a.url,title:a.title,parentBookmarkId:e}}),W(null),_("âœ… å·²ä¿å­˜åˆ° NewTab"),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:`ã€Š${a.title}ã€‹å·²ä¿å­˜åˆ° NewTab`});const t="âœ… å·²ä¿å­˜åˆ° NewTab";setTimeout(()=>{u.getState().successMessage===t&&u.getState().setSuccessMessage(null)},2e3)}catch(e){W(null),z(e instanceof Error?e.message:"ä¿å­˜å¤±è´¥")}else z("æœªè·å–åˆ°é¡µé¢ä¿¡æ¯")},disabled:l||!a?.url,className:"rounded-lg bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-[11px] font-semibold text-[var(--tab-popup-primary-text)] shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:"ä¿å­˜åˆ° NewTab"})]})]})}),e.jsxs("main",{className:"relative flex-1 space-y-2.5 overflow-y-auto px-4 pb-[70px] pt-[60px] bg-[var(--tab-popup-bg)]",children:["newtab"===Ne&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:"ä¿å­˜åˆ° NewTab"}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-text-muted)]",children:"é€‰æ‹©æ–‡ä»¶å¤¹åä¿å­˜ï¼Œæˆ–ä½¿ç”¨ AI æ¨èã€‚"})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-blue-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-blue-badge-text)]",children:"NewTab"})]}),be&&e.jsx("div",{className:"mt-2 rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-2 text-xs text-[var(--tab-popup-text-muted)]",children:be}),se.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap items-center gap-1 text-xs text-[var(--tab-popup-text-muted)]",children:se.map((t,a)=>e.jsx("button",{onClick:()=>Ie(t.id),className:"rounded-md bg-[var(--tab-popup-action-neutral-bg)] px-2 py-1 hover:bg-[var(--tab-popup-action-neutral-bg-hover)] transition-colors",children:0===a?"æ ¹ç›®å½•":t.title},t.id))}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{if(a?.url)if(de)try{ce(!0);const e=await I({type:"RECOMMEND_NEWTAB_FOLDER",payload:{title:a.title,url:a.url,description:a.description}});le(e.suggestedFolders||[])}catch(e){z(e instanceof Error?e.message:"AI æ¨èå¤±è´¥")}finally{ce(!1)}else xe("ç›®å½•åˆ—è¡¨æœªåŠ è½½ï¼Œæš‚æ—¶æ— æ³•è¿›è¡Œ AI æ–‡ä»¶å¤¹æ¨èã€‚ä½ ä»å¯ç›´æ¥ä¿å­˜åˆ°æ ¹ç›®å½•ã€‚");else z("æœªè·å–åˆ°é¡µé¢ä¿¡æ¯")},disabled:ie||!a?.url||!de,className:"rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-2 text-xs font-medium text-[var(--tab-popup-text)] transition-all duration-200 hover:bg-[var(--tab-popup-action-neutral-bg)] disabled:opacity-40",children:ie?"AI æ¨èä¸­...":"AI æ¨èæ–‡ä»¶å¤¹"}),e.jsx("button",{onClick:Ae,className:"rounded-lg border border-[var(--tab-popup-border-strong)] bg-[var(--tab-popup-surface)] px-3 py-2 text-xs font-medium text-[var(--tab-popup-text)] transition-all duration-200 hover:bg-[var(--tab-popup-action-neutral-bg)]",children:"åˆ·æ–°æ–‡ä»¶å¤¹"})]})]}),ne.length>0&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-purple-border)] bg-gradient-to-br from-[var(--tab-popup-section-purple-from)] to-[var(--tab-popup-section-purple-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:"AI æ¨èæ–‡ä»¶å¤¹"}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-purple-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-purple-badge-text)]",children:ne.length})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ne.map(t=>e.jsx("button",{onClick:()=>Ie(t.id),className:"inline-flex items-center rounded-lg bg-[var(--tab-popup-action-neutral-bg)] px-2.5 py-1 text-xs font-medium text-[var(--tab-popup-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)] transition-colors",title:t.path,children:e.jsx("span",{className:"truncate max-w-[240px]",children:t.path.replace(/^Tmakrs\//,"")})},t.id))})]}),e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-emerald-border)] bg-gradient-to-br from-[var(--tab-popup-section-emerald-from)] to-[var(--tab-popup-section-emerald-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:"é€‰æ‹©æ–‡ä»¶å¤¹"}),e.jsx("span",{className:"text-xs text-[var(--tab-popup-text-muted)]",children:"ç‚¹å‡»è¿›å…¥"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-[var(--tab-popup-border-strong)] scrollbar-track-transparent",children:e.jsxs("div",{className:"space-y-1",children:[ee.filter(e=>e.parentId===(ae||J)).filter(e=>e.id!==(ae||J)).map(t=>e.jsxs("button",{onClick:()=>Ie(t.id),className:"w-full flex items-center justify-between rounded-lg bg-[var(--tab-popup-action-neutral-bg)] px-3 py-2 text-left text-sm text-[var(--tab-popup-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)] transition-colors",children:[e.jsx("span",{className:"truncate",children:t.title}),e.jsx("span",{className:"text-xs text-[var(--tab-popup-text-muted)]",children:"è¿›å…¥"})]},t.id)),0===ee.filter(e=>e.parentId===(ae||J)).length&&e.jsx("div",{className:"py-4 text-center text-xs text-[var(--tab-popup-text-muted)]",children:"å½“å‰å±‚çº§æ²¡æœ‰å­æ–‡ä»¶å¤¹"})]})})]})]}),i&&e.jsxs("section",{className:"flex items-center gap-3 rounded-xl border border-[var(--tab-popup-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 text-sm text-[var(--tab-popup-text)] shadow-lg",children:[e.jsx(x,{}),e.jsx("p",{children:"AI æ­£åœ¨åˆ†æå½“å‰é¡µé¢ï¼Œè¯·ç¨å€™..."})]}),!Ee&&!i&&0===r.length&&e.jsx("section",{className:"rounded-xl border border-[var(--tab-popup-section-amber-border)] bg-gradient-to-br from-[var(--tab-popup-section-amber-from)] to-[var(--tab-popup-section-amber-to)] p-3.5 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"h-5 w-5 flex-shrink-0 text-[var(--tab-popup-section-amber-icon)] mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--tab-popup-section-amber-title)]",children:"AI æ¨èå·²å…³é—­"}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-section-amber-text)]",children:"è¯·ä»ä¸‹æ–¹æ ‡ç­¾åº“ä¸­é€‰æ‹©æ ‡ç­¾ï¼Œæˆ–åœ¨è®¾ç½®ä¸­å¯ç”¨ AI æ¨èã€‚"})]})]})}),o.length>0&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-blue-border)] bg-gradient-to-br from-[var(--tab-popup-section-blue-from)] to-[var(--tab-popup-section-blue-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--tab-popup-text)]",children:"å·²é€‰æ‹©æ ‡ç­¾"}),e.jsx("span",{className:"text-[10px] text-[var(--tab-popup-text-muted)]",children:"ç‚¹å‡»æ ‡ç­¾å¯å–æ¶ˆé€‰æ‹©ã€‚"})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-blue-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-blue-badge-text)]",children:o.length})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.map(t=>e.jsx("button",{onClick:()=>$(t),title:"ç‚¹å‡»ç§»é™¤æ ‡ç­¾",className:w(Me),children:e.jsx("span",{className:"truncate max-w-[120px]",children:t})},t))})]}),a&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!H),className:"flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 "+(H?"bg-[var(--tab-popup-action-emerald-bg)] text-[var(--tab-popup-action-emerald-text)] hover:bg-[var(--tab-popup-action-emerald-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:H?"å…¬å¼€ï¼ˆç‚¹å‡»åˆ‡æ¢ä¸ºéšç§ï¼‰":"éšç§ï¼ˆç‚¹å‡»åˆ‡æ¢ä¸ºå…¬å¼€ï¼‰",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:H?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("button",{type:"button",onClick:()=>{U(!!a?.thumbnail&&!P)},disabled:!a.thumbnail,className:`flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 ${P?"bg-[var(--tab-popup-action-amber-bg)] text-[var(--tab-popup-action-amber-text)] hover:bg-[var(--tab-popup-action-amber-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"} ${a.thumbnail?"":"cursor-not-allowed opacity-40"}`,title:P?"åŒ…å«å°é¢å›¾ï¼ˆç‚¹å‡»å–æ¶ˆï¼‰":"ä¸åŒ…å«å°é¢å›¾ï¼ˆç‚¹å‡»æ·»åŠ ï¼‰",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{type:"button",onClick:()=>R(!K),className:"flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 "+(K?"bg-[var(--tab-popup-action-purple-bg)] text-[var(--tab-popup-action-purple-text)] hover:bg-[var(--tab-popup-action-purple-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:K?"åˆ›å»ºå¿«ç…§ï¼ˆç‚¹å‡»å–æ¶ˆï¼‰":"ä¸åˆ›å»ºå¿«ç…§ï¼ˆç‚¹å‡»åˆ›å»ºï¼‰",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("button",{type:"button",onClick:()=>Ce(!ke),className:"flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 "+(ke?"bg-[var(--tab-popup-action-blue-bg)] text-[var(--tab-popup-action-blue-text)] hover:bg-[var(--tab-popup-action-blue-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:ke?"ä¿®æ”¹æ ‡é¢˜ï¼ˆç‚¹å‡»æ”¶èµ·ï¼‰":"ä¿®æ”¹æ ‡é¢˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>Le(!Se),className:"flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 "+(Se?"bg-[var(--tab-popup-action-blue-bg)] text-[var(--tab-popup-action-blue-text)] hover:bg-[var(--tab-popup-action-blue-bg-hover)]":"bg-[var(--tab-popup-action-neutral-bg)] text-[var(--tab-popup-action-neutral-text)] hover:bg-[var(--tab-popup-action-neutral-bg-hover)]"),title:Se?"ä¿®æ”¹æè¿°ï¼ˆç‚¹å‡»æ”¶èµ·ï¼‰":"ä¿®æ”¹æè¿°ï¼ˆç‚¹å‡»å±•å¼€ï¼‰",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})})})]}),e.jsxs("div",{className:"mb-2.5 space-y-2",children:[ke&&e.jsxs("div",{className:"flex gap-2 animate-in slide-in-from-top-2 fade-in duration-200",children:[e.jsx("input",{type:"text",value:ve,onChange:e=>he(e.target.value),onKeyDown:e=>{"Enter"===e.key&&ze()},placeholder:"è¾“å…¥è‡ªå®šä¹‰æ ‡é¢˜åå›è½¦æˆ–ç‚¹å‡»åº”ç”¨",className:"flex-1 rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-2 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)] focus:border-[var(--tab-popup-input-focus-border)]",autoFocus:!0}),e.jsx("button",{onClick:ze,disabled:!ve.trim()||!a,className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-2 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:"åº”ç”¨"})]}),Se&&e.jsxs("div",{className:"flex gap-2 animate-in slide-in-from-top-2 fade-in duration-200",children:[e.jsx("textarea",{value:ge,onChange:e=>fe(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&_e()},placeholder:"è¾“å…¥è‡ªå®šä¹‰æè¿°å Ctrl+Enter æˆ–ç‚¹å‡»åº”ç”¨",rows:2,className:"flex-1 rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-2 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)] focus:border-[var(--tab-popup-input-focus-border)] resize-none",autoFocus:!0}),e.jsx("button",{onClick:_e,disabled:!a,className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-2 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:"åº”ç”¨"})]})]}),e.jsx(S,{title:a.title,url:a.url,description:a.description,thumbnail:P?a.thumbnail:void 0,thumbnails:P?a.thumbnails:void 0,favicon:a.favicon,onThumbnailChange:e=>{F({...a,thumbnail:e})}})]}),"bookmark"===Ne&&r.length>0&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-purple-border)] bg-gradient-to-br from-[var(--tab-popup-section-purple-from)] to-[var(--tab-popup-section-purple-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2.5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--tab-popup-text)]",children:"AI æ¨è"}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-text-muted)]",children:"æ ¹æ®é¡µé¢å†…å®¹å®æ—¶ç”Ÿæˆï¼Œç‚¹å‡»å¯å¿«é€Ÿé€‰æ‹©ã€‚"})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-purple-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-purple-badge-text)]",children:r.length})]}),e.jsx(C,{tags:r,selectedTags:o,onToggle:$,theme:Me})]}),"bookmark"===Ne&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-emerald-border)] bg-gradient-to-br from-[var(--tab-popup-section-emerald-from)] to-[var(--tab-popup-section-emerald-to)] p-3.5 shadow-lg",children:[e.jsxs("div",{className:"mb-2.5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--tab-popup-text)]",children:[e.jsx("svg",{className:"h-4 w-4 text-[var(--tab-popup-section-emerald-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"æ ‡ç­¾åº“"]}),e.jsx("p",{className:"mt-1 text-xs text-[var(--tab-popup-text-muted)]",children:"ä¸ä½ çš„å†å²æ ‡ç­¾æ•°æ®åŒæ­¥ï¼Œç‚¹é€‰å³å¯åŠ å…¥ã€‚"})]}),e.jsx("span",{className:"rounded-full bg-[var(--tab-popup-section-emerald-badge-bg)] px-2 py-0.5 text-xs font-medium text-[var(--tab-popup-section-emerald-badge-text)]",children:s.length})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-[var(--tab-popup-border-strong)] scrollbar-track-transparent",children:0===s.length?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx("p",{className:"text-xs text-[var(--tab-popup-text-muted)]",children:n?"åŠ è½½ä¸­...":"æš‚æ— æ ‡ç­¾"})}):e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.sort((e,t)=>t.count-e.count).map(t=>{const a=o.includes(t.name);return e.jsxs("button",{onClick:()=>$(t.name),className:`inline-flex items-center rounded-lg px-2.5 py-1 text-xs font-medium transition-all duration-200 active:scale-95 ${k(Me,a)}`,children:["bw"!==Me&&e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 flex-shrink-0 rounded-full",style:{backgroundColor:t.color||"var(--tab-message-success-icon)"}}),e.jsx("span",{className:"truncate max-w-[110px]",children:t.name}),t.count>0&&e.jsxs("span",{className:"ml-1 text-[10px] opacity-60",children:["(",t.count,")"]})]},t.id)})})})]}),null!==q&&e.jsxs("section",{className:"rounded-xl border border-[var(--tab-popup-section-gray-border)] bg-[var(--tab-popup-section-gray-bg)] p-2.5 text-xs text-[var(--tab-popup-text-muted)] shadow-sm",children:["æœ€è¿‘ä¸€æ¬¡ä¿å­˜è€—æ—¶ ",(q/1e3).toFixed(2),"s"]})]}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-20 px-3 pt-2 pb-2.5 bg-[var(--tab-popup-footer-bg)] border-t border-[var(--tab-popup-footer-border)] shadow-sm rounded-t-2xl",children:"bookmark"!==Ne?null:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 flex-shrink-0 text-[var(--tab-popup-text-muted)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),e.jsx("input",{type:"text",value:ue,onChange:e=>me(e.target.value),onKeyPress:e=>{"Enter"===e.key&&Be()},placeholder:"è¾“å…¥æ ‡ç­¾åå¹¶å›è½¦æ·»åŠ ",className:"flex-1 rounded-xl border border-[var(--tab-popup-input-border)] bg-[var(--tab-popup-input-bg)] px-3 py-1.5 text-sm text-[var(--tab-popup-input-text)] placeholder:text-[var(--tab-popup-input-placeholder)] focus:outline-none focus:ring-2 focus:ring-[var(--tab-popup-input-focus-ring)] focus:border-[var(--tab-popup-input-focus-border)]"}),e.jsx("button",{onClick:Be,disabled:!ue.trim(),className:"rounded-xl bg-gradient-to-r from-[var(--tab-popup-primary-from)] to-[var(--tab-popup-primary-via)] px-4 py-1.5 text-sm font-medium text-[var(--tab-popup-primary-text)] shadow-sm transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-40 active:scale-95",children:"æ·»åŠ "})]})})]}),g&&g.needsDialog&&e.jsx(M,{bookmark:g,newTags:o,onUpdateTags:async e=>{g.id&&await X(g.id,e)},onUpdateDescription:async e=>{g.id&&await G(g.id,e)},onCreateSnapshot:async()=>{g.id&&await Y(g.id)},onCancel:()=>O(null)})]})}const _=document.getElementById("root");_&&l.createRoot(_).render(e.jsx(i.StrictMode,{children:e.jsx(z,{})}));
