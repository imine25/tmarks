const e=[{code:"zh_CN",name:"简体中文",nativeName:"简体中文"},{code:"en",name:"English",nativeName:"English"}],t="tmarks_language";let a=null;const n={};function i(){try{if("undefined"!=typeof chrome&&chrome.i18n){if(chrome.i18n.getUILanguage().startsWith("zh"))return"zh_CN"}if(navigator.language.startsWith("zh"))return"zh_CN"}catch{}return"en"}function o(){return a||i()}async function s(e){a=e;try{"undefined"!=typeof chrome&&chrome.storage&&await chrome.storage.local.set({[t]:e})}catch{}delete n[e]}const r=function(e,t){const a=o(),i=n[a];if(i&&i[e]){let a=i[e].message;const n=i[e];if(t){const e=Array.isArray(t)?t:[t];if(n.placeholders){Object.keys(n.placeholders).forEach(t=>{const i=n.placeholders[t].content.match(/^\$(\d+)$/);if(i){const n=parseInt(i[1],10)-1;n>=0&&n<e.length&&(a=a.replace(new RegExp(`\\$${t}\\$`,"gi"),e[n]))}})}else e.forEach((e,t)=>{a=a.replace(new RegExp(`\\$${t+1}`,"g"),e)})}return a}try{if("undefined"!=typeof chrome&&chrome.i18n){const a=chrome.i18n.getMessage(e,t);if(a)return a}}catch{}return e};function c(){return o().startsWith("zh")}async function p(){const e=await async function(){if(a)return a;try{if("undefined"!=typeof chrome&&chrome.storage){const e=await chrome.storage.local.get(t);if(e[t])return a=e[t],a}}catch{}return a=i(),a}();await async function(e){if(n[e])return n[e];try{if("undefined"!=typeof chrome&&chrome.runtime){const t=chrome.runtime.getURL(`_locales/${e}/messages.json`),a=await fetch(t);if(a.ok){const t=await a.json();return n[e]=t,t}}}catch{}return{}}(e)}const l={provider:"openai",apiKeys:{},apiUrls:{},model:"gpt-4o",enableCustomPrompt:!1,customPrompt:void 0},f={apiUrl:"",apiKey:""},m={theme:"auto",themeStyle:"default",autoSync:!0,syncInterval:24,maxSuggestedTags:5,defaultVisibility:"public",enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1,tagTheme:"classic"},h=()=>({aiConfig:{provider:l.provider,apiKeys:{...l.apiKeys},apiUrls:{...l.apiUrls},model:l.model,enableCustomPrompt:l.enableCustomPrompt,customPrompt:l.customPrompt,savedConnections:{}},bookmarkSite:{...f},preferences:{...m}});class g{static STORAGE_KEY="config";static configCache=null;static initialized=!1;static cloneSavedConnections(e){const t={};return e?(Object.entries(e).forEach(([e,a])=>{Array.isArray(a)&&(t[e]=a.map(e=>({...e})))}),t):t}static mergeWithDefaults(e){const t=h();return e?{aiConfig:{provider:e.aiConfig?.provider||t.aiConfig.provider,apiKeys:{...t.aiConfig.apiKeys,...e.aiConfig?.apiKeys||{}},apiUrls:{...t.aiConfig.apiUrls,...e.aiConfig?.apiUrls||{}},model:e.aiConfig?.model??t.aiConfig.model,customPrompt:e.aiConfig?.customPrompt??t.aiConfig.customPrompt,enableCustomPrompt:e.aiConfig?.enableCustomPrompt??t.aiConfig.enableCustomPrompt,savedConnections:{...t.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}}},bookmarkSite:{apiUrl:e.bookmarkSite?.apiUrl??t.bookmarkSite.apiUrl,apiKey:e.bookmarkSite?.apiKey??t.bookmarkSite.apiKey},preferences:{theme:e.preferences?.theme??t.preferences.theme,themeStyle:e.preferences?.themeStyle??t.preferences.themeStyle,autoSync:e.preferences?.autoSync??t.preferences.autoSync,syncInterval:e.preferences?.syncInterval??t.preferences.syncInterval,maxSuggestedTags:e.preferences?.maxSuggestedTags??t.preferences.maxSuggestedTags,defaultVisibility:e.preferences?.defaultVisibility??t.preferences.defaultVisibility,enableAI:e.preferences?.enableAI??t.preferences.enableAI,defaultIncludeThumbnail:e.preferences?.defaultIncludeThumbnail??t.preferences.defaultIncludeThumbnail,defaultCreateSnapshot:e.preferences?.defaultCreateSnapshot??t.preferences.defaultCreateSnapshot,tagTheme:e.preferences?.tagTheme??t.preferences.tagTheme,newtabFolderRecommendCount:e.preferences?.newtabFolderRecommendCount??t.preferences.newtabFolderRecommendCount,enableNewtabAI:e.preferences?.enableNewtabAI??t.preferences.enableNewtabAI,enableNewtabFolderPrompt:e.preferences?.enableNewtabFolderPrompt??t.preferences.enableNewtabFolderPrompt,newtabFolderPrompt:e.preferences?.newtabFolderPrompt??t.preferences.newtabFolderPrompt}}:t}static ensureInitialized(){this.initialized||(chrome.storage.onChanged.addListener((e,t)=>{if("local"!==t)return;const a=e[this.STORAGE_KEY];a&&(this.configCache=this.mergeWithDefaults(a.newValue))}),this.initialized=!0)}static async loadConfig(){if(this.ensureInitialized(),this.configCache)return this.configCache;try{const e=await chrome.storage.local.get([this.STORAGE_KEY]),t=this.mergeWithDefaults(e[this.STORAGE_KEY]);return this.configCache=t,t}catch(e){const t=h();return this.configCache=t,t}}static async saveConfig(e){try{const t=await this.loadConfig();let a;a=Boolean(e.aiConfig&&Object.prototype.hasOwnProperty.call(e.aiConfig,"savedConnections"))?this.cloneSavedConnections(e.aiConfig?.savedConnections):this.cloneSavedConnections({...t.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}});const{savedConnections:n,...i}=e.aiConfig||{},o={...t,...e,aiConfig:{...t.aiConfig,...i,savedConnections:a},bookmarkSite:{...t.bookmarkSite,...e.bookmarkSite||{}},preferences:{...t.preferences,...e.preferences||{}}};await chrome.storage.local.set({[this.STORAGE_KEY]:o}),this.configCache=this.mergeWithDefaults(o)}catch(t){throw t}}static async getAIApiKey(){const e=await this.loadConfig(),t=e.aiConfig.provider;return e.aiConfig.apiKeys[t]}static async setAIApiKey(e,t){const a=await this.loadConfig();await this.saveConfig({aiConfig:{...a.aiConfig,apiKeys:{...a.aiConfig.apiKeys,[e]:t}}})}static async getBookmarkSiteApiKey(){return(await this.loadConfig()).bookmarkSite.apiKey}static async getBookmarkSiteApiUrl(){return(await this.loadConfig()).bookmarkSite.apiUrl}static async getTMarksConfig(){const e=await this.loadConfig();return{bookmarkApiUrl:e.bookmarkSite.apiUrl,bookmarkApiKey:e.bookmarkSite.apiKey}}static async clear(){await chrome.storage.local.clear(),this.configCache=null}}const u={DEFAULT_BASE_URL:"https://tmarks.669696.xyz",DEFAULT_API_BASE:"https://tmarks.669696.xyz/api"};function d(e){const t=(e||u.DEFAULT_BASE_URL).replace(/\/$/,"");return{BASE_URL:t,API_BASE:`${t}/api`,WEB_APP:`${t}/`,TAB_GROUPS:`${t}/tab`}}function C(e){if(!e)return u.DEFAULT_API_BASE;const t=e.trim().replace(/\/+$/,"");return t.endsWith("/api")?t:`${t}/api`}const y={OPENAI:"https://api.openai.com/v1",CLAUDE:"https://api.anthropic.com/v1",DEEPSEEK:"https://api.deepseek.com/v1",ZHIPU:"https://open.bigmodel.cn/api/paas/v4",MODELSCOPE:"https://api-inference.modelscope.cn/v1",SILICONFLOW:"https://api.siliconflow.cn/v1",IFLOW:"https://apis.iflow.cn/v1"},b={OPENAI:"https://platform.openai.com/api-keys",CLAUDE:"https://console.anthropic.com/",DEEPSEEK:"https://platform.deepseek.com/api_keys",ZHIPU:"https://open.bigmodel.cn/usercenter/apikeys",MODELSCOPE:"https://www.modelscope.cn/my/myaccesstoken",SILICONFLOW:"https://cloud.siliconflow.cn/account/ak",IFLOW:"https://console.xfyun.cn/services/iat"},S={GOOGLE_FAVICON:"https://www.google.com/s2/favicons"},E={DEFAULT_PAGE_SIZE:100,MAX_PAGES:100};export{b as A,S as E,E as P,g as S,u as T,p as a,y as b,o as c,e as d,d as g,c as i,C as n,s,r as t};
