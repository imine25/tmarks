# æµè§ˆå™¨æ–°æ ‡ç­¾é¡µï¼ˆNew Tabï¼‰åŠŸèƒ½æ–¹æ¡ˆ

## ç›®æ ‡

å°†æµè§ˆå™¨æ‰©å±•æ‰©å±•ä¸ºé»˜è®¤çš„æ–°æ ‡ç­¾é¡µï¼Œç”¨æˆ·æ‰“å¼€æ–°æ ‡ç­¾æ—¶è‡ªåŠ¨æ˜¾ç¤ºæˆ‘ä»¬çš„ç•Œé¢ã€‚

---

## æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ Aï¼šç‹¬ç«‹çš„æ–°æ ‡ç­¾é¡µï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹ï¼š**
- æ–°æ ‡ç­¾é¡µæœ‰ç‹¬ç«‹çš„ç•Œé¢å’ŒåŠŸèƒ½
- ä¸å½±å“ç°æœ‰çš„ popup åŠŸèƒ½
- ç”¨æˆ·å¯ä»¥é€‰æ‹©æ˜¯å¦å¯ç”¨

**ä¼˜ç‚¹ï¼š**
- åŠŸèƒ½åˆ†ç¦»ï¼Œäº’ä¸å¹²æ‰°
- å¯ä»¥è®¾è®¡æ›´ä¸°å¯Œçš„ç•Œé¢ï¼ˆå…¨å±ï¼‰
- ç”¨æˆ·ä½“éªŒæ›´å¥½

**ç¼ºç‚¹ï¼š**
- éœ€è¦é¢å¤–å¼€å‘ä¸€ä¸ªé¡µé¢

### æ–¹æ¡ˆ Bï¼šå¤ç”¨ Popup ç•Œé¢

**ç‰¹ç‚¹ï¼š**
- æ–°æ ‡ç­¾é¡µç›´æ¥ä½¿ç”¨ popup çš„ç•Œé¢
- ä»£ç å¤ç”¨ï¼Œå¼€å‘å¿«

**ä¼˜ç‚¹ï¼š**
- å¼€å‘æˆæœ¬ä½
- ç»´æŠ¤ç®€å•

**ç¼ºç‚¹ï¼š**
- ç•Œé¢å¯èƒ½ä¸é€‚åˆå…¨å±æ˜¾ç¤º
- åŠŸèƒ½å—é™

---

## æ¨èå®ç°ï¼šæ–¹æ¡ˆ A

### 1. æ–°æ ‡ç­¾é¡µåŠŸèƒ½è®¾è®¡

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
1. **å¿«é€Ÿä¹¦ç­¾è®¿é—®** - æ˜¾ç¤ºæœ€è¿‘/å¸¸ç”¨ä¹¦ç­¾
2. **æ ‡ç­¾ç»„ç®¡ç†** - å¿«é€Ÿæ‰“å¼€æ ‡ç­¾ç»„
3. **æœç´¢ä¹¦ç­¾** - å…¨å±€æœç´¢
4. **å¿«é€Ÿæ”¶çº³** - ä¸€é”®æ”¶çº³å½“å‰æ‰“å¼€çš„æ ‡ç­¾
5. **ç»Ÿè®¡é¢æ¿** - æ˜¾ç¤ºä¹¦ç­¾ç»Ÿè®¡
6. **å¿«æ·æ“ä½œ** - å¿«é€Ÿæ·»åŠ ä¹¦ç­¾ã€åˆ›å»ºæ ‡ç­¾ç»„

**ç•Œé¢å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœç´¢æ¡†                          [è®¾ç½®] [ç”¨æˆ·]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ“Š ç»Ÿè®¡å¡ç‰‡                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ä¹¦ç­¾æ•°â”‚ â”‚æ ‡ç­¾ç»„â”‚ â”‚ä»Šæ—¥æ–°â”‚ â”‚æ”¶è—æ•°â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                     â”‚
â”‚  â­ å¸¸ç”¨ä¹¦ç­¾                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ ä¹¦ç­¾1  â”‚ â”‚ ä¹¦ç­¾2  â”‚ â”‚ ä¹¦ç­¾3  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                     â”‚
â”‚  ğŸ“ æ ‡ç­¾ç»„                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ å·¥ä½œç›¸å…³ (12)  â”‚ â”‚ å­¦ä¹ èµ„æ–™ (8)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                     â”‚
â”‚  ğŸš€ å¿«æ·æ“ä½œ                                         â”‚
â”‚  [+ æ·»åŠ ä¹¦ç­¾] [ğŸ“¥ æ”¶çº³æ ‡ç­¾] [ğŸ”„ åŒæ­¥]              â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–°æ ‡ç­¾é¡µæ–‡ä»¶

**1. åˆ›å»º HTML æ–‡ä»¶**

`tab/src/newtab/index.html`

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–°æ ‡ç­¾é¡µ - AI ä¹¦ç­¾åŠ©æ‰‹</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./index.tsx"></script>
  </body>
</html>
```

**2. åˆ›å»ºå…¥å£æ–‡ä»¶**

`tab/src/newtab/index.tsx`

```typescript
import React from 'react'
import ReactDOM from 'react-dom/client'
import { NewTabPage } from './NewTabPage'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <NewTabPage />
  </React.StrictMode>
)
```

**3. åˆ›å»ºæ ·å¼æ–‡ä»¶**

`tab/src/newtab/index.css`

```css
@import '../popup/index.css';

body {
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

#root {
  width: 100%;
  height: 100%;
}
```

**4. åˆ›å»ºä¸»ç»„ä»¶**

`tab/src/newtab/NewTabPage.tsx`

```typescript
import { useEffect, useState } from 'react'
import { useAppStore } from '@/lib/store'
import { QuickStats } from './components/QuickStats'
import { RecentBookmarks } from './components/RecentBookmarks'
import { TabGroups } from './components/TabGroups'
import { QuickActions } from './components/QuickActions'
import { SearchBar } from './components/SearchBar'

export function NewTabPage() {
  const { loadConfig, config } = useAppStore()
  const [searchQuery, setSearchQuery] = useState('')

  useEffect(() => {
    loadConfig()
  }, [])

  if (!config) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-base-100 to-base-200">
      {/* é¡¶éƒ¨æ  */}
      <header className="sticky top-0 z-10 bg-base-100/80 backdrop-blur-sm border-b border-base-300">
        <div className="container mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <h1 className="text-2xl font-bold">AI ä¹¦ç­¾åŠ©æ‰‹</h1>
            </div>
            <div className="flex items-center gap-4">
              <button className="btn btn-ghost btn-sm">è®¾ç½®</button>
              <button className="btn btn-ghost btn-sm">ç”¨æˆ·</button>
            </div>
          </div>
        </div>
      </header>

      {/* ä¸»å†…å®¹åŒº */}
      <main className="container mx-auto px-6 py-8">
        {/* æœç´¢æ¡† */}
        <SearchBar value={searchQuery} onChange={setSearchQuery} />

        {/* ç»Ÿè®¡å¡ç‰‡ */}
        <QuickStats />

        {/* å¸¸ç”¨ä¹¦ç­¾ */}
        <RecentBookmarks searchQuery={searchQuery} />

        {/* æ ‡ç­¾ç»„ */}
        <TabGroups searchQuery={searchQuery} />

        {/* å¿«æ·æ“ä½œ */}
        <QuickActions />
      </main>
    </div>
  )
}
```

### ç¬¬äºŒæ­¥ï¼šæ›´æ–° manifest.json

```json
{
  "manifest_version": 3,
  "name": "AI ä¹¦ç­¾åŠ©æ‰‹",
  "version": "1.0.0",
  "description": "æ™ºèƒ½æ ‡ç­¾æ¨èçš„æµè§ˆå™¨ä¹¦ç­¾ç®¡ç†å·¥å…·",
  
  "chrome_url_overrides": {
    "newtab": "src/newtab/index.html"
  },
  
  "icons": {
    "16": "icons/icon-16.png",
    "48": "icons/icon-48.png",
    "128": "icons/icon-128.png"
  },
  
  "action": {
    "default_title": "AI ä¹¦ç­¾åŠ©æ‰‹",
    "default_popup": "src/popup/index.html",
    "default_icon": {
      "16": "icons/icon-16.png",
      "48": "icons/icon-48.png",
      "128": "icons/icon-128.png"
    }
  },
  
  "background": {
    "service_worker": "src/background/index.ts",
    "type": "module"
  },
  
  "permissions": [
    "storage",
    "activeTab",
    "tabs",
    "scripting",
    "notifications"
  ],
  
  "host_permissions": [
    "https://api.openai.com/*",
    "https://api.anthropic.com/*",
    "https://*/*"
  ],
  
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["src/content/index.ts"]
    }
  ],
  
  "options_ui": {
    "page": "src/options/index.html",
    "open_in_tab": true
  },
  
  "content_security_policy": {
    "extension_pages": "script-src 'self'; object-src 'self'"
  }
}
```

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°æ„å»ºé…ç½®

`tab/vite.config.ts` - æ·»åŠ  newtab å…¥å£

```typescript
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        popup: resolve(__dirname, 'src/popup/index.html'),
        options: resolve(__dirname, 'src/options/index.html'),
        newtab: resolve(__dirname, 'src/newtab/index.html'), // æ–°å¢
        background: resolve(__dirname, 'src/background/index.ts'),
        content: resolve(__dirname, 'src/content/index.ts'),
      },
      output: {
        entryFileNames: 'src/[name]/index.js',
        chunkFileNames: 'assets/[name]-[hash].js',
        assetFileNames: 'assets/[name]-[hash].[ext]'
      }
    }
  }
})
```

---

## ç»„ä»¶è®¾è®¡

### 1. QuickStats - ç»Ÿè®¡å¡ç‰‡

```typescript
// tab/src/newtab/components/QuickStats.tsx
export function QuickStats() {
  const [stats, setStats] = useState({
    totalBookmarks: 0,
    totalGroups: 0,
    todayAdded: 0,
    favorites: 0
  })

  useEffect(() => {
    // ä» API æˆ–æœ¬åœ°å­˜å‚¨åŠ è½½ç»Ÿè®¡æ•°æ®
    loadStats()
  }, [])

  return (
    <div className="grid grid-cols-4 gap-4 mb-8">
      <StatCard icon="ğŸ“š" label="ä¹¦ç­¾æ€»æ•°" value={stats.totalBookmarks} />
      <StatCard icon="ğŸ“" label="æ ‡ç­¾ç»„" value={stats.totalGroups} />
      <StatCard icon="âœ¨" label="ä»Šæ—¥æ–°å¢" value={stats.todayAdded} />
      <StatCard icon="â­" label="æ”¶è—æ•°" value={stats.favorites} />
    </div>
  )
}
```

### 2. RecentBookmarks - æœ€è¿‘ä¹¦ç­¾

```typescript
// tab/src/newtab/components/RecentBookmarks.tsx
export function RecentBookmarks({ searchQuery }: { searchQuery: string }) {
  const [bookmarks, setBookmarks] = useState([])

  useEffect(() => {
    // åŠ è½½æœ€è¿‘ä¹¦ç­¾
    loadRecentBookmarks(searchQuery)
  }, [searchQuery])

  return (
    <section className="mb-8">
      <h2 className="text-xl font-bold mb-4">â­ å¸¸ç”¨ä¹¦ç­¾</h2>
      <div className="grid grid-cols-6 gap-4">
        {bookmarks.map(bookmark => (
          <BookmarkCard key={bookmark.id} bookmark={bookmark} />
        ))}
      </div>
    </section>
  )
}
```

### 3. TabGroups - æ ‡ç­¾ç»„

```typescript
// tab/src/newtab/components/TabGroups.tsx
export function TabGroups({ searchQuery }: { searchQuery: string }) {
  const [groups, setGroups] = useState([])

  useEffect(() => {
    // åŠ è½½æ ‡ç­¾ç»„
    loadTabGroups(searchQuery)
  }, [searchQuery])

  return (
    <section className="mb-8">
      <h2 className="text-xl font-bold mb-4">ğŸ“ æ ‡ç­¾ç»„</h2>
      <div className="grid grid-cols-3 gap-4">
        {groups.map(group => (
          <TabGroupCard key={group.id} group={group} />
        ))}
      </div>
    </section>
  )
}
```

### 4. QuickActions - å¿«æ·æ“ä½œ

```typescript
// tab/src/newtab/components/QuickActions.tsx
export function QuickActions() {
  return (
    <section className="fixed bottom-8 right-8">
      <div className="flex gap-4">
        <button className="btn btn-primary btn-lg">
          + æ·»åŠ ä¹¦ç­¾
        </button>
        <button className="btn btn-secondary btn-lg">
          ğŸ“¥ æ”¶çº³æ ‡ç­¾
        </button>
        <button className="btn btn-ghost btn-lg">
          ğŸ”„ åŒæ­¥
        </button>
      </div>
    </section>
  )
}
```

---

## ç”¨æˆ·è®¾ç½®

### å…è®¸ç”¨æˆ·é€‰æ‹©æ˜¯å¦å¯ç”¨æ–°æ ‡ç­¾é¡µ

åœ¨ Options é¡µé¢æ·»åŠ å¼€å…³ï¼š

```typescript
// tab/src/options/Options.tsx
const [enableNewTab, setEnableNewTab] = useState(true)

// ä¿å­˜è®¾ç½®
const handleSaveNewTabSetting = async () => {
  await chrome.storage.local.set({ enableNewTab })
  
  if (enableNewTab) {
    // å¯ç”¨æ–°æ ‡ç­¾é¡µ
    await chrome.runtime.sendMessage({ action: 'enableNewTab' })
  } else {
    // ç¦ç”¨æ–°æ ‡ç­¾é¡µï¼ˆæ¢å¤é»˜è®¤ï¼‰
    await chrome.runtime.sendMessage({ action: 'disableNewTab' })
  }
}
```

**æ³¨æ„ï¼š** Chrome æ‰©å±•ä¸€æ—¦è®¾ç½®äº† `chrome_url_overrides.newtab`ï¼Œå°±ä¼šè¦†ç›–é»˜è®¤æ–°æ ‡ç­¾é¡µã€‚å¦‚æœè¦è®©ç”¨æˆ·é€‰æ‹©ï¼Œéœ€è¦ï¼š
1. æä¾›ä¸¤ä¸ªç‰ˆæœ¬çš„æ‰©å±•ï¼ˆä¸€ä¸ªæœ‰æ–°æ ‡ç­¾é¡µï¼Œä¸€ä¸ªæ²¡æœ‰ï¼‰
2. æˆ–è€…åœ¨æ–°æ ‡ç­¾é¡µä¸­æä¾›"æ¢å¤é»˜è®¤"çš„é“¾æ¥

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ‡’åŠ è½½

```typescript
// ä½¿ç”¨ React.lazy æ‡’åŠ è½½ç»„ä»¶
const RecentBookmarks = lazy(() => import('./components/RecentBookmarks'))
const TabGroups = lazy(() => import('./components/TabGroups'))
```

### 2. ç¼“å­˜

```typescript
// ç¼“å­˜ä¹¦ç­¾æ•°æ®ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
const CACHE_KEY = 'newtab_bookmarks_cache'
const CACHE_DURATION = 5 * 60 * 1000 // 5 åˆ†é’Ÿ

const loadBookmarksWithCache = async () => {
  const cached = await chrome.storage.local.get(CACHE_KEY)
  if (cached[CACHE_KEY] && Date.now() - cached.timestamp < CACHE_DURATION) {
    return cached[CACHE_KEY]
  }
  
  const bookmarks = await fetchBookmarks()
  await chrome.storage.local.set({
    [CACHE_KEY]: bookmarks,
    timestamp: Date.now()
  })
  return bookmarks
}
```

### 3. è™šæ‹Ÿæ»šåŠ¨

å¯¹äºå¤§é‡ä¹¦ç­¾ï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š

```typescript
import { FixedSizeList } from 'react-window'

<FixedSizeList
  height={600}
  itemCount={bookmarks.length}
  itemSize={80}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>
      <BookmarkCard bookmark={bookmarks[index]} />
    </div>
  )}
</FixedSizeList>
```

---

## å…¼å®¹æ€§

| æµè§ˆå™¨ | æ”¯æŒ | é…ç½®å­—æ®µ |
|--------|------|---------|
| Chrome | âœ… | `chrome_url_overrides.newtab` |
| Edge | âœ… | `chrome_url_overrides.newtab` |
| Firefox | âœ… | `chrome_url_overrides.newtab` |
| Opera | âœ… | `chrome_url_overrides.newtab` |
| Safari | âŒ | ä¸æ”¯æŒ |

---

## æ€»ç»“

**æ¨èæ–¹æ¡ˆï¼š**
1. åˆ›å»ºç‹¬ç«‹çš„æ–°æ ‡ç­¾é¡µï¼ˆæ–¹æ¡ˆ Aï¼‰
2. æä¾›ä¸°å¯Œçš„åŠŸèƒ½ï¼šç»Ÿè®¡ã€æœç´¢ã€å¿«æ·æ“ä½œ
3. ä¼˜åŒ–æ€§èƒ½ï¼šæ‡’åŠ è½½ã€ç¼“å­˜ã€è™šæ‹Ÿæ»šåŠ¨
4. åœ¨ Options ä¸­æä¾›å¼€å…³ï¼ˆå¯é€‰ï¼‰

**å¼€å‘ä¼˜å…ˆçº§ï¼š**
1. åŸºç¡€æ¡†æ¶å’Œå¸ƒå±€
2. ç»Ÿè®¡å¡ç‰‡
3. æœ€è¿‘ä¹¦ç­¾å±•ç¤º
4. æ ‡ç­¾ç»„å±•ç¤º
5. æœç´¢åŠŸèƒ½
6. å¿«æ·æ“ä½œ

éœ€è¦æˆ‘å¼€å§‹å®ç°å—ï¼Ÿ
